Return-Path: <linux-cifs-owner@vger.kernel.org>
X-Original-To: lists+linux-cifs@lfdr.de
Delivered-To: lists+linux-cifs@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 009E264FAF9
	for <lists+linux-cifs@lfdr.de>; Sat, 17 Dec 2022 17:18:10 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229480AbiLQQSJ (ORCPT <rfc822;lists+linux-cifs@lfdr.de>);
        Sat, 17 Dec 2022 11:18:09 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:41828 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229923AbiLQQSI (ORCPT
        <rfc822;linux-cifs@vger.kernel.org>); Sat, 17 Dec 2022 11:18:08 -0500
Received: from mail-lj1-x231.google.com (mail-lj1-x231.google.com [IPv6:2a00:1450:4864:20::231])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id CA3751115F
        for <linux-cifs@vger.kernel.org>; Sat, 17 Dec 2022 08:18:05 -0800 (PST)
Received: by mail-lj1-x231.google.com with SMTP id g14so5096409ljh.10
        for <linux-cifs@vger.kernel.org>; Sat, 17 Dec 2022 08:18:05 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=cc:to:subject:message-id:date:from:mime-version:from:to:cc:subject
         :date:message-id:reply-to;
        bh=NGee+z15pZB82PEfK3oltO3aU8kbWqr6Bhe7tXQwCwA=;
        b=Js5DpWGIAITiz0aEusNkTFZgmeVuehMIAu+Vaf0kpKw/WC4p1cfW1H5SeWlAtOgxqK
         m/uzZ0G+ZStbzcgGXubQ38VXuKh5rpJc0ClazCYG4EFIOye9RLInyuih2p1vXqZYBKKd
         Mone5rk7mH7NsSE35CFGaQlp7yqh0xCXt2eOTbXGQbIDceM0x5u8DcdOfgz4qE9hh/bB
         c6HtveouW+piPxtpICyPvDSOqoG1asuy36iBePZtt6+qL3nsx1OommA3ILtrK53isu62
         QXsKgcziaUp3eZ2vxZHqrnfN4jI/3T28glQMKqZMuUIEwBSSn50hjkAEz++RRdzekOZy
         FPOw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=cc:to:subject:message-id:date:from:mime-version:x-gm-message-state
         :from:to:cc:subject:date:message-id:reply-to;
        bh=NGee+z15pZB82PEfK3oltO3aU8kbWqr6Bhe7tXQwCwA=;
        b=gquE/lkeu3y8WedclIaOLpnYrqVhgOl/2MbVpcQhhCnMDmgvVNCfCsTlVazofiXkHN
         vahsWgIBrpuAOrNT2X6VRQqLj0yedLgW8RIBOo6wViIPjk3yO1VPwkCVoX452JoV3fv9
         YtrKE5lVgDTx2ct519/uca6t086Qs3UHu9zuDPWIM20qXXtujtU9KOj8gVuZAkvcXik3
         KconBZM6p+2kB/TJMc8+YamGSWKvsrkKjga1ka3gnoCiwYY0G+1uBb6aqqFD9WGMUSWH
         aPSpGHw/TjeG81w2VFItUCs5Mvp05LVWBj6tTfmB2kMXQgwAUscJgHTPTvkcZxw5eeBJ
         1VAQ==
X-Gm-Message-State: AFqh2kqw6jGJWMkHZc5P8bQcahWvCk61zXsftOeX7AX8gSWhBffazHlU
        sEQi8qtTgmvtUdAKvFcQJvMaLefg0LTgNZP0tpixiYVY
X-Google-Smtp-Source: AMrXdXviILGIEZsU8L9MLDCzf0vsfMhXmMhFJglPl9UI4INlxb7zeTrtp5prEuGcTpN5dMs7B1sWllCvHAjRudhbxi0=
X-Received: by 2002:a05:651c:2122:b0:27f:7d3a:d8a3 with SMTP id
 a34-20020a05651c212200b0027f7d3ad8a3mr13909ljq.518.1671293883588; Sat, 17 Dec
 2022 08:18:03 -0800 (PST)
MIME-Version: 1.0
From:   Steve French <smfrench@gmail.com>
Date:   Sat, 17 Dec 2022 10:17:52 -0600
Message-ID: <CAH2r5mue8Ucb2S_rVRMbmfUy-indv-E67+=Hd292uMDu_f_Jag@mail.gmail.com>
Subject: [PATCH[SMB3 client] part 4 of 4 from the DFS/reconnect patch series
To:     CIFS <linux-cifs@vger.kernel.org>
Cc:     Paulo Alcantara <pc@cjr.nz>
Content-Type: multipart/mixed; boundary="0000000000003f406205f0086e5b"
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM,
        RCVD_IN_DNSWL_NONE,SPF_HELO_NONE,SPF_PASS autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-cifs.vger.kernel.org>
X-Mailing-List: linux-cifs@vger.kernel.org

--0000000000003f406205f0086e5b
Content-Type: text/plain; charset="UTF-8"

Last four patches from the recent DFS/reconnect series from Paulo.
(The earlier send to the list bounced).



-- 
Thanks,

Steve

--0000000000003f406205f0086e5b
Content-Type: text/x-patch; charset="US-ASCII"; name="0009-cifs-refresh-root-referrals.patch"
Content-Disposition: attachment; 
	filename="0009-cifs-refresh-root-referrals.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs57bi70>
X-Attachment-Id: f_lbs57bi70

RnJvbSA2MmViOWRkY2Y2MDFhMjIzYzYzOGI0ZTU3M2EzYzc0YjU4ZjVkMmI1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogVHVl
LCAxMyBEZWMgMjAyMiAxMTozMDozMCAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMDkvMTRdIGNpZnM6
IHJlZnJlc2ggcm9vdCByZWZlcnJhbHMKCkFsc28gcmVmcmVzaCBjYWNoZWQgcm9vdCByZWZlcnJh
bHMgc28gdGhlIG90aGVyIGNhY2hlZCByZWZlcnJhbHMgbWF5CmhhdmUgYSBiZXR0ZXIgY2hhbmNl
IHRvIGhhdmUgYSB3b3JraW5nIHJvb3Qgc2VydmVyIHRvIGlzc3VlIHRoZQpyZWZlcnJhbHMgb24u
CgpTaWduZWQtb2ZmLWJ5OiBQYXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIubno+ClNpZ25l
ZC1vZmYtYnk6IFN0ZXZlIEZyZW5jaCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4KLS0tCiBmcy9j
aWZzL2Rmc19jYWNoZS5jIHwgNDAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDIyIGluc2VydGlvbnMoKyksIDE4IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2ZzL2NpZnMvZGZzX2NhY2hlLmMgYi9mcy9jaWZzL2Rmc19jYWNoZS5jCmlu
ZGV4IDk1Y2MzOTUxNDIwZS4uY2I4M2I4NmVhZmU2IDEwMDY0NAotLS0gYS9mcy9jaWZzL2Rmc19j
YWNoZS5jCisrKyBiL2ZzL2NpZnMvZGZzX2NhY2hlLmMKQEAgLTEzNDYsMTQgKzEzNDYsMTUgQEAg
c3RhdGljIHZvaWQgbWFya19mb3JfcmVjb25uZWN0X2lmX25lZWRlZChzdHJ1Y3QgY2lmc190Y29u
ICp0Y29uLCBzdHJ1Y3QgZGZzX2NhY2gKIC8qIFJlZnJlc2ggZGZzIHJlZmVycmFsIG9mIHRjb24g
YW5kIG1hcmsgaXQgZm9yIHJlY29ubmVjdCBpZiBuZWVkZWQgKi8KIHN0YXRpYyBpbnQgX19yZWZy
ZXNoX3Rjb24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwgYm9vbCBm
b3JjZV9yZWZyZXNoKQogeworCXN0cnVjdCBkZnNfY2FjaGVfdGd0X2xpc3QgdGwgPSBERlNfQ0FD
SEVfVEdUX0xJU1RfSU5JVCh0bCk7CiAJc3RydWN0IGNpZnNfc2VzICpzZXMgPSBDSUZTX0RGU19S
T09UX1NFUyh0Y29uLT5zZXMpOwotCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CisJc3RydWN0IGNp
ZnNfdGNvbiAqaXBjID0gc2VzLT50Y29uX2lwYzsKIAlzdHJ1Y3QgZGZzX2luZm8zX3BhcmFtICpy
ZWZzID0gTlVMTDsKLQlpbnQgbnVtcmVmcyA9IDA7CiAJYm9vbCBuZWVkc19yZWZyZXNoID0gZmFs
c2U7Ci0Jc3RydWN0IGRmc19jYWNoZV90Z3RfbGlzdCB0bCA9IERGU19DQUNIRV9UR1RfTElTVF9J
TklUKHRsKTsKLQlpbnQgcmMgPSAwOworCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CiAJdW5zaWdu
ZWQgaW50IHhpZDsKKwlpbnQgbnVtcmVmcyA9IDA7CisJaW50IHJjID0gMDsKIAogCXhpZCA9IGdl
dF94aWQoKTsKIApAQCAtMTM3Miw2ICsxMzczLDE0IEBAIHN0YXRpYyBpbnQgX19yZWZyZXNoX3Rj
b24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwgYm9vbCBmb3JjZV9y
CiAJCWdvdG8gb3V0OwogCX0KIAorCXNwaW5fbG9jaygmaXBjLT50Y19sb2NrKTsKKwlpZiAoc2Vz
LT5zZXNfc3RhdHVzICE9IFNFU19HT09EIHx8IGlwYy0+c3RhdHVzICE9IFRJRF9HT09EKSB7CisJ
CXNwaW5fdW5sb2NrKCZpcGMtPnRjX2xvY2spOworCQljaWZzX2RiZyhGWUksICIlczogc2tpcCBj
YWNoZSByZWZyZXNoIGR1ZSB0byBkaXNjb25uZWN0ZWQgaXBjXG4iLCBfX2Z1bmNfXyk7CisJCWdv
dG8gb3V0OworCX0KKwlzcGluX3VubG9jaygmaXBjLT50Y19sb2NrKTsKKwogCXJjID0gZ2V0X2Rm
c19yZWZlcnJhbCh4aWQsIHNlcywgcGF0aCwgJnJlZnMsICZudW1yZWZzKTsKIAlpZiAoIXJjKSB7
CiAJCS8qIENyZWF0ZSBvciB1cGRhdGUgYSBjYWNoZSBlbnRyeSB3aXRoIHRoZSBuZXcgcmVmZXJy
YWwgKi8KQEAgLTE0NTcsOSArMTQ2Niw5IEBAIGludCBkZnNfY2FjaGVfcmVtb3VudF9mcyhzdHJ1
Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiKQogc3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3Jr
ZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8g
KnNlcnZlcjsKLQlzdHJ1Y3QgY2lmc19zZXMgKnNlczsKIAlzdHJ1Y3QgY2lmc190Y29uICp0Y29u
LCAqbnRjb247CiAJc3RydWN0IGxpc3RfaGVhZCB0Y29uczsKKwlzdHJ1Y3QgY2lmc19zZXMgKnNl
czsKIAogCUlOSVRfTElTVF9IRUFEKCZ0Y29ucyk7CiAKQEAgLTE0NjksMjMgKzE0NzgsMTUgQEAg
c3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCQkJY29udGludWU7CiAKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeShzZXMsICZzZXJ2ZXItPnNt
Yl9zZXNfbGlzdCwgc21iX3Nlc19saXN0KSB7Ci0JCQlzdHJ1Y3QgY2lmc19zZXMgKnJvb3Rfc2Vz
ID0gQ0lGU19ERlNfUk9PVF9TRVMoc2VzKTsKLQotCQkJc3Bpbl9sb2NrKCZyb290X3Nlcy0+c2Vz
X2xvY2spOwotCQkJaWYgKHJvb3Rfc2VzLT5zZXNfc3RhdHVzICE9IFNFU19HT09EKSB7Ci0JCQkJ
c3Bpbl91bmxvY2soJnJvb3Rfc2VzLT5zZXNfbG9jayk7Ci0JCQkJY29udGludWU7CisJCQlpZiAo
c2VzLT50Y29uX2lwYykgeworCQkJCXNlcy0+c2VzX2NvdW50Kys7CisJCQkJbGlzdF9hZGRfdGFp
bCgmc2VzLT50Y29uX2lwYy0+dWxpc3QsICZ0Y29ucyk7CiAJCQl9Ci0JCQlzcGluX3VubG9jaygm
cm9vdF9zZXMtPnNlc19sb2NrKTsKLQogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeSh0Y29uLCAmc2Vz
LT50Y29uX2xpc3QsIHRjb25fbGlzdCkgewotCQkJCXNwaW5fbG9jaygmdGNvbi0+dGNfbG9jayk7
Ci0JCQkJaWYgKCF0Y29uLT5pcGMgJiYgdGNvbi0+c3RhdHVzICE9IFRJRF9ORVcgJiYKLQkJCQkg
ICAgdGNvbi0+c3RhdHVzICE9IFRJRF9ORUVEX1RDT04pIHsKKwkJCQlpZiAoIXRjb24tPmlwYykg
ewogCQkJCQl0Y29uLT50Y19jb3VudCsrOwogCQkJCQlsaXN0X2FkZF90YWlsKCZ0Y29uLT51bGlz
dCwgJnRjb25zKTsKIAkJCQl9Ci0JCQkJc3Bpbl91bmxvY2soJnRjb24tPnRjX2xvY2spOwogCQkJ
fQogCQl9CiAJfQpAQCAtMTUwMSw3ICsxNTAyLDEwIEBAIHN0YXRpYyB2b2lkIHJlZnJlc2hfY2Fj
aGVfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkJCV9fcmVmcmVzaF90Y29uKHNl
cnZlci0+bGVhZl9mdWxscGF0aCArIDEsIHRjb24sIGZhbHNlKTsKIAkJbXV0ZXhfdW5sb2NrKCZz
ZXJ2ZXItPnJlZnBhdGhfbG9jayk7CiAKLQkJY2lmc19wdXRfdGNvbih0Y29uKTsKKwkJaWYgKHRj
b24tPmlwYykKKwkJCWNpZnNfcHV0X3NtYl9zZXModGNvbi0+c2VzKTsKKwkJZWxzZQorCQkJY2lm
c19wdXRfdGNvbih0Y29uKTsKIAl9CiAKIAlzcGluX2xvY2soJmNhY2hlX3R0bF9sb2NrKTsKLS0g
CjIuMzQuMQoK
--0000000000003f406205f0086e5b
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0010-cifs-don-t-block-in-dfs_cache_noreq_update_tgthint.patch"
Content-Disposition: attachment; 
	filename="0010-cifs-don-t-block-in-dfs_cache_noreq_update_tgthint.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs57fqj1>
X-Attachment-Id: f_lbs57fqj1

RnJvbSAwNzVhMGZlNTRlYjljM2Q4OGFkM2I0MTlhNjFhNDYzYThkZjNiMTc4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogRnJp
LCAxNiBEZWMgMjAyMiAyMTo0MTozMSAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMTAvMTRdIGNpZnM6
IGRvbid0IGJsb2NrIGluIGRmc19jYWNoZV9ub3JlcV91cGRhdGVfdGd0aGludCgpCgpBdm9pZCBi
bG9ja2luZyBpbiBkZnNfY2FjaGVfbm9yZXFfdXBkYXRlX3RndGhpbnQoKSB3aGlsZSByZWNvbm5l
Y3RpbmcKc2VydmVycyBvciB0Y29ucyBhcyB0aGUgY2FjaGUgcmVmcmVzaCB3b3JrZXIgb3IgbmV3
IG1vdW50cyBtaWdodAphbHJlYWR5IGJlIHVwZGF0aW5nIHRoZWlyIHRhcmdldHMuCgpNb3ZlIHNv
bWUgbW9yZSBkZnMgcmVsYXRlZCBjb2RlIG91dCBvZiBjb25uZWN0LmMgd2hpbGUgYXQgaXQuCgpT
aWduZWQtb2ZmLWJ5OiBQYXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIubno+ClNpZ25lZC1v
ZmYtYnk6IFN0ZXZlIEZyZW5jaCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4KLS0tCiBmcy9jaWZz
L2Nvbm5lY3QuYyAgIHwgMjY0ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCiBmcy9jaWZzL2Rmcy5jICAgICAgIHwgMjU5ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysKIGZzL2NpZnMvZGZzX2NhY2hlLmMgfCAgMTggKystCiBmcy9j
aWZzL2Rmc19jYWNoZS5oIHwgICAyICstCiA0IGZpbGVzIGNoYW5nZWQsIDI2OSBpbnNlcnRpb25z
KCspLCAyNzQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZnMvY2lmcy9jb25uZWN0LmMgYi9m
cy9jaWZzL2Nvbm5lY3QuYwppbmRleCBkYjNhMmIzYWM0OTcuLjQxMDA5ZWY3ODc4ZiAxMDA2NDQK
LS0tIGEvZnMvY2lmcy9jb25uZWN0LmMKKysrIGIvZnMvY2lmcy9jb25uZWN0LmMKQEAgLTUyOSw5
ICs1MjksNyBAQCBzdGF0aWMgaW50IHJlY29ubmVjdF9kZnNfc2VydmVyKHN0cnVjdCBUQ1BfU2Vy
dmVyX0luZm8gKnNlcnZlcikKIAkJbW9kX2RlbGF5ZWRfd29yayhjaWZzaW9kX3dxLCAmc2VydmVy
LT5yZWNvbm5lY3QsIDApOwogCX0gd2hpbGUgKHNlcnZlci0+dGNwU3RhdHVzID09IENpZnNOZWVk
UmVjb25uZWN0KTsKIAotCWlmICh0YXJnZXRfaGludCkKLQkJZGZzX2NhY2hlX25vcmVxX3VwZGF0
ZV90Z3RoaW50KHJlZnBhdGgsIHRhcmdldF9oaW50KTsKLQorCWRmc19jYWNoZV9ub3JlcV91cGRh
dGVfdGd0aGludChyZWZwYXRoLCB0YXJnZXRfaGludCk7CiAJZGZzX2NhY2hlX2ZyZWVfdGd0cygm
dGwpOwogCiAJLyogTmVlZCB0byBzZXQgdXAgZWNobyB3b3JrZXIgYWdhaW4gb25jZSBjb25uZWN0
aW9uIGhhcyBiZWVuIGVzdGFibGlzaGVkICovCkBAIC00MDc5LDI2NSArNDA3Nyw3IEBAIGNpZnNf
cHJ1bmVfdGxpbmtzKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkJCQlUTElOS19JRExFX0VY
UElSRSk7CiB9CiAKLSNpZmRlZiBDT05GSUdfQ0lGU19ERlNfVVBDQUxMCi0vKiBVcGRhdGUgZGZz
IHJlZmVycmFsIHBhdGggb2Ygc3VwZXJibG9jayAqLwotc3RhdGljIGludCB1cGRhdGVfc2VydmVy
X2Z1bGxwYXRoKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgc3RydWN0IGNpZnNfc2Jf
aW5mbyAqY2lmc19zYiwKLQkJCQkgIGNvbnN0IGNoYXIgKnRhcmdldCkKLXsKLQlpbnQgcmMgPSAw
OwotCXNpemVfdCBsZW4gPSBzdHJsZW4odGFyZ2V0KTsKLQljaGFyICpyZWZwYXRoLCAqbnBhdGg7
Ci0KLQlpZiAodW5saWtlbHkobGVuIDwgMiB8fCAqdGFyZ2V0ICE9ICdcXCcpKQotCQlyZXR1cm4g
LUVJTlZBTDsKLQotCWlmICh0YXJnZXRbMV0gPT0gJ1xcJykgewotCQlsZW4gKz0gMTsKLQkJcmVm
cGF0aCA9IGttYWxsb2MobGVuLCBHRlBfS0VSTkVMKTsKLQkJaWYgKCFyZWZwYXRoKQotCQkJcmV0
dXJuIC1FTk9NRU07Ci0KLQkJc2NucHJpbnRmKHJlZnBhdGgsIGxlbiwgIiVzIiwgdGFyZ2V0KTsK
LQl9IGVsc2UgewotCQlsZW4gKz0gc2l6ZW9mKCJcXCIpOwotCQlyZWZwYXRoID0ga21hbGxvYyhs
ZW4sIEdGUF9LRVJORUwpOwotCQlpZiAoIXJlZnBhdGgpCi0JCQlyZXR1cm4gLUVOT01FTTsKLQot
CQlzY25wcmludGYocmVmcGF0aCwgbGVuLCAiXFwlcyIsIHRhcmdldCk7Ci0JfQotCi0JbnBhdGgg
PSBkZnNfY2FjaGVfY2Fub25pY2FsX3BhdGgocmVmcGF0aCwgY2lmc19zYi0+bG9jYWxfbmxzLCBj
aWZzX3JlbWFwKGNpZnNfc2IpKTsKLQlrZnJlZShyZWZwYXRoKTsKLQotCWlmIChJU19FUlIobnBh
dGgpKSB7Ci0JCXJjID0gUFRSX0VSUihucGF0aCk7Ci0JfSBlbHNlIHsKLQkJbXV0ZXhfbG9jaygm
c2VydmVyLT5yZWZwYXRoX2xvY2spOwotCQlrZnJlZShzZXJ2ZXItPmxlYWZfZnVsbHBhdGgpOwot
CQlzZXJ2ZXItPmxlYWZfZnVsbHBhdGggPSBucGF0aDsKLQkJbXV0ZXhfdW5sb2NrKCZzZXJ2ZXIt
PnJlZnBhdGhfbG9jayk7Ci0JCXNlcnZlci0+Y3VycmVudF9mdWxscGF0aCA9IHNlcnZlci0+bGVh
Zl9mdWxscGF0aDsKLQl9Ci0JcmV0dXJuIHJjOwotfQotCi1zdGF0aWMgaW50IHRhcmdldF9zaGFy
ZV9tYXRjaGVzX3NlcnZlcihzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIGNvbnN0IGNo
YXIgKnRjcF9ob3N0LAotCQkJCSAgICAgICBzaXplX3QgdGNwX2hvc3RfbGVuLCBjaGFyICpzaGFy
ZSwgYm9vbCAqdGFyZ2V0X21hdGNoKQotewotCWludCByYyA9IDA7Ci0JY29uc3QgY2hhciAqZGZz
X2hvc3Q7Ci0Jc2l6ZV90IGRmc19ob3N0X2xlbjsKLQotCSp0YXJnZXRfbWF0Y2ggPSB0cnVlOwot
CWV4dHJhY3RfdW5jX2hvc3RuYW1lKHNoYXJlLCAmZGZzX2hvc3QsICZkZnNfaG9zdF9sZW4pOwot
Ci0JLyogQ2hlY2sgaWYgaG9zdG5hbWVzIG9yIGFkZHJlc3NlcyBtYXRjaCAqLwotCWlmIChkZnNf
aG9zdF9sZW4gIT0gdGNwX2hvc3RfbGVuIHx8IHN0cm5jYXNlY21wKGRmc19ob3N0LCB0Y3BfaG9z
dCwgZGZzX2hvc3RfbGVuKSAhPSAwKSB7Ci0JCWNpZnNfZGJnKEZZSSwgIiVzOiAlLipzIGRvZXNu
J3QgbWF0Y2ggJS4qc1xuIiwgX19mdW5jX18sIChpbnQpZGZzX2hvc3RfbGVuLAotCQkJIGRmc19o
b3N0LCAoaW50KXRjcF9ob3N0X2xlbiwgdGNwX2hvc3QpOwotCQlyYyA9IG1hdGNoX3RhcmdldF9p
cChzZXJ2ZXIsIGRmc19ob3N0LCBkZnNfaG9zdF9sZW4sIHRhcmdldF9tYXRjaCk7Ci0JCWlmIChy
YykKLQkJCWNpZnNfZGJnKFZGUywgIiVzOiBmYWlsZWQgdG8gbWF0Y2ggdGFyZ2V0IGlwOiAlZFxu
IiwgX19mdW5jX18sIHJjKTsKLQl9Ci0JcmV0dXJuIHJjOwotfQotCi1zdGF0aWMgaW50IF9fdHJl
ZV9jb25uZWN0X2Rmc190YXJnZXQoY29uc3QgdW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNf
dGNvbiAqdGNvbiwKLQkJCQkgICAgIHN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IsIGNoYXIg
KnRyZWUsIGJvb2wgaXNsaW5rLAotCQkJCSAgICAgc3RydWN0IGRmc19jYWNoZV90Z3RfbGlzdCAq
dGwpCi17Ci0JaW50IHJjOwotCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24t
PnNlcy0+c2VydmVyOwotCWNvbnN0IHN0cnVjdCBzbWJfdmVyc2lvbl9vcGVyYXRpb25zICpvcHMg
PSBzZXJ2ZXItPm9wczsKLQlzdHJ1Y3QgY2lmc19zZXMgKnJvb3Rfc2VzID0gQ0lGU19ERlNfUk9P
VF9TRVModGNvbi0+c2VzKTsKLQlzdHJ1Y3QgY2lmc190Y29uICppcGMgPSByb290X3Nlcy0+dGNv
bl9pcGM7Ci0JY2hhciAqc2hhcmUgPSBOVUxMLCAqcHJlZml4ID0gTlVMTDsKLQljb25zdCBjaGFy
ICp0Y3BfaG9zdDsKLQlzaXplX3QgdGNwX2hvc3RfbGVuOwotCXN0cnVjdCBkZnNfY2FjaGVfdGd0
X2l0ZXJhdG9yICp0aXQ7Ci0JYm9vbCB0YXJnZXRfbWF0Y2g7Ci0KLQlleHRyYWN0X3VuY19ob3N0
bmFtZShzZXJ2ZXItPmhvc3RuYW1lLCAmdGNwX2hvc3QsICZ0Y3BfaG9zdF9sZW4pOwotCi0JdGl0
ID0gZGZzX2NhY2hlX2dldF90Z3RfaXRlcmF0b3IodGwpOwotCWlmICghdGl0KSB7Ci0JCXJjID0g
LUVOT0VOVDsKLQkJZ290byBvdXQ7Ci0JfQotCi0JLyogVHJ5IHRvIHRyZWUgY29ubmVjdCB0byBh
bGwgZGZzIHRhcmdldHMgKi8KLQlmb3IgKDsgdGl0OyB0aXQgPSBkZnNfY2FjaGVfZ2V0X25leHRf
dGd0KHRsLCB0aXQpKSB7Ci0JCWNvbnN0IGNoYXIgKnRhcmdldCA9IGRmc19jYWNoZV9nZXRfdGd0
X25hbWUodGl0KTsKLQkJc3RydWN0IGRmc19jYWNoZV90Z3RfbGlzdCBudGwgPSBERlNfQ0FDSEVf
VEdUX0xJU1RfSU5JVChudGwpOwotCi0JCWtmcmVlKHNoYXJlKTsKLQkJa2ZyZWUocHJlZml4KTsK
LQkJc2hhcmUgPSBwcmVmaXggPSBOVUxMOwotCi0JCS8qIENoZWNrIGlmIHNoYXJlIG1hdGNoZXMg
d2l0aCB0Y3Agc2VzICovCi0JCXJjID0gZGZzX2NhY2hlX2dldF90Z3Rfc2hhcmUoc2VydmVyLT5j
dXJyZW50X2Z1bGxwYXRoICsgMSwgdGl0LCAmc2hhcmUsICZwcmVmaXgpOwotCQlpZiAocmMpIHsK
LQkJCWNpZnNfZGJnKFZGUywgIiVzOiBmYWlsZWQgdG8gcGFyc2UgdGFyZ2V0IHNoYXJlOiAlZFxu
IiwgX19mdW5jX18sIHJjKTsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJcmMgPSB0YXJnZXRfc2hhcmVf
bWF0Y2hlc19zZXJ2ZXIoc2VydmVyLCB0Y3BfaG9zdCwgdGNwX2hvc3RfbGVuLCBzaGFyZSwKLQkJ
CQkJCSAmdGFyZ2V0X21hdGNoKTsKLQkJaWYgKHJjKQotCQkJYnJlYWs7Ci0JCWlmICghdGFyZ2V0
X21hdGNoKSB7Ci0JCQlyYyA9IC1FSE9TVFVOUkVBQ0g7Ci0JCQljb250aW51ZTsKLQkJfQotCi0J
CWlmIChpcGMtPm5lZWRfcmVjb25uZWN0KSB7Ci0JCQlzY25wcmludGYodHJlZSwgTUFYX1RSRUVf
U0laRSwgIlxcXFwlc1xcSVBDJCIsIHNlcnZlci0+aG9zdG5hbWUpOwotCQkJcmMgPSBvcHMtPnRy
ZWVfY29ubmVjdCh4aWQsIGlwYy0+c2VzLCB0cmVlLCBpcGMsIGNpZnNfc2ItPmxvY2FsX25scyk7
Ci0JCQlpZiAocmMpCi0JCQkJYnJlYWs7Ci0JCX0KLQotCQlzY25wcmludGYodHJlZSwgTUFYX1RS
RUVfU0laRSwgIlxcJXMiLCBzaGFyZSk7Ci0JCWlmICghaXNsaW5rKSB7Ci0JCQlyYyA9IG9wcy0+
dHJlZV9jb25uZWN0KHhpZCwgdGNvbi0+c2VzLCB0cmVlLCB0Y29uLCBjaWZzX3NiLT5sb2NhbF9u
bHMpOwotCQkJYnJlYWs7Ci0JCX0KLQkJLyoKLQkJICogSWYgbm8gZGZzIHJlZmVycmFscyB3ZXJl
IHJldHVybmVkIGZyb20gbGluayB0YXJnZXQsIHRoZW4ganVzdCBkbyBhIFRSRUVfQ09OTkVDVAot
CQkgKiB0byBpdC4gIE90aGVyd2lzZSwgY2FjaGUgdGhlIGRmcyByZWZlcnJhbCBhbmQgdGhlbiBt
YXJrIGN1cnJlbnQgdGNwIHNlcyBmb3IKLQkJICogcmVjb25uZWN0IHNvIGVpdGhlciB0aGUgZGVt
dWx0aXBsZXggdGhyZWFkIG9yIHRoZSBlY2hvIHdvcmtlciB3aWxsIHJlY29ubmVjdCB0bwotCQkg
KiBuZXdseSByZXNvbHZlZCB0YXJnZXQuCi0JCSAqLwotCQlpZiAoZGZzX2NhY2hlX2ZpbmQoeGlk
LCByb290X3NlcywgY2lmc19zYi0+bG9jYWxfbmxzLCBjaWZzX3JlbWFwKGNpZnNfc2IpLCB0YXJn
ZXQsCi0JCQkJICAgTlVMTCwgJm50bCkpIHsKLQkJCXJjID0gb3BzLT50cmVlX2Nvbm5lY3QoeGlk
LCB0Y29uLT5zZXMsIHRyZWUsIHRjb24sIGNpZnNfc2ItPmxvY2FsX25scyk7Ci0JCQlpZiAocmMp
Ci0JCQkJY29udGludWU7Ci0JCQlyYyA9IGRmc19jYWNoZV9ub3JlcV91cGRhdGVfdGd0aGludChz
ZXJ2ZXItPmN1cnJlbnRfZnVsbHBhdGggKyAxLCB0aXQpOwotCQkJaWYgKCFyYykKLQkJCQlyYyA9
IGNpZnNfdXBkYXRlX3N1cGVyX3ByZXBhdGgoY2lmc19zYiwgcHJlZml4KTsKLQkJfSBlbHNlIHsK
LQkJCS8qIFRhcmdldCBpcyBhbm90aGVyIGRmcyBzaGFyZSAqLwotCQkJcmMgPSB1cGRhdGVfc2Vy
dmVyX2Z1bGxwYXRoKHNlcnZlciwgY2lmc19zYiwgdGFyZ2V0KTsKLQkJCWRmc19jYWNoZV9mcmVl
X3RndHModGwpOwotCi0JCQlpZiAoIXJjKSB7Ci0JCQkJcmMgPSAtRVJFTU9URTsKLQkJCQlsaXN0
X3JlcGxhY2VfaW5pdCgmbnRsLnRsX2xpc3QsICZ0bC0+dGxfbGlzdCk7Ci0JCQl9IGVsc2UKLQkJ
CQlkZnNfY2FjaGVfZnJlZV90Z3RzKCZudGwpOwotCQl9Ci0JCWJyZWFrOwotCX0KLQotb3V0Ogot
CWtmcmVlKHNoYXJlKTsKLQlrZnJlZShwcmVmaXgpOwotCi0JcmV0dXJuIHJjOwotfQotCi1zdGF0
aWMgaW50IHRyZWVfY29ubmVjdF9kZnNfdGFyZ2V0KGNvbnN0IHVuc2lnbmVkIGludCB4aWQsIHN0
cnVjdCBjaWZzX3Rjb24gKnRjb24sCi0JCQkJICAgc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19z
YiwgY2hhciAqdHJlZSwgYm9vbCBpc2xpbmssCi0JCQkJICAgc3RydWN0IGRmc19jYWNoZV90Z3Rf
bGlzdCAqdGwpCi17Ci0JaW50IHJjOwotCWludCBudW1fbGlua3MgPSAwOwotCXN0cnVjdCBUQ1Bf
U2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOwotCi0JZG8gewotCQlyYyA9
IF9fdHJlZV9jb25uZWN0X2Rmc190YXJnZXQoeGlkLCB0Y29uLCBjaWZzX3NiLCB0cmVlLCBpc2xp
bmssIHRsKTsKLQkJaWYgKCFyYyB8fCByYyAhPSAtRVJFTU9URSkKLQkJCWJyZWFrOwotCX0gd2hp
bGUgKHJjID0gLUVMT09QLCArK251bV9saW5rcyA8IE1BWF9ORVNURURfTElOS1MpOwotCS8qCi0J
ICogSWYgd2UgY291bGRuJ3QgdHJlZSBjb25uZWN0IHRvIGFueSB0YXJnZXRzIGZyb20gbGFzdCBy
ZWZlcnJhbCBwYXRoLCB0aGVuIHJldHJ5IGZyb20KLQkgKiBvcmlnaW5hbCByZWZlcnJhbCBwYXRo
LgotCSAqLwotCWlmIChyYyAmJiBzZXJ2ZXItPmN1cnJlbnRfZnVsbHBhdGggIT0gc2VydmVyLT5v
cmlnaW5fZnVsbHBhdGgpIHsKLQkJc2VydmVyLT5jdXJyZW50X2Z1bGxwYXRoID0gc2VydmVyLT5v
cmlnaW5fZnVsbHBhdGg7Ci0JCWNpZnNfc2lnbmFsX2NpZnNkX2Zvcl9yZWNvbm5lY3Qoc2VydmVy
LCB0cnVlKTsKLQl9Ci0KLQlkZnNfY2FjaGVfZnJlZV90Z3RzKHRsKTsKLQlyZXR1cm4gcmM7Ci19
Ci0KLWludCBjaWZzX3RyZWVfY29ubmVjdChjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3Qg
Y2lmc190Y29uICp0Y29uLCBjb25zdCBzdHJ1Y3QgbmxzX3RhYmxlICpubHNjKQotewotCWludCBy
YzsKLQlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIgPSB0Y29uLT5zZXMtPnNlcnZlcjsK
LQljb25zdCBzdHJ1Y3Qgc21iX3ZlcnNpb25fb3BlcmF0aW9ucyAqb3BzID0gc2VydmVyLT5vcHM7
Ci0Jc3RydWN0IHN1cGVyX2Jsb2NrICpzYiA9IE5VTEw7Ci0Jc3RydWN0IGNpZnNfc2JfaW5mbyAq
Y2lmc19zYjsKLQlzdHJ1Y3QgZGZzX2NhY2hlX3RndF9saXN0IHRsID0gREZTX0NBQ0hFX1RHVF9M
SVNUX0lOSVQodGwpOwotCWNoYXIgKnRyZWU7Ci0Jc3RydWN0IGRmc19pbmZvM19wYXJhbSByZWYg
PSB7MH07Ci0KLQkvKiBvbmx5IHNlbmQgb25jZSBwZXIgY29ubmVjdCAqLwotCXNwaW5fbG9jaygm
dGNvbi0+dGNfbG9jayk7Ci0JaWYgKHRjb24tPnNlcy0+c2VzX3N0YXR1cyAhPSBTRVNfR09PRCB8
fAotCSAgICAodGNvbi0+c3RhdHVzICE9IFRJRF9ORVcgJiYKLQkgICAgdGNvbi0+c3RhdHVzICE9
IFRJRF9ORUVEX1RDT04pKSB7Ci0JCXNwaW5fdW5sb2NrKCZ0Y29uLT50Y19sb2NrKTsKLQkJcmV0
dXJuIDA7Ci0JfQotCXRjb24tPnN0YXR1cyA9IFRJRF9JTl9UQ09OOwotCXNwaW5fdW5sb2NrKCZ0
Y29uLT50Y19sb2NrKTsKLQotCXRyZWUgPSBremFsbG9jKE1BWF9UUkVFX1NJWkUsIEdGUF9LRVJO
RUwpOwotCWlmICghdHJlZSkgewotCQlyYyA9IC1FTk9NRU07Ci0JCWdvdG8gb3V0OwotCX0KLQot
CWlmICh0Y29uLT5pcGMpIHsKLQkJc2NucHJpbnRmKHRyZWUsIE1BWF9UUkVFX1NJWkUsICJcXFxc
JXNcXElQQyQiLCBzZXJ2ZXItPmhvc3RuYW1lKTsKLQkJcmMgPSBvcHMtPnRyZWVfY29ubmVjdCh4
aWQsIHRjb24tPnNlcywgdHJlZSwgdGNvbiwgbmxzYyk7Ci0JCWdvdG8gb3V0OwotCX0KLQotCXNi
ID0gY2lmc19nZXRfdGNwX3N1cGVyKHNlcnZlcik7Ci0JaWYgKElTX0VSUihzYikpIHsKLQkJcmMg
PSBQVFJfRVJSKHNiKTsKLQkJY2lmc19kYmcoVkZTLCAiJXM6IGNvdWxkIG5vdCBmaW5kIHN1cGVy
YmxvY2s6ICVkXG4iLCBfX2Z1bmNfXywgcmMpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQljaWZzX3Ni
ID0gQ0lGU19TQihzYik7Ci0KLQkvKiBJZiBpdCBpcyBub3QgZGZzIG9yIHRoZXJlIHdhcyBubyBj
YWNoZWQgZGZzIHJlZmVycmFsLCB0aGVuIHJlY29ubmVjdCB0byBzYW1lIHNoYXJlICovCi0JaWYg
KCFzZXJ2ZXItPmN1cnJlbnRfZnVsbHBhdGggfHwKLQkgICAgZGZzX2NhY2hlX25vcmVxX2ZpbmQo
c2VydmVyLT5jdXJyZW50X2Z1bGxwYXRoICsgMSwgJnJlZiwgJnRsKSkgewotCQlyYyA9IG9wcy0+
dHJlZV9jb25uZWN0KHhpZCwgdGNvbi0+c2VzLCB0Y29uLT50cmVlX25hbWUsIHRjb24sIGNpZnNf
c2ItPmxvY2FsX25scyk7Ci0JCWdvdG8gb3V0OwotCX0KLQotCXJjID0gdHJlZV9jb25uZWN0X2Rm
c190YXJnZXQoeGlkLCB0Y29uLCBjaWZzX3NiLCB0cmVlLCByZWYuc2VydmVyX3R5cGUgPT0gREZT
X1RZUEVfTElOSywKLQkJCQkgICAgICZ0bCk7Ci0JZnJlZV9kZnNfaW5mb19wYXJhbSgmcmVmKTsK
LQotb3V0OgotCWtmcmVlKHRyZWUpOwotCWNpZnNfcHV0X3RjcF9zdXBlcihzYik7Ci0KLQlpZiAo
cmMpIHsKLQkJc3Bpbl9sb2NrKCZ0Y29uLT50Y19sb2NrKTsKLQkJaWYgKHRjb24tPnN0YXR1cyA9
PSBUSURfSU5fVENPTikKLQkJCXRjb24tPnN0YXR1cyA9IFRJRF9ORUVEX1RDT047Ci0JCXNwaW5f
dW5sb2NrKCZ0Y29uLT50Y19sb2NrKTsKLQl9IGVsc2UgewotCQlzcGluX2xvY2soJnRjb24tPnRj
X2xvY2spOwotCQlpZiAodGNvbi0+c3RhdHVzID09IFRJRF9JTl9UQ09OKQotCQkJdGNvbi0+c3Rh
dHVzID0gVElEX0dPT0Q7Ci0JCXNwaW5fdW5sb2NrKCZ0Y29uLT50Y19sb2NrKTsKLQkJdGNvbi0+
bmVlZF9yZWNvbm5lY3QgPSBmYWxzZTsKLQl9Ci0KLQlyZXR1cm4gcmM7Ci19Ci0jZWxzZQorI2lm
bmRlZiBDT05GSUdfQ0lGU19ERlNfVVBDQUxMCiBpbnQgY2lmc190cmVlX2Nvbm5lY3QoY29uc3Qg
dW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwgY29uc3Qgc3RydWN0IG5s
c190YWJsZSAqbmxzYykKIHsKIAlpbnQgcmM7CmRpZmYgLS1naXQgYS9mcy9jaWZzL2Rmcy5jIGIv
ZnMvY2lmcy9kZnMuYwppbmRleCBmYmM4ZTg4MGExZmUuLjVhZmFiY2E2NTRjMSAxMDA2NDQKLS0t
IGEvZnMvY2lmcy9kZnMuYworKysgYi9mcy9jaWZzL2Rmcy5jCkBAIC0yODQsMyArMjg0LDI2MiBA
QCBpbnQgZGZzX21vdW50X3NoYXJlKHN0cnVjdCBjaWZzX21vdW50X2N0eCAqbW50X2N0eCwgYm9v
bCAqaXNkZnMpCiAKIAlyZXR1cm4gX19kZnNfbW91bnRfc2hhcmUobW50X2N0eCk7CiB9CisKKy8q
IFVwZGF0ZSBkZnMgcmVmZXJyYWwgcGF0aCBvZiBzdXBlcmJsb2NrICovCitzdGF0aWMgaW50IHVw
ZGF0ZV9zZXJ2ZXJfZnVsbHBhdGgoc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzdHJ1
Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiLAorCQkJCSAgY29uc3QgY2hhciAqdGFyZ2V0KQorewor
CWludCByYyA9IDA7CisJc2l6ZV90IGxlbiA9IHN0cmxlbih0YXJnZXQpOworCWNoYXIgKnJlZnBh
dGgsICpucGF0aDsKKworCWlmICh1bmxpa2VseShsZW4gPCAyIHx8ICp0YXJnZXQgIT0gJ1xcJykp
CisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKHRhcmdldFsxXSA9PSAnXFwnKSB7CisJCWxlbiAr
PSAxOworCQlyZWZwYXRoID0ga21hbGxvYyhsZW4sIEdGUF9LRVJORUwpOworCQlpZiAoIXJlZnBh
dGgpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlzY25wcmludGYocmVmcGF0aCwgbGVuLCAiJXMi
LCB0YXJnZXQpOworCX0gZWxzZSB7CisJCWxlbiArPSBzaXplb2YoIlxcIik7CisJCXJlZnBhdGgg
PSBrbWFsbG9jKGxlbiwgR0ZQX0tFUk5FTCk7CisJCWlmICghcmVmcGF0aCkKKwkJCXJldHVybiAt
RU5PTUVNOworCisJCXNjbnByaW50ZihyZWZwYXRoLCBsZW4sICJcXCVzIiwgdGFyZ2V0KTsKKwl9
CisKKwlucGF0aCA9IGRmc19jYWNoZV9jYW5vbmljYWxfcGF0aChyZWZwYXRoLCBjaWZzX3NiLT5s
b2NhbF9ubHMsIGNpZnNfcmVtYXAoY2lmc19zYikpOworCWtmcmVlKHJlZnBhdGgpOworCisJaWYg
KElTX0VSUihucGF0aCkpIHsKKwkJcmMgPSBQVFJfRVJSKG5wYXRoKTsKKwl9IGVsc2UgeworCQlt
dXRleF9sb2NrKCZzZXJ2ZXItPnJlZnBhdGhfbG9jayk7CisJCWtmcmVlKHNlcnZlci0+bGVhZl9m
dWxscGF0aCk7CisJCXNlcnZlci0+bGVhZl9mdWxscGF0aCA9IG5wYXRoOworCQltdXRleF91bmxv
Y2soJnNlcnZlci0+cmVmcGF0aF9sb2NrKTsKKwkJc2VydmVyLT5jdXJyZW50X2Z1bGxwYXRoID0g
c2VydmVyLT5sZWFmX2Z1bGxwYXRoOworCX0KKwlyZXR1cm4gcmM7Cit9CisKK3N0YXRpYyBpbnQg
dGFyZ2V0X3NoYXJlX21hdGNoZXNfc2VydmVyKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZl
ciwgY29uc3QgY2hhciAqdGNwX2hvc3QsCisJCQkJICAgICAgIHNpemVfdCB0Y3BfaG9zdF9sZW4s
IGNoYXIgKnNoYXJlLCBib29sICp0YXJnZXRfbWF0Y2gpCit7CisJaW50IHJjID0gMDsKKwljb25z
dCBjaGFyICpkZnNfaG9zdDsKKwlzaXplX3QgZGZzX2hvc3RfbGVuOworCisJKnRhcmdldF9tYXRj
aCA9IHRydWU7CisJZXh0cmFjdF91bmNfaG9zdG5hbWUoc2hhcmUsICZkZnNfaG9zdCwgJmRmc19o
b3N0X2xlbik7CisKKwkvKiBDaGVjayBpZiBob3N0bmFtZXMgb3IgYWRkcmVzc2VzIG1hdGNoICov
CisJaWYgKGRmc19ob3N0X2xlbiAhPSB0Y3BfaG9zdF9sZW4gfHwgc3RybmNhc2VjbXAoZGZzX2hv
c3QsIHRjcF9ob3N0LCBkZnNfaG9zdF9sZW4pICE9IDApIHsKKwkJY2lmc19kYmcoRllJLCAiJXM6
ICUuKnMgZG9lc24ndCBtYXRjaCAlLipzXG4iLCBfX2Z1bmNfXywgKGludClkZnNfaG9zdF9sZW4s
CisJCQkgZGZzX2hvc3QsIChpbnQpdGNwX2hvc3RfbGVuLCB0Y3BfaG9zdCk7CisJCXJjID0gbWF0
Y2hfdGFyZ2V0X2lwKHNlcnZlciwgZGZzX2hvc3QsIGRmc19ob3N0X2xlbiwgdGFyZ2V0X21hdGNo
KTsKKwkJaWYgKHJjKQorCQkJY2lmc19kYmcoVkZTLCAiJXM6IGZhaWxlZCB0byBtYXRjaCB0YXJn
ZXQgaXA6ICVkXG4iLCBfX2Z1bmNfXywgcmMpOworCX0KKwlyZXR1cm4gcmM7Cit9CisKK3N0YXRp
YyBpbnQgX190cmVlX2Nvbm5lY3RfZGZzX3RhcmdldChjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBz
dHJ1Y3QgY2lmc190Y29uICp0Y29uLAorCQkJCSAgICAgc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lm
c19zYiwgY2hhciAqdHJlZSwgYm9vbCBpc2xpbmssCisJCQkJICAgICBzdHJ1Y3QgZGZzX2NhY2hl
X3RndF9saXN0ICp0bCkKK3sKKwlpbnQgcmM7CisJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2Vy
dmVyID0gdGNvbi0+c2VzLT5zZXJ2ZXI7CisJY29uc3Qgc3RydWN0IHNtYl92ZXJzaW9uX29wZXJh
dGlvbnMgKm9wcyA9IHNlcnZlci0+b3BzOworCXN0cnVjdCBjaWZzX3NlcyAqcm9vdF9zZXMgPSBD
SUZTX0RGU19ST09UX1NFUyh0Y29uLT5zZXMpOworCXN0cnVjdCBjaWZzX3Rjb24gKmlwYyA9IHJv
b3Rfc2VzLT50Y29uX2lwYzsKKwljaGFyICpzaGFyZSA9IE5VTEwsICpwcmVmaXggPSBOVUxMOwor
CWNvbnN0IGNoYXIgKnRjcF9ob3N0OworCXNpemVfdCB0Y3BfaG9zdF9sZW47CisJc3RydWN0IGRm
c19jYWNoZV90Z3RfaXRlcmF0b3IgKnRpdDsKKwlib29sIHRhcmdldF9tYXRjaDsKKworCWV4dHJh
Y3RfdW5jX2hvc3RuYW1lKHNlcnZlci0+aG9zdG5hbWUsICZ0Y3BfaG9zdCwgJnRjcF9ob3N0X2xl
bik7CisKKwl0aXQgPSBkZnNfY2FjaGVfZ2V0X3RndF9pdGVyYXRvcih0bCk7CisJaWYgKCF0aXQp
IHsKKwkJcmMgPSAtRU5PRU5UOworCQlnb3RvIG91dDsKKwl9CisKKwkvKiBUcnkgdG8gdHJlZSBj
b25uZWN0IHRvIGFsbCBkZnMgdGFyZ2V0cyAqLworCWZvciAoOyB0aXQ7IHRpdCA9IGRmc19jYWNo
ZV9nZXRfbmV4dF90Z3QodGwsIHRpdCkpIHsKKwkJY29uc3QgY2hhciAqdGFyZ2V0ID0gZGZzX2Nh
Y2hlX2dldF90Z3RfbmFtZSh0aXQpOworCQlzdHJ1Y3QgZGZzX2NhY2hlX3RndF9saXN0IG50bCA9
IERGU19DQUNIRV9UR1RfTElTVF9JTklUKG50bCk7CisKKwkJa2ZyZWUoc2hhcmUpOworCQlrZnJl
ZShwcmVmaXgpOworCQlzaGFyZSA9IHByZWZpeCA9IE5VTEw7CisKKwkJLyogQ2hlY2sgaWYgc2hh
cmUgbWF0Y2hlcyB3aXRoIHRjcCBzZXMgKi8KKwkJcmMgPSBkZnNfY2FjaGVfZ2V0X3RndF9zaGFy
ZShzZXJ2ZXItPmN1cnJlbnRfZnVsbHBhdGggKyAxLCB0aXQsICZzaGFyZSwgJnByZWZpeCk7CisJ
CWlmIChyYykgeworCQkJY2lmc19kYmcoVkZTLCAiJXM6IGZhaWxlZCB0byBwYXJzZSB0YXJnZXQg
c2hhcmU6ICVkXG4iLCBfX2Z1bmNfXywgcmMpOworCQkJYnJlYWs7CisJCX0KKworCQlyYyA9IHRh
cmdldF9zaGFyZV9tYXRjaGVzX3NlcnZlcihzZXJ2ZXIsIHRjcF9ob3N0LCB0Y3BfaG9zdF9sZW4s
IHNoYXJlLAorCQkJCQkJICZ0YXJnZXRfbWF0Y2gpOworCQlpZiAocmMpCisJCQlicmVhazsKKwkJ
aWYgKCF0YXJnZXRfbWF0Y2gpIHsKKwkJCXJjID0gLUVIT1NUVU5SRUFDSDsKKwkJCWNvbnRpbnVl
OworCQl9CisKKwkJZGZzX2NhY2hlX25vcmVxX3VwZGF0ZV90Z3RoaW50KHNlcnZlci0+Y3VycmVu
dF9mdWxscGF0aCArIDEsIHRpdCk7CisKKwkJaWYgKGlwYy0+bmVlZF9yZWNvbm5lY3QpIHsKKwkJ
CXNjbnByaW50Zih0cmVlLCBNQVhfVFJFRV9TSVpFLCAiXFxcXCVzXFxJUEMkIiwgc2VydmVyLT5o
b3N0bmFtZSk7CisJCQlyYyA9IG9wcy0+dHJlZV9jb25uZWN0KHhpZCwgaXBjLT5zZXMsIHRyZWUs
IGlwYywgY2lmc19zYi0+bG9jYWxfbmxzKTsKKwkJCWlmIChyYykKKwkJCQlicmVhazsKKwkJfQor
CisJCXNjbnByaW50Zih0cmVlLCBNQVhfVFJFRV9TSVpFLCAiXFwlcyIsIHNoYXJlKTsKKwkJaWYg
KCFpc2xpbmspIHsKKwkJCXJjID0gb3BzLT50cmVlX2Nvbm5lY3QoeGlkLCB0Y29uLT5zZXMsIHRy
ZWUsIHRjb24sIGNpZnNfc2ItPmxvY2FsX25scyk7CisJCQlicmVhazsKKwkJfQorCQkvKgorCQkg
KiBJZiBubyBkZnMgcmVmZXJyYWxzIHdlcmUgcmV0dXJuZWQgZnJvbSBsaW5rIHRhcmdldCwgdGhl
biBqdXN0IGRvIGEgVFJFRV9DT05ORUNUCisJCSAqIHRvIGl0LiAgT3RoZXJ3aXNlLCBjYWNoZSB0
aGUgZGZzIHJlZmVycmFsIGFuZCB0aGVuIG1hcmsgY3VycmVudCB0Y3Agc2VzIGZvcgorCQkgKiBy
ZWNvbm5lY3Qgc28gZWl0aGVyIHRoZSBkZW11bHRpcGxleCB0aHJlYWQgb3IgdGhlIGVjaG8gd29y
a2VyIHdpbGwgcmVjb25uZWN0IHRvCisJCSAqIG5ld2x5IHJlc29sdmVkIHRhcmdldC4KKwkJICov
CisJCWlmIChkZnNfY2FjaGVfZmluZCh4aWQsIHJvb3Rfc2VzLCBjaWZzX3NiLT5sb2NhbF9ubHMs
IGNpZnNfcmVtYXAoY2lmc19zYiksIHRhcmdldCwKKwkJCQkgICBOVUxMLCAmbnRsKSkgeworCQkJ
cmMgPSBvcHMtPnRyZWVfY29ubmVjdCh4aWQsIHRjb24tPnNlcywgdHJlZSwgdGNvbiwgY2lmc19z
Yi0+bG9jYWxfbmxzKTsKKwkJCWlmIChyYykKKwkJCQljb250aW51ZTsKKworCQkJcmMgPSBjaWZz
X3VwZGF0ZV9zdXBlcl9wcmVwYXRoKGNpZnNfc2IsIHByZWZpeCk7CisJCX0gZWxzZSB7CisJCQkv
KiBUYXJnZXQgaXMgYW5vdGhlciBkZnMgc2hhcmUgKi8KKwkJCXJjID0gdXBkYXRlX3NlcnZlcl9m
dWxscGF0aChzZXJ2ZXIsIGNpZnNfc2IsIHRhcmdldCk7CisJCQlkZnNfY2FjaGVfZnJlZV90Z3Rz
KHRsKTsKKworCQkJaWYgKCFyYykgeworCQkJCXJjID0gLUVSRU1PVEU7CisJCQkJbGlzdF9yZXBs
YWNlX2luaXQoJm50bC50bF9saXN0LCAmdGwtPnRsX2xpc3QpOworCQkJfSBlbHNlCisJCQkJZGZz
X2NhY2hlX2ZyZWVfdGd0cygmbnRsKTsKKwkJfQorCQlicmVhazsKKwl9CisKK291dDoKKwlrZnJl
ZShzaGFyZSk7CisJa2ZyZWUocHJlZml4KTsKKworCXJldHVybiByYzsKK30KKworc3RhdGljIGlu
dCB0cmVlX2Nvbm5lY3RfZGZzX3RhcmdldChjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3Qg
Y2lmc190Y29uICp0Y29uLAorCQkJCSAgIHN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IsIGNo
YXIgKnRyZWUsIGJvb2wgaXNsaW5rLAorCQkJCSAgIHN0cnVjdCBkZnNfY2FjaGVfdGd0X2xpc3Qg
KnRsKQoreworCWludCByYzsKKwlpbnQgbnVtX2xpbmtzID0gMDsKKwlzdHJ1Y3QgVENQX1NlcnZl
cl9JbmZvICpzZXJ2ZXIgPSB0Y29uLT5zZXMtPnNlcnZlcjsKKworCWRvIHsKKwkJcmMgPSBfX3Ry
ZWVfY29ubmVjdF9kZnNfdGFyZ2V0KHhpZCwgdGNvbiwgY2lmc19zYiwgdHJlZSwgaXNsaW5rLCB0
bCk7CisJCWlmICghcmMgfHwgcmMgIT0gLUVSRU1PVEUpCisJCQlicmVhazsKKwl9IHdoaWxlIChy
YyA9IC1FTE9PUCwgKytudW1fbGlua3MgPCBNQVhfTkVTVEVEX0xJTktTKTsKKwkvKgorCSAqIElm
IHdlIGNvdWxkbid0IHRyZWUgY29ubmVjdCB0byBhbnkgdGFyZ2V0cyBmcm9tIGxhc3QgcmVmZXJy
YWwgcGF0aCwgdGhlbiByZXRyeSBmcm9tCisJICogb3JpZ2luYWwgcmVmZXJyYWwgcGF0aC4KKwkg
Ki8KKwlpZiAocmMgJiYgc2VydmVyLT5jdXJyZW50X2Z1bGxwYXRoICE9IHNlcnZlci0+b3JpZ2lu
X2Z1bGxwYXRoKSB7CisJCXNlcnZlci0+Y3VycmVudF9mdWxscGF0aCA9IHNlcnZlci0+b3JpZ2lu
X2Z1bGxwYXRoOworCQljaWZzX3NpZ25hbF9jaWZzZF9mb3JfcmVjb25uZWN0KHNlcnZlciwgdHJ1
ZSk7CisJfQorCisJZGZzX2NhY2hlX2ZyZWVfdGd0cyh0bCk7CisJcmV0dXJuIHJjOworfQorCitp
bnQgY2lmc190cmVlX2Nvbm5lY3QoY29uc3QgdW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNf
dGNvbiAqdGNvbiwgY29uc3Qgc3RydWN0IG5sc190YWJsZSAqbmxzYykKK3sKKwlpbnQgcmM7CisJ
c3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyID0gdGNvbi0+c2VzLT5zZXJ2ZXI7CisJY29u
c3Qgc3RydWN0IHNtYl92ZXJzaW9uX29wZXJhdGlvbnMgKm9wcyA9IHNlcnZlci0+b3BzOworCXN0
cnVjdCBzdXBlcl9ibG9jayAqc2IgPSBOVUxMOworCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNf
c2I7CisJc3RydWN0IGRmc19jYWNoZV90Z3RfbGlzdCB0bCA9IERGU19DQUNIRV9UR1RfTElTVF9J
TklUKHRsKTsKKwljaGFyICp0cmVlOworCXN0cnVjdCBkZnNfaW5mbzNfcGFyYW0gcmVmID0gezB9
OworCisJLyogb25seSBzZW5kIG9uY2UgcGVyIGNvbm5lY3QgKi8KKwlzcGluX2xvY2soJnRjb24t
PnRjX2xvY2spOworCWlmICh0Y29uLT5zZXMtPnNlc19zdGF0dXMgIT0gU0VTX0dPT0QgfHwKKwkg
ICAgKHRjb24tPnN0YXR1cyAhPSBUSURfTkVXICYmCisJICAgIHRjb24tPnN0YXR1cyAhPSBUSURf
TkVFRF9UQ09OKSkgeworCQlzcGluX3VubG9jaygmdGNvbi0+dGNfbG9jayk7CisJCXJldHVybiAw
OworCX0KKwl0Y29uLT5zdGF0dXMgPSBUSURfSU5fVENPTjsKKwlzcGluX3VubG9jaygmdGNvbi0+
dGNfbG9jayk7CisKKwl0cmVlID0ga3phbGxvYyhNQVhfVFJFRV9TSVpFLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIXRyZWUpIHsKKwkJcmMgPSAtRU5PTUVNOworCQlnb3RvIG91dDsKKwl9CisKKwlpZiAo
dGNvbi0+aXBjKSB7CisJCXNjbnByaW50Zih0cmVlLCBNQVhfVFJFRV9TSVpFLCAiXFxcXCVzXFxJ
UEMkIiwgc2VydmVyLT5ob3N0bmFtZSk7CisJCXJjID0gb3BzLT50cmVlX2Nvbm5lY3QoeGlkLCB0
Y29uLT5zZXMsIHRyZWUsIHRjb24sIG5sc2MpOworCQlnb3RvIG91dDsKKwl9CisKKwlzYiA9IGNp
ZnNfZ2V0X3RjcF9zdXBlcihzZXJ2ZXIpOworCWlmIChJU19FUlIoc2IpKSB7CisJCXJjID0gUFRS
X0VSUihzYik7CisJCWNpZnNfZGJnKFZGUywgIiVzOiBjb3VsZCBub3QgZmluZCBzdXBlcmJsb2Nr
OiAlZFxuIiwgX19mdW5jX18sIHJjKTsKKwkJZ290byBvdXQ7CisJfQorCisJY2lmc19zYiA9IENJ
RlNfU0Ioc2IpOworCisJLyogSWYgaXQgaXMgbm90IGRmcyBvciB0aGVyZSB3YXMgbm8gY2FjaGVk
IGRmcyByZWZlcnJhbCwgdGhlbiByZWNvbm5lY3QgdG8gc2FtZSBzaGFyZSAqLworCWlmICghc2Vy
dmVyLT5jdXJyZW50X2Z1bGxwYXRoIHx8CisJICAgIGRmc19jYWNoZV9ub3JlcV9maW5kKHNlcnZl
ci0+Y3VycmVudF9mdWxscGF0aCArIDEsICZyZWYsICZ0bCkpIHsKKwkJcmMgPSBvcHMtPnRyZWVf
Y29ubmVjdCh4aWQsIHRjb24tPnNlcywgdGNvbi0+dHJlZV9uYW1lLCB0Y29uLCBjaWZzX3NiLT5s
b2NhbF9ubHMpOworCQlnb3RvIG91dDsKKwl9CisKKwlyYyA9IHRyZWVfY29ubmVjdF9kZnNfdGFy
Z2V0KHhpZCwgdGNvbiwgY2lmc19zYiwgdHJlZSwgcmVmLnNlcnZlcl90eXBlID09IERGU19UWVBF
X0xJTkssCisJCQkJICAgICAmdGwpOworCWZyZWVfZGZzX2luZm9fcGFyYW0oJnJlZik7CisKK291
dDoKKwlrZnJlZSh0cmVlKTsKKwljaWZzX3B1dF90Y3Bfc3VwZXIoc2IpOworCisJaWYgKHJjKSB7
CisJCXNwaW5fbG9jaygmdGNvbi0+dGNfbG9jayk7CisJCWlmICh0Y29uLT5zdGF0dXMgPT0gVElE
X0lOX1RDT04pCisJCQl0Y29uLT5zdGF0dXMgPSBUSURfTkVFRF9UQ09OOworCQlzcGluX3VubG9j
aygmdGNvbi0+dGNfbG9jayk7CisJfSBlbHNlIHsKKwkJc3Bpbl9sb2NrKCZ0Y29uLT50Y19sb2Nr
KTsKKwkJaWYgKHRjb24tPnN0YXR1cyA9PSBUSURfSU5fVENPTikKKwkJCXRjb24tPnN0YXR1cyA9
IFRJRF9HT09EOworCQlzcGluX3VubG9jaygmdGNvbi0+dGNfbG9jayk7CisJCXRjb24tPm5lZWRf
cmVjb25uZWN0ID0gZmFsc2U7CisJfQorCisJcmV0dXJuIHJjOworfQpkaWZmIC0tZ2l0IGEvZnMv
Y2lmcy9kZnNfY2FjaGUuYyBiL2ZzL2NpZnMvZGZzX2NhY2hlLmMKaW5kZXggY2I4M2I4NmVhZmU2
Li40M2FkMTE3NmRjYjkgMTAwNjQ0Ci0tLSBhL2ZzL2NpZnMvZGZzX2NhY2hlLmMKKysrIGIvZnMv
Y2lmcy9kZnNfY2FjaGUuYwpAQCAtMTA4MiwyNiArMTA4MiwyMyBAQCBpbnQgZGZzX2NhY2hlX3Vw
ZGF0ZV90Z3RoaW50KGNvbnN0IHVuc2lnbmVkIGludCB4aWQsIHN0cnVjdCBjaWZzX3NlcyAqc2Vz
LAogICoKICAqIFJldHVybiB6ZXJvIGlmIHRoZSB0YXJnZXQgaGludCB3YXMgdXBkYXRlZCBzdWNj
ZXNzZnVsbHksIG90aGVyd2lzZSBub24temVyby4KICAqLwotaW50IGRmc19jYWNoZV9ub3JlcV91
cGRhdGVfdGd0aGludChjb25zdCBjaGFyICpwYXRoLCBjb25zdCBzdHJ1Y3QgZGZzX2NhY2hlX3Rn
dF9pdGVyYXRvciAqaXQpCit2b2lkIGRmc19jYWNoZV9ub3JlcV91cGRhdGVfdGd0aGludChjb25z
dCBjaGFyICpwYXRoLCBjb25zdCBzdHJ1Y3QgZGZzX2NhY2hlX3RndF9pdGVyYXRvciAqaXQpCiB7
Ci0JaW50IHJjOwotCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CiAJc3RydWN0IGNhY2hlX2Rmc190
Z3QgKnQ7CisJc3RydWN0IGNhY2hlX2VudHJ5ICpjZTsKIAotCWlmICghaXQpCi0JCXJldHVybiAt
RUlOVkFMOworCWlmICghcGF0aCB8fCAhaXQpCisJCXJldHVybjsKIAogCWNpZnNfZGJnKEZZSSwg
IiVzOiBwYXRoOiAlc1xuIiwgX19mdW5jX18sIHBhdGgpOwogCi0JZG93bl93cml0ZSgmaHRhYmxl
X3J3X2xvY2spOworCWlmICghZG93bl93cml0ZV90cnlsb2NrKCZodGFibGVfcndfbG9jaykpCisJ
CXJldHVybjsKIAogCWNlID0gbG9va3VwX2NhY2hlX2VudHJ5KHBhdGgpOwotCWlmIChJU19FUlIo
Y2UpKSB7Ci0JCXJjID0gUFRSX0VSUihjZSk7CisJaWYgKElTX0VSUihjZSkpCiAJCWdvdG8gb3V0
X3VubG9jazsKLQl9CiAKLQlyYyA9IDA7CiAJdCA9IGNlLT50Z3RoaW50OwogCiAJaWYgKHVubGlr
ZWx5KCFzdHJjYXNlY21wKGl0LT5pdF9uYW1lLCB0LT5uYW1lKSkpCkBAIC0xMTE4LDcgKzExMTUs
NiBAQCBpbnQgZGZzX2NhY2hlX25vcmVxX3VwZGF0ZV90Z3RoaW50KGNvbnN0IGNoYXIgKnBhdGgs
IGNvbnN0IHN0cnVjdCBkZnNfY2FjaGVfdGd0XwogCiBvdXRfdW5sb2NrOgogCXVwX3dyaXRlKCZo
dGFibGVfcndfbG9jayk7Ci0JcmV0dXJuIHJjOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2ZzL2Np
ZnMvZGZzX2NhY2hlLmggYi9mcy9jaWZzL2Rmc19jYWNoZS5oCmluZGV4IDUyMDcwZDFkZjE4OS4u
ZjdjZmYwYmU5MzI3IDEwMDY0NAotLS0gYS9mcy9jaWZzL2Rmc19jYWNoZS5oCisrKyBiL2ZzL2Np
ZnMvZGZzX2NhY2hlLmgKQEAgLTM4LDcgKzM4LDcgQEAgaW50IGRmc19jYWNoZV9ub3JlcV9maW5k
KGNvbnN0IGNoYXIgKnBhdGgsIHN0cnVjdCBkZnNfaW5mbzNfcGFyYW0gKnJlZiwKIGludCBkZnNf
Y2FjaGVfdXBkYXRlX3RndGhpbnQoY29uc3QgdW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNf
c2VzICpzZXMsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBubHNfdGFibGUgKmNwLCBpbnQgcmVtYXAs
IGNvbnN0IGNoYXIgKnBhdGgsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBkZnNfY2FjaGVfdGd0X2l0
ZXJhdG9yICppdCk7Ci1pbnQgZGZzX2NhY2hlX25vcmVxX3VwZGF0ZV90Z3RoaW50KGNvbnN0IGNo
YXIgKnBhdGgsIGNvbnN0IHN0cnVjdCBkZnNfY2FjaGVfdGd0X2l0ZXJhdG9yICppdCk7Cit2b2lk
IGRmc19jYWNoZV9ub3JlcV91cGRhdGVfdGd0aGludChjb25zdCBjaGFyICpwYXRoLCBjb25zdCBz
dHJ1Y3QgZGZzX2NhY2hlX3RndF9pdGVyYXRvciAqaXQpOwogaW50IGRmc19jYWNoZV9nZXRfdGd0
X3JlZmVycmFsKGNvbnN0IGNoYXIgKnBhdGgsIGNvbnN0IHN0cnVjdCBkZnNfY2FjaGVfdGd0X2l0
ZXJhdG9yICppdCwKIAkJCSAgICAgICBzdHJ1Y3QgZGZzX2luZm8zX3BhcmFtICpyZWYpOwogaW50
IGRmc19jYWNoZV9nZXRfdGd0X3NoYXJlKGNoYXIgKnBhdGgsIGNvbnN0IHN0cnVjdCBkZnNfY2Fj
aGVfdGd0X2l0ZXJhdG9yICppdCwgY2hhciAqKnNoYXJlLAotLSAKMi4zNC4xCgo=
--0000000000003f406205f0086e5b
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0011-cifs-fix-confusing-debug-message.patch"
Content-Disposition: attachment; 
	filename="0011-cifs-fix-confusing-debug-message.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs57j3d2>
X-Attachment-Id: f_lbs57j3d2

RnJvbSA5NjMyNzYwNmFkY2ExZGEzMjRiZmZmM2E0NDJhN2I5MWM3YmEwOWQ0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogRnJp
LCAxNiBEZWMgMjAyMiAyMjowMzo0MSAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMTEvMTRdIGNpZnM6
IGZpeCBjb25mdXNpbmcgZGVidWcgbWVzc2FnZQoKU2luY2UgcmMgd2FzIGluaXRpYWxpc2VkIHRv
IC1FTk9NRU0gaW4gY2lmc19nZXRfc21iX3NlcygpLCB3aGVuIGFuCmV4aXN0aW5nIHNtYiBzZXNz
aW9uIHdhcyBmb3VuZCwgZnJlZV94aWQoKSB3b3VsZCBiZSBjYWxsZWQgYW5kIHRoZW4KcHJpbnQK
CiAgQ0lGUzogZnMvY2lmcy9jb25uZWN0LmM6IEV4aXN0aW5nIHRjcCBzZXNzaW9uIHdpdGggc2Vy
dmVyIGZvdW5kCiAgQ0lGUzogZnMvY2lmcy9jb25uZWN0LmM6IFZGUzogaW4gY2lmc19nZXRfc21i
X3NlcyBhcyBYaWQ6IDQ0IHdpdGggdWlkOiAwCiAgQ0lGUzogZnMvY2lmcy9jb25uZWN0LmM6IEV4
aXN0aW5nIHNtYiBzZXNzIGZvdW5kIChzdGF0dXM9MSkKICBDSUZTOiBmcy9jaWZzL2Nvbm5lY3Qu
YzogVkZTOiBsZWF2aW5nIGNpZnNfZ2V0X3NtYl9zZXMgKHhpZCA9IDQ0KSByYyA9IC0xMgoKRml4
IHRoaXMgYnkgaW5pdGlhbGlzaW5nIHJjIHRvIDAgYW5kIHRoZW4gbGV0IGZyZWVfeGlkKCkgcHJp
bnQgdGhpcwppbnN0ZWFkCgogIENJRlM6IGZzL2NpZnMvY29ubmVjdC5jOiBFeGlzdGluZyB0Y3Ag
c2Vzc2lvbiB3aXRoIHNlcnZlciBmb3VuZAogIENJRlM6IGZzL2NpZnMvY29ubmVjdC5jOiBWRlM6
IGluIGNpZnNfZ2V0X3NtYl9zZXMgYXMgWGlkOiAxNCB3aXRoIHVpZDogMAogIENJRlM6IGZzL2Np
ZnMvY29ubmVjdC5jOiBFeGlzdGluZyBzbWIgc2VzcyBmb3VuZCAoc3RhdHVzPTEpCiAgQ0lGUzog
ZnMvY2lmcy9jb25uZWN0LmM6IFZGUzogbGVhdmluZyBjaWZzX2dldF9zbWJfc2VzICh4aWQgPSAx
NCkgcmMgPSAwCgpTaWduZWQtb2ZmLWJ5OiBQYXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIu
bno+CkNjOiBzdGFibGVAdmdlci5rZXJuZWwub3JnClNpZ25lZC1vZmYtYnk6IFN0ZXZlIEZyZW5j
aCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4KLS0tCiBmcy9jaWZzL2Nvbm5lY3QuYyB8IDQgKysr
LQogMSBmaWxlIGNoYW5nZWQsIDMgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAt
LWdpdCBhL2ZzL2NpZnMvY29ubmVjdC5jIGIvZnMvY2lmcy9jb25uZWN0LmMKaW5kZXggNDEwMDll
Zjc4NzhmLi4wNjllODk0ZDU5MTcgMTAwNjQ0Ci0tLSBhL2ZzL2NpZnMvY29ubmVjdC5jCisrKyBi
L2ZzL2NpZnMvY29ubmVjdC5jCkBAIC0yMTQyLDcgKzIxNDIsNyBAQCBjaWZzX3NldF9jaWZzY3Jl
ZHMoc3RydWN0IHNtYjNfZnNfY29udGV4dCAqY3R4IF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAog
c3RydWN0IGNpZnNfc2VzICoKIGNpZnNfZ2V0X3NtYl9zZXMoc3RydWN0IFRDUF9TZXJ2ZXJfSW5m
byAqc2VydmVyLCBzdHJ1Y3Qgc21iM19mc19jb250ZXh0ICpjdHgpCiB7Ci0JaW50IHJjID0gLUVO
T01FTTsKKwlpbnQgcmMgPSAwOwogCXVuc2lnbmVkIGludCB4aWQ7CiAJc3RydWN0IGNpZnNfc2Vz
ICpzZXM7CiAJc3RydWN0IHNvY2thZGRyX2luICphZGRyID0gKHN0cnVjdCBzb2NrYWRkcl9pbiAq
KSZzZXJ2ZXItPmRzdGFkZHI7CkBAIC0yMTkxLDYgKzIxOTEsOCBAQCBjaWZzX2dldF9zbWJfc2Vz
KHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgc3RydWN0IHNtYjNfZnNfY29udGV4dCAq
Y3R4KQogCQlyZXR1cm4gc2VzOwogCX0KIAorCXJjID0gLUVOT01FTTsKKwogCWNpZnNfZGJnKEZZ
SSwgIkV4aXN0aW5nIHNtYiBzZXNzIG5vdCBmb3VuZFxuIik7CiAJc2VzID0gc2VzSW5mb0FsbG9j
KCk7CiAJaWYgKHNlcyA9PSBOVUxMKQotLSAKMi4zNC4xCgo=
--0000000000003f406205f0086e5b
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0012-cifs-fix-source-pathname-comparison-of-dfs-supers.patch"
Content-Disposition: attachment; 
	filename="0012-cifs-fix-source-pathname-comparison-of-dfs-supers.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs57m2x3>
X-Attachment-Id: f_lbs57m2x3

RnJvbSA0ZTA5MmY4MDI5YWFlODdhMmI4ZDliNDcxOWYxZDM0MGI5YzhhODEwIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogRnJp
LCAxNiBEZWMgMjAyMiAyMzoyNTozOCAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMTIvMTRdIGNpZnM6
IGZpeCBzb3VyY2UgcGF0aG5hbWUgY29tcGFyaXNvbiBvZiBkZnMgc3VwZXJzCgpXZSBzdG9yZSB0
aGUgVENQX1NlcnZlcl9JbmZvOjpvcmlnaW5fZnVsbHBhdGggcGF0aCBjYW5vbmljYWxpc2VkCihl
LmcuIHdpdGggJ1xcJyBwYXRoIHNlcGFyYXRvcnMpLCBzbyBpZ25vcmUgc2VwYXJhdG9ycyB3aGVu
IGNvbXBhcmluZwppdCB3aXRoIHNtYjNfZnNfY29udGV4dDo6c291cmNlLgoKU2lnbmVkLW9mZi1i
eTogUGF1bG8gQWxjYW50YXJhIChTVVNFKSA8cGNAY2pyLm56PgpTaWduZWQtb2ZmLWJ5OiBTdGV2
ZSBGcmVuY2ggPHN0ZnJlbmNoQG1pY3Jvc29mdC5jb20+Ci0tLQogZnMvY2lmcy9jb25uZWN0LmMg
fCAxNiArKysrKysrKysrKysrKystCiAxIGZpbGUgY2hhbmdlZCwgMTUgaW5zZXJ0aW9ucygrKSwg
MSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2ZzL2NpZnMvY29ubmVjdC5jIGIvZnMvY2lmcy9j
b25uZWN0LmMKaW5kZXggMDY5ZTg5NGQ1OTE3Li5hNjZjNzQyMmI4YmMgMTAwNjQ0Ci0tLSBhL2Zz
L2NpZnMvY29ubmVjdC5jCisrKyBiL2ZzL2NpZnMvY29ubmVjdC5jCkBAIC0xNDEyLDYgKzE0MTIs
MjAgQEAgbWF0Y2hfc2VjdXJpdHkoc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzdHJ1
Y3Qgc21iM19mc19jb250ZXh0ICpjdHgpCiAJcmV0dXJuIHRydWU7CiB9CiAKK3N0YXRpYyBib29s
IGRmc19zcmNfcGF0aG5hbWVfZXF1YWwoY29uc3QgY2hhciAqczEsIGNvbnN0IGNoYXIgKnMyKQor
eworCWlmIChzdHJsZW4oczEpICE9IHN0cmxlbihzMikpCisJCXJldHVybiBmYWxzZTsKKwlmb3Ig
KDsgKnMxOyBzMSsrLCBzMisrKSB7CisJCWlmICgqczEgPT0gJy8nIHx8ICpzMSA9PSAnXFwnKSB7
CisJCQlpZiAoKnMyICE9ICcvJyAmJiAqczIgIT0gJ1xcJykKKwkJCQlyZXR1cm4gZmFsc2U7CisJ
CX0gZWxzZSBpZiAodG9sb3dlcigqczEpICE9IHRvbG93ZXIoKnMyKSkKKwkJCXJldHVybiBmYWxz
ZTsKKwl9CisJcmV0dXJuIHRydWU7Cit9CisKIC8qIHRoaXMgZnVuY3Rpb24gbXVzdCBiZSBjYWxs
ZWQgd2l0aCBzcnZfbG9jayBoZWxkICovCiBzdGF0aWMgaW50IG1hdGNoX3NlcnZlcihzdHJ1Y3Qg
VENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIHN0cnVjdCBzbWIzX2ZzX2NvbnRleHQgKmN0eCwKIAkJ
CWJvb2wgZGZzX3N1cGVyX2NtcCkKQEAgLTE0NDksNyArMTQ2Myw3IEBAIHN0YXRpYyBpbnQgbWF0
Y2hfc2VydmVyKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgc3RydWN0IHNtYjNfZnNf
Y29udGV4dCAqCiAJICovCiAJaWYgKGRmc19zdXBlcl9jbXApIHsKIAkJaWYgKCFjdHgtPnNvdXJj
ZSB8fCAhc2VydmVyLT5vcmlnaW5fZnVsbHBhdGggfHwKLQkJICAgIHN0cmNhc2VjbXAoc2VydmVy
LT5vcmlnaW5fZnVsbHBhdGgsIGN0eC0+c291cmNlKSkKKwkJICAgICFkZnNfc3JjX3BhdGhuYW1l
X2VxdWFsKHNlcnZlci0+b3JpZ2luX2Z1bGxwYXRoLCBjdHgtPnNvdXJjZSkpCiAJCQlyZXR1cm4g
MDsKIAl9IGVsc2UgewogCQkvKiBTa2lwIGFkZHIsIGhvc3RuYW1lIGFuZCBwb3J0IG1hdGNoaW5n
IGZvciBERlMgY29ubmVjdGlvbnMgKi8KLS0gCjIuMzQuMQoK
--0000000000003f406205f0086e5b
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0013-cifs-optimize-reconnect-of-nested-links.patch"
Content-Disposition: attachment; 
	filename="0013-cifs-optimize-reconnect-of-nested-links.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs57p6j4>
X-Attachment-Id: f_lbs57p6j4

RnJvbSBhN2YzYzE1YTIxODUwZWYzNmNmMzhmN2UwNDZjMjc5NjNiNzI3OTU1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogU2F0
LCAxNyBEZWMgMjAyMiAwMDo0NjoxMSAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMTMvMTRdIGNpZnM6
IG9wdGltaXplIHJlY29ubmVjdCBvZiBuZXN0ZWQgbGlua3MKClRoZXJlIGlzIG5vIHBvaW50IGdv
aW5nIGFsbCB0aGUgd2F5IGJhY2sgdG8gdGhlIG9yaWdpbmFsIGRmcyBmdWxsIHBhdGgKaWYgcmVj
b25uZWN0IG9mIHRjb24gZGlkIG5vdCBmaW5pc2ggZHVlIGEgbmVzdGVkIGxpbmsgZm91bmQgYXMg
bmV3bHkKcmVzb2x2ZWQgdGFyZ2V0IGZvciB0aGUgY3VycmVudCByZWZlcnJhbC4gIFNvLCBqdXN0
IG1hcmsgY3VycmVudApzZXJ2ZXIgZm9yIHJlY29ubmVjdCBhcyB3ZSBhbHJlYWR5IHNldCBAY3Vy
cmVudF9mdWxscGF0aCB0byB0aGUgbmV3CmRmcyByZWZlcnJhbCBpbiB1cGRhdGVfc2VydmVyX2Z1
bGxwYXRoKCkuCgpTaWduZWQtb2ZmLWJ5OiBQYXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIu
bno+ClNpZ25lZC1vZmYtYnk6IFN0ZXZlIEZyZW5jaCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4K
LS0tCiBmcy9jaWZzL2Rmcy5jIHwgOSArKysrLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA0IGluc2Vy
dGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZnMvY2lmcy9kZnMuYyBiL2Zz
L2NpZnMvZGZzLmMKaW5kZXggNWFmYWJjYTY1NGMxLi5iNTQxZTY4Mzc4ZjYgMTAwNjQ0Ci0tLSBh
L2ZzL2NpZnMvZGZzLmMKKysrIGIvZnMvY2lmcy9kZnMuYwpAQCAtNDUxLDYgKzQ1MSw3IEBAIHN0
YXRpYyBpbnQgdHJlZV9jb25uZWN0X2Rmc190YXJnZXQoY29uc3QgdW5zaWduZWQgaW50IHhpZCwg
c3RydWN0IGNpZnNfdGNvbiAqdGNvCiAJaW50IHJjOwogCWludCBudW1fbGlua3MgPSAwOwogCXN0
cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOworCWNoYXIg
Km9sZF9mdWxscGF0aCA9IHNlcnZlci0+bGVhZl9mdWxscGF0aDsKIAogCWRvIHsKIAkJcmMgPSBf
X3RyZWVfY29ubmVjdF9kZnNfdGFyZ2V0KHhpZCwgdGNvbiwgY2lmc19zYiwgdHJlZSwgaXNsaW5r
LCB0bCk7CkBAIC00NTgsMTMgKzQ1OSwxMSBAQCBzdGF0aWMgaW50IHRyZWVfY29ubmVjdF9kZnNf
dGFyZ2V0KGNvbnN0IHVuc2lnbmVkIGludCB4aWQsIHN0cnVjdCBjaWZzX3Rjb24gKnRjbwogCQkJ
YnJlYWs7CiAJfSB3aGlsZSAocmMgPSAtRUxPT1AsICsrbnVtX2xpbmtzIDwgTUFYX05FU1RFRF9M
SU5LUyk7CiAJLyoKLQkgKiBJZiB3ZSBjb3VsZG4ndCB0cmVlIGNvbm5lY3QgdG8gYW55IHRhcmdl
dHMgZnJvbSBsYXN0IHJlZmVycmFsIHBhdGgsIHRoZW4gcmV0cnkgZnJvbQotCSAqIG9yaWdpbmFs
IHJlZmVycmFsIHBhdGguCisJICogSWYgd2UgY291bGRuJ3QgdHJlZSBjb25uZWN0IHRvIGFueSB0
YXJnZXRzIGZyb20gbGFzdCByZWZlcnJhbCBwYXRoLCB0aGVuCisJICogcmV0cnkgaXQgZnJvbSBu
ZXdseSByZXNvbHZlZCBkZnMgcmVmZXJyYWwuCiAJICovCi0JaWYgKHJjICYmIHNlcnZlci0+Y3Vy
cmVudF9mdWxscGF0aCAhPSBzZXJ2ZXItPm9yaWdpbl9mdWxscGF0aCkgewotCQlzZXJ2ZXItPmN1
cnJlbnRfZnVsbHBhdGggPSBzZXJ2ZXItPm9yaWdpbl9mdWxscGF0aDsKKwlpZiAocmMgJiYgc2Vy
dmVyLT5sZWFmX2Z1bGxwYXRoICE9IG9sZF9mdWxscGF0aCkKIAkJY2lmc19zaWduYWxfY2lmc2Rf
Zm9yX3JlY29ubmVjdChzZXJ2ZXIsIHRydWUpOwotCX0KIAogCWRmc19jYWNoZV9mcmVlX3RndHMo
dGwpOwogCXJldHVybiByYzsKLS0gCjIuMzQuMQoK
--0000000000003f406205f0086e5b--
