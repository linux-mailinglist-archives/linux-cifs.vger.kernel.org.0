Return-Path: <linux-cifs-owner@vger.kernel.org>
X-Original-To: lists+linux-cifs@lfdr.de
Delivered-To: lists+linux-cifs@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id E951F64FAF6
	for <lists+linux-cifs@lfdr.de>; Sat, 17 Dec 2022 17:09:15 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229897AbiLQQJO (ORCPT <rfc822;lists+linux-cifs@lfdr.de>);
        Sat, 17 Dec 2022 11:09:14 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:40514 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229659AbiLQQJN (ORCPT
        <rfc822;linux-cifs@vger.kernel.org>); Sat, 17 Dec 2022 11:09:13 -0500
Received: from mail-lf1-x12d.google.com (mail-lf1-x12d.google.com [IPv6:2a00:1450:4864:20::12d])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 29F1DDE88
        for <linux-cifs@vger.kernel.org>; Sat, 17 Dec 2022 08:09:11 -0800 (PST)
Received: by mail-lf1-x12d.google.com with SMTP id 1so7873108lfz.4
        for <linux-cifs@vger.kernel.org>; Sat, 17 Dec 2022 08:09:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=cc:to:subject:message-id:date:from:mime-version:from:to:cc:subject
         :date:message-id:reply-to;
        bh=r8F8nuW7iMAdPwEf2w/j1li0d06ObK2muadeH3tSnys=;
        b=L/Omo6PjALko/7OfPUxLvtt9d98IVpcSpc/TMxqQPlkhR8hAa6ZWuu9V6nj3jDGyLG
         UktgrHJF28WuIPJe6lIZGmAuVXjRnsvtgUT5SWyuZOsxwKHSkGalxADZ8AscMdnUzB2y
         jCsL1qA4Np9Pk3My365EL/NWrlJrJ2I0NhOOfOEG8zPdRiLopf4clKDbl8qVWlll4Pk+
         aCWIFhibwkX5X80PI6gY3IjYs0l1uUam3rSDtiMDVi2QuWPXSYnp/orfrDxmh1fhB5Sg
         lPeeb6Hg7z7O+vNB84zU+IujrDlnli2zLIkIzkbRyx33nvp024FUUUwHSlYcQ9QX3lb3
         li6A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=cc:to:subject:message-id:date:from:mime-version:x-gm-message-state
         :from:to:cc:subject:date:message-id:reply-to;
        bh=r8F8nuW7iMAdPwEf2w/j1li0d06ObK2muadeH3tSnys=;
        b=nn6sr5pRgdv7tHAycUMCSfEx8AvlhFts8xnLyP6p9tyQE7hJjBja56Al5V0tWBcuHw
         WZrBMzM7H0OFmlfEye/fcE/1q6aAFsXQrhe5k02K1Q36yx3e4TVXC58xB+Kx+Tsr2iXY
         Txi/gkHja3rl4SEIkE6lrIwIiFF4jSypNBkjsTe4b6FEGsJ7dSAZFNa0VIL7ivK0tsYi
         g7FYaIFfxcn5Ir0iEzSobAAU9l8qFmEF3M2HgfdQvIUWqF7ZiXMAGvr6DZ+eTfVFig+p
         7bKiYiRl0GpyJ1li6YXttKoeG9IoZjwSirrvyS0lbWed2BwCk7KTSV43WuQRqLyFw1o6
         AhtA==
X-Gm-Message-State: ANoB5pmsLTFRte+BT02JlAKU2bx+NHOp6XSuJbJOzGF3rYwg08f8Yzjt
        By+N7Lc0WLD4ALatVfEi7ZpGKAGDLyIsp1MAlFRp+fu4
X-Google-Smtp-Source: AA0mqf7+KNo7O5RBgfZ8NfEo0UQEW0k1loqpiToD8qOzgWXZXBEa5tLBmm1//gqZs1P7bMVgVo3sQV//2DYtbR3f+l4=
X-Received: by 2002:a19:5219:0:b0:4b5:9125:1432 with SMTP id
 m25-20020a195219000000b004b591251432mr4047970lfb.204.1671293348931; Sat, 17
 Dec 2022 08:09:08 -0800 (PST)
MIME-Version: 1.0
From:   Steve French <smfrench@gmail.com>
Date:   Sat, 17 Dec 2022 10:08:57 -0600
Message-ID: <CAH2r5mtVOY_BhwHgZC9DdZ0n3MTWMiBh2AWbhZZB7aKoVdGYyw@mail.gmail.com>
Subject: [PATCH][SMB3 client] DFS/reconnect fixes part 3 of 4
To:     CIFS <linux-cifs@vger.kernel.org>
Cc:     Paulo Alcantara <pc@cjr.nz>
Content-Type: multipart/mixed; boundary="00000000000061094b05f0084e71"
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM,
        RCVD_IN_DNSWL_NONE,SPF_HELO_NONE,SPF_PASS autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-cifs.vger.kernel.org>
X-Mailing-List: linux-cifs@vger.kernel.org

--00000000000061094b05f0084e71
Content-Type: text/plain; charset="UTF-8"

More from Paulo's recent DFS/reconnect patch series (resending to list
since they seem to have bounced when sent earlier)



-- 
Thanks,

Steve

--00000000000061094b05f0084e71
Content-Type: text/x-patch; charset="US-ASCII"; name="0009-cifs-refresh-root-referrals.patch"
Content-Disposition: attachment; 
	filename="0009-cifs-refresh-root-referrals.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs4w11f0>
X-Attachment-Id: f_lbs4w11f0

RnJvbSA2MmViOWRkY2Y2MDFhMjIzYzYzOGI0ZTU3M2EzYzc0YjU4ZjVkMmI1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogVHVl
LCAxMyBEZWMgMjAyMiAxMTozMDozMCAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMDkvMTRdIGNpZnM6
IHJlZnJlc2ggcm9vdCByZWZlcnJhbHMKCkFsc28gcmVmcmVzaCBjYWNoZWQgcm9vdCByZWZlcnJh
bHMgc28gdGhlIG90aGVyIGNhY2hlZCByZWZlcnJhbHMgbWF5CmhhdmUgYSBiZXR0ZXIgY2hhbmNl
IHRvIGhhdmUgYSB3b3JraW5nIHJvb3Qgc2VydmVyIHRvIGlzc3VlIHRoZQpyZWZlcnJhbHMgb24u
CgpTaWduZWQtb2ZmLWJ5OiBQYXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIubno+ClNpZ25l
ZC1vZmYtYnk6IFN0ZXZlIEZyZW5jaCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4KLS0tCiBmcy9j
aWZzL2Rmc19jYWNoZS5jIHwgNDAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDIyIGluc2VydGlvbnMoKyksIDE4IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2ZzL2NpZnMvZGZzX2NhY2hlLmMgYi9mcy9jaWZzL2Rmc19jYWNoZS5jCmlu
ZGV4IDk1Y2MzOTUxNDIwZS4uY2I4M2I4NmVhZmU2IDEwMDY0NAotLS0gYS9mcy9jaWZzL2Rmc19j
YWNoZS5jCisrKyBiL2ZzL2NpZnMvZGZzX2NhY2hlLmMKQEAgLTEzNDYsMTQgKzEzNDYsMTUgQEAg
c3RhdGljIHZvaWQgbWFya19mb3JfcmVjb25uZWN0X2lmX25lZWRlZChzdHJ1Y3QgY2lmc190Y29u
ICp0Y29uLCBzdHJ1Y3QgZGZzX2NhY2gKIC8qIFJlZnJlc2ggZGZzIHJlZmVycmFsIG9mIHRjb24g
YW5kIG1hcmsgaXQgZm9yIHJlY29ubmVjdCBpZiBuZWVkZWQgKi8KIHN0YXRpYyBpbnQgX19yZWZy
ZXNoX3Rjb24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwgYm9vbCBm
b3JjZV9yZWZyZXNoKQogeworCXN0cnVjdCBkZnNfY2FjaGVfdGd0X2xpc3QgdGwgPSBERlNfQ0FD
SEVfVEdUX0xJU1RfSU5JVCh0bCk7CiAJc3RydWN0IGNpZnNfc2VzICpzZXMgPSBDSUZTX0RGU19S
T09UX1NFUyh0Y29uLT5zZXMpOwotCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CisJc3RydWN0IGNp
ZnNfdGNvbiAqaXBjID0gc2VzLT50Y29uX2lwYzsKIAlzdHJ1Y3QgZGZzX2luZm8zX3BhcmFtICpy
ZWZzID0gTlVMTDsKLQlpbnQgbnVtcmVmcyA9IDA7CiAJYm9vbCBuZWVkc19yZWZyZXNoID0gZmFs
c2U7Ci0Jc3RydWN0IGRmc19jYWNoZV90Z3RfbGlzdCB0bCA9IERGU19DQUNIRV9UR1RfTElTVF9J
TklUKHRsKTsKLQlpbnQgcmMgPSAwOworCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CiAJdW5zaWdu
ZWQgaW50IHhpZDsKKwlpbnQgbnVtcmVmcyA9IDA7CisJaW50IHJjID0gMDsKIAogCXhpZCA9IGdl
dF94aWQoKTsKIApAQCAtMTM3Miw2ICsxMzczLDE0IEBAIHN0YXRpYyBpbnQgX19yZWZyZXNoX3Rj
b24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwgYm9vbCBmb3JjZV9y
CiAJCWdvdG8gb3V0OwogCX0KIAorCXNwaW5fbG9jaygmaXBjLT50Y19sb2NrKTsKKwlpZiAoc2Vz
LT5zZXNfc3RhdHVzICE9IFNFU19HT09EIHx8IGlwYy0+c3RhdHVzICE9IFRJRF9HT09EKSB7CisJ
CXNwaW5fdW5sb2NrKCZpcGMtPnRjX2xvY2spOworCQljaWZzX2RiZyhGWUksICIlczogc2tpcCBj
YWNoZSByZWZyZXNoIGR1ZSB0byBkaXNjb25uZWN0ZWQgaXBjXG4iLCBfX2Z1bmNfXyk7CisJCWdv
dG8gb3V0OworCX0KKwlzcGluX3VubG9jaygmaXBjLT50Y19sb2NrKTsKKwogCXJjID0gZ2V0X2Rm
c19yZWZlcnJhbCh4aWQsIHNlcywgcGF0aCwgJnJlZnMsICZudW1yZWZzKTsKIAlpZiAoIXJjKSB7
CiAJCS8qIENyZWF0ZSBvciB1cGRhdGUgYSBjYWNoZSBlbnRyeSB3aXRoIHRoZSBuZXcgcmVmZXJy
YWwgKi8KQEAgLTE0NTcsOSArMTQ2Niw5IEBAIGludCBkZnNfY2FjaGVfcmVtb3VudF9mcyhzdHJ1
Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiKQogc3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3Jr
ZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8g
KnNlcnZlcjsKLQlzdHJ1Y3QgY2lmc19zZXMgKnNlczsKIAlzdHJ1Y3QgY2lmc190Y29uICp0Y29u
LCAqbnRjb247CiAJc3RydWN0IGxpc3RfaGVhZCB0Y29uczsKKwlzdHJ1Y3QgY2lmc19zZXMgKnNl
czsKIAogCUlOSVRfTElTVF9IRUFEKCZ0Y29ucyk7CiAKQEAgLTE0NjksMjMgKzE0NzgsMTUgQEAg
c3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCQkJY29udGludWU7CiAKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeShzZXMsICZzZXJ2ZXItPnNt
Yl9zZXNfbGlzdCwgc21iX3Nlc19saXN0KSB7Ci0JCQlzdHJ1Y3QgY2lmc19zZXMgKnJvb3Rfc2Vz
ID0gQ0lGU19ERlNfUk9PVF9TRVMoc2VzKTsKLQotCQkJc3Bpbl9sb2NrKCZyb290X3Nlcy0+c2Vz
X2xvY2spOwotCQkJaWYgKHJvb3Rfc2VzLT5zZXNfc3RhdHVzICE9IFNFU19HT09EKSB7Ci0JCQkJ
c3Bpbl91bmxvY2soJnJvb3Rfc2VzLT5zZXNfbG9jayk7Ci0JCQkJY29udGludWU7CisJCQlpZiAo
c2VzLT50Y29uX2lwYykgeworCQkJCXNlcy0+c2VzX2NvdW50Kys7CisJCQkJbGlzdF9hZGRfdGFp
bCgmc2VzLT50Y29uX2lwYy0+dWxpc3QsICZ0Y29ucyk7CiAJCQl9Ci0JCQlzcGluX3VubG9jaygm
cm9vdF9zZXMtPnNlc19sb2NrKTsKLQogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeSh0Y29uLCAmc2Vz
LT50Y29uX2xpc3QsIHRjb25fbGlzdCkgewotCQkJCXNwaW5fbG9jaygmdGNvbi0+dGNfbG9jayk7
Ci0JCQkJaWYgKCF0Y29uLT5pcGMgJiYgdGNvbi0+c3RhdHVzICE9IFRJRF9ORVcgJiYKLQkJCQkg
ICAgdGNvbi0+c3RhdHVzICE9IFRJRF9ORUVEX1RDT04pIHsKKwkJCQlpZiAoIXRjb24tPmlwYykg
ewogCQkJCQl0Y29uLT50Y19jb3VudCsrOwogCQkJCQlsaXN0X2FkZF90YWlsKCZ0Y29uLT51bGlz
dCwgJnRjb25zKTsKIAkJCQl9Ci0JCQkJc3Bpbl91bmxvY2soJnRjb24tPnRjX2xvY2spOwogCQkJ
fQogCQl9CiAJfQpAQCAtMTUwMSw3ICsxNTAyLDEwIEBAIHN0YXRpYyB2b2lkIHJlZnJlc2hfY2Fj
aGVfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkJCV9fcmVmcmVzaF90Y29uKHNl
cnZlci0+bGVhZl9mdWxscGF0aCArIDEsIHRjb24sIGZhbHNlKTsKIAkJbXV0ZXhfdW5sb2NrKCZz
ZXJ2ZXItPnJlZnBhdGhfbG9jayk7CiAKLQkJY2lmc19wdXRfdGNvbih0Y29uKTsKKwkJaWYgKHRj
b24tPmlwYykKKwkJCWNpZnNfcHV0X3NtYl9zZXModGNvbi0+c2VzKTsKKwkJZWxzZQorCQkJY2lm
c19wdXRfdGNvbih0Y29uKTsKIAl9CiAKIAlzcGluX2xvY2soJmNhY2hlX3R0bF9sb2NrKTsKLS0g
CjIuMzQuMQoK
--00000000000061094b05f0084e71
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0008-cifs-fix-refresh-of-cached-referrals.patch"
Content-Disposition: attachment; 
	filename="0008-cifs-fix-refresh-of-cached-referrals.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs4w6vh1>
X-Attachment-Id: f_lbs4w6vh1

RnJvbSBlMjdlMDU2ZjA4MDI2NzI2ZjM2Mjc1ZjkxY2VkNzZjODgxMjc4MThkIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogVHVl
LCAxMyBEZWMgMjAyMiAwMToyMzoxNiAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMDgvMTRdIGNpZnM6
IGZpeCByZWZyZXNoIG9mIGNhY2hlZCByZWZlcnJhbHMKCldlIGNhbid0IHJlbHkgb24gY2lmc190
Y29uOjpzZXMgdG8gcmVmcmVzaCBjYWNoZWQgcmVmZXJyYWwgYXMgdGhlCnNlcnZlciB0YXJnZXQg
bWlnaHQgbm90IHJlc3BvbmQgdG8gcmVmZXJyYWxzLCBlLmcuIHNoYXJlIGlzIG5vdCBob3N0ZWQK
aW4gYSBERlMgcm9vdCBzZXJ2ZXIuICBDb25zaWRlciB0aGUgZm9sbG93aW5nCgogIG1vdW50IC8v
ZG9tL2Rmcy9saW5rIC0+IC9yb290MS9kZnMvbGluayAtPiAvZnMwL3NoYXJlCgp3aGVyZSBmczAg
Y2FuJ3QgZ2V0IGEgcmVmZXJyYWwgZm9yICIvcm9vdDEvZGZzL2xpbmsiLgoKVG8gc2ltcGxpZnkg
YW5kIGZpeCB0aGUgYWNjZXNzIG9mIGRmcyByb290IHNlc3Npb25zLCBzdG9yZSB0aGUgZGZzCnJv
b3Qgc2Vzc2lvbiBwb2ludGVyIGRpcmVjdGx5IHRvIG5ldyBzZXNzaW9ucyBzbyBtYWtpbmcgaXQg
ZWFzaWVyIHRvCnNlbGVjdCB0aGUgYXBwcm9wcmlhdGUgaXBjIGNvbm5lY3Rpb24gYW5kIHVzZSBp
dCBmb3IgZmFpbG92ZXIgb3IgY2FjaGUKcmVmcmVzaC4KClNpZ25lZC1vZmYtYnk6IFBhdWxvIEFs
Y2FudGFyYSAoU1VTRSkgPHBjQGNqci5uej4KU2lnbmVkLW9mZi1ieTogU3RldmUgRnJlbmNoIDxz
dGZyZW5jaEBtaWNyb3NvZnQuY29tPgotLS0KIGZzL2NpZnMvY2lmc2dsb2IuaCAgfCAgIDMgKwog
ZnMvY2lmcy9jb25uZWN0LmMgICB8ICAgNSArLQogZnMvY2lmcy9kZnMuYyAgICAgICB8ICAgNiAr
KwogZnMvY2lmcy9kZnNfY2FjaGUuYyB8IDE0MCArKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAzNyBpbnNlcnRpb25zKCspLCAxMTcg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZnMvY2lmcy9jaWZzZ2xvYi5oIGIvZnMvY2lmcy9j
aWZzZ2xvYi5oCmluZGV4IDJlMjk3NmYxODc0Zi4uY2ZkZDViZjcwMWExIDEwMDY0NAotLS0gYS9m
cy9jaWZzL2NpZnNnbG9iLmgKKysrIGIvZnMvY2lmcy9jaWZzZ2xvYi5oCkBAIC0xMDcsNiArMTA3
LDggQEAKIAogI2RlZmluZSBDSUZTX01BWF9XT1JLU1RBVElPTl9MRU4gIChfX05FV19VVFNfTEVO
ICsgMSkgIC8qIHJlYXNvbmFibGUgbWF4IGZvciBjbGllbnQgKi8KIAorI2RlZmluZSBDSUZTX0RG
U19ST09UX1NFUyhzZXMpICgoc2VzKS0+ZGZzX3Jvb3Rfc2VzID86IChzZXMpKQorCiAvKgogICog
Q0lGUyB2ZnMgY2xpZW50IFN0YXR1cyBpbmZvcm1hdGlvbiAoYmFzZWQgb24gd2hhdCB3ZSBrbm93
LikKICAqLwpAQCAtMTA5OSw2ICsxMTAxLDcgQEAgc3RydWN0IGNpZnNfc2VzIHsKIAkgKi8KIAl1
bnNpZ25lZCBsb25nIGNoYW5zX25lZWRfcmVjb25uZWN0OwogCS8qID09PT09PT09PSBlbmQ6IHBy
b3RlY3RlZCBieSBjaGFuX2xvY2sgPT09PT09PT0gKi8KKwlzdHJ1Y3QgY2lmc19zZXMgKmRmc19y
b290X3NlczsKIH07CiAKIHN0YXRpYyBpbmxpbmUgYm9vbApkaWZmIC0tZ2l0IGEvZnMvY2lmcy9j
b25uZWN0LmMgYi9mcy9jaWZzL2Nvbm5lY3QuYwppbmRleCBhNjZjYjIzYTk1NGUuLmRiM2EyYjNh
YzQ5NyAxMDA2NDQKLS0tIGEvZnMvY2lmcy9jb25uZWN0LmMKKysrIGIvZnMvY2lmcy9jb25uZWN0
LmMKQEAgLTQxNTAsNyArNDE1MCw4IEBAIHN0YXRpYyBpbnQgX190cmVlX2Nvbm5lY3RfZGZzX3Rh
cmdldChjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3QgY2lmc190Y29uICp0CiAJaW50IHJj
OwogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOwog
CWNvbnN0IHN0cnVjdCBzbWJfdmVyc2lvbl9vcGVyYXRpb25zICpvcHMgPSBzZXJ2ZXItPm9wczsK
LQlzdHJ1Y3QgY2lmc190Y29uICppcGMgPSB0Y29uLT5zZXMtPnRjb25faXBjOworCXN0cnVjdCBj
aWZzX3NlcyAqcm9vdF9zZXMgPSBDSUZTX0RGU19ST09UX1NFUyh0Y29uLT5zZXMpOworCXN0cnVj
dCBjaWZzX3Rjb24gKmlwYyA9IHJvb3Rfc2VzLT50Y29uX2lwYzsKIAljaGFyICpzaGFyZSA9IE5V
TEwsICpwcmVmaXggPSBOVUxMOwogCWNvbnN0IGNoYXIgKnRjcF9ob3N0OwogCXNpemVfdCB0Y3Bf
aG9zdF9sZW47CkBAIC00MjA4LDcgKzQyMDksNyBAQCBzdGF0aWMgaW50IF9fdHJlZV9jb25uZWN0
X2Rmc190YXJnZXQoY29uc3QgdW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdAog
CQkgKiByZWNvbm5lY3Qgc28gZWl0aGVyIHRoZSBkZW11bHRpcGxleCB0aHJlYWQgb3IgdGhlIGVj
aG8gd29ya2VyIHdpbGwgcmVjb25uZWN0IHRvCiAJCSAqIG5ld2x5IHJlc29sdmVkIHRhcmdldC4K
IAkJICovCi0JCWlmIChkZnNfY2FjaGVfZmluZCh4aWQsIHRjb24tPnNlcywgY2lmc19zYi0+bG9j
YWxfbmxzLCBjaWZzX3JlbWFwKGNpZnNfc2IpLCB0YXJnZXQsCisJCWlmIChkZnNfY2FjaGVfZmlu
ZCh4aWQsIHJvb3Rfc2VzLCBjaWZzX3NiLT5sb2NhbF9ubHMsIGNpZnNfcmVtYXAoY2lmc19zYiks
IHRhcmdldCwKIAkJCQkgICBOVUxMLCAmbnRsKSkgewogCQkJcmMgPSBvcHMtPnRyZWVfY29ubmVj
dCh4aWQsIHRjb24tPnNlcywgdHJlZSwgdGNvbiwgY2lmc19zYi0+bG9jYWxfbmxzKTsKIAkJCWlm
IChyYykKZGlmZiAtLWdpdCBhL2ZzL2NpZnMvZGZzLmMgYi9mcy9jaWZzL2Rmcy5jCmluZGV4IDg4
YTBjYWIzMzViNC4uZmJjOGU4ODBhMWZlIDEwMDY0NAotLS0gYS9mcy9jaWZzL2Rmcy5jCisrKyBi
L2ZzL2NpZnMvZGZzLmMKQEAgLTk1LDcgKzk1LDEzIEBAIHN0YXRpYyBpbnQgZ2V0X3Nlc3Npb24o
c3RydWN0IGNpZnNfbW91bnRfY3R4ICptbnRfY3R4LCBjb25zdCBjaGFyICpmdWxsX3BhdGgpCiAJ
Y3R4LT5sZWFmX2Z1bGxwYXRoID0gKGNoYXIgKilmdWxsX3BhdGg7CiAJcmMgPSBjaWZzX21vdW50
X2dldF9zZXNzaW9uKG1udF9jdHgpOwogCWN0eC0+bGVhZl9mdWxscGF0aCA9IE5VTEw7CisJaWYg
KCFyYykgeworCQlzdHJ1Y3QgY2lmc19zZXMgKnNlcyA9IG1udF9jdHgtPnNlczsKIAorCQltdXRl
eF9sb2NrKCZzZXMtPnNlc3Npb25fbXV0ZXgpOworCQlzZXMtPmRmc19yb290X3NlcyA9IG1udF9j
dHgtPnJvb3Rfc2VzOworCQltdXRleF91bmxvY2soJnNlcy0+c2Vzc2lvbl9tdXRleCk7CisJfQog
CXJldHVybiByYzsKIH0KIApkaWZmIC0tZ2l0IGEvZnMvY2lmcy9kZnNfY2FjaGUuYyBiL2ZzL2Np
ZnMvZGZzX2NhY2hlLmMKaW5kZXggYmVmNjcyNTM0Mzk3Li45NWNjMzk1MTQyMGUgMTAwNjQ0Ci0t
LSBhL2ZzL2NpZnMvZGZzX2NhY2hlLmMKKysrIGIvZnMvY2lmcy9kZnNfY2FjaGUuYwpAQCAtODMs
MjcgKzgzLDYgQEAgc3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3JrZXIoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKTsKIAogc3RhdGljIERFQ0xBUkVfREVMQVlFRF9XT1JLKHJlZnJlc2hfdGFz
aywgcmVmcmVzaF9jYWNoZV93b3JrZXIpOwogCi1zdGF0aWMgdm9pZCBnZXRfaXBjX3VuYyhjb25z
dCBjaGFyICpyZWZfcGF0aCwgY2hhciAqaXBjLCBzaXplX3QgaXBjbGVuKQotewotCWNvbnN0IGNo
YXIgKmhvc3Q7Ci0Jc2l6ZV90IGxlbjsKLQotCWV4dHJhY3RfdW5jX2hvc3RuYW1lKHJlZl9wYXRo
LCAmaG9zdCwgJmxlbik7Ci0Jc2NucHJpbnRmKGlwYywgaXBjbGVuLCAiXFxcXCUuKnNcXElQQyQi
LCAoaW50KWxlbiwgaG9zdCk7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgY2lmc19zZXMgKmZpbmRfaXBj
X2Zyb21fc2VydmVyX3BhdGgoc3RydWN0IGNpZnNfc2VzICoqc2VzLCBjb25zdCBjaGFyICpwYXRo
KQotewotCWNoYXIgdW5jW1NFUlZFUl9OQU1FX0xFTkdUSCArIHNpemVvZigiLy94L0lQQyQiKV0g
PSB7MH07Ci0KLQlnZXRfaXBjX3VuYyhwYXRoLCB1bmMsIHNpemVvZih1bmMpKTsKLQlmb3IgKDsg
KnNlczsgc2VzKyspIHsKLQkJaWYgKCFzdHJjYXNlY21wKHVuYywgKCpzZXMpLT50Y29uX2lwYy0+
dHJlZV9uYW1lKSkKLQkJCXJldHVybiAqc2VzOwotCX0KLQlyZXR1cm4gRVJSX1BUUigtRU5PRU5U
KTsKLX0KLQogc3RhdGljIHZvaWQgX19tb3VudF9ncm91cF9yZWxlYXNlKHN0cnVjdCBtb3VudF9n
cm91cCAqbWcpCiB7CiAJaW50IGk7CkBAIC03NjAsOCArNzM5LDYgQEAgc3RhdGljIGludCBnZXRf
ZGZzX3JlZmVycmFsKGNvbnN0IHVuc2lnbmVkIGludCB4aWQsIHN0cnVjdCBjaWZzX3NlcyAqc2Vz
LCBjb25zdAogCWludCByYzsKIAlpbnQgaTsKIAotCWNpZnNfZGJnKEZZSSwgIiVzOiBnZXQgYW4g
REZTIHJlZmVycmFsIGZvciAlc1xuIiwgX19mdW5jX18sIHBhdGgpOwotCiAJKnJlZnMgPSBOVUxM
OwogCSpudW1yZWZzID0gMDsKIApAQCAtNzcwLDYgKzc0Nyw3IEBAIHN0YXRpYyBpbnQgZ2V0X2Rm
c19yZWZlcnJhbChjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3QgY2lmc19zZXMgKnNlcywg
Y29uc3QKIAlpZiAodW5saWtlbHkoIWNhY2hlX2NwKSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKKwlj
aWZzX2RiZyhGWUksICIlczogaXBjPSVzIHJlZmVycmFsPSVzXG4iLCBfX2Z1bmNfXywgc2VzLT50
Y29uX2lwYy0+dHJlZV9uYW1lLCBwYXRoKTsKIAlyYyA9ICBzZXMtPnNlcnZlci0+b3BzLT5nZXRf
ZGZzX3JlZmVyKHhpZCwgc2VzLCBwYXRoLCByZWZzLCBudW1yZWZzLCBjYWNoZV9jcCwKIAkJCQkJ
ICAgICAgTk9fTUFQX1VOSV9SU1ZEKTsKIAlpZiAoIXJjKSB7CkBAIC0xMzY2LDEwICsxMzQ0LDkg
QEAgc3RhdGljIHZvaWQgbWFya19mb3JfcmVjb25uZWN0X2lmX25lZWRlZChzdHJ1Y3QgY2lmc190
Y29uICp0Y29uLCBzdHJ1Y3QgZGZzX2NhY2gKIH0KIAogLyogUmVmcmVzaCBkZnMgcmVmZXJyYWwg
b2YgdGNvbiBhbmQgbWFyayBpdCBmb3IgcmVjb25uZWN0IGlmIG5lZWRlZCAqLwotc3RhdGljIGlu
dCBfX3JlZnJlc2hfdGNvbihjb25zdCBjaGFyICpwYXRoLCBzdHJ1Y3QgY2lmc19zZXMgKipzZXNz
aW9ucywgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwKLQkJCSAgYm9vbCBmb3JjZV9yZWZyZXNoKQor
c3RhdGljIGludCBfX3JlZnJlc2hfdGNvbihjb25zdCBjaGFyICpwYXRoLCBzdHJ1Y3QgY2lmc190
Y29uICp0Y29uLCBib29sIGZvcmNlX3JlZnJlc2gpCiB7Ci0Jc3RydWN0IGNpZnNfc2VzICpzZXM7
CisJc3RydWN0IGNpZnNfc2VzICpzZXMgPSBDSUZTX0RGU19ST09UX1NFUyh0Y29uLT5zZXMpOwog
CXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7CiAJc3RydWN0IGRmc19pbmZvM19wYXJhbSAqcmVmcyA9
IE5VTEw7CiAJaW50IG51bXJlZnMgPSAwOwpAQCAtMTM3OCwxMSArMTM1NSw3IEBAIHN0YXRpYyBp
bnQgX19yZWZyZXNoX3Rjb24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNfc2VzICoqc2Vz
c2lvbnMsIHN0cnVjdCBjCiAJaW50IHJjID0gMDsKIAl1bnNpZ25lZCBpbnQgeGlkOwogCi0Jc2Vz
ID0gZmluZF9pcGNfZnJvbV9zZXJ2ZXJfcGF0aChzZXNzaW9ucywgcGF0aCk7Ci0JaWYgKElTX0VS
UihzZXMpKSB7Ci0JCWNpZnNfZGJnKEZZSSwgIiVzOiBjb3VsZCBub3QgZmluZCBpcGMgc2Vzc2lv
blxuIiwgX19mdW5jX18pOwotCQlyZXR1cm4gUFRSX0VSUihzZXMpOwotCX0KKwl4aWQgPSBnZXRf
eGlkKCk7CiAKIAlkb3duX3JlYWQoJmh0YWJsZV9yd19sb2NrKTsKIAljZSA9IGxvb2t1cF9jYWNo
ZV9lbnRyeShwYXRoKTsKQEAgLTEzOTksMTIgKzEzNzIsOSBAQCBzdGF0aWMgaW50IF9fcmVmcmVz
aF90Y29uKGNvbnN0IGNoYXIgKnBhdGgsIHN0cnVjdCBjaWZzX3NlcyAqKnNlc3Npb25zLCBzdHJ1
Y3QgYwogCQlnb3RvIG91dDsKIAl9CiAKLQl4aWQgPSBnZXRfeGlkKCk7CiAJcmMgPSBnZXRfZGZz
X3JlZmVycmFsKHhpZCwgc2VzLCBwYXRoLCAmcmVmcywgJm51bXJlZnMpOwotCWZyZWVfeGlkKHhp
ZCk7Ci0KLQkvKiBDcmVhdGUgb3IgdXBkYXRlIGEgY2FjaGUgZW50cnkgd2l0aCB0aGUgbmV3IHJl
ZmVycmFsICovCiAJaWYgKCFyYykgeworCQkvKiBDcmVhdGUgb3IgdXBkYXRlIGEgY2FjaGUgZW50
cnkgd2l0aCB0aGUgbmV3IHJlZmVycmFsICovCiAJCWR1bXBfcmVmcyhyZWZzLCBudW1yZWZzKTsK
IAogCQlkb3duX3dyaXRlKCZodGFibGVfcndfbG9jayk7CkBAIC0xNDE5LDI0ICsxMzg5LDIwIEBA
IHN0YXRpYyBpbnQgX19yZWZyZXNoX3Rjb24oY29uc3QgY2hhciAqcGF0aCwgc3RydWN0IGNpZnNf
c2VzICoqc2Vzc2lvbnMsIHN0cnVjdCBjCiAJfQogCiBvdXQ6CisJZnJlZV94aWQoeGlkKTsKIAlk
ZnNfY2FjaGVfZnJlZV90Z3RzKCZ0bCk7CiAJZnJlZV9kZnNfaW5mb19hcnJheShyZWZzLCBudW1y
ZWZzKTsKIAlyZXR1cm4gcmM7CiB9CiAKLXN0YXRpYyBpbnQgcmVmcmVzaF90Y29uKHN0cnVjdCBj
aWZzX3NlcyAqKnNlc3Npb25zLCBzdHJ1Y3QgY2lmc190Y29uICp0Y29uLCBib29sIGZvcmNlX3Jl
ZnJlc2gpCitzdGF0aWMgaW50IHJlZnJlc2hfdGNvbihzdHJ1Y3QgY2lmc190Y29uICp0Y29uLCBi
b29sIGZvcmNlX3JlZnJlc2gpCiB7CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyID0g
dGNvbi0+c2VzLT5zZXJ2ZXI7CiAKIAltdXRleF9sb2NrKCZzZXJ2ZXItPnJlZnBhdGhfbG9jayk7
Ci0JaWYgKHNlcnZlci0+b3JpZ2luX2Z1bGxwYXRoKSB7Ci0JCWlmIChzZXJ2ZXItPmxlYWZfZnVs
bHBhdGggJiYgc3RyY2FzZWNtcChzZXJ2ZXItPmxlYWZfZnVsbHBhdGgsCi0JCQkJCQkJc2VydmVy
LT5vcmlnaW5fZnVsbHBhdGgpKQotCQkJX19yZWZyZXNoX3Rjb24oc2VydmVyLT5sZWFmX2Z1bGxw
YXRoICsgMSwgc2Vzc2lvbnMsIHRjb24sIGZvcmNlX3JlZnJlc2gpOwotCQlfX3JlZnJlc2hfdGNv
bihzZXJ2ZXItPm9yaWdpbl9mdWxscGF0aCArIDEsIHNlc3Npb25zLCB0Y29uLCBmb3JjZV9yZWZy
ZXNoKTsKLQl9CisJaWYgKHNlcnZlci0+bGVhZl9mdWxscGF0aCkKKwkJX19yZWZyZXNoX3Rjb24o
c2VydmVyLT5sZWFmX2Z1bGxwYXRoICsgMSwgdGNvbiwgZm9yY2VfcmVmcmVzaCk7CiAJbXV0ZXhf
dW5sb2NrKCZzZXJ2ZXItPnJlZnBhdGhfbG9jayk7Ci0KIAlyZXR1cm4gMDsKIH0KIApAQCAtMTQ1
NCw5ICsxNDIwLDYgQEAgaW50IGRmc19jYWNoZV9yZW1vdW50X2ZzKHN0cnVjdCBjaWZzX3NiX2lu
Zm8gKmNpZnNfc2IpCiB7CiAJc3RydWN0IGNpZnNfdGNvbiAqdGNvbjsKIAlzdHJ1Y3QgVENQX1Nl
cnZlcl9JbmZvICpzZXJ2ZXI7Ci0Jc3RydWN0IG1vdW50X2dyb3VwICptZzsKLQlzdHJ1Y3QgY2lm
c19zZXMgKnNlc3Npb25zW0NBQ0hFX01BWF9FTlRSSUVTICsgMV0gPSB7TlVMTH07Ci0JaW50IHJj
OwogCiAJaWYgKCFjaWZzX3NiIHx8ICFjaWZzX3NiLT5tYXN0ZXJfdGxpbmspCiAJCXJldHVybiAt
RUlOVkFMOwpAQCAtMTQ3MywyMSArMTQzNiw2IEBAIGludCBkZnNfY2FjaGVfcmVtb3VudF9mcyhz
dHJ1Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiKQogCQljaWZzX2RiZyhGWUksICIlczogbm8gZGZz
IG1vdW50IGdyb3VwIGlkXG4iLCBfX2Z1bmNfXyk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KLQot
CW11dGV4X2xvY2soJm1vdW50X2dyb3VwX2xpc3RfbG9jayk7Ci0JbWcgPSBmaW5kX21vdW50X2dy
b3VwX2xvY2tlZCgmY2lmc19zYi0+ZGZzX21vdW50X2lkKTsKLQlpZiAoSVNfRVJSKG1nKSkgewot
CQltdXRleF91bmxvY2soJm1vdW50X2dyb3VwX2xpc3RfbG9jayk7Ci0JCWNpZnNfZGJnKEZZSSwg
IiVzOiBubyBpcGMgc2Vzc2lvbiBmb3IgcmVmcmVzaGluZyByZWZlcnJhbFxuIiwgX19mdW5jX18p
OwotCQlyZXR1cm4gUFRSX0VSUihtZyk7Ci0JfQotCWtyZWZfZ2V0KCZtZy0+cmVmY291bnQpOwot
CW11dGV4X3VubG9jaygmbW91bnRfZ3JvdXBfbGlzdF9sb2NrKTsKLQotCXNwaW5fbG9jaygmbWct
PmxvY2spOwotCW1lbWNweSgmc2Vzc2lvbnMsIG1nLT5zZXNzaW9ucywgbWctPm51bV9zZXNzaW9u
cyAqIHNpemVvZihtZy0+c2Vzc2lvbnNbMF0pKTsKLQlzcGluX3VubG9jaygmbWctPmxvY2spOwot
CiAJLyoKIAkgKiBBZnRlciByZWNvbm5lY3RpbmcgdG8gYSBkaWZmZXJlbnQgc2VydmVyLCB1bmlx
dWUgaWRzIHdvbid0IG1hdGNoIGFueW1vcmUsIHNvIHdlIGRpc2FibGUKIAkgKiBzZXJ2ZXJpbm8u
IFRoaXMgcHJldmVudHMgZGVudHJ5IHJldmFsaWRhdGlvbiB0byB0aGluayB0aGUgZGVudHJ5IGFy
ZSBzdGFsZSAoRVNUQUxFKS4KQEAgLTE0OTgsMTcgKzE0NDYsMTUgQEAgaW50IGRmc19jYWNoZV9y
ZW1vdW50X2ZzKHN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IpCiAJICogdGhhdCBoYXZlIGRp
ZmZlcmVudCBwcmVmaXggcGF0aHMuCiAJICovCiAJY2lmc19zYi0+bW50X2NpZnNfZmxhZ3MgfD0g
Q0lGU19NT1VOVF9VU0VfUFJFRklYX1BBVEg7Ci0JcmMgPSByZWZyZXNoX3Rjb24oc2Vzc2lvbnMs
IHRjb24sIHRydWUpOwogCi0Ja3JlZl9wdXQoJm1nLT5yZWZjb3VudCwgbW91bnRfZ3JvdXBfcmVs
ZWFzZSk7Ci0JcmV0dXJuIHJjOworCXJldHVybiByZWZyZXNoX3Rjb24odGNvbiwgdHJ1ZSk7CiB9
CiAKIC8qCi0gKiBSZWZyZXNoIGFsbCBhY3RpdmUgZGZzIG1vdW50cyByZWdhcmRsZXNzIG9mIHdo
ZXRoZXIgdGhleSBhcmUgaW4gY2FjaGUgb3Igbm90LgotICogKGNhY2hlIGNhbiBiZSBjbGVhcmVk
KQorICogV29ya2VyIHRoYXQgd2lsbCByZWZyZXNoIERGUyBjYWNoZSBmcm9tIGFsbCBhY3RpdmUg
bW91bnRzIGJhc2VkIG9uIGxvd2VzdCBUVEwgdmFsdWUKKyAqIGZyb20gYSBERlMgcmVmZXJyYWwu
CiAgKi8KLXN0YXRpYyB2b2lkIHJlZnJlc2hfbW91bnRzKHN0cnVjdCBjaWZzX3NlcyAqKnNlc3Np
b25zKQorc3RhdGljIHZvaWQgcmVmcmVzaF9jYWNoZV93b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0
ICp3b3JrKQogewogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlcjsKIAlzdHJ1Y3QgY2lm
c19zZXMgKnNlczsKQEAgLTE1MjMsOSArMTQ2OSwxOSBAQCBzdGF0aWMgdm9pZCByZWZyZXNoX21v
dW50cyhzdHJ1Y3QgY2lmc19zZXMgKipzZXNzaW9ucykKIAkJCWNvbnRpbnVlOwogCiAJCWxpc3Rf
Zm9yX2VhY2hfZW50cnkoc2VzLCAmc2VydmVyLT5zbWJfc2VzX2xpc3QsIHNtYl9zZXNfbGlzdCkg
eworCQkJc3RydWN0IGNpZnNfc2VzICpyb290X3NlcyA9IENJRlNfREZTX1JPT1RfU0VTKHNlcyk7
CisKKwkJCXNwaW5fbG9jaygmcm9vdF9zZXMtPnNlc19sb2NrKTsKKwkJCWlmIChyb290X3Nlcy0+
c2VzX3N0YXR1cyAhPSBTRVNfR09PRCkgeworCQkJCXNwaW5fdW5sb2NrKCZyb290X3Nlcy0+c2Vz
X2xvY2spOworCQkJCWNvbnRpbnVlOworCQkJfQorCQkJc3Bpbl91bmxvY2soJnJvb3Rfc2VzLT5z
ZXNfbG9jayk7CisKIAkJCWxpc3RfZm9yX2VhY2hfZW50cnkodGNvbiwgJnNlcy0+dGNvbl9saXN0
LCB0Y29uX2xpc3QpIHsKIAkJCQlzcGluX2xvY2soJnRjb24tPnRjX2xvY2spOwotCQkJCWlmICgh
dGNvbi0+aXBjICYmICF0Y29uLT5uZWVkX3JlY29ubmVjdCkgeworCQkJCWlmICghdGNvbi0+aXBj
ICYmIHRjb24tPnN0YXR1cyAhPSBUSURfTkVXICYmCisJCQkJICAgIHRjb24tPnN0YXR1cyAhPSBU
SURfTkVFRF9UQ09OKSB7CiAJCQkJCXRjb24tPnRjX2NvdW50Kys7CiAJCQkJCWxpc3RfYWRkX3Rh
aWwoJnRjb24tPnVsaXN0LCAmdGNvbnMpOwogCQkJCX0KQEAgLTE1NDIsNTcgKzE0OTgsMTEgQEAg
c3RhdGljIHZvaWQgcmVmcmVzaF9tb3VudHMoc3RydWN0IGNpZnNfc2VzICoqc2Vzc2lvbnMpCiAK
IAkJbXV0ZXhfbG9jaygmc2VydmVyLT5yZWZwYXRoX2xvY2spOwogCQlpZiAoc2VydmVyLT5sZWFm
X2Z1bGxwYXRoKQotCQkJX19yZWZyZXNoX3Rjb24oc2VydmVyLT5sZWFmX2Z1bGxwYXRoICsgMSwg
c2Vzc2lvbnMsIHRjb24sIGZhbHNlKTsKKwkJCV9fcmVmcmVzaF90Y29uKHNlcnZlci0+bGVhZl9m
dWxscGF0aCArIDEsIHRjb24sIGZhbHNlKTsKIAkJbXV0ZXhfdW5sb2NrKCZzZXJ2ZXItPnJlZnBh
dGhfbG9jayk7CiAKIAkJY2lmc19wdXRfdGNvbih0Y29uKTsKIAl9Ci19Ci0KLS8qCi0gKiBXb3Jr
ZXIgdGhhdCB3aWxsIHJlZnJlc2ggREZTIGNhY2hlIGFuZCBhY3RpdmUgbW91bnRzIGJhc2VkIG9u
IGxvd2VzdCBUVEwgdmFsdWUgZnJvbSBhIERGUwotICogcmVmZXJyYWwuCi0gKi8KLXN0YXRpYyB2
b2lkIHJlZnJlc2hfY2FjaGVfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKLXsKLQlz
dHJ1Y3QgbGlzdF9oZWFkIG1nbGlzdDsKLQlzdHJ1Y3QgbW91bnRfZ3JvdXAgKm1nLCAqdG1wX21n
OwotCXN0cnVjdCBjaWZzX3NlcyAqc2Vzc2lvbnNbQ0FDSEVfTUFYX0VOVFJJRVMgKyAxXSA9IHtO
VUxMfTsKLQlpbnQgbWF4X3Nlc3Npb25zID0gQVJSQVlfU0laRShzZXNzaW9ucykgLSAxOwotCWlu
dCBpID0gMCwgY291bnQ7Ci0KLQlJTklUX0xJU1RfSEVBRCgmbWdsaXN0KTsKLQotCS8qIEdldCBy
ZWZlcmVjZXMgb2YgbW91bnQgZ3JvdXBzICovCi0JbXV0ZXhfbG9jaygmbW91bnRfZ3JvdXBfbGlz
dF9sb2NrKTsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG1nLCAmbW91bnRfZ3JvdXBfbGlzdCwgbGlz
dCkgewotCQlrcmVmX2dldCgmbWctPnJlZmNvdW50KTsKLQkJbGlzdF9hZGQoJm1nLT5yZWZyZXNo
X2xpc3QsICZtZ2xpc3QpOwotCX0KLQltdXRleF91bmxvY2soJm1vdW50X2dyb3VwX2xpc3RfbG9j
ayk7Ci0KLQkvKiBGaWxsIGluIGxvY2FsIGFycmF5IHdpdGggYW4gTlVMTC10ZXJtaW5hdGVkIGxp
c3Qgb2YgYWxsIHJlZmVycmFsIHNlcnZlciBzZXNzaW9ucyAqLwotCWxpc3RfZm9yX2VhY2hfZW50
cnkobWcsICZtZ2xpc3QsIHJlZnJlc2hfbGlzdCkgewotCQlpZiAoaSA+PSBtYXhfc2Vzc2lvbnMp
Ci0JCQlicmVhazsKLQotCQlzcGluX2xvY2soJm1nLT5sb2NrKTsKLQkJaWYgKGkgKyBtZy0+bnVt
X3Nlc3Npb25zID4gbWF4X3Nlc3Npb25zKQotCQkJY291bnQgPSBtYXhfc2Vzc2lvbnMgLSBpOwot
CQllbHNlCi0JCQljb3VudCA9IG1nLT5udW1fc2Vzc2lvbnM7Ci0JCW1lbWNweSgmc2Vzc2lvbnNb
aV0sIG1nLT5zZXNzaW9ucywgY291bnQgKiBzaXplb2YobWctPnNlc3Npb25zWzBdKSk7Ci0JCXNw
aW5fdW5sb2NrKCZtZy0+bG9jayk7Ci0JCWkgKz0gY291bnQ7Ci0JfQotCi0JaWYgKHNlc3Npb25z
WzBdKQotCQlyZWZyZXNoX21vdW50cyhzZXNzaW9ucyk7Ci0KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5
X3NhZmUobWcsIHRtcF9tZywgJm1nbGlzdCwgcmVmcmVzaF9saXN0KSB7Ci0JCWxpc3RfZGVsX2lu
aXQoJm1nLT5yZWZyZXNoX2xpc3QpOwotCQlrcmVmX3B1dCgmbWctPnJlZmNvdW50LCBtb3VudF9n
cm91cF9yZWxlYXNlKTsKLQl9CiAKIAlzcGluX2xvY2soJmNhY2hlX3R0bF9sb2NrKTsKIAlxdWV1
ZV9kZWxheWVkX3dvcmsoZGZzY2FjaGVfd3EsICZyZWZyZXNoX3Rhc2ssIGNhY2hlX3R0bCAqIEha
KTsKLS0gCjIuMzQuMQoK
--00000000000061094b05f0084e71
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0007-cifs-don-t-refresh-cached-referrals-from-unactive-mo.patch"
Content-Disposition: attachment; 
	filename="0007-cifs-don-t-refresh-cached-referrals-from-unactive-mo.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lbs4wa2o2>
X-Attachment-Id: f_lbs4wa2o2

RnJvbSAwY2UxN2I0YmRiNTA4ZDIyM2NjMDdkYjMyNGFlMzMxMTNlZGFmOTM4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsbyBBbGNhbnRhcmEgPHBjQGNqci5uej4KRGF0ZTogVHVl
LCAxMyBEZWMgMjAyMiAwMDoyOToyMiAtMDMwMApTdWJqZWN0OiBbUEFUQ0ggMDcvMTRdIGNpZnM6
IGRvbid0IHJlZnJlc2ggY2FjaGVkIHJlZmVycmFscyBmcm9tIHVuYWN0aXZlCiBtb3VudHMKClRo
ZXJlIGlzIG5vIHBvaW50IHJlZnJlc2hpbmcgY2FjaGVkIHJlZmVycmFscyBmcm9tIHVuYWN0aXZl
IG1vdW50cyBhcwp0aGV5IHdpbGwgbm8gbG9uZ2VyIGJlIHVzZWQgYW5kIG5ldyBtb3VudHMgd2ls
bCBlaXRoZXIgY3JlYXRlIG9yCnJlZnJlc2ggdGhlbSBhbnl3YXkuCgpTaWduZWQtb2ZmLWJ5OiBQ
YXVsbyBBbGNhbnRhcmEgKFNVU0UpIDxwY0BjanIubno+ClNpZ25lZC1vZmYtYnk6IFN0ZXZlIEZy
ZW5jaCA8c3RmcmVuY2hAbWljcm9zb2Z0LmNvbT4KLS0tCiBmcy9jaWZzL2Rmc19jYWNoZS5jIHwg
NzMgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUg
Y2hhbmdlZCwgMSBpbnNlcnRpb24oKyksIDcyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Zz
L2NpZnMvZGZzX2NhY2hlLmMgYi9mcy9jaWZzL2Rmc19jYWNoZS5jCmluZGV4IGJmNWU2NzRmNDNi
OC4uYmVmNjcyNTM0Mzk3IDEwMDY0NAotLS0gYS9mcy9jaWZzL2Rmc19jYWNoZS5jCisrKyBiL2Zz
L2NpZnMvZGZzX2NhY2hlLmMKQEAgLTE1NDksNzQgKzE1NDksNiBAQCBzdGF0aWMgdm9pZCByZWZy
ZXNoX21vdW50cyhzdHJ1Y3QgY2lmc19zZXMgKipzZXNzaW9ucykKIAl9CiB9CiAKLXN0YXRpYyB2
b2lkIHJlZnJlc2hfY2FjaGUoc3RydWN0IGNpZnNfc2VzICoqc2Vzc2lvbnMpCi17Ci0JaW50IGk7
Ci0Jc3RydWN0IGNpZnNfc2VzICpzZXM7Ci0JdW5zaWduZWQgaW50IHhpZDsKLQljaGFyICpyZWZf
cGF0aHNbQ0FDSEVfTUFYX0VOVFJJRVNdOwotCWludCBjb3VudCA9IDA7Ci0Jc3RydWN0IGNhY2hl
X2VudHJ5ICpjZTsKLQotCS8qCi0JICogUmVmcmVzaCBhbGwgY2FjaGVkIGVudHJpZXMuICBHZXQg
YWxsIG5ldyByZWZlcnJhbHMgb3V0c2lkZSBjcml0aWNhbCBzZWN0aW9uIHRvIGF2b2lkCi0JICog
c3RhcnZhdGlvbiB3aGlsZSBwZXJmb3JtaW5nIFNNQjIgSU9DVEwgb24gYnJva2VuIG9yIHNsb3cg
Y29ubmVjdGlvbnMuCi0KLQkgKiBUaGUgY2FjaGUgZW50cmllcyBtYXkgY292ZXIgbW9yZSBwYXRo
cyB0aGFuIHRoZSBhY3RpdmUgbW91bnRzCi0JICogKGUuZy4gZG9tYWluLWJhc2VkIERGUyByZWZl
cnJhbHMgb3IgbXVsdGkgdGllciBERlMgc2V0dXBzKS4KLQkgKi8KLQlkb3duX3JlYWQoJmh0YWJs
ZV9yd19sb2NrKTsKLQlmb3IgKGkgPSAwOyBpIDwgQ0FDSEVfSFRBQkxFX1NJWkU7IGkrKykgewot
CQlzdHJ1Y3QgaGxpc3RfaGVhZCAqbCA9ICZjYWNoZV9odGFibGVbaV07Ci0KLQkJaGxpc3RfZm9y
X2VhY2hfZW50cnkoY2UsIGwsIGhsaXN0KSB7Ci0JCQlpZiAoY291bnQgPT0gQVJSQVlfU0laRShy
ZWZfcGF0aHMpKQotCQkJCWdvdG8gb3V0X3VubG9jazsKLQkJCWlmIChobGlzdF91bmhhc2hlZCgm
Y2UtPmhsaXN0KSB8fCAhY2FjaGVfZW50cnlfZXhwaXJlZChjZSkgfHwKLQkJCSAgICBJU19FUlIo
ZmluZF9pcGNfZnJvbV9zZXJ2ZXJfcGF0aChzZXNzaW9ucywgY2UtPnBhdGgpKSkKLQkJCQljb250
aW51ZTsKLQkJCXJlZl9wYXRoc1tjb3VudCsrXSA9IGtzdHJkdXAoY2UtPnBhdGgsIEdGUF9BVE9N
SUMpOwotCQl9Ci0JfQotCi1vdXRfdW5sb2NrOgotCXVwX3JlYWQoJmh0YWJsZV9yd19sb2NrKTsK
LQotCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7Ci0JCWNoYXIgKnBhdGggPSByZWZfcGF0
aHNbaV07Ci0JCXN0cnVjdCBkZnNfaW5mbzNfcGFyYW0gKnJlZnMgPSBOVUxMOwotCQlpbnQgbnVt
cmVmcyA9IDA7Ci0JCWludCByYyA9IDA7Ci0KLQkJaWYgKCFwYXRoKQotCQkJY29udGludWU7Ci0K
LQkJc2VzID0gZmluZF9pcGNfZnJvbV9zZXJ2ZXJfcGF0aChzZXNzaW9ucywgcGF0aCk7Ci0JCWlm
IChJU19FUlIoc2VzKSkKLQkJCWdvdG8gbmV4dF9yZWZlcnJhbDsKLQotCQl4aWQgPSBnZXRfeGlk
KCk7Ci0JCXJjID0gZ2V0X2Rmc19yZWZlcnJhbCh4aWQsIHNlcywgcGF0aCwgJnJlZnMsICZudW1y
ZWZzKTsKLQkJZnJlZV94aWQoeGlkKTsKLQotCQlpZiAoIXJjKSB7Ci0JCQlkb3duX3dyaXRlKCZo
dGFibGVfcndfbG9jayk7Ci0JCQljZSA9IGxvb2t1cF9jYWNoZV9lbnRyeShwYXRoKTsKLQkJCS8q
Ci0JCQkgKiBXZSBuZWVkIHRvIHJlLWNoZWNrIGl0IGJlY2F1c2Ugb3RoZXIgdGFza3MgbWlnaHQg
aGF2ZSBpdCBkZWxldGVkIG9yCi0JCQkgKiB1cGRhdGVkLgotCQkJICovCi0JCQlpZiAoIUlTX0VS
UihjZSkgJiYgY2FjaGVfZW50cnlfZXhwaXJlZChjZSkpCi0JCQkJdXBkYXRlX2NhY2hlX2VudHJ5
X2xvY2tlZChjZSwgcmVmcywgbnVtcmVmcyk7Ci0JCQl1cF93cml0ZSgmaHRhYmxlX3J3X2xvY2sp
OwotCQl9Ci0KLW5leHRfcmVmZXJyYWw6Ci0JCWtmcmVlKHBhdGgpOwotCQlmcmVlX2Rmc19pbmZv
X2FycmF5KHJlZnMsIG51bXJlZnMpOwotCX0KLX0KLQogLyoKICAqIFdvcmtlciB0aGF0IHdpbGwg
cmVmcmVzaCBERlMgY2FjaGUgYW5kIGFjdGl2ZSBtb3VudHMgYmFzZWQgb24gbG93ZXN0IFRUTCB2
YWx1ZSBmcm9tIGEgREZTCiAgKiByZWZlcnJhbC4KQEAgLTE2NTQsMTEgKzE1ODYsOCBAQCBzdGF0
aWMgdm9pZCByZWZyZXNoX2NhY2hlX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJ
CWkgKz0gY291bnQ7CiAJfQogCi0JaWYgKHNlc3Npb25zWzBdKSB7Ci0JCS8qIFJlZnJlc2ggYWxs
IGFjdGl2ZSBtb3VudHMgYW5kIGNhY2hlZCBlbnRyaWVzICovCisJaWYgKHNlc3Npb25zWzBdKQog
CQlyZWZyZXNoX21vdW50cyhzZXNzaW9ucyk7Ci0JCXJlZnJlc2hfY2FjaGUoc2Vzc2lvbnMpOwot
CX0KIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShtZywgdG1wX21nLCAmbWdsaXN0LCByZWZy
ZXNoX2xpc3QpIHsKIAkJbGlzdF9kZWxfaW5pdCgmbWctPnJlZnJlc2hfbGlzdCk7Ci0tIAoyLjM0
LjEKCg==
--00000000000061094b05f0084e71--
