Return-Path: <linux-cifs+bounces-902-lists+linux-cifs=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-cifs@lfdr.de
Delivered-To: lists+linux-cifs@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [139.178.88.99])
	by mail.lfdr.de (Postfix) with ESMTPS id 9727E83759C
	for <lists+linux-cifs@lfdr.de>; Mon, 22 Jan 2024 22:51:07 +0100 (CET)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 0127028A02A
	for <lists+linux-cifs@lfdr.de>; Mon, 22 Jan 2024 21:51:06 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 7B528482CA;
	Mon, 22 Jan 2024 21:51:02 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com header.b="J1p78Lmg"
X-Original-To: linux-cifs@vger.kernel.org
Received: from mail-lf1-f52.google.com (mail-lf1-f52.google.com [209.85.167.52])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 807FD482C4
	for <linux-cifs@vger.kernel.org>; Mon, 22 Jan 2024 21:50:53 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.167.52
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1705960262; cv=none; b=hGoGT6zdN1yam6qOJ0Bh3bycUuxceFSahCPb90AVtZd+qKoyFo2k7SxGLSgoBvh3TRawqm4KAs0Z6Wymgm2SbpIR2g56UgnaUmtPgMcv/ZQvEo+ZXFbANuS79SKKa7dXM4y0x1RndFrj8l7MLsBrPs1KG0LNIp53TL9hbSvBmJs=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1705960262; c=relaxed/simple;
	bh=3fDliQSyVlGtDrLj8Gm7Ze138tOHNprRuyak/L2cKEg=;
	h=MIME-Version:References:In-Reply-To:From:Date:Message-ID:Subject:
	 To:Cc:Content-Type; b=NicESmv1JRSpVAiDmxEyYeuKVLMP29+QpRjPvqJgSeuVxbZH2NFTvUg2457WbHyHs52StfpJXeipxynmP0axRqhcQt2RZkqRtGdpS6pz9theSegky5DEfXb3nPUgYLcP16wwey5MSLE2oMnrNA7MZDoLtyuLzNQrOav5bCn41PM=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=gmail.com; spf=pass smtp.mailfrom=gmail.com; dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com header.b=J1p78Lmg; arc=none smtp.client-ip=209.85.167.52
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=gmail.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=gmail.com
Received: by mail-lf1-f52.google.com with SMTP id 2adb3069b0e04-50e67f70f34so3691668e87.0
        for <linux-cifs@vger.kernel.org>; Mon, 22 Jan 2024 13:50:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20230601; t=1705960251; x=1706565051; darn=vger.kernel.org;
        h=cc:to:subject:message-id:date:from:in-reply-to:references
         :mime-version:from:to:cc:subject:date:message-id:reply-to;
        bh=KT5E9Jm17iHrCwk/FTcRXELjJABPt9J7PEA5gvyoH8w=;
        b=J1p78LmgzKZEnjJcXyDDBdE2DgvN259EEZ5JyyZXOLDfCXJF/ohVuBlnEE9+BjL1XS
         WaHeatvwOJYIf+etzIJJ2C6izNt1D4Cx5kbvq4Vr7iOxK+1upWlEADtvAu4cdBWjHlON
         utJJDHDbeozPrjsXGkZmlgSh8AzhYmWW3SJTE9IeRdRvLzDbBeRBGIodRwms8PGDWz+t
         W4QrhnovsPiGiTEcGnLhBCjDQYBoWlAssg/SsJQbGla5AWBdqVLKPUlZUTVokQpNB6yA
         28ieynNx0dbAkwB31hnI3ZYvj28Lr2vArUaRMOFcevdFh/sYoUY9GDQmYbHlv3rPim/2
         fjzA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1705960251; x=1706565051;
        h=cc:to:subject:message-id:date:from:in-reply-to:references
         :mime-version:x-gm-message-state:from:to:cc:subject:date:message-id
         :reply-to;
        bh=KT5E9Jm17iHrCwk/FTcRXELjJABPt9J7PEA5gvyoH8w=;
        b=SPEu5N/K41lDt3Y6f9bNWg11fMivnKUTkHZWcNw/Iip3fVbtJ4qtL6lFPn8g0ojrTy
         cQiUR5GWgpibb1xi2ZpQb+ReIluwkwYR035Bs8SMt15y5a/hzbye9Yu0A2L64UU5V78V
         j2vbjODBLgJe0d5flG+phLCBZ1W6ka7re4gipFqxMDGyJ4QHXi7+HXVbReW6C0dH5Y6g
         nf6lppZtEebKyUAoowS8oQkTg8Z7cNh+wTE8sqi6DT0+42UXLnP8kvkx8R8OGyfJbV/T
         GGOvSll/hYVLpBxVpX7Fjw1aQ9WQOsfMS911a4ae/z7GBsGMBQmleuNH/egbrQLrDDTO
         22kA==
X-Gm-Message-State: AOJu0YyTbjjF4CBXgzS1ZPnTGVSVJvemvMZAz7ma78HL5sDXWF463JxK
	W/FfYULUlOqd48p1Zn7+2QMlMue9V8oGLtWkQPFq7XpajmtEwYOzv25wTU5Dzn6u2JlT/q7kDmm
	d7oLUMQvaAUZ8FQ/4gArb4y2xZDHOONocAnw=
X-Google-Smtp-Source: AGHT+IELOoH0Oh71QQARzzbqLg2RFFgnIZ3jKsTL96MsJKUjweJvHkdZzIYg0BaF8SVcj9hqt35+DKOf+JUV45Rtk3Q=
X-Received: by 2002:ac2:43cb:0:b0:50e:b298:9e16 with SMTP id
 u11-20020ac243cb000000b0050eb2989e16mr1878546lfl.135.1705960251091; Mon, 22
 Jan 2024 13:50:51 -0800 (PST)
Precedence: bulk
X-Mailing-List: linux-cifs@vger.kernel.org
List-Id: <linux-cifs.vger.kernel.org>
List-Subscribe: <mailto:linux-cifs+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-cifs+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
References: <CAH2r5mvpZEk0cf2VAu9AyVYs20uk7f9G4y8461F3WX2v+afpoA@mail.gmail.com>
 <3837550.1705930069@warthog.procyon.org.uk>
In-Reply-To: <3837550.1705930069@warthog.procyon.org.uk>
From: Steve French <smfrench@gmail.com>
Date: Mon, 22 Jan 2024 15:50:37 -0600
Message-ID: <CAH2r5mv24g+Y9=DOWcRau-k9vEg-aSdejYhS=9eyci+_GxNipg@mail.gmail.com>
Subject: Re: cifs: integrate with netfs updates patch series
To: David Howells <dhowells@redhat.com>
Cc: CIFS <linux-cifs@vger.kernel.org>
Content-Type: multipart/mixed; boundary="000000000000c5796c060f8fd206"

--000000000000c5796c060f8fd206
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

From David's newer updates today to the series, I lightly updated
patches 8 and 9 (to remove a trivial checkpatch warning). See attached

On Mon, Jan 22, 2024 at 7:27=E2=80=AFAM David Howells <dhowells@redhat.com>=
 wrote:
>
> Steve French <smfrench@gmail.com> wrote:
>
> > I had to do a few minor updates to David Howell's recent netfs series
> > for cifs.ko (to rebase on current code, and eliminate a few checkpatch
> > warnings, see attached) but patch 8 fails to build  - see below (so
> > only tentatively merged the first seven for testing):
>
> I've updated by cifs-netfs branch.
>
> David
>


--=20
Thanks,

Steve

--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0008-cifs-Move-cifs_loose_read_iter-and-cifs_file_write_i.patch"
Content-Disposition: attachment; 
	filename="0008-cifs-Move-cifs_loose_read_iter-and-cifs_file_write_i.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46b3>
X-Attachment-Id: f_lrpgn46b3

RnJvbSAyZDRkMTkzMDE5NWJkMGFmM2ExMmRlZmI2M2ZhZDBlZjJjZjNkOWM0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBUaHUsIDEyIE9jdCAyMDIzIDA4OjM2OjQ0ICswMTAwClN1YmplY3Q6IFtQQVRDSCAwOC8x
Ml0gY2lmczogTW92ZSBjaWZzX2xvb3NlX3JlYWRfaXRlcigpIGFuZAogY2lmc19maWxlX3dyaXRl
X2l0ZXIoKSB0byBmaWxlLmMKCk1vdmUgY2lmc19sb29zZV9yZWFkX2l0ZXIoKSBhbmQgY2lmc19m
aWxlX3dyaXRlX2l0ZXIoKSB0byBmaWxlLmMgc28gdGhhdAp0aGV5IGFyZSBjb2xvY2F0ZWQgd2l0
aCBzaW1pbGFyIGZ1bmN0aW9ucyByYXRoZXIgdGhhbiBiZWluZyBzcGxpdCB3aXRoCmNpZnNmcy5j
LgoKU2lnbmVkLW9mZi1ieTogRGF2aWQgSG93ZWxscyA8ZGhvd2VsbHNAcmVkaGF0LmNvbT4KY2M6
IFNoeWFtIFByYXNhZCBOIDxuc3BtYW5nYWxvcmVAZ21haWwuY29tPgpjYzogUm9oaXRoIFN1cmFi
YXR0dWxhIDxyb2hpdGhzLm1zZnRAZ21haWwuY29tPgpjYzogSmVmZiBMYXl0b24gPGpsYXl0b25A
a2VybmVsLm9yZz4KY2M6IGxpbnV4LWNpZnNAdmdlci5rZXJuZWwub3JnCmNjOiBsaW51eC1jYWNo
ZWZzQHJlZGhhdC5jb20KY2M6IGxpbnV4LWZzZGV2ZWxAdmdlci5rZXJuZWwub3JnCmNjOiBsaW51
eC1tbUBrdmFjay5vcmcKLS0tCiBmcy9zbWIvY2xpZW50L2NpZnNmcy5jIHwgNTUgLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBmcy9zbWIvY2xpZW50L2NpZnNmcy5o
IHwgIDIgKysKIGZzL3NtYi9jbGllbnQvZmlsZS5jICAgfCA1MyArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDU1IGluc2VydGlvbnMoKyks
IDU1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc2ZzLmMgYi9m
cy9zbWIvY2xpZW50L2NpZnNmcy5jCmluZGV4IDQxNjE3NTQxZDE3NS4uNGI2ZDFhNWU0NzQxIDEw
MDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2NpZnNmcy5jCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lm
c2ZzLmMKQEAgLTk4NCw2MSArOTg0LDYgQEAgY2lmc19zbWIzX2RvX21vdW50KHN0cnVjdCBmaWxl
X3N5c3RlbV90eXBlICpmc190eXBlLAogCXJldHVybiByb290OwogfQogCi0KLXN0YXRpYyBzc2l6
ZV90Ci1jaWZzX2xvb3NlX3JlYWRfaXRlcihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3Zf
aXRlciAqaXRlcikKLXsKLQlzc2l6ZV90IHJjOwotCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBmaWxl
X2lub2RlKGlvY2ItPmtpX2ZpbHApOwotCi0JaWYgKGlvY2ItPmtpX2ZsYWdzICYgSU9DQl9ESVJF
Q1QpCi0JCXJldHVybiBjaWZzX3VzZXJfcmVhZHYoaW9jYiwgaXRlcik7Ci0KLQlyYyA9IGNpZnNf
cmV2YWxpZGF0ZV9tYXBwaW5nKGlub2RlKTsKLQlpZiAocmMpCi0JCXJldHVybiByYzsKLQotCXJl
dHVybiBnZW5lcmljX2ZpbGVfcmVhZF9pdGVyKGlvY2IsIGl0ZXIpOwotfQotCi1zdGF0aWMgc3Np
emVfdCBjaWZzX2ZpbGVfd3JpdGVfaXRlcihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3Zf
aXRlciAqZnJvbSkKLXsKLQlzdHJ1Y3QgaW5vZGUgKmlub2RlID0gZmlsZV9pbm9kZShpb2NiLT5r
aV9maWxwKTsKLQlzdHJ1Y3QgY2lmc0lub2RlSW5mbyAqY2lub2RlID0gQ0lGU19JKGlub2RlKTsK
LQlzc2l6ZV90IHdyaXR0ZW47Ci0JaW50IHJjOwotCi0JaWYgKGlvY2ItPmtpX2ZpbHAtPmZfZmxh
Z3MgJiBPX0RJUkVDVCkgewotCQl3cml0dGVuID0gY2lmc191c2VyX3dyaXRldihpb2NiLCBmcm9t
KTsKLQkJaWYgKHdyaXR0ZW4gPiAwICYmIENJRlNfQ0FDSEVfUkVBRChjaW5vZGUpKSB7Ci0JCQlj
aWZzX3phcF9tYXBwaW5nKGlub2RlKTsKLQkJCWNpZnNfZGJnKEZZSSwKLQkJCQkgIlNldCBubyBv
cGxvY2sgZm9yIGlub2RlPSVwIGFmdGVyIGEgd3JpdGUgb3BlcmF0aW9uXG4iLAotCQkJCSBpbm9k
ZSk7Ci0JCQljaW5vZGUtPm9wbG9jayA9IDA7Ci0JCX0KLQkJcmV0dXJuIHdyaXR0ZW47Ci0JfQot
Ci0Jd3JpdHRlbiA9IGNpZnNfZ2V0X3dyaXRlcihjaW5vZGUpOwotCWlmICh3cml0dGVuKQotCQly
ZXR1cm4gd3JpdHRlbjsKLQotCXdyaXR0ZW4gPSBnZW5lcmljX2ZpbGVfd3JpdGVfaXRlcihpb2Ni
LCBmcm9tKTsKLQotCWlmIChDSUZTX0NBQ0hFX1dSSVRFKENJRlNfSShpbm9kZSkpKQotCQlnb3Rv
IG91dDsKLQotCXJjID0gZmlsZW1hcF9mZGF0YXdyaXRlKGlub2RlLT5pX21hcHBpbmcpOwotCWlm
IChyYykKLQkJY2lmc19kYmcoRllJLCAiJXM6ICVkIHJjIG9uICVwIGlub2RlXG4iLAotCQkJIF9f
ZnVuY19fLCByYywgaW5vZGUpOwotCi1vdXQ6Ci0JY2lmc19wdXRfd3JpdGVyKGNpbm9kZSk7Ci0J
cmV0dXJuIHdyaXR0ZW47Ci19Ci0KIHN0YXRpYyBsb2ZmX3QgY2lmc19sbHNlZWsoc3RydWN0IGZp
bGUgKmZpbGUsIGxvZmZfdCBvZmZzZXQsIGludCB3aGVuY2UpCiB7CiAJc3RydWN0IGNpZnNGaWxl
SW5mbyAqY2ZpbGUgPSBmaWxlLT5wcml2YXRlX2RhdGE7CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xp
ZW50L2NpZnNmcy5oIGIvZnMvc21iL2NsaWVudC9jaWZzZnMuaAppbmRleCA2ODVmN2QxMTM5YzYu
LmU4ZTBmODYzZTkzNSAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9jaWZzZnMuaAorKysgYi9m
cy9zbWIvY2xpZW50L2NpZnNmcy5oCkBAIC0xMDAsNiArMTAwLDggQEAgZXh0ZXJuIHNzaXplX3Qg
Y2lmc19zdHJpY3RfcmVhZHYoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKnRv
KTsKIGV4dGVybiBzc2l6ZV90IGNpZnNfdXNlcl93cml0ZXYoc3RydWN0IGtpb2NiICppb2NiLCBz
dHJ1Y3QgaW92X2l0ZXIgKmZyb20pOwogZXh0ZXJuIHNzaXplX3QgY2lmc19kaXJlY3Rfd3JpdGV2
KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKTsKIGV4dGVybiBzc2l6
ZV90IGNpZnNfc3RyaWN0X3dyaXRldihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRl
ciAqZnJvbSk7Citzc2l6ZV90IGNpZnNfZmlsZV93cml0ZV9pdGVyKHN0cnVjdCBraW9jYiAqaW9j
Yiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKTsKK3NzaXplX3QgY2lmc19sb29zZV9yZWFkX2l0ZXIo
c3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKml0ZXIpOwogZXh0ZXJuIGludCBj
aWZzX2Zsb2NrKHN0cnVjdCBmaWxlICpwZmlsZSwgaW50IGNtZCwgc3RydWN0IGZpbGVfbG9jayAq
cGxvY2spOwogZXh0ZXJuIGludCBjaWZzX2xvY2soc3RydWN0IGZpbGUgKiwgaW50LCBzdHJ1Y3Qg
ZmlsZV9sb2NrICopOwogZXh0ZXJuIGludCBjaWZzX2ZzeW5jKHN0cnVjdCBmaWxlICosIGxvZmZf
dCwgbG9mZl90LCBpbnQpOwpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9z
bWIvY2xpZW50L2ZpbGUuYwppbmRleCA3MzhiMThiNWY1YjEuLjcyOTM0Y2VlMGM1OSAxMDA2NDQK
LS0tIGEvZnMvc21iL2NsaWVudC9maWxlLmMKKysrIGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAg
LTQ1NjksNiArNDU2OSw1OSBAQCBzc2l6ZV90IGNpZnNfdXNlcl9yZWFkdihzdHJ1Y3Qga2lvY2Ig
KmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqdG8pCiAJcmV0dXJuIF9fY2lmc19yZWFkdihpb2NiLCB0
bywgZmFsc2UpOwogfQogCitzc2l6ZV90IGNpZnNfbG9vc2VfcmVhZF9pdGVyKHN0cnVjdCBraW9j
YiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICppdGVyKQoreworCXNzaXplX3QgcmM7CisJc3RydWN0
IGlub2RlICppbm9kZSA9IGZpbGVfaW5vZGUoaW9jYi0+a2lfZmlscCk7CisKKwlpZiAoaW9jYi0+
a2lfZmxhZ3MgJiBJT0NCX0RJUkVDVCkKKwkJcmV0dXJuIGNpZnNfdXNlcl9yZWFkdihpb2NiLCBp
dGVyKTsKKworCXJjID0gY2lmc19yZXZhbGlkYXRlX21hcHBpbmcoaW5vZGUpOworCWlmIChyYykK
KwkJcmV0dXJuIHJjOworCisJcmV0dXJuIGdlbmVyaWNfZmlsZV9yZWFkX2l0ZXIoaW9jYiwgaXRl
cik7Cit9CisKK3NzaXplX3QgY2lmc19maWxlX3dyaXRlX2l0ZXIoc3RydWN0IGtpb2NiICppb2Ni
LCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20pCit7CisJc3RydWN0IGlub2RlICppbm9kZSA9IGZpbGVf
aW5vZGUoaW9jYi0+a2lfZmlscCk7CisJc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpbm9kZSA9IENJ
RlNfSShpbm9kZSk7CisJc3NpemVfdCB3cml0dGVuOworCWludCByYzsKKworCWlmIChpb2NiLT5r
aV9maWxwLT5mX2ZsYWdzICYgT19ESVJFQ1QpIHsKKwkJd3JpdHRlbiA9IGNpZnNfdXNlcl93cml0
ZXYoaW9jYiwgZnJvbSk7CisJCWlmICh3cml0dGVuID4gMCAmJiBDSUZTX0NBQ0hFX1JFQUQoY2lu
b2RlKSkgeworCQkJY2lmc196YXBfbWFwcGluZyhpbm9kZSk7CisJCQljaWZzX2RiZyhGWUksCisJ
CQkJICJTZXQgbm8gb3Bsb2NrIGZvciBpbm9kZT0lcCBhZnRlciBhIHdyaXRlIG9wZXJhdGlvblxu
IiwKKwkJCQkgaW5vZGUpOworCQkJY2lub2RlLT5vcGxvY2sgPSAwOworCQl9CisJCXJldHVybiB3
cml0dGVuOworCX0KKworCXdyaXR0ZW4gPSBjaWZzX2dldF93cml0ZXIoY2lub2RlKTsKKwlpZiAo
d3JpdHRlbikKKwkJcmV0dXJuIHdyaXR0ZW47CisKKwl3cml0dGVuID0gZ2VuZXJpY19maWxlX3dy
aXRlX2l0ZXIoaW9jYiwgZnJvbSk7CisKKwlpZiAoQ0lGU19DQUNIRV9XUklURShDSUZTX0koaW5v
ZGUpKSkKKwkJZ290byBvdXQ7CisKKwlyYyA9IGZpbGVtYXBfZmRhdGF3cml0ZShpbm9kZS0+aV9t
YXBwaW5nKTsKKwlpZiAocmMpCisJCWNpZnNfZGJnKEZZSSwgImNpZnNfZmlsZV93cml0ZV9pdGVy
OiAlZCByYyBvbiAlcCBpbm9kZVxuIiwKKwkJCSByYywgaW5vZGUpOworCitvdXQ6CisJY2lmc19w
dXRfd3JpdGVyKGNpbm9kZSk7CisJcmV0dXJuIHdyaXR0ZW47Cit9CisKIHNzaXplX3QKIGNpZnNf
c3RyaWN0X3JlYWR2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICp0bykKIHsK
LS0gCjIuNDAuMQoK
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0007-cifs-Implement-netfslib-hooks.patch"
Content-Disposition: attachment; 
	filename="0007-cifs-Implement-netfslib-hooks.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46c4>
X-Attachment-Id: f_lrpgn46c4

RnJvbSBiZTE4OWQ5NzY2NmM5ZmJkMDI0NTU5ZjBiNzY5OWQ0NjgxZjY5Mzc3IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTg6MTY6MTUgKzAxMDAKU3ViamVjdDogW1BBVENIIDA3LzEy
XSBjaWZzOiBJbXBsZW1lbnQgbmV0ZnNsaWIgaG9va3MKClByb3ZpZGUgaW1wbGVtZW50YXRpb24g
b2YgdGhlIG5ldGZzbGliIGhvb2tzIHRoYXQgd2lsbCBiZSB1c2VkIGJ5IG5ldGZzbGliCnRvIGFz
ayBjaWZzIHRvIHNldCB1cCBhbmQgcGVyZm9ybSBvcGVyYXRpb25zLiAgT2YgcGFydGljdWxhciBu
b3RlIGFyZQoKICgqKSBjaWZzX2NsYW1wX2xlbmd0aCgpIC0gVGhpcyBpcyB1c2VkIHRvIG5lZ290
aWF0ZSB0aGUgc2l6ZSBvZiB0aGUgbmV4dAogICAgIHN1YnJlcXVlc3QgaW4gYSByZWFkIHJlcXVl
c3QsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGNyZWRpdCBhdmFpbGFibGUKICAgICBhbmQgdGhl
IHJzaXplLiAgVGhlIGNyZWRpdHMgYXJlIGF0dGFjaGVkIHRvIHRoZSBzdWJyZXF1ZXN0LgoKICgq
KSBjaWZzX3JlcV9pc3N1ZV9yZWFkKCkgLSBUaGlzIGlzIHVzZWQgdG8gaXNzdWUgYSBzdWJyZXF1
ZXN0IHRoYXQgaGFzCiAgICAgYmVlbiBzZXQgdXAgYW5kIGNsYW1wZWQuCgogKCopIGNpZnNfY3Jl
YXRlX3dyaXRlX3JlcXVlc3RzKCkgLSBUaGlzIGlzIHVzZWQgdG8gYnJlYWsgdGhlIGdpdmVuIHNw
YW4gb2YKICAgICBmaWxlIHBvc2l0aW9ucyBpbnRvIHN1Ym9wZXJhdGlvbnMgYWNjb3JkaW5nIHRv
IGNpZnMncyB3c2l6ZSBhbmQKICAgICBhdmFpbGFibGUgY3JlZGl0cy4gIEFzIGVhY2ggc3Vib3Ag
aXMgY3JlYXRlZCwgaXQgY2FuIGJlIGRpc3BhdGNoZWQgb3IKICAgICBxdWV1ZWQgZm9yIGRpc3Bh
dGNoLgoKQXQgdGhpcyBwb2ludCwgY2lmcyBpcyBub3Qgd2lyZWQgdXAgdG8gYWN0dWFsbHkgKnVz
ZSogbmV0ZnNsaWI7IHRoYXQgd2lsbApiZSBkb25lIGluIGEgc3Vic2VxdWVudCBwYXRjaC4KClNp
Z25lZC1vZmYtYnk6IERhdmlkIEhvd2VsbHMgPGRob3dlbGxzQHJlZGhhdC5jb20+CmNjOiBTaHlh
bSBQcmFzYWQgTiA8bnNwbWFuZ2Fsb3JlQGdtYWlsLmNvbT4KY2M6IFJvaGl0aCBTdXJhYmF0dHVs
YSA8cm9oaXRocy5tc2Z0QGdtYWlsLmNvbT4KY2M6IEplZmYgTGF5dG9uIDxqbGF5dG9uQGtlcm5l
bC5vcmc+CmNjOiBsaW51eC1jaWZzQHZnZXIua2VybmVsLm9yZwpjYzogbGludXgtY2FjaGVmc0By
ZWRoYXQuY29tCmNjOiBsaW51eC1mc2RldmVsQHZnZXIua2VybmVsLm9yZwpjYzogbGludXgtbW1A
a3ZhY2sub3JnCi0tLQogZnMvbmV0ZnMvYnVmZmVyZWRfd3JpdGUuYyAgICB8ICAgMyArCiBmcy9z
bWIvY2xpZW50L0tjb25maWcgICAgICAgIHwgICAxICsKIGZzL3NtYi9jbGllbnQvY2lmc2dsb2Iu
aCAgICAgfCAgMjYgKystCiBmcy9zbWIvY2xpZW50L2ZpbGUuYyAgICAgICAgIHwgMzU3ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2xpbnV4L25ldGZzLmggICAg
ICAgIHwgICAxICsKIGluY2x1ZGUvdHJhY2UvZXZlbnRzL25ldGZzLmggfCAgIDEgKwogNiBmaWxl
cyBjaGFuZ2VkLCAzODEgaW5zZXJ0aW9ucygrKSwgOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9mcy9uZXRmcy9idWZmZXJlZF93cml0ZS5jIGIvZnMvbmV0ZnMvYnVmZmVyZWRfd3JpdGUuYwpp
bmRleCA5M2RjNzZmMzRlMzkuLmY2OWZjY2VmODc4ZCAxMDA2NDQKLS0tIGEvZnMvbmV0ZnMvYnVm
ZmVyZWRfd3JpdGUuYworKysgYi9mcy9uZXRmcy9idWZmZXJlZF93cml0ZS5jCkBAIC0zOTMsNiAr
MzkzLDkgQEAgc3NpemVfdCBuZXRmc19wZXJmb3JtX3dyaXRlKHN0cnVjdCBraW9jYiAqaW9jYiwg
c3RydWN0IGlvdl9pdGVyICppdGVyLAogCX0gd2hpbGUgKGlvdl9pdGVyX2NvdW50KGl0ZXIpKTsK
IAogb3V0OgorCWlmIChsaWtlbHkod3JpdHRlbikgJiYgY3R4LT5vcHMtPnBvc3RfbW9kaWZ5KQor
CQljdHgtPm9wcy0+cG9zdF9tb2RpZnkoaW5vZGUpOworCiAJaWYgKHVubGlrZWx5KHdyZXEpKSB7
CiAJCXJldCA9IG5ldGZzX2VuZF93cml0ZXRocm91Z2god3JlcSwgaW9jYik7CiAJCXdiY19kZXRh
Y2hfaW5vZGUoJndiYyk7CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L0tjb25maWcgYi9mcy9z
bWIvY2xpZW50L0tjb25maWcKaW5kZXggMjkyN2JkMTc0YTg4Li4yNTE3ZGMyNDIzODYgMTAwNjQ0
Ci0tLSBhL2ZzL3NtYi9jbGllbnQvS2NvbmZpZworKysgYi9mcy9zbWIvY2xpZW50L0tjb25maWcK
QEAgLTIsNiArMiw3IEBACiBjb25maWcgQ0lGUwogCXRyaXN0YXRlICJTTUIzIGFuZCBDSUZTIHN1
cHBvcnQgKGFkdmFuY2VkIG5ldHdvcmsgZmlsZXN5c3RlbSkiCiAJZGVwZW5kcyBvbiBJTkVUCisJ
c2VsZWN0IE5FVEZTX1NVUFBPUlQKIAlzZWxlY3QgTkxTCiAJc2VsZWN0IE5MU19VQ1MyX1VUSUxT
CiAJc2VsZWN0IENSWVBUTwpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oIGIv
ZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oCmluZGV4IDM0MTQ1MWUxZjk0NC4uMzAxZTg4YzQ5YThm
IDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmgKKysrIGIvZnMvc21iL2NsaWVu
dC9jaWZzZ2xvYi5oCkBAIC0xNDU2LDE1ICsxNDU2LDIzIEBAIHN0cnVjdCBjaWZzX2Fpb19jdHgg
ewogCWJvb2wJCQlkaXJlY3RfaW87CiB9OwogCitzdHJ1Y3QgY2lmc19pb19yZXF1ZXN0IHsKKwlz
dHJ1Y3QgbmV0ZnNfaW9fcmVxdWVzdAkJcnJlcTsKKwlzdHJ1Y3QgY2lmc0ZpbGVJbmZvCQkqY2Zp
bGU7Cit9OworCiAvKiBhc3luY2hyb25vdXMgcmVhZCBzdXBwb3J0ICovCiBzdHJ1Y3QgY2lmc19p
b19zdWJyZXF1ZXN0IHsKLQlzdHJ1Y3QgbmV0ZnNfaW9fc3VicmVxdWVzdAlzdWJyZXE7Ci0Jc3Ry
dWN0IGNpZnNGaWxlSW5mbwkJKmNmaWxlOwotCXN0cnVjdCBhZGRyZXNzX3NwYWNlCQkqbWFwcGlu
ZzsKLQlzdHJ1Y3QgY2lmc19haW9fY3R4CQkqY3R4OworCXVuaW9uIHsKKwkJc3RydWN0IG5ldGZz
X2lvX3N1YnJlcXVlc3Qgc3VicmVxOworCQlzdHJ1Y3QgbmV0ZnNfaW9fcmVxdWVzdCAqcnJlcTsK
KwkJc3RydWN0IGNpZnNfaW9fcmVxdWVzdCAqcmVxOworCX07CiAJc3NpemVfdAkJCQlnb3RfYnl0
ZXM7CiAJcGlkX3QJCQkJcGlkOworCXVuc2lnbmVkIGludAkJCXhpZDsKIAlpbnQJCQkJcmVzdWx0
OworCWJvb2wJCQkJaGF2ZV9jcmVkaXRzOwogCXN0cnVjdCBrdmVjCQkJaW92WzJdOwogCXN0cnVj
dCBUQ1BfU2VydmVyX0luZm8JCSpzZXJ2ZXI7CiAjaWZkZWYgQ09ORklHX0NJRlNfU01CX0RJUkVD
VApAQCAtMTQ3MiwxNCArMTQ4MCwxNiBAQCBzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0IHsKICNl
bmRpZgogCXN0cnVjdCBjaWZzX2NyZWRpdHMJCWNyZWRpdHM7CiAKLQllbnVtIHdyaXRlYmFja19z
eW5jX21vZGVzCXN5bmNfbW9kZTsKLQlib29sCQkJCXVuY2FjaGVkOwotCXN0cnVjdCBiaW9fdmVj
CQkJKmJ2OwotCiAJLy8gVE9ETzogUmVtb3ZlIGZvbGxvd2luZyBlbGVtZW50cwogCXN0cnVjdCBs
aXN0X2hlYWQJCWxpc3Q7CiAJc3RydWN0IGNvbXBsZXRpb24JCWRvbmU7CiAJc3RydWN0IHdvcmtf
c3RydWN0CQl3b3JrOworCXN0cnVjdCBjaWZzRmlsZUluZm8JCSpjZmlsZTsKKwlzdHJ1Y3QgYWRk
cmVzc19zcGFjZQkJKm1hcHBpbmc7CisJc3RydWN0IGNpZnNfYWlvX2N0eAkJKmN0eDsKKwllbnVt
IHdyaXRlYmFja19zeW5jX21vZGVzCXN5bmNfbW9kZTsKKwlib29sCQkJCXVuY2FjaGVkOworCXN0
cnVjdCBiaW9fdmVjCQkJKmJ2OwogfTsKIAogLyoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQv
ZmlsZS5jIGIvZnMvc21iL2NsaWVudC9maWxlLmMKaW5kZXggMTc2ZmU0ZWU3Nzc2Li43MzhiMThi
NWY1YjEgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvZmlsZS5jCisrKyBiL2ZzL3NtYi9jbGll
bnQvZmlsZS5jCkBAIC0zNiw2ICszNiwzNjMgQEAKICNpbmNsdWRlICJmc19jb250ZXh0LmgiCiAj
aW5jbHVkZSAiY2lmc19pb2N0bC5oIgogI2luY2x1ZGUgImNhY2hlZF9kaXIuaCIKKyNpbmNsdWRl
IDx0cmFjZS9ldmVudHMvbmV0ZnMuaD4KKworc3RhdGljIGludCBjaWZzX3Jlb3Blbl9maWxlKHN0
cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlLCBib29sIGNhbl9mbHVzaCk7CisKK3N0YXRpYyB2b2lk
IGNpZnNfdXBsb2FkX3RvX3NlcnZlcihzdHJ1Y3QgbmV0ZnNfaW9fc3VicmVxdWVzdCAqc3VicmVx
KQoreworCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhID0KKwkJY29udGFpbmVyX29m
KHN1YnJlcSwgc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCwgc3VicmVxKTsKKwlzc2l6ZV90IHJj
OworCisJdHJhY2VfbmV0ZnNfc3JlcShzdWJyZXEsIG5ldGZzX3NyZXFfdHJhY2Vfc3VibWl0KTsK
KworCWlmICh3ZGF0YS0+cmVxLT5jZmlsZS0+aW52YWxpZEhhbmRsZSkKKwkJcmMgPSAtRUFHQUlO
OworCWVsc2UKKwkJcmMgPSB3ZGF0YS0+c2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0YSk7
CisJaWYgKHJjIDwgMCkKKwkJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYod2RhdGEtPnNlcnZlciwg
JndkYXRhLT5jcmVkaXRzLCAwKTsKK30KKworc3RhdGljIHZvaWQgY2lmc191cGxvYWRfdG9fc2Vy
dmVyX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IG5ldGZzX2lv
X3N1YnJlcXVlc3QgKnN1YnJlcSA9CisJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgbmV0ZnNf
aW9fc3VicmVxdWVzdCwgd29yayk7CisKKwljaWZzX3VwbG9hZF90b19zZXJ2ZXIoc3VicmVxKTsK
K30KKworLyoKKyAqIFNldCB1cCB3cml0ZSByZXF1ZXN0cyBmb3IgYSB3cml0ZWJhY2sgc2xpY2Uu
ICBXZSBuZWVkIHRvIGFkZCBhIHdyaXRlIHJlcXVlc3QKKyAqIGZvciBlYWNoIHdyaXRlIHdlIHdh
bnQgdG8gbWFrZS4KKyAqLworc3RhdGljIHZvaWQgY2lmc19jcmVhdGVfd3JpdGVfcmVxdWVzdHMo
c3RydWN0IG5ldGZzX2lvX3JlcXVlc3QgKndyZXEsCisJCQkJICAgICAgIGxvZmZfdCBzdGFydCwg
c2l6ZV90IHJlbWFpbikKK3sKKwlzdHJ1Y3QgbmV0ZnNfaW9fc3VicmVxdWVzdCAqc3VicmVxOwor
CXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhOworCXN0cnVjdCBjaWZzX2lvX3JlcXVl
c3QgKnJlcSA9IGNvbnRhaW5lcl9vZih3cmVxLCBzdHJ1Y3QgY2lmc19pb19yZXF1ZXN0LCBycmVx
KTsKKwlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXI7CisJc3RydWN0IGNpZnNGaWxlSW5m
byAqb3Blbl9maWxlID0gcmVxLT5jZmlsZTsKKwlzdHJ1Y3QgY2lmc19zYl9pbmZvICpjaWZzX3Ni
ID0gQ0lGU19TQih3cmVxLT5pbm9kZS0+aV9zYik7CisJaW50IHJjID0gMDsKKwlzaXplX3Qgb2Zm
c2V0ID0gMDsKKwlwaWRfdCBwaWQ7CisJdW5zaWduZWQgaW50IHhpZCwgbWF4X3NlZ3MgPSBJTlRf
TUFYOworCisJaWYgKGNpZnNfc2ItPm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VOVF9SV1BJREZP
UldBUkQpCisJCXBpZCA9IG9wZW5fZmlsZS0+cGlkOworCWVsc2UKKwkJcGlkID0gY3VycmVudC0+
dGdpZDsKKworCXNlcnZlciA9IGNpZnNfcGlja19jaGFubmVsKHRsaW5rX3Rjb24ob3Blbl9maWxl
LT50bGluayktPnNlcyk7CisJeGlkID0gZ2V0X3hpZCgpOworCisjaWZkZWYgQ09ORklHX0NJRlNf
U01CX0RJUkVDVAorCWlmIChzZXJ2ZXItPnNtYmRfY29ubikKKwkJbWF4X3NlZ3MgPSBzZXJ2ZXIt
PnNtYmRfY29ubi0+bWF4X2ZybXJfZGVwdGg7CisjZW5kaWYKKworCWRvIHsKKwkJdW5zaWduZWQg
aW50IG5zZWdzID0gMDsKKwkJc2l6ZV90IG1heF9sZW4sIHBhcnQsIHdzaXplOworCisJCXN1YnJl
cSA9IG5ldGZzX2NyZWF0ZV93cml0ZV9yZXF1ZXN0KHdyZXEsIE5FVEZTX1VQTE9BRF9UT19TRVJW
RVIsCisJCQkJCQkgICAgc3RhcnQsIHJlbWFpbiwKKwkJCQkJCSAgICBjaWZzX3VwbG9hZF90b19z
ZXJ2ZXJfd29ya2VyKTsKKwkJaWYgKCFzdWJyZXEpIHsKKwkJCXdyZXEtPmVycm9yID0gLUVOT01F
TTsKKwkJCWJyZWFrOworCQl9CisKKwkJd2RhdGEgPSBjb250YWluZXJfb2Yoc3VicmVxLCBzdHJ1
Y3QgY2lmc19pb19zdWJyZXF1ZXN0LCBzdWJyZXEpOworCityZXRyeToKKwkJaWYgKHNpZ25hbF9w
ZW5kaW5nKGN1cnJlbnQpKSB7CisJCQl3cmVxLT5lcnJvciA9IC1FSU5UUjsKKwkJCWJyZWFrOwor
CQl9CisKKwkJaWYgKG9wZW5fZmlsZS0+aW52YWxpZEhhbmRsZSkgeworCQkJcmMgPSBjaWZzX3Jl
b3Blbl9maWxlKG9wZW5fZmlsZSwgZmFsc2UpOworCQkJaWYgKHJjIDwgMCkgeworCQkJCWlmIChy
YyA9PSAtRUFHQUlOKQorCQkJCQlnb3RvIHJldHJ5OworCQkJCWJyZWFrOworCQkJfQorCQl9CisK
KwkJcmMgPSBzZXJ2ZXItPm9wcy0+d2FpdF9tdHVfY3JlZGl0cyhzZXJ2ZXIsIHdyZXEtPndzaXpl
LCAmd3NpemUsCisJCQkJCQkgICAmd2RhdGEtPmNyZWRpdHMpOworCQlpZiAocmMpCisJCQlicmVh
azsKKworCQltYXhfbGVuID0gbWluKHJlbWFpbiwgd3NpemUpOworCQlpZiAoIW1heF9sZW4pIHsK
KwkJCXJjID0gLUVBR0FJTjsKKwkJCWdvdG8gZmFpbGVkX3JldHVybl9jcmVkaXRzOworCQl9CisK
KwkJcGFydCA9IG5ldGZzX2xpbWl0X2l0ZXIoJndyZXEtPmlvX2l0ZXIsIG9mZnNldCwgbWF4X2xl
biwgbWF4X3NlZ3MpOworCQljaWZzX2RiZyhGWUksICJjcmVhdGVfd3JpdGVfcmVxdWVzdCBsZW49
JXp4LyV6eCBuc2Vncz0ldS8lbHUvJXVcbiIsCisJCQkgcGFydCwgbWF4X2xlbiwgbnNlZ3MsIHdy
ZXEtPmlvX2l0ZXIubnJfc2VncywgbWF4X3NlZ3MpOworCQlpZiAoIXBhcnQpIHsKKwkJCXJjID0g
LUVJTzsKKwkJCWdvdG8gZmFpbGVkX3JldHVybl9jcmVkaXRzOworCQl9CisKKwkJaWYgKHBhcnQg
PCB3ZGF0YS0+c3VicmVxLmxlbikgeworCQkJd2RhdGEtPnN1YnJlcS5sZW4gPSBwYXJ0OworCQkJ
aW92X2l0ZXJfdHJ1bmNhdGUoJndkYXRhLT5zdWJyZXEuaW9faXRlciwgcGFydCk7CisJCX0KKwor
CQl3ZGF0YS0+c2VydmVyCT0gc2VydmVyOworCQl3ZGF0YS0+cGlkCT0gcGlkOworCisJCXJjID0g
YWRqdXN0X2NyZWRpdHMoc2VydmVyLCAmd2RhdGEtPmNyZWRpdHMsIHdkYXRhLT5zdWJyZXEubGVu
KTsKKwkJaWYgKHJjKSB7CisJCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIsICZ3ZGF0
YS0+Y3JlZGl0cywgMCk7CisJCQlpZiAocmMgPT0gLUVBR0FJTikKKwkJCQlnb3RvIHJldHJ5Owor
CQkJZ290byBmYWlsZWQ7CisJCX0KKworCQljaWZzX3VwbG9hZF90b19zZXJ2ZXIoc3VicmVxKTsK
KwkJLy9uZXRmc19xdWV1ZV93cml0ZV9yZXF1ZXN0KHN1YnJlcSk7CisJCXN0YXJ0ICs9IHBhcnQ7
CisJCW9mZnNldCArPSBwYXJ0OworCQlyZW1haW4gLT0gcGFydDsKKwl9IHdoaWxlIChyZW1haW4g
PiAwKTsKKworCWZyZWVfeGlkKHhpZCk7CisJcmV0dXJuOworCitmYWlsZWRfcmV0dXJuX2NyZWRp
dHM6CisJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYoc2VydmVyLCAmd2RhdGEtPmNyZWRpdHMsIDAp
OworZmFpbGVkOgorCW5ldGZzX3dyaXRlX3N1YnJlcXVlc3RfdGVybWluYXRlZChzdWJyZXEsIHJj
LCBmYWxzZSk7CisJZnJlZV94aWQoeGlkKTsKK30KKworLyoKKyAqIFNwbGl0IHRoZSByZWFkIHVw
IGFjY29yZGluZyB0byBob3cgbWFueSBjcmVkaXRzIHdlIGNhbiBnZXQgZm9yIGVhY2ggcGllY2Uu
CisgKiBJdCdzIG9rYXkgdG8gc2xlZXAgaGVyZSBpZiB3ZSBuZWVkIHRvIHdhaXQgZm9yIG1vcmUg
Y3JlZGl0IHRvIGJlY29tZQorICogYXZhaWxhYmxlLgorICoKKyAqIFdlIGFsc28gY2hvb3NlIHRo
ZSBzZXJ2ZXIgYW5kIGFsbG9jYXRlIGFuIG9wZXJhdGlvbiBJRCB0byBiZSBjbGVhbmVkIHVwCisg
KiBsYXRlci4KKyAqLworc3RhdGljIGJvb2wgY2lmc19jbGFtcF9sZW5ndGgoc3RydWN0IG5ldGZz
X2lvX3N1YnJlcXVlc3QgKnN1YnJlcSkKK3sKKwlzdHJ1Y3QgbmV0ZnNfaW9fcmVxdWVzdCAqcnJl
cSA9IHN1YnJlcS0+cnJlcTsKKwlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXI7CisJc3Ry
dWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPSBjb250YWluZXJfb2Yoc3VicmVxLCBzdHJ1
Y3QgY2lmc19pb19zdWJyZXF1ZXN0LCBzdWJyZXEpOworCXN0cnVjdCBjaWZzX2lvX3JlcXVlc3Qg
KnJlcSA9IGNvbnRhaW5lcl9vZihzdWJyZXEtPnJyZXEsIHN0cnVjdCBjaWZzX2lvX3JlcXVlc3Qs
IHJyZXEpOworCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IgPSBDSUZTX1NCKHJyZXEtPmlu
b2RlLT5pX3NiKTsKKwlzaXplX3QgcnNpemUgPSAwOworCWludCByYzsKKworCXJkYXRhLT54aWQg
PSBnZXRfeGlkKCk7CisKKwlzZXJ2ZXIgPSBjaWZzX3BpY2tfY2hhbm5lbCh0bGlua190Y29uKHJl
cS0+Y2ZpbGUtPnRsaW5rKS0+c2VzKTsKKwlyZGF0YS0+c2VydmVyID0gc2VydmVyOworCisJaWYg
KGNpZnNfc2ItPmN0eC0+cnNpemUgPT0gMCkKKwkJY2lmc19zYi0+Y3R4LT5yc2l6ZSA9CisJCQlz
ZXJ2ZXItPm9wcy0+bmVnb3RpYXRlX3JzaXplKHRsaW5rX3Rjb24ocmVxLT5jZmlsZS0+dGxpbmsp
LAorCQkJCQkJICAgICBjaWZzX3NiLT5jdHgpOworCisKKwlyYyA9IHNlcnZlci0+b3BzLT53YWl0
X210dV9jcmVkaXRzKHNlcnZlciwgY2lmc19zYi0+Y3R4LT5yc2l6ZSwgJnJzaXplLAorCQkJCQkg
ICAmcmRhdGEtPmNyZWRpdHMpOworCWlmIChyYykgeworCQlzdWJyZXEtPmVycm9yID0gcmM7CisJ
CXJldHVybiBmYWxzZTsKKwl9CisKKwlyZGF0YS0+aGF2ZV9jcmVkaXRzID0gdHJ1ZTsKKwlzdWJy
ZXEtPmxlbiA9IG1pbl90KHNpemVfdCwgc3VicmVxLT5sZW4sIHJzaXplKTsKKyNpZmRlZiBDT05G
SUdfQ0lGU19TTUJfRElSRUNUCisJaWYgKHNlcnZlci0+c21iZF9jb25uKQorCQlzdWJyZXEtPm1h
eF9ucl9zZWdzID0gc2VydmVyLT5zbWJkX2Nvbm4tPm1heF9mcm1yX2RlcHRoOworI2VuZGlmCisJ
cmV0dXJuIHRydWU7Cit9CisKKy8qCisgKiBJc3N1ZSBhIHJlYWQgb3BlcmF0aW9uIG9uIGJlaGFs
ZiBvZiB0aGUgbmV0ZnMgaGVscGVyIGZ1bmN0aW9ucy4gIFdlJ3JlIGFza2VkCisgKiB0byBtYWtl
IGEgcmVhZCBvZiBhIGNlcnRhaW4gc2l6ZSBhdCBhIHBvaW50IGluIHRoZSBmaWxlLiAgV2UgYXJl
IHBlcm1pdHRlZAorICogdG8gb25seSByZWFkIGEgcG9ydGlvbiBvZiB0aGF0LCBidXQgYXMgbG9u
ZyBhcyB3ZSByZWFkIHNvbWV0aGluZywgdGhlIG5ldGZzCisgKiBoZWxwZXIgd2lsbCBjYWxsIHVz
IGFnYWluIHNvIHRoYXQgd2UgY2FuIGlzc3VlIGFub3RoZXIgcmVhZC4KKyAqLworc3RhdGljIHZv
aWQgY2lmc19yZXFfaXNzdWVfcmVhZChzdHJ1Y3QgbmV0ZnNfaW9fc3VicmVxdWVzdCAqc3VicmVx
KQoreworCXN0cnVjdCBuZXRmc19pb19yZXF1ZXN0ICpycmVxID0gc3VicmVxLT5ycmVxOworCXN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhID0gY29udGFpbmVyX29mKHN1YnJlcSwgc3Ry
dWN0IGNpZnNfaW9fc3VicmVxdWVzdCwgc3VicmVxKTsKKwlzdHJ1Y3QgY2lmc19pb19yZXF1ZXN0
ICpyZXEgPSBjb250YWluZXJfb2Yoc3VicmVxLT5ycmVxLCBzdHJ1Y3QgY2lmc19pb19yZXF1ZXN0
LCBycmVxKTsKKwlzdHJ1Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiID0gQ0lGU19TQihycmVxLT5p
bm9kZS0+aV9zYik7CisJcGlkX3QgcGlkOworCWludCByYyA9IDA7CisKKwlpZiAoY2lmc19zYi0+
bW50X2NpZnNfZmxhZ3MgJiBDSUZTX01PVU5UX1JXUElERk9SV0FSRCkKKwkJcGlkID0gcmVxLT5j
ZmlsZS0+cGlkOworCWVsc2UKKwkJcGlkID0gY3VycmVudC0+dGdpZDsgLy8gVW1tbS4uLiAgVGhp
cyBtYXkgYmUgYSB3b3JrcXVldWUKKworCWNpZnNfZGJnKEZZSSwgIiVzOiBvcD0lMDh4WyV4XSBt
YXBwaW5nPSVwIGxlbj0lenUvJXp1XG4iLAorCQkgX19mdW5jX18sIHJyZXEtPmRlYnVnX2lkLCBz
dWJyZXEtPmRlYnVnX2luZGV4LCBycmVxLT5tYXBwaW5nLAorCQkgc3VicmVxLT50cmFuc2ZlcnJl
ZCwgc3VicmVxLT5sZW4pOworCisJaWYgKHJlcS0+Y2ZpbGUtPmludmFsaWRIYW5kbGUpIHsKKwkJ
ZG8geworCQkJcmMgPSBjaWZzX3Jlb3Blbl9maWxlKHJlcS0+Y2ZpbGUsIHRydWUpOworCQl9IHdo
aWxlIChyYyA9PSAtRUFHQUlOKTsKKwkJaWYgKHJjKQorCQkJZ290byBvdXQ7CisJfQorCisJX19z
ZXRfYml0KE5FVEZTX1NSRVFfQ0xFQVJfVEFJTCwgJnN1YnJlcS0+ZmxhZ3MpOworCXJkYXRhLT5w
aWQgPSBwaWQ7CisKKwlyYyA9IGFkanVzdF9jcmVkaXRzKHJkYXRhLT5zZXJ2ZXIsICZyZGF0YS0+
Y3JlZGl0cywgcmRhdGEtPnN1YnJlcS5sZW4pOworCWlmICghcmMpIHsKKwkJaWYgKHJkYXRhLT5y
ZXEtPmNmaWxlLT5pbnZhbGlkSGFuZGxlKQorCQkJcmMgPSAtRUFHQUlOOworCQllbHNlCisJCQly
YyA9IHJkYXRhLT5zZXJ2ZXItPm9wcy0+YXN5bmNfcmVhZHYocmRhdGEpOworCX0KKworb3V0Ogor
CWlmIChyYykKKwkJbmV0ZnNfc3VicmVxX3Rlcm1pbmF0ZWQoc3VicmVxLCByYywgZmFsc2UpOwor
fQorCisvKgorICogSW5pdGlhbGlzZSBhIHJlcXVlc3QuCisgKi8KK3N0YXRpYyBpbnQgY2lmc19p
bml0X3JlcXVlc3Qoc3RydWN0IG5ldGZzX2lvX3JlcXVlc3QgKnJyZXEsIHN0cnVjdCBmaWxlICpm
aWxlKQoreworCXN0cnVjdCBjaWZzX2lvX3JlcXVlc3QgKnJlcSA9IGNvbnRhaW5lcl9vZihycmVx
LCBzdHJ1Y3QgY2lmc19pb19yZXF1ZXN0LCBycmVxKTsKKwlzdHJ1Y3QgY2lmc19zYl9pbmZvICpj
aWZzX3NiID0gQ0lGU19TQihycmVxLT5pbm9kZS0+aV9zYik7CisJc3RydWN0IGNpZnNGaWxlSW5m
byAqb3Blbl9maWxlID0gTlVMTDsKKwlpbnQgcmV0OworCisJcnJlcS0+cnNpemUgPSBjaWZzX3Ni
LT5jdHgtPnJzaXplOworCXJyZXEtPndzaXplID0gY2lmc19zYi0+Y3R4LT53c2l6ZTsKKworCWlm
IChmaWxlKSB7CisJCW9wZW5fZmlsZSA9IGZpbGUtPnByaXZhdGVfZGF0YTsKKwkJcnJlcS0+bmV0
ZnNfcHJpdiA9IGZpbGUtPnByaXZhdGVfZGF0YTsKKwkJcmVxLT5jZmlsZSA9IGNpZnNGaWxlSW5m
b19nZXQob3Blbl9maWxlKTsKKwl9IGVsc2UgaWYgKHJyZXEtPm9yaWdpbiA9PSBORVRGU19XUklU
RUJBQ0sgfHwKKwkJICAgcnJlcS0+b3JpZ2luID09IE5FVEZTX0xBVU5ERVJfV1JJVEUpIHsKKwkJ
cmV0ID0gY2lmc19nZXRfd3JpdGFibGVfZmlsZShDSUZTX0kocnJlcS0+aW5vZGUpLCBGSU5EX1dS
X0FOWSwgJnJlcS0+Y2ZpbGUpOworCQlpZiAocmV0KSB7CisJCQljaWZzX2RiZyhWRlMsICJObyB3
cml0YWJsZSBoYW5kbGUgaW4gd3JpdGVwYWdlcyByZXQ9JWRcbiIsIHJldCk7CisJCQlyZXR1cm4g
cmV0OworCQl9CisJfSBlbHNlIHsKKwkJV0FSTl9PTl9PTkNFKDEpOworCQlyZXR1cm4gLUVJTzsK
Kwl9CisKKwlyZXR1cm4gMDsKK30KKworLyoKKyAqIEV4cGFuZCB0aGUgc2l6ZSBvZiBhIHJlYWRh
aGVhZCB0byB0aGUgc2l6ZSBvZiB0aGUgcnNpemUsIGlmIGF0IGxlYXN0IGFzCisgKiBsYXJnZSBh
cyBhIHBhZ2UsIGFsbG93aW5nIGZvciB0aGUgcG9zc2liaWxpdHkgdGhhdCByc2l6ZSBpcyBub3Qg
cG93LTIKKyAqIGFsaWduZWQuCisgKi8KK3N0YXRpYyB2b2lkIGNpZnNfZXhwYW5kX3JlYWRhaGVh
ZChzdHJ1Y3QgbmV0ZnNfaW9fcmVxdWVzdCAqcnJlcSkKK3sKKwl1bnNpZ25lZCBpbnQgcnNpemUg
PSBycmVxLT5yc2l6ZTsKKwlsb2ZmX3QgbWlzYWxpZ25tZW50LCBpX3NpemUgPSBpX3NpemVfcmVh
ZChycmVxLT5pbm9kZSk7CisKKwlpZiAocnNpemUgPCBQQUdFX1NJWkUpCisJCXJldHVybjsKKwor
CWlmIChyc2l6ZSA8IElOVF9NQVgpCisJCXJzaXplID0gcm91bmR1cF9wb3dfb2ZfdHdvKHJzaXpl
KTsKKwllbHNlCisJCXJzaXplID0gKCh1bnNpZ25lZCBpbnQpSU5UX01BWCArIDEpIC8gMjsKKwor
CW1pc2FsaWdubWVudCA9IHJyZXEtPnN0YXJ0ICYgKHJzaXplIC0gMSk7CisJaWYgKG1pc2FsaWdu
bWVudCkgeworCQlycmVxLT5zdGFydCAtPSBtaXNhbGlnbm1lbnQ7CisJCXJyZXEtPmxlbiArPSBt
aXNhbGlnbm1lbnQ7CisJfQorCisJcnJlcS0+bGVuID0gcm91bmRfdXAocnJlcS0+bGVuLCByc2l6
ZSk7CisJaWYgKHJyZXEtPnN0YXJ0IDwgaV9zaXplICYmIHJyZXEtPmxlbiA+IGlfc2l6ZSAtIHJy
ZXEtPnN0YXJ0KQorCQlycmVxLT5sZW4gPSBpX3NpemUgLSBycmVxLT5zdGFydDsKK30KKworLyoK
KyAqIENvbXBsZXRpb24gb2YgYSByZXF1ZXN0IG9wZXJhdGlvbi4KKyAqLworc3RhdGljIHZvaWQg
Y2lmc19ycmVxX2RvbmUoc3RydWN0IG5ldGZzX2lvX3JlcXVlc3QgKnJyZXEpCit7CisJc3RydWN0
IHRpbWVzcGVjNjQgYXRpbWUsIG10aW1lOworCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBycmVxLT5p
bm9kZTsKKworCS8qIHdlIGRvIG5vdCB3YW50IGF0aW1lIHRvIGJlIGxlc3MgdGhhbiBtdGltZSwg
aXQgYnJva2Ugc29tZSBhcHBzICovCisJYXRpbWUgPSBpbm9kZV9zZXRfYXRpbWVfdG9fdHMoaW5v
ZGUsIGN1cnJlbnRfdGltZShpbm9kZSkpOworCW10aW1lID0gaW5vZGVfZ2V0X210aW1lKGlub2Rl
KTsKKwlpZiAodGltZXNwZWM2NF9jb21wYXJlKCZhdGltZSwgJm10aW1lKSkKKwkJaW5vZGVfc2V0
X2F0aW1lX3RvX3RzKGlub2RlLCBpbm9kZV9nZXRfbXRpbWUoaW5vZGUpKTsKK30KKworc3RhdGlj
IHZvaWQgY2lmc19wb3N0X21vZGlmeShzdHJ1Y3QgaW5vZGUgKmlub2RlKQoreworCS8qIEluZGlj
YXRpb24gdG8gdXBkYXRlIGN0aW1lIGFuZCBtdGltZSBhcyBjbG9zZSBpcyBkZWZlcnJlZCAqLwor
CXNldF9iaXQoQ0lGU19JTk9fTU9ESUZJRURfQVRUUiwgJkNJRlNfSShpbm9kZSktPmZsYWdzKTsK
K30KKworc3RhdGljIHZvaWQgY2lmc19mcmVlX3JlcXVlc3Qoc3RydWN0IG5ldGZzX2lvX3JlcXVl
c3QgKnJyZXEpCit7CisJc3RydWN0IGNpZnNfaW9fcmVxdWVzdCAqcmVxID0gY29udGFpbmVyX29m
KHJyZXEsIHN0cnVjdCBjaWZzX2lvX3JlcXVlc3QsIHJyZXEpOworCisJaWYgKHJlcS0+Y2ZpbGUp
CisJCWNpZnNGaWxlSW5mb19wdXQocmVxLT5jZmlsZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNpZnNf
ZnJlZV9zdWJyZXF1ZXN0KHN0cnVjdCBuZXRmc19pb19zdWJyZXF1ZXN0ICpzdWJyZXEpCit7CisJ
c3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPQorCQljb250YWluZXJfb2Yoc3VicmVx
LCBzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0LCBzdWJyZXEpOworCWludCByYzsKKworCWlmIChy
ZGF0YS0+c3VicmVxLnNvdXJjZSA9PSBORVRGU19ET1dOTE9BRF9GUk9NX1NFUlZFUikgeworI2lm
ZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QKKwkJaWYgKHJkYXRhLT5tcikgeworCQkJc21iZF9k
ZXJlZ2lzdGVyX21yKHJkYXRhLT5tcik7CisJCQlyZGF0YS0+bXIgPSBOVUxMOworCQl9CisjZW5k
aWYKKworCQlpZiAocmRhdGEtPmhhdmVfY3JlZGl0cykKKwkJCWFkZF9jcmVkaXRzX2FuZF93YWtl
X2lmKHJkYXRhLT5zZXJ2ZXIsICZyZGF0YS0+Y3JlZGl0cywgMCk7CisJCXJjID0gc3VicmVxLT5l
cnJvcjsKKwkJZnJlZV94aWQocmRhdGEtPnhpZCk7CisJfQorfQorCitjb25zdCBzdHJ1Y3QgbmV0
ZnNfcmVxdWVzdF9vcHMgY2lmc19yZXFfb3BzID0geworCS5pb19yZXF1ZXN0X3NpemUJPSBzaXpl
b2Yoc3RydWN0IGNpZnNfaW9fcmVxdWVzdCksCisJLmlvX3N1YnJlcXVlc3Rfc2l6ZQk9IHNpemVv
ZihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0KSwKKwkuaW5pdF9yZXF1ZXN0CQk9IGNpZnNfaW5p
dF9yZXF1ZXN0LAorCS5mcmVlX3JlcXVlc3QJCT0gY2lmc19mcmVlX3JlcXVlc3QsCisJLmZyZWVf
c3VicmVxdWVzdAk9IGNpZnNfZnJlZV9zdWJyZXF1ZXN0LAorCS5leHBhbmRfcmVhZGFoZWFkCT0g
Y2lmc19leHBhbmRfcmVhZGFoZWFkLAorCS5jbGFtcF9sZW5ndGgJCT0gY2lmc19jbGFtcF9sZW5n
dGgsCisJLmlzc3VlX3JlYWQJCT0gY2lmc19yZXFfaXNzdWVfcmVhZCwKKwkuZG9uZQkJCT0gY2lm
c19ycmVxX2RvbmUsCisJLnBvc3RfbW9kaWZ5CQk9IGNpZnNfcG9zdF9tb2RpZnksCisJLmNyZWF0
ZV93cml0ZV9yZXF1ZXN0cwk9IGNpZnNfY3JlYXRlX3dyaXRlX3JlcXVlc3RzLAorfTsKIAogLyoK
ICAqIFJlbW92ZSB0aGUgZGlydHkgZmxhZ3MgZnJvbSBhIHNwYW4gb2YgcGFnZXMuCmRpZmYgLS1n
aXQgYS9pbmNsdWRlL2xpbnV4L25ldGZzLmggYi9pbmNsdWRlL2xpbnV4L25ldGZzLmgKaW5kZXgg
MTAwY2JiMjYxMjY5Li42MTE5NWNmMTZkNmUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvbmV0
ZnMuaAorKysgYi9pbmNsdWRlL2xpbnV4L25ldGZzLmgKQEAgLTMxMiw2ICszMTIsNyBAQCBzdHJ1
Y3QgbmV0ZnNfcmVxdWVzdF9vcHMgewogCiAJLyogTW9kaWZpY2F0aW9uIGhhbmRsaW5nICovCiAJ
dm9pZCAoKnVwZGF0ZV9pX3NpemUpKHN0cnVjdCBpbm9kZSAqaW5vZGUsIGxvZmZfdCBpX3NpemUp
OworCXZvaWQgKCpwb3N0X21vZGlmeSkoc3RydWN0IGlub2RlICppbm9kZSk7CiAKIAkvKiBXcml0
ZSByZXF1ZXN0IGhhbmRsaW5nICovCiAJdm9pZCAoKmNyZWF0ZV93cml0ZV9yZXF1ZXN0cykoc3Ry
dWN0IG5ldGZzX2lvX3JlcXVlc3QgKndyZXEsCmRpZmYgLS1naXQgYS9pbmNsdWRlL3RyYWNlL2V2
ZW50cy9uZXRmcy5oIGIvaW5jbHVkZS90cmFjZS9ldmVudHMvbmV0ZnMuaAppbmRleCA0NDdhOGMy
MWNmNTcuLjA2NTY3YjViZThmYSAxMDA2NDQKLS0tIGEvaW5jbHVkZS90cmFjZS9ldmVudHMvbmV0
ZnMuaAorKysgYi9pbmNsdWRlL3RyYWNlL2V2ZW50cy9uZXRmcy5oCkBAIC0xMDEsNiArMTAxLDcg
QEAKICNkZWZpbmUgbmV0ZnNfc3JlcV9yZWZfdHJhY2VzCQkJCQlcCiAJRU0obmV0ZnNfc3JlcV90
cmFjZV9nZXRfY29weV90b19jYWNoZSwJIkdFVCBDT1BZMkMgIikJXAogCUVNKG5ldGZzX3NyZXFf
dHJhY2VfZ2V0X3Jlc3VibWl0LAkiR0VUIFJFU1VCTUlUIikJXAorCUVNKG5ldGZzX3NyZXFfdHJh
Y2VfZ2V0X3N1Ym1pdCwJCSJHRVQgU1VCTUlUIikJXAogCUVNKG5ldGZzX3NyZXFfdHJhY2VfZ2V0
X3Nob3J0X3JlYWQsCSJHRVQgU0hPUlRSRCIpCVwKIAlFTShuZXRmc19zcmVxX3RyYWNlX25ldywJ
CSJORVcgICAgICAgICIpCVwKIAlFTShuZXRmc19zcmVxX3RyYWNlX3B1dF9jbGVhciwJCSJQVVQg
Q0xFQVIgICIpCVwKLS0gCjIuNDAuMQoK
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0009-cifs-Cut-over-to-using-netfslib.patch"
Content-Disposition: attachment; 
	filename="0009-cifs-Cut-over-to-using-netfslib.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn4691>
X-Attachment-Id: f_lrpgn4691

RnJvbSBmOTliOTc3YjM4OWVlOWFmY2Y3ZTJhZTU0NjNkY2Y3NDU3YjE2MGIwIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTg6Mjk6NTkgKzAxMDAKU3ViamVjdDogW1BBVENIIDA5LzEy
XSBjaWZzOiBDdXQgb3ZlciB0byB1c2luZyBuZXRmc2xpYgoKTWFrZSB0aGUgY2lmcyBmaWxlc3lz
dGVtIHVzZSBuZXRmc2xpYiB0byBoYW5kbGUgcmVhZGluZyBhbmQgd3JpdGluZyBvbgpiZWhhbGYg
b2YgY2lmcy4gIFRoZSBjaGFuZ2VzIGluY2x1ZGU6CgogKDEpIFZhcmlvdXMgcmVhZF9pdGVyL3dy
aXRlX2l0ZXIgdHlwZSBmdW5jdGlvbnMgYXJlIHR1cm5lZCBpbnRvIHdyYXBwZXJzCiAgICAgYXJv
dW5kIG5ldGZzbGliIEFQSSBmdW5jdGlvbnMgb3IgYXJlIHBvaW50ZWQgZGlyZWN0bHkgYXQgdGhv
c2UKICAgICBmdW5jdGlvbnM6CgoJY2lmc19maWxlX2RpcmVjdHssX25vYnJsfV9vcHMgc3dpdGNo
IHRvIHVzZQoJbmV0ZnNfdW5idWZmZXJlZF9yZWFkX2l0ZXIgYW5kIG5ldGZzX3VuYnVmZmVyZWRf
d3JpdGVfaXRlci4KCkxhcmdlIHBpZWNlcyBvZiBjb2RlIHRoYXQgd2lsbCBiZSByZW1vdmVkIGFy
ZSAjaWYnZCBvdXQgYW5kIHdpbGwgYmUgcmVtb3ZlZAppbiBzdWJzZXF1ZW50IHBhdGNoZXMuCgpb
P10gV2h5IGRvZXMgY2lmcyBtYXJrIHRoZSBwYWdlIGRpcnR5IGluIHRoZSBkZXN0aW5hdGlvbiBi
dWZmZXIgb2YgYSBESU8KICAgIHJlYWQ/ICBTaG91bGQgdGhhdCBoYXBwZW4gYXV0b21hdGljYWxs
eT8gIERvZXMgbmV0ZnMgbmVlZCB0byBkbyB0aGF0PwoKU2lnbmVkLW9mZi1ieTogRGF2aWQgSG93
ZWxscyA8ZGhvd2VsbHNAcmVkaGF0LmNvbT4KY2M6IFNoeWFtIFByYXNhZCBOIDxuc3BtYW5nYWxv
cmVAZ21haWwuY29tPgpjYzogUm9oaXRoIFN1cmFiYXR0dWxhIDxyb2hpdGhzLm1zZnRAZ21haWwu
Y29tPgpjYzogSmVmZiBMYXl0b24gPGpsYXl0b25Aa2VybmVsLm9yZz4KY2M6IGxpbnV4LWNpZnNA
dmdlci5rZXJuZWwub3JnCmNjOiBsaW51eC1jYWNoZWZzQHJlZGhhdC5jb20KY2M6IGxpbnV4LWZz
ZGV2ZWxAdmdlci5rZXJuZWwub3JnCmNjOiBsaW51eC1tbUBrdmFjay5vcmcKLS0tCiBmcy9uZXRm
cy9pby5jICAgICAgICAgICAgIHwgICA3ICstCiBmcy9zbWIvY2xpZW50L2NpZnNmcy5jICAgIHwg
ICA4ICstCiBmcy9zbWIvY2xpZW50L2NpZnNmcy5oICAgIHwgICA4ICstCiBmcy9zbWIvY2xpZW50
L2NpZnNnbG9iLmggIHwgICAzICstCiBmcy9zbWIvY2xpZW50L2NpZnNwcm90by5oIHwgICA4ICst
CiBmcy9zbWIvY2xpZW50L2NpZnNzbWIuYyAgIHwgIDQ1ICsrKysrKy0tLS0tCiBmcy9zbWIvY2xp
ZW50L2ZpbGUuYyAgICAgIHwgMTY2ICsrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0t
LS0tCiBmcy9zbWIvY2xpZW50L2ZzY2FjaGUuYyAgIHwgICAyICsKIGZzL3NtYi9jbGllbnQvZnNj
YWNoZS5oICAgfCAgIDQgKwogZnMvc21iL2NsaWVudC9pbm9kZS5jICAgICB8ICAxOSArKysrLQog
ZnMvc21iL2NsaWVudC9zbWIycGR1LmMgICB8IDEwMCArKysrKysrKysrKysrKy0tLS0tLS0tLQog
ZnMvc21iL2NsaWVudC90cmFjZS5oICAgICB8IDE0NCArKysrKysrKysrKysrKysrKysrKysrKysr
KysrLS0tLS0KIGZzL3NtYi9jbGllbnQvdHJhbnNwb3J0LmMgfCAgIDMgKwogMTMgZmlsZXMgY2hh
bmdlZCwgMzQ3IGluc2VydGlvbnMoKyksIDE3MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9m
cy9uZXRmcy9pby5jIGIvZnMvbmV0ZnMvaW8uYwppbmRleCA0MzA5ZWRmMzM4NjIuLmY3NDViYWE1
ZWJhYyAxMDA2NDQKLS0tIGEvZnMvbmV0ZnMvaW8uYworKysgYi9mcy9uZXRmcy9pby5jCkBAIC0z
NTIsOCArMzUyLDEzIEBAIHN0YXRpYyB2b2lkIG5ldGZzX3JyZXFfYXNzZXNzX2RpbyhzdHJ1Y3Qg
bmV0ZnNfaW9fcmVxdWVzdCAqcnJlcSkKIAl1bnNpZ25lZCBpbnQgaTsKIAlzaXplX3QgdHJhbnNm
ZXJyZWQgPSAwOwogCi0JZm9yIChpID0gMDsgaSA8IHJyZXEtPmRpcmVjdF9idl9jb3VudDsgaSsr
KQorCWZvciAoaSA9IDA7IGkgPCBycmVxLT5kaXJlY3RfYnZfY291bnQ7IGkrKykgewogCQlmbHVz
aF9kY2FjaGVfcGFnZShycmVxLT5kaXJlY3RfYnZbaV0uYnZfcGFnZSk7CisJCS8vIFRPRE86IGNp
ZnMgbWFya3MgcGFnZXMgaW4gdGhlIGRlc3RpbmF0aW9uIGJ1ZmZlcgorCQkvLyBkaXJ0eSB1bmRl
ciBzb21lIGNpcmN1bXN0YW5jZXMgYWZ0ZXIgYSByZWFkLiAgRG8gd2UKKwkJLy8gbmVlZCB0byBk
byB0aGF0IHRvbz8KKwkJc2V0X3BhZ2VfZGlydHkocnJlcS0+ZGlyZWN0X2J2W2ldLmJ2X3BhZ2Up
OworCX0KIAogCWxpc3RfZm9yX2VhY2hfZW50cnkoc3VicmVxLCAmcnJlcS0+c3VicmVxdWVzdHMs
IHJyZXFfbGluaykgewogCQlpZiAoc3VicmVxLT5lcnJvciB8fCBzdWJyZXEtPnRyYW5zZmVycmVk
ID09IDApCmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L2NpZnNmcy5jIGIvZnMvc21iL2NsaWVu
dC9jaWZzZnMuYwppbmRleCA0YjZkMWE1ZTQ3NDEuLmRlODM4Y2I4MmNlMSAxMDA2NDQKLS0tIGEv
ZnMvc21iL2NsaWVudC9jaWZzZnMuYworKysgYi9mcy9zbWIvY2xpZW50L2NpZnNmcy5jCkBAIC0x
NTE2LDggKzE1MTYsOCBAQCBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGNpZnNfZmlsZV9z
dHJpY3Rfb3BzID0gewogfTsKIAogY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBjaWZzX2Zp
bGVfZGlyZWN0X29wcyA9IHsKLQkucmVhZF9pdGVyID0gY2lmc19kaXJlY3RfcmVhZHYsCi0JLndy
aXRlX2l0ZXIgPSBjaWZzX2RpcmVjdF93cml0ZXYsCisJLnJlYWRfaXRlciA9IG5ldGZzX3VuYnVm
ZmVyZWRfcmVhZF9pdGVyLAorCS53cml0ZV9pdGVyID0gbmV0ZnNfZmlsZV93cml0ZV9pdGVyLAog
CS5vcGVuID0gY2lmc19vcGVuLAogCS5yZWxlYXNlID0gY2lmc19jbG9zZSwKIAkubG9jayA9IGNp
ZnNfbG9jaywKQEAgLTE1NzIsOCArMTU3Miw4IEBAIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlv
bnMgY2lmc19maWxlX3N0cmljdF9ub2JybF9vcHMgPSB7CiB9OwogCiBjb25zdCBzdHJ1Y3QgZmls
ZV9vcGVyYXRpb25zIGNpZnNfZmlsZV9kaXJlY3Rfbm9icmxfb3BzID0gewotCS5yZWFkX2l0ZXIg
PSBjaWZzX2RpcmVjdF9yZWFkdiwKLQkud3JpdGVfaXRlciA9IGNpZnNfZGlyZWN0X3dyaXRldiwK
KwkucmVhZF9pdGVyID0gbmV0ZnNfdW5idWZmZXJlZF9yZWFkX2l0ZXIsCisJLndyaXRlX2l0ZXIg
PSBuZXRmc19maWxlX3dyaXRlX2l0ZXIsCiAJLm9wZW4gPSBjaWZzX29wZW4sCiAJLnJlbGVhc2Ug
PSBjaWZzX2Nsb3NlLAogCS5mc3luYyA9IGNpZnNfZnN5bmMsCmRpZmYgLS1naXQgYS9mcy9zbWIv
Y2xpZW50L2NpZnNmcy5oIGIvZnMvc21iL2NsaWVudC9jaWZzZnMuaAppbmRleCBlOGUwZjg2M2U5
MzUuLjVjZDU0N2I3YjVlYSAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9jaWZzZnMuaAorKysg
Yi9mcy9zbWIvY2xpZW50L2NpZnNmcy5oCkBAIC04NSw2ICs4NSw3IEBAIGV4dGVybiBjb25zdCBz
dHJ1Y3QgaW5vZGVfb3BlcmF0aW9ucyBjaWZzX25hbWVzcGFjZV9pbm9kZV9vcGVyYXRpb25zOwog
CiAKIC8qIEZ1bmN0aW9ucyByZWxhdGVkIHRvIGZpbGVzIGFuZCBkaXJlY3RvcmllcyAqLworZXh0
ZXJuIGNvbnN0IHN0cnVjdCBuZXRmc19yZXF1ZXN0X29wcyBjaWZzX3JlcV9vcHM7CiBleHRlcm4g
Y29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBjaWZzX2ZpbGVfb3BzOwogZXh0ZXJuIGNvbnN0
IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgY2lmc19maWxlX2RpcmVjdF9vcHM7IC8qIGlmIGRpcmVj
dGlvIG1udCAqLwogZXh0ZXJuIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgY2lmc19maWxl
X3N0cmljdF9vcHM7IC8qIGlmIHN0cmljdGlvIG1udCAqLwpAQCAtOTQsMTEgKzk1LDcgQEAgZXh0
ZXJuIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgY2lmc19maWxlX3N0cmljdF9ub2JybF9v
cHM7CiBleHRlcm4gaW50IGNpZnNfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmls
ZSAqZmlsZSk7CiBleHRlcm4gaW50IGNpZnNfY2xvc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3Ry
dWN0IGZpbGUgKmZpbGUpOwogZXh0ZXJuIGludCBjaWZzX2Nsb3NlZGlyKHN0cnVjdCBpbm9kZSAq
aW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKTsKLWV4dGVybiBzc2l6ZV90IGNpZnNfdXNlcl9yZWFk
dihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqdG8pOwotZXh0ZXJuIHNzaXpl
X3QgY2lmc19kaXJlY3RfcmVhZHYoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIg
KnRvKTsKIGV4dGVybiBzc2l6ZV90IGNpZnNfc3RyaWN0X3JlYWR2KHN0cnVjdCBraW9jYiAqaW9j
Yiwgc3RydWN0IGlvdl9pdGVyICp0byk7Ci1leHRlcm4gc3NpemVfdCBjaWZzX3VzZXJfd3JpdGV2
KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKTsKLWV4dGVybiBzc2l6
ZV90IGNpZnNfZGlyZWN0X3dyaXRldihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRl
ciAqZnJvbSk7CiBleHRlcm4gc3NpemVfdCBjaWZzX3N0cmljdF93cml0ZXYoc3RydWN0IGtpb2Ni
ICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20pOwogc3NpemVfdCBjaWZzX2ZpbGVfd3JpdGVf
aXRlcihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqZnJvbSk7CiBzc2l6ZV90
IGNpZnNfbG9vc2VfcmVhZF9pdGVyKHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVy
ICppdGVyKTsKQEAgLTExMiw5ICsxMDksNiBAQCBleHRlcm4gaW50IGNpZnNfZmlsZV9zdHJpY3Rf
bW1hcChzdHJ1Y3QgZmlsZSAqZmlsZSwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpOwogZXh0
ZXJuIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgY2lmc19kaXJfb3BzOwogZXh0ZXJuIGlu
dCBjaWZzX2Rpcl9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKTsK
IGV4dGVybiBpbnQgY2lmc19yZWFkZGlyKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgZGlyX2Nv
bnRleHQgKmN0eCk7Ci1leHRlcm4gdm9pZCBjaWZzX3BhZ2VzX3dyaXR0ZW5fYmFjayhzdHJ1Y3Qg
aW5vZGUgKmlub2RlLCBsb2ZmX3Qgc3RhcnQsIHVuc2lnbmVkIGludCBsZW4pOwotZXh0ZXJuIHZv
aWQgY2lmc19wYWdlc193cml0ZV9mYWlsZWQoc3RydWN0IGlub2RlICppbm9kZSwgbG9mZl90IHN0
YXJ0LCB1bnNpZ25lZCBpbnQgbGVuKTsKLWV4dGVybiB2b2lkIGNpZnNfcGFnZXNfd3JpdGVfcmVk
aXJ0eShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBsb2ZmX3Qgc3RhcnQsIHVuc2lnbmVkIGludCBsZW4p
OwogCiAvKiBGdW5jdGlvbnMgcmVsYXRlZCB0byBkaXIgZW50cmllcyAqLwogZXh0ZXJuIGNvbnN0
IHN0cnVjdCBkZW50cnlfb3BlcmF0aW9ucyBjaWZzX2RlbnRyeV9vcHM7CmRpZmYgLS1naXQgYS9m
cy9zbWIvY2xpZW50L2NpZnNnbG9iLmggYi9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmgKaW5kZXgg
MzAxZTg4YzQ5YThmLi5iZTYxYjMwN2U0Y2QgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvY2lm
c2dsb2IuaAorKysgYi9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmgKQEAgLTE0ODAsNyArMTQ4MCw3
IEBAIHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgewogI2VuZGlmCiAJc3RydWN0IGNpZnNfY3Jl
ZGl0cwkJY3JlZGl0czsKIAotCS8vIFRPRE86IFJlbW92ZSBmb2xsb3dpbmcgZWxlbWVudHMKKyNp
ZiAwIC8vIFRPRE86IFJlbW92ZSBmb2xsb3dpbmcgZWxlbWVudHMKIAlzdHJ1Y3QgbGlzdF9oZWFk
CQlsaXN0OwogCXN0cnVjdCBjb21wbGV0aW9uCQlkb25lOwogCXN0cnVjdCB3b3JrX3N0cnVjdAkJ
d29yazsKQEAgLTE0OTAsNiArMTQ5MCw3IEBAIHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3Qgewog
CWVudW0gd3JpdGViYWNrX3N5bmNfbW9kZXMJc3luY19tb2RlOwogCWJvb2wJCQkJdW5jYWNoZWQ7
CiAJc3RydWN0IGJpb192ZWMJCQkqYnY7CisjZW5kaWYKIH07CiAKIC8qCmRpZmYgLS1naXQgYS9m
cy9zbWIvY2xpZW50L2NpZnNwcm90by5oIGIvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8uaAppbmRl
eCAwNGYzMThhMGEyZDcuLjdhZGYwNDM5MTA2ZiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9j
aWZzcHJvdG8uaAorKysgYi9mcy9zbWIvY2xpZW50L2NpZnNwcm90by5oCkBAIC0xNDUsOCArMTQ1
LDggQEAgZXh0ZXJuIGludCBjaGVja1NNQihjaGFyICpidWYsIHVuc2lnbmVkIGludCBsZW4sIHN0
cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNydnIpOwogZXh0ZXJuIGJvb2wgaXNfdmFsaWRfb3Bsb2Nr
X2JyZWFrKGNoYXIgKiwgc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqKTsKIGV4dGVybiBib29sIGJh
Y2t1cF9jcmVkKHN0cnVjdCBjaWZzX3NiX2luZm8gKik7CiBleHRlcm4gYm9vbCBpc19zaXplX3Nh
ZmVfdG9fY2hhbmdlKHN0cnVjdCBjaWZzSW5vZGVJbmZvICosIF9fdTY0IGVvZik7Ci1leHRlcm4g
dm9pZCBjaWZzX3VwZGF0ZV9lb2Yoc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNpLCBsb2ZmX3Qg
b2Zmc2V0LAotCQkJICAgIHVuc2lnbmVkIGludCBieXRlc193cml0dGVuKTsKK3ZvaWQgY2lmc193
cml0ZV9zdWJyZXF1ZXN0X3Rlcm1pbmF0ZWQoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2Rh
dGEsIHNzaXplX3QgcmVzdWx0LAorCQkJCSAgICAgIGJvb2wgd2FzX2FzeW5jKTsKIGV4dGVybiBz
dHJ1Y3QgY2lmc0ZpbGVJbmZvICpmaW5kX3dyaXRhYmxlX2ZpbGUoc3RydWN0IGNpZnNJbm9kZUlu
Zm8gKiwgaW50KTsKIGV4dGVybiBpbnQgY2lmc19nZXRfd3JpdGFibGVfZmlsZShzdHJ1Y3QgY2lm
c0lub2RlSW5mbyAqY2lmc19pbm9kZSwKIAkJCQkgIGludCBmbGFncywKQEAgLTU5NCw2ICs1OTQs
NyBAQCB2b2lkIF9fY2lmc19wdXRfc21iX3NlcyhzdHJ1Y3QgY2lmc19zZXMgKnNlcyk7CiBleHRl
cm4gc3RydWN0IGNpZnNfc2VzICoKIGNpZnNfZ2V0X3NtYl9zZXMoc3RydWN0IFRDUF9TZXJ2ZXJf
SW5mbyAqc2VydmVyLCBzdHJ1Y3Qgc21iM19mc19jb250ZXh0ICpjdHgpOwogCisjaWYgMCAvLyBU
T0RPIFJlbW92ZQogdm9pZCBjaWZzX3JlYWRkYXRhX3JlbGVhc2Uoc3RydWN0IGNpZnNfaW9fc3Vi
cmVxdWVzdCAqcmRhdGEpOwogc3RhdGljIGlubGluZSB2b2lkIGNpZnNfZ2V0X3JlYWRkYXRhKHN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKQogewpAQCAtNjA0LDExICs2MDUsMTMgQEAg
c3RhdGljIGlubGluZSB2b2lkIGNpZnNfcHV0X3JlYWRkYXRhKHN0cnVjdCBjaWZzX2lvX3N1YnJl
cXVlc3QgKnJkYXRhKQogCWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJnJkYXRhLT5zdWJyZXEu
cmVmKSkKIAkJY2lmc19yZWFkZGF0YV9yZWxlYXNlKHJkYXRhKTsKIH0KKyNlbmRpZgogaW50IGNp
ZnNfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEpOwogaW50IGNp
ZnNfcmVhZHZfcmVjZWl2ZShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIHN0cnVjdCBt
aWRfcV9lbnRyeSAqbWlkKTsKIAogaW50IGNpZnNfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKndkYXRhKTsKIHZvaWQgY2lmc193cml0ZXZfY29tcGxldGUoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKTsKKyNpZiAwIC8vIFRPRE8gUmVtb3ZlCiBzdHJ1Y3QgY2lmc19pb19z
dWJyZXF1ZXN0ICpjaWZzX3dyaXRlZGF0YV9hbGxvYyh3b3JrX2Z1bmNfdCBjb21wbGV0ZSk7CiB2
b2lkIGNpZnNfd3JpdGVkYXRhX3JlbGVhc2Uoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRh
dGEpOwogc3RhdGljIGlubGluZSB2b2lkIGNpZnNfZ2V0X3dyaXRlZGF0YShzdHJ1Y3QgY2lmc19p
b19zdWJyZXF1ZXN0ICp3ZGF0YSkKQEAgLTYyMCw2ICs2MjMsNyBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgY2lmc19wdXRfd3JpdGVkYXRhKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQog
CWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJndkYXRhLT5zdWJyZXEucmVmKSkKIAkJY2lmc193
cml0ZWRhdGFfcmVsZWFzZSh3ZGF0YSk7CiB9CisjZW5kaWYKIGludCBjaWZzX3F1ZXJ5X21mX3N5
bWxpbmsodW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwKIAkJCSAgc3Ry
dWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYiwKIAkJCSAgY29uc3QgdW5zaWduZWQgY2hhciAqcGF0
aCwgY2hhciAqcGJ1ZiwKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc3NtYi5jIGIvZnMv
c21iL2NsaWVudC9jaWZzc21iLmMKaW5kZXggYjFjMzNhNjI0MTU3Li5iNjIxNGYxZTMyNjEgMTAw
NjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvY2lmc3NtYi5jCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lm
c3NtYi5jCkBAIC0xMjY1LDcgKzEyNjUsNyBAQCBzdGF0aWMgdm9pZAogY2lmc19yZWFkdl9jYWxs
YmFjayhzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCkKIHsKIAlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1
ZXN0ICpyZGF0YSA9IG1pZC0+Y2FsbGJhY2tfZGF0YTsKLQlzdHJ1Y3QgY2lmc190Y29uICp0Y29u
ID0gdGxpbmtfdGNvbihyZGF0YS0+Y2ZpbGUtPnRsaW5rKTsKKwlzdHJ1Y3QgY2lmc190Y29uICp0
Y29uID0gdGxpbmtfdGNvbihyZGF0YS0+cmVxLT5jZmlsZS0+dGxpbmspOwogCXN0cnVjdCBUQ1Bf
U2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOwogCXN0cnVjdCBzbWJfcnFz
dCBycXN0ID0geyAucnFfaW92ID0gcmRhdGEtPmlvdiwKIAkJCQkgLnJxX252ZWMgPSAyLApAQCAt
MTMwNiw3ICsxMzA2LDEyIEBAIGNpZnNfcmVhZHZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5
ICptaWQpCiAJCXJkYXRhLT5yZXN1bHQgPSAtRUlPOwogCX0KIAotCXF1ZXVlX3dvcmsoY2lmc2lv
ZF93cSwgJnJkYXRhLT53b3JrKTsKKwlpZiAocmRhdGEtPnJlc3VsdCA9PSAwIHx8IHJkYXRhLT5y
ZXN1bHQgPT0gLUVBR0FJTikKKwkJaW92X2l0ZXJfYWR2YW5jZSgmcmRhdGEtPnN1YnJlcS5pb19p
dGVyLCByZGF0YS0+Z290X2J5dGVzKTsKKwluZXRmc19zdWJyZXFfdGVybWluYXRlZCgmcmRhdGEt
PnN1YnJlcSwKKwkJCQkocmRhdGEtPnJlc3VsdCA9PSAwIHx8IHJkYXRhLT5yZXN1bHQgPT0gLUVB
R0FJTikgPworCQkJCXJkYXRhLT5nb3RfYnl0ZXMgOiByZGF0YS0+cmVzdWx0LAorCQkJCWZhbHNl
KTsKIAlyZWxlYXNlX21pZChtaWQpOwogCWFkZF9jcmVkaXRzKHNlcnZlciwgJmNyZWRpdHMsIDAp
OwogfQpAQCAtMTMxOCw3ICsxMzIzLDcgQEAgY2lmc19hc3luY19yZWFkdihzdHJ1Y3QgY2lmc19p
b19zdWJyZXF1ZXN0ICpyZGF0YSkKIAlpbnQgcmM7CiAJUkVBRF9SRVEgKnNtYiA9IE5VTEw7CiAJ
aW50IHdjdDsKLQlzdHJ1Y3QgY2lmc190Y29uICp0Y29uID0gdGxpbmtfdGNvbihyZGF0YS0+Y2Zp
bGUtPnRsaW5rKTsKKwlzdHJ1Y3QgY2lmc190Y29uICp0Y29uID0gdGxpbmtfdGNvbihyZGF0YS0+
cmVxLT5jZmlsZS0+dGxpbmspOwogCXN0cnVjdCBzbWJfcnFzdCBycXN0ID0geyAucnFfaW92ID0g
cmRhdGEtPmlvdiwKIAkJCQkgLnJxX252ZWMgPSAyIH07CiAKQEAgLTEzNDMsNyArMTM0OCw3IEBA
IGNpZnNfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEpCiAJc21i
LT5oZHIuUGlkSGlnaCA9IGNwdV90b19sZTE2KChfX3UxNikocmRhdGEtPnBpZCA+PiAxNikpOwog
CiAJc21iLT5BbmRYQ29tbWFuZCA9IDB4RkY7CS8qIG5vbmUgKi8KLQlzbWItPkZpZCA9IHJkYXRh
LT5jZmlsZS0+ZmlkLm5ldGZpZDsKKwlzbWItPkZpZCA9IHJkYXRhLT5yZXEtPmNmaWxlLT5maWQu
bmV0ZmlkOwogCXNtYi0+T2Zmc2V0TG93ID0gY3B1X3RvX2xlMzIocmRhdGEtPnN1YnJlcS5zdGFy
dCAmIDB4RkZGRkZGRkYpOwogCWlmICh3Y3QgPT0gMTIpCiAJCXNtYi0+T2Zmc2V0SGlnaCA9IGNw
dV90b19sZTMyKHJkYXRhLT5zdWJyZXEuc3RhcnQgPj4gMzIpOwpAQCAtMTYxMywxNSArMTYxOCwx
NiBAQCBzdGF0aWMgdm9pZAogY2lmc193cml0ZXZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5
ICptaWQpCiB7CiAJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEgPSBtaWQtPmNhbGxi
YWNrX2RhdGE7Ci0Jc3RydWN0IGNpZnNfdGNvbiAqdGNvbiA9IHRsaW5rX3Rjb24od2RhdGEtPmNm
aWxlLT50bGluayk7Ci0JdW5zaWduZWQgaW50IHdyaXR0ZW47CisJc3RydWN0IGNpZnNfdGNvbiAq
dGNvbiA9IHRsaW5rX3Rjb24od2RhdGEtPnJlcS0+Y2ZpbGUtPnRsaW5rKTsKIAlXUklURV9SU1Ag
KnNtYiA9IChXUklURV9SU1AgKiltaWQtPnJlc3BfYnVmOwogCXN0cnVjdCBjaWZzX2NyZWRpdHMg
Y3JlZGl0cyA9IHsgLnZhbHVlID0gMSwgLmluc3RhbmNlID0gMCB9OworCXNzaXplX3QgcmVzdWx0
OworCXNpemVfdCB3cml0dGVuOwogCiAJc3dpdGNoIChtaWQtPm1pZF9zdGF0ZSkgewogCWNhc2Ug
TUlEX1JFU1BPTlNFX1JFQ0VJVkVEOgotCQl3ZGF0YS0+cmVzdWx0ID0gY2lmc19jaGVja19yZWNl
aXZlKG1pZCwgdGNvbi0+c2VzLT5zZXJ2ZXIsIDApOwotCQlpZiAod2RhdGEtPnJlc3VsdCAhPSAw
KQorCQlyZXN1bHQgPSBjaWZzX2NoZWNrX3JlY2VpdmUobWlkLCB0Y29uLT5zZXMtPnNlcnZlciwg
MCk7CisJCWlmIChyZXN1bHQgIT0gMCkKIAkJCWJyZWFrOwogCiAJCXdyaXR0ZW4gPSBsZTE2X3Rv
X2NwdShzbWItPkNvdW50SGlnaCk7CkBAIC0xNjM3LDIwICsxNjQzLDIwIEBAIGNpZnNfd3JpdGV2
X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCQkJd3JpdHRlbiAmPSAweEZGRkY7
CiAKIAkJaWYgKHdyaXR0ZW4gPCB3ZGF0YS0+c3VicmVxLmxlbikKLQkJCXdkYXRhLT5yZXN1bHQg
PSAtRU5PU1BDOworCQkJcmVzdWx0ID0gLUVOT1NQQzsKIAkJZWxzZQotCQkJd2RhdGEtPnN1YnJl
cS5sZW4gPSB3cml0dGVuOworCQkJcmVzdWx0ID0gd3JpdHRlbjsKIAkJYnJlYWs7CiAJY2FzZSBN
SURfUkVRVUVTVF9TVUJNSVRURUQ6CiAJY2FzZSBNSURfUkVUUllfTkVFREVEOgotCQl3ZGF0YS0+
cmVzdWx0ID0gLUVBR0FJTjsKKwkJcmVzdWx0ID0gLUVBR0FJTjsKIAkJYnJlYWs7CiAJZGVmYXVs
dDoKLQkJd2RhdGEtPnJlc3VsdCA9IC1FSU87CisJCXJlc3VsdCA9IC1FSU87CiAJCWJyZWFrOwog
CX0KIAotCXF1ZXVlX3dvcmsoY2lmc2lvZF93cSwgJndkYXRhLT53b3JrKTsKKwljaWZzX3dyaXRl
X3N1YnJlcXVlc3RfdGVybWluYXRlZCh3ZGF0YSwgcmVzdWx0LCB0cnVlKTsKIAlyZWxlYXNlX21p
ZChtaWQpOwogCWFkZF9jcmVkaXRzKHRjb24tPnNlcy0+c2VydmVyLCAmY3JlZGl0cywgMCk7CiB9
CkBAIC0xNjYyLDcgKzE2NjgsNyBAQCBjaWZzX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lmc19pb19z
dWJyZXF1ZXN0ICp3ZGF0YSkKIAlpbnQgcmMgPSAtRUFDQ0VTOwogCVdSSVRFX1JFUSAqc21iID0g
TlVMTDsKIAlpbnQgd2N0OwotCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHdk
YXRhLT5jZmlsZS0+dGxpbmspOworCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29u
KHdkYXRhLT5yZXEtPmNmaWxlLT50bGluayk7CiAJc3RydWN0IGt2ZWMgaW92WzJdOwogCXN0cnVj
dCBzbWJfcnFzdCBycXN0ID0geyB9OwogCkBAIC0xNjcyLDcgKzE2NzgsOCBAQCBjaWZzX2FzeW5j
X3dyaXRldihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKIAkJd2N0ID0gMTI7CiAJ
CWlmICh3ZGF0YS0+c3VicmVxLnN0YXJ0ID4+IDMyID4gMCkgewogCQkJLyogY2FuIG5vdCBoYW5k
bGUgYmlnIG9mZnNldCBmb3Igb2xkIHNydiAqLwotCQkJcmV0dXJuIC1FSU87CisJCQlyYyA9IC1F
SU87CisJCQlnb3RvIG91dDsKIAkJfQogCX0KIApAQCAtMTY4NCw3ICsxNjkxLDcgQEAgY2lmc19h
c3luY193cml0ZXYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEpCiAJc21iLT5oZHIu
UGlkSGlnaCA9IGNwdV90b19sZTE2KChfX3UxNikod2RhdGEtPnBpZCA+PiAxNikpOwogCiAJc21i
LT5BbmRYQ29tbWFuZCA9IDB4RkY7CS8qIG5vbmUgKi8KLQlzbWItPkZpZCA9IHdkYXRhLT5jZmls
ZS0+ZmlkLm5ldGZpZDsKKwlzbWItPkZpZCA9IHdkYXRhLT5yZXEtPmNmaWxlLT5maWQubmV0Zmlk
OwogCXNtYi0+T2Zmc2V0TG93ID0gY3B1X3RvX2xlMzIod2RhdGEtPnN1YnJlcS5zdGFydCAmIDB4
RkZGRkZGRkYpOwogCWlmICh3Y3QgPT0gMTQpCiAJCXNtYi0+T2Zmc2V0SGlnaCA9IGNwdV90b19s
ZTMyKHdkYXRhLT5zdWJyZXEuc3RhcnQgPj4gMzIpOwpAQCAtMTcyNCwxNyArMTczMSwxNyBAQCBj
aWZzX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKIAkJaW92
WzFdLmlvdl9sZW4gKz0gNDsgLyogcGFkIGJpZ2dlciBieSBmb3VyIGJ5dGVzICovCiAJfQogCi0J
Y2lmc19nZXRfd3JpdGVkYXRhKHdkYXRhKTsKIAlyYyA9IGNpZnNfY2FsbF9hc3luYyh0Y29uLT5z
ZXMtPnNlcnZlciwgJnJxc3QsIE5VTEwsCiAJCQkgICAgIGNpZnNfd3JpdGV2X2NhbGxiYWNrLCBO
VUxMLCB3ZGF0YSwgMCwgTlVMTCk7CiAKIAlpZiAocmMgPT0gMCkKIAkJY2lmc19zdGF0c19pbmMo
JnRjb24tPnN0YXRzLmNpZnNfc3RhdHMubnVtX3dyaXRlcyk7Ci0JZWxzZQotCQljaWZzX3B1dF93
cml0ZWRhdGEod2RhdGEpOwogCiBhc3luY193cml0ZXZfb3V0OgogCWNpZnNfc21hbGxfYnVmX3Jl
bGVhc2Uoc21iKTsKK291dDoKKwlpZiAocmMpCisJCWNpZnNfd3JpdGVfc3VicmVxdWVzdF90ZXJt
aW5hdGVkKHdkYXRhLCByYywgZmFsc2UpOwogCXJldHVybiByYzsKIH0KIApkaWZmIC0tZ2l0IGEv
ZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9zbWIvY2xpZW50L2ZpbGUuYwppbmRleCA3MjkzNGNl
ZTBjNTkuLjIzZGNlYzllY2ZhNCAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9maWxlLmMKKysr
IGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAgLTIyLDYgKzIyLDcgQEAKICNpbmNsdWRlIDxsaW51
eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvc3dhcC5oPgogI2luY2x1ZGUgPGxpbnV4L21tLmg+
CisjaW5jbHVkZSA8bGludXgvbmV0ZnMuaD4KICNpbmNsdWRlIDxhc20vZGl2NjQuaD4KICNpbmNs
dWRlICJjaWZzZnMuaCIKICNpbmNsdWRlICJjaWZzcGR1LmgiCkBAIC0xNzIsNyArMTczLDcgQEAg
c3RhdGljIHZvaWQgY2lmc19jcmVhdGVfd3JpdGVfcmVxdWVzdHMoc3RydWN0IG5ldGZzX2lvX3Jl
cXVlc3QgKndyZXEsCiBmYWlsZWRfcmV0dXJuX2NyZWRpdHM6CiAJYWRkX2NyZWRpdHNfYW5kX3dh
a2VfaWYoc2VydmVyLCAmd2RhdGEtPmNyZWRpdHMsIDApOwogZmFpbGVkOgotCW5ldGZzX3dyaXRl
X3N1YnJlcXVlc3RfdGVybWluYXRlZChzdWJyZXEsIHJjLCBmYWxzZSk7CisJY2lmc193cml0ZV9z
dWJyZXF1ZXN0X3Rlcm1pbmF0ZWQod2RhdGEsIHJjLCBmYWxzZSk7CiAJZnJlZV94aWQoeGlkKTsK
IH0KIApAQCAtMzk0LDYgKzM5NSw3IEBAIGNvbnN0IHN0cnVjdCBuZXRmc19yZXF1ZXN0X29wcyBj
aWZzX3JlcV9vcHMgPSB7CiAJLmNyZWF0ZV93cml0ZV9yZXF1ZXN0cwk9IGNpZnNfY3JlYXRlX3dy
aXRlX3JlcXVlc3RzLAogfTsKIAorI2lmIDAgLy8gVE9ETyByZW1vdmUgMzk3CiAvKgogICogUmVt
b3ZlIHRoZSBkaXJ0eSBmbGFncyBmcm9tIGEgc3BhbiBvZiBwYWdlcy4KICAqLwpAQCAtNTE4LDYg
KzUyMCw3IEBAIHZvaWQgY2lmc19wYWdlc193cml0ZV9yZWRpcnR5KHN0cnVjdCBpbm9kZSAqaW5v
ZGUsIGxvZmZfdCBzdGFydCwgdW5zaWduZWQgaW50IGxlCiAKIAlyY3VfcmVhZF91bmxvY2soKTsK
IH0KKyNlbmRpZiAvLyBlbmQgbmV0ZnNsaWIgcmVtb3ZlIDM5NwogCiAvKgogICogTWFyayBhcyBp
bnZhbGlkLCBhbGwgb3BlbiBmaWxlcyBvbiB0cmVlIGNvbm5lY3Rpb25zIHNpbmNlIHRoZXkKQEAg
LTI0NjcsMjAgKzI0NzAsMjMgQEAgaW50IGNpZnNfbG9jayhzdHJ1Y3QgZmlsZSAqZmlsZSwgaW50
IGNtZCwgc3RydWN0IGZpbGVfbG9jayAqZmxvY2spCiAJcmV0dXJuIHJjOwogfQogCi0vKgotICog
dXBkYXRlIHRoZSBmaWxlIHNpemUgKGlmIG5lZWRlZCkgYWZ0ZXIgYSB3cml0ZS4gU2hvdWxkIGJl
IGNhbGxlZCB3aXRoCi0gKiB0aGUgaW5vZGUtPmlfbG9jayBoZWxkCi0gKi8KLXZvaWQKLWNpZnNf
dXBkYXRlX2VvZihzdHJ1Y3QgY2lmc0lub2RlSW5mbyAqY2lmc2ksIGxvZmZfdCBvZmZzZXQsCi0J
CSAgICAgIHVuc2lnbmVkIGludCBieXRlc193cml0dGVuKQordm9pZCBjaWZzX3dyaXRlX3N1YnJl
cXVlc3RfdGVybWluYXRlZChzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSwgc3NpemVf
dCByZXN1bHQsCisJCQkJICAgICAgYm9vbCB3YXNfYXN5bmMpCiB7Ci0JbG9mZl90IGVuZF9vZl93
cml0ZSA9IG9mZnNldCArIGJ5dGVzX3dyaXR0ZW47CisJc3RydWN0IG5ldGZzX2lvX3JlcXVlc3Qg
KndyZXEgPSB3ZGF0YS0+cnJlcTsKKwlsb2ZmX3QgbmV3X3NlcnZlcl9lb2Y7CiAKLQlpZiAoZW5k
X29mX3dyaXRlID4gY2lmc2ktPm5ldGZzLnJlbW90ZV9pX3NpemUpCi0JCW5ldGZzX3Jlc2l6ZV9m
aWxlKCZjaWZzaS0+bmV0ZnMsIGVuZF9vZl93cml0ZSwgdHJ1ZSk7CisJaWYgKHJlc3VsdCA+IDAp
IHsKKwkJbmV3X3NlcnZlcl9lb2YgPSB3ZGF0YS0+c3VicmVxLnN0YXJ0ICsgd2RhdGEtPnN1YnJl
cS50cmFuc2ZlcnJlZCArIHJlc3VsdDsKKworCQlpZiAobmV3X3NlcnZlcl9lb2YgPiBuZXRmc19p
bm9kZSh3cmVxLT5pbm9kZSktPnJlbW90ZV9pX3NpemUpCisJCQluZXRmc19yZXNpemVfZmlsZShu
ZXRmc19pbm9kZSh3cmVxLT5pbm9kZSksIG5ld19zZXJ2ZXJfZW9mLCB0cnVlKTsKKwl9CisKKwlu
ZXRmc193cml0ZV9zdWJyZXF1ZXN0X3Rlcm1pbmF0ZWQoJndkYXRhLT5zdWJyZXEsIHJlc3VsdCwg
d2FzX2FzeW5jKTsKIH0KIAorI2lmIDAgLy8gVE9ETyByZW1vdmUgMjQ4Mwogc3RhdGljIHNzaXpl
X3QKIGNpZnNfd3JpdGUoc3RydWN0IGNpZnNGaWxlSW5mbyAqb3Blbl9maWxlLCBfX3UzMiBwaWQs
IGNvbnN0IGNoYXIgKndyaXRlX2RhdGEsCiAJICAgc2l6ZV90IHdyaXRlX3NpemUsIGxvZmZfdCAq
b2Zmc2V0KQpAQCAtMjU2NCw2ICsyNTcwLDcgQEAgY2lmc193cml0ZShzdHJ1Y3QgY2lmc0ZpbGVJ
bmZvICpvcGVuX2ZpbGUsIF9fdTMyIHBpZCwgY29uc3QgY2hhciAqd3JpdGVfZGF0YSwKIAlmcmVl
X3hpZCh4aWQpOwogCXJldHVybiB0b3RhbF93cml0dGVuOwogfQorI2VuZGlmIC8vIGVuZCBuZXRm
c2xpYiByZW1vdmUgMjQ4MwogCiBzdHJ1Y3QgY2lmc0ZpbGVJbmZvICpmaW5kX3JlYWRhYmxlX2Zp
bGUoc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNfaW5vZGUsCiAJCQkJCWJvb2wgZnN1aWRfb25s
eSkKQEAgLTI3NjksNiArMjc3Niw3IEBAIGNpZnNfZ2V0X3JlYWRhYmxlX3BhdGgoc3RydWN0IGNp
ZnNfdGNvbiAqdGNvbiwgY29uc3QgY2hhciAqbmFtZSwKIAlyZXR1cm4gLUVOT0VOVDsKIH0KIAor
I2lmIDAgLy8gVE9ETyByZW1vdmUgMjc3Mwogdm9pZAogY2lmc193cml0ZWRhdGFfcmVsZWFzZShz
dHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKIHsKQEAgLTM0NTksNyArMzQ2NywxMSBA
QCBzdGF0aWMgaW50IGNpZnNfd3JpdGVfZW5kKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgYWRk
cmVzc19zcGFjZSAqbWFwcGluZywKIAogCXJldHVybiByYzsKIH0KKyNlbmRpZiAvLyBFbmQgbmV0
ZnMgcmVtb3ZhbCAyNzczCiAKKy8qCisgKiBGbHVzaCBkYXRhIG9uIGEgc3RyaWN0IGZpbGUuCisg
Ki8KIGludCBjaWZzX3N0cmljdF9mc3luYyhzdHJ1Y3QgZmlsZSAqZmlsZSwgbG9mZl90IHN0YXJ0
LCBsb2ZmX3QgZW5kLAogCQkgICAgICBpbnQgZGF0YXN5bmMpCiB7CkBAIC0zNTE0LDYgKzM1MjYs
OSBAQCBpbnQgY2lmc19zdHJpY3RfZnN5bmMoc3RydWN0IGZpbGUgKmZpbGUsIGxvZmZfdCBzdGFy
dCwgbG9mZl90IGVuZCwKIAlyZXR1cm4gcmM7CiB9CiAKKy8qCisgKiBGbHVzaCBkYXRhIG9uIGEg
bm9uLXN0cmljdCBkYXRhLgorICovCiBpbnQgY2lmc19mc3luYyhzdHJ1Y3QgZmlsZSAqZmlsZSwg
bG9mZl90IHN0YXJ0LCBsb2ZmX3QgZW5kLCBpbnQgZGF0YXN5bmMpCiB7CiAJdW5zaWduZWQgaW50
IHhpZDsKQEAgLTM1ODAsNiArMzU5NSw3IEBAIGludCBjaWZzX2ZsdXNoKHN0cnVjdCBmaWxlICpm
aWxlLCBmbF9vd25lcl90IGlkKQogCXJldHVybiByYzsKIH0KIAorI2lmIDAgLy8gVE9ETyByZW1v
dmUgMzU5NAogc3RhdGljIHZvaWQgY29sbGVjdF91bmNhY2hlZF93cml0ZV9kYXRhKHN0cnVjdCBj
aWZzX2Fpb19jdHggKmN0eCk7CiAKIHN0YXRpYyB2b2lkCkBAIC00MDQxLDYgKzQwNTcsNyBAQCBz
c2l6ZV90IGNpZnNfdXNlcl93cml0ZXYoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0
ZXIgKmZyb20pCiB7CiAJcmV0dXJuIF9fY2lmc193cml0ZXYoaW9jYiwgZnJvbSwgZmFsc2UpOwog
fQorI2VuZGlmIC8vIFRPRE8gcmVtb3ZlIDM1OTQKIAogc3RhdGljIHNzaXplX3QKIGNpZnNfd3Jp
dGV2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKQpAQCAtNDA1Miw3
ICs0MDY5LDEwIEBAIGNpZnNfd3JpdGV2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9p
dGVyICpmcm9tKQogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRsaW5rX3Rjb24o
Y2ZpbGUtPnRsaW5rKS0+c2VzLT5zZXJ2ZXI7CiAJc3NpemVfdCByYzsKIAotCWlub2RlX2xvY2so
aW5vZGUpOworCXJjID0gbmV0ZnNfc3RhcnRfaW9fd3JpdGUoaW5vZGUpOworCWlmIChyYyA8IDAp
CisJCXJldHVybiByYzsKKwogCS8qCiAJICogV2UgbmVlZCB0byBob2xkIHRoZSBzZW0gdG8gYmUg
c3VyZSBub2JvZHkgbW9kaWZpZXMgbG9jayBsaXN0CiAJICogd2l0aCBhIGJybG9jayB0aGF0IHBy
ZXZlbnRzIHdyaXRpbmcuCkBAIC00MDY2LDEzICs0MDg2LDEyIEBAIGNpZnNfd3JpdGV2KHN0cnVj
dCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKQogCWlmICghY2lmc19maW5kX2xv
Y2tfY29uZmxpY3QoY2ZpbGUsIGlvY2ItPmtpX3BvcywgaW92X2l0ZXJfY291bnQoZnJvbSksCiAJ
CQkJICAgICBzZXJ2ZXItPnZhbHMtPmV4Y2x1c2l2ZV9sb2NrX3R5cGUsIDAsCiAJCQkJICAgICBO
VUxMLCBDSUZTX1dSSVRFX09QKSkKLQkJcmMgPSBfX2dlbmVyaWNfZmlsZV93cml0ZV9pdGVyKGlv
Y2IsIGZyb20pOworCQlyYyA9IG5ldGZzX2J1ZmZlcmVkX3dyaXRlX2l0ZXJfbG9ja2VkKGlvY2Is
IGZyb20sIE5VTEwpOwogCWVsc2UKIAkJcmMgPSAtRUFDQ0VTOwogb3V0OgogCXVwX3JlYWQoJmNp
bm9kZS0+bG9ja19zZW0pOwotCWlub2RlX3VubG9jayhpbm9kZSk7Ci0KKwluZXRmc19lbmRfaW9f
d3JpdGUoaW5vZGUpOwogCWlmIChyYyA+IDApCiAJCXJjID0gZ2VuZXJpY193cml0ZV9zeW5jKGlv
Y2IsIHJjKTsKIAlyZXR1cm4gcmM7CkBAIC00MDk1LDkgKzQxMTQsOSBAQCBjaWZzX3N0cmljdF93
cml0ZXYoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20pCiAKIAlpZiAo
Q0lGU19DQUNIRV9XUklURShjaW5vZGUpKSB7CiAJCWlmIChjYXBfdW5peCh0Y29uLT5zZXMpICYm
Ci0JCShDSUZTX1VOSVhfRkNOVExfQ0FQICYgbGU2NF90b19jcHUodGNvbi0+ZnNVbml4SW5mby5D
YXBhYmlsaXR5KSkKLQkJICAmJiAoKGNpZnNfc2ItPm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VO
VF9OT1BPU0lYQlJMKSA9PSAwKSkgewotCQkJd3JpdHRlbiA9IGdlbmVyaWNfZmlsZV93cml0ZV9p
dGVyKGlvY2IsIGZyb20pOworCQkgICAgKENJRlNfVU5JWF9GQ05UTF9DQVAgJiBsZTY0X3RvX2Nw
dSh0Y29uLT5mc1VuaXhJbmZvLkNhcGFiaWxpdHkpKSAmJgorCQkgICAgKChjaWZzX3NiLT5tbnRf
Y2lmc19mbGFncyAmIENJRlNfTU9VTlRfTk9QT1NJWEJSTCkgPT0gMCkpIHsKKwkJCXdyaXR0ZW4g
PSBuZXRmc19maWxlX3dyaXRlX2l0ZXIoaW9jYiwgZnJvbSk7CiAJCQlnb3RvIG91dDsKIAkJfQog
CQl3cml0dGVuID0gY2lmc193cml0ZXYoaW9jYiwgZnJvbSk7CkBAIC00MTA5LDcgKzQxMjgsNyBA
QCBjaWZzX3N0cmljdF93cml0ZXYoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIg
KmZyb20pCiAJICogYWZmZWN0ZWQgcGFnZXMgYmVjYXVzZSBpdCBtYXkgY2F1c2UgYSBlcnJvciB3
aXRoIG1hbmRhdG9yeSBsb2NrcyBvbgogCSAqIHRoZXNlIHBhZ2VzIGJ1dCBub3Qgb24gdGhlIHJl
Z2lvbiBmcm9tIHBvcyB0byBwcG9zK2xlbi0xLgogCSAqLwotCXdyaXR0ZW4gPSBjaWZzX3VzZXJf
d3JpdGV2KGlvY2IsIGZyb20pOworCXdyaXR0ZW4gPSBuZXRmc19maWxlX3dyaXRlX2l0ZXIoaW9j
YiwgZnJvbSk7CiAJaWYgKENJRlNfQ0FDSEVfUkVBRChjaW5vZGUpKSB7CiAJCS8qCiAJCSAqIFdl
IGhhdmUgcmVhZCBsZXZlbCBjYWNoaW5nIGFuZCB3ZSBoYXZlIGp1c3Qgc2VudCBhIHdyaXRlCkBA
IC00MTI4LDYgKzQxNDcsNyBAQCBjaWZzX3N0cmljdF93cml0ZXYoc3RydWN0IGtpb2NiICppb2Ni
LCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20pCiAJcmV0dXJuIHdyaXR0ZW47CiB9CiAKKyNpZiAwIC8v
IFRPRE8gcmVtb3ZlIDQxNDMKIHN0YXRpYyBzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpjaWZz
X3JlYWRkYXRhX2FsbG9jKHdvcmtfZnVuY190IGNvbXBsZXRlKQogewogCXN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKnJkYXRhOwpAQCAtNDU2Nyw3ICs0NTg3LDkgQEAgc3NpemVfdCBjaWZzX2Rp
cmVjdF9yZWFkdihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqdG8pCiBzc2l6
ZV90IGNpZnNfdXNlcl9yZWFkdihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAq
dG8pCiB7CiAJcmV0dXJuIF9fY2lmc19yZWFkdihpb2NiLCB0bywgZmFsc2UpOworCiB9CisjZW5k
aWYgLy8gZW5kIG5ldGZzbGliIHJlbW92YWwgNDE0MwogCiBzc2l6ZV90IGNpZnNfbG9vc2VfcmVh
ZF9pdGVyKHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICppdGVyKQogewpAQCAt
NDU3NSwxMyArNDU5NywxMyBAQCBzc2l6ZV90IGNpZnNfbG9vc2VfcmVhZF9pdGVyKHN0cnVjdCBr
aW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICppdGVyKQogCXN0cnVjdCBpbm9kZSAqaW5vZGUg
PSBmaWxlX2lub2RlKGlvY2ItPmtpX2ZpbHApOwogCiAJaWYgKGlvY2ItPmtpX2ZsYWdzICYgSU9D
Ql9ESVJFQ1QpCi0JCXJldHVybiBjaWZzX3VzZXJfcmVhZHYoaW9jYiwgaXRlcik7CisJCXJldHVy
biBuZXRmc191bmJ1ZmZlcmVkX3JlYWRfaXRlcihpb2NiLCBpdGVyKTsKIAogCXJjID0gY2lmc19y
ZXZhbGlkYXRlX21hcHBpbmcoaW5vZGUpOwogCWlmIChyYykKIAkJcmV0dXJuIHJjOwogCi0JcmV0
dXJuIGdlbmVyaWNfZmlsZV9yZWFkX2l0ZXIoaW9jYiwgaXRlcik7CisJcmV0dXJuIG5ldGZzX2Zp
bGVfcmVhZF9pdGVyKGlvY2IsIGl0ZXIpOwogfQogCiBzc2l6ZV90IGNpZnNfZmlsZV93cml0ZV9p
dGVyKHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKQpAQCAtNDU5Miw3
ICs0NjE0LDcgQEAgc3NpemVfdCBjaWZzX2ZpbGVfd3JpdGVfaXRlcihzdHJ1Y3Qga2lvY2IgKmlv
Y2IsIHN0cnVjdCBpb3ZfaXRlciAqZnJvbSkKIAlpbnQgcmM7CiAKIAlpZiAoaW9jYi0+a2lfZmls
cC0+Zl9mbGFncyAmIE9fRElSRUNUKSB7Ci0JCXdyaXR0ZW4gPSBjaWZzX3VzZXJfd3JpdGV2KGlv
Y2IsIGZyb20pOworCQl3cml0dGVuID0gbmV0ZnNfdW5idWZmZXJlZF93cml0ZV9pdGVyKGlvY2Is
IGZyb20pOwogCQlpZiAod3JpdHRlbiA+IDAgJiYgQ0lGU19DQUNIRV9SRUFEKGNpbm9kZSkpIHsK
IAkJCWNpZnNfemFwX21hcHBpbmcoaW5vZGUpOwogCQkJY2lmc19kYmcoRllJLApAQCAtNDYwNywx
NyArNDYyOSwxNSBAQCBzc2l6ZV90IGNpZnNfZmlsZV93cml0ZV9pdGVyKHN0cnVjdCBraW9jYiAq
aW9jYiwgc3RydWN0IGlvdl9pdGVyICpmcm9tKQogCWlmICh3cml0dGVuKQogCQlyZXR1cm4gd3Jp
dHRlbjsKIAotCXdyaXR0ZW4gPSBnZW5lcmljX2ZpbGVfd3JpdGVfaXRlcihpb2NiLCBmcm9tKTsK
LQotCWlmIChDSUZTX0NBQ0hFX1dSSVRFKENJRlNfSShpbm9kZSkpKQotCQlnb3RvIG91dDsKKwl3
cml0dGVuID0gbmV0ZnNfZmlsZV93cml0ZV9pdGVyKGlvY2IsIGZyb20pOwogCi0JcmMgPSBmaWxl
bWFwX2ZkYXRhd3JpdGUoaW5vZGUtPmlfbWFwcGluZyk7Ci0JaWYgKHJjKQotCQljaWZzX2RiZyhG
WUksICIlczogJWQgcmMgb24gJXAgaW5vZGVcbiIsCi0JCQkgX19mdW5jX18sIHJjLCBpbm9kZSk7
CisJaWYgKCFDSUZTX0NBQ0hFX1dSSVRFKENJRlNfSShpbm9kZSkpKSB7CisJCXJjID0gZmlsZW1h
cF9mZGF0YXdyaXRlKGlub2RlLT5pX21hcHBpbmcpOworCQlpZiAocmMpCisJCQljaWZzX2RiZyhG
WUksICIlczogJWQgcmMgb24gJXAgaW5vZGVcbiIsCisJCQkJIF9fZnVuY19fLCByYywgaW5vZGUp
OworCX0KIAotb3V0OgogCWNpZnNfcHV0X3dyaXRlcihjaW5vZGUpOwogCXJldHVybiB3cml0dGVu
OwogfQpAQCAtNDY0MiwxMiArNDY2MiwxNSBAQCBjaWZzX3N0cmljdF9yZWFkdihzdHJ1Y3Qga2lv
Y2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqdG8pCiAJICogcG9zK2xlbi0xLgogCSAqLwogCWlm
ICghQ0lGU19DQUNIRV9SRUFEKGNpbm9kZSkpCi0JCXJldHVybiBjaWZzX3VzZXJfcmVhZHYoaW9j
YiwgdG8pOworCQlyZXR1cm4gbmV0ZnNfdW5idWZmZXJlZF9yZWFkX2l0ZXIoaW9jYiwgdG8pOwog
CiAJaWYgKGNhcF91bml4KHRjb24tPnNlcykgJiYKIAkgICAgKENJRlNfVU5JWF9GQ05UTF9DQVAg
JiBsZTY0X3RvX2NwdSh0Y29uLT5mc1VuaXhJbmZvLkNhcGFiaWxpdHkpKSAmJgotCSAgICAoKGNp
ZnNfc2ItPm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VOVF9OT1BPU0lYQlJMKSA9PSAwKSkKLQkJ
cmV0dXJuIGdlbmVyaWNfZmlsZV9yZWFkX2l0ZXIoaW9jYiwgdG8pOworCSAgICAoKGNpZnNfc2It
Pm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VOVF9OT1BPU0lYQlJMKSA9PSAwKSkgeworCQlpZiAo
aW9jYi0+a2lfZmxhZ3MgJiBJT0NCX0RJUkVDVCkKKwkJCXJldHVybiBuZXRmc191bmJ1ZmZlcmVk
X3JlYWRfaXRlcihpb2NiLCB0byk7CisJCXJldHVybiBuZXRmc19idWZmZXJlZF9yZWFkX2l0ZXIo
aW9jYiwgdG8pOworCX0KIAogCS8qCiAJICogV2UgbmVlZCB0byBob2xkIHRoZSBzZW0gdG8gYmUg
c3VyZSBub2JvZHkgbW9kaWZpZXMgbG9jayBsaXN0CkBAIC00NjU2LDEyICs0Njc5LDE3IEBAIGNp
ZnNfc3RyaWN0X3JlYWR2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICp0bykK
IAlkb3duX3JlYWQoJmNpbm9kZS0+bG9ja19zZW0pOwogCWlmICghY2lmc19maW5kX2xvY2tfY29u
ZmxpY3QoY2ZpbGUsIGlvY2ItPmtpX3BvcywgaW92X2l0ZXJfY291bnQodG8pLAogCQkJCSAgICAg
dGNvbi0+c2VzLT5zZXJ2ZXItPnZhbHMtPnNoYXJlZF9sb2NrX3R5cGUsCi0JCQkJICAgICAwLCBO
VUxMLCBDSUZTX1JFQURfT1ApKQotCQlyYyA9IGdlbmVyaWNfZmlsZV9yZWFkX2l0ZXIoaW9jYiwg
dG8pOworCQkJCSAgICAgMCwgTlVMTCwgQ0lGU19SRUFEX09QKSkgeworCQlpZiAoaW9jYi0+a2lf
ZmxhZ3MgJiBJT0NCX0RJUkVDVCkKKwkJCXJjID0gbmV0ZnNfdW5idWZmZXJlZF9yZWFkX2l0ZXIo
aW9jYiwgdG8pOworCQllbHNlCisJCQlyYyA9IG5ldGZzX2J1ZmZlcmVkX3JlYWRfaXRlcihpb2Ni
LCB0byk7CisJfQogCXVwX3JlYWQoJmNpbm9kZS0+bG9ja19zZW0pOwogCXJldHVybiByYzsKIH0K
IAorI2lmIDAgLy8gVE9ETyByZW1vdmUgNDYzMwogc3RhdGljIHNzaXplX3QKIGNpZnNfcmVhZChz
dHJ1Y3QgZmlsZSAqZmlsZSwgY2hhciAqcmVhZF9kYXRhLCBzaXplX3QgcmVhZF9zaXplLCBsb2Zm
X3QgKm9mZnNldCkKIHsKQEAgLTQ3NTMsMjkgKzQ3ODEsMTEgQEAgY2lmc19yZWFkKHN0cnVjdCBm
aWxlICpmaWxlLCBjaGFyICpyZWFkX2RhdGEsIHNpemVfdCByZWFkX3NpemUsIGxvZmZfdCAqb2Zm
c2V0KQogCWZyZWVfeGlkKHhpZCk7CiAJcmV0dXJuIHRvdGFsX3JlYWQ7CiB9CisjZW5kaWYgLy8g
ZW5kIG5ldGZzbGliIHJlbW92ZSA0NjMzCiAKLS8qCi0gKiBJZiB0aGUgcGFnZSBpcyBtbWFwJ2Vk
IGludG8gYSBwcm9jZXNzJyBwYWdlIHRhYmxlcywgdGhlbiB3ZSBuZWVkIHRvIG1ha2UKLSAqIHN1
cmUgdGhhdCBpdCBkb2Vzbid0IGNoYW5nZSB3aGlsZSBiZWluZyB3cml0dGVuIGJhY2suCi0gKi8K
IHN0YXRpYyB2bV9mYXVsdF90IGNpZnNfcGFnZV9ta3dyaXRlKHN0cnVjdCB2bV9mYXVsdCAqdm1m
KQogewotCXN0cnVjdCBmb2xpbyAqZm9saW8gPSBwYWdlX2ZvbGlvKHZtZi0+cGFnZSk7Ci0KLQkv
KiBXYWl0IGZvciB0aGUgZm9saW8gdG8gYmUgd3JpdHRlbiB0byB0aGUgY2FjaGUgYmVmb3JlIHdl
IGFsbG93IGl0IHRvCi0JICogYmUgbW9kaWZpZWQuICBXZSB0aGVuIGFzc3VtZSB0aGUgZW50aXJl
IGZvbGlvIHdpbGwgbmVlZCB3cml0aW5nIGJhY2suCi0JICovCi0jaWZkZWYgQ09ORklHX0NJRlNf
RlNDQUNIRQotCWlmIChmb2xpb190ZXN0X2ZzY2FjaGUoZm9saW8pICYmCi0JICAgIGZvbGlvX3dh
aXRfZnNjYWNoZV9raWxsYWJsZShmb2xpbykgPCAwKQotCQlyZXR1cm4gVk1fRkFVTFRfUkVUUlk7
Ci0jZW5kaWYKLQotCWZvbGlvX3dhaXRfd3JpdGViYWNrKGZvbGlvKTsKLQotCWlmIChmb2xpb19s
b2NrX2tpbGxhYmxlKGZvbGlvKSA8IDApCi0JCXJldHVybiBWTV9GQVVMVF9SRVRSWTsKLQlyZXR1
cm4gVk1fRkFVTFRfTE9DS0VEOworCXJldHVybiBuZXRmc19wYWdlX21rd3JpdGUodm1mLCBOVUxM
KTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBjaWZzX2Zp
bGVfdm1fb3BzID0gewpAQCAtNDgyMSw2ICs0ODMxLDcgQEAgaW50IGNpZnNfZmlsZV9tbWFwKHN0
cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKIAlyZXR1cm4gcmM7
CiB9CiAKKyNpZiAwIC8vIFRPRE8gcmVtb3ZlIDQ3OTQKIC8qCiAgKiBVbmxvY2sgYSBidW5jaCBv
ZiBmb2xpb3MgaW4gdGhlIHBhZ2VjYWNoZS4KICAqLwpAQCAtNTEwNSw2ICs1MTE2LDcgQEAgc3Rh
dGljIGludCBjaWZzX3JlYWRfZm9saW8oc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBmb2xpbyAq
Zm9saW8pCiAJZnJlZV94aWQoeGlkKTsKIAlyZXR1cm4gcmM7CiB9CisjZW5kaWYgLy8gZW5kIG5l
dGZzbGliIHJlbW92ZSA0Nzk0CiAKIHN0YXRpYyBpbnQgaXNfaW5vZGVfd3JpdGFibGUoc3RydWN0
IGNpZnNJbm9kZUluZm8gKmNpZnNfaW5vZGUpCiB7CkBAIC01MTUxLDYgKzUxNjMsNyBAQCBib29s
IGlzX3NpemVfc2FmZV90b19jaGFuZ2Uoc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNJbm9kZSwg
X191NjQgZW5kX29mX2ZpbGUpCiAJCXJldHVybiB0cnVlOwogfQogCisjaWYgMCAvLyBUT0RPIHJl
bW92ZSA1MTUyCiBzdGF0aWMgaW50IGNpZnNfd3JpdGVfYmVnaW4oc3RydWN0IGZpbGUgKmZpbGUs
IHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nLAogCQkJbG9mZl90IHBvcywgdW5zaWduZWQg
bGVuLAogCQkJc3RydWN0IHBhZ2UgKipwYWdlcCwgdm9pZCAqKmZzZGF0YSkKQEAgLTUyNjcsNiAr
NTI4MCw3IEBAIHN0YXRpYyBpbnQgY2lmc19sYXVuZGVyX2ZvbGlvKHN0cnVjdCBmb2xpbyAqZm9s
aW8pCiAJZm9saW9fd2FpdF9mc2NhY2hlKGZvbGlvKTsKIAlyZXR1cm4gcmM7CiB9CisjZW5kaWYg
Ly8gZW5kIG5ldGZzbGliIHJlbW92ZSA1MTUyCiAKIHZvaWQgY2lmc19vcGxvY2tfYnJlYWsoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewpAQCAtNTM1Nyw2ICs1MzcxLDcgQEAgdm9pZCBjaWZz
X29wbG9ja19icmVhayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJY2lmc19kb25lX29wbG9j
a19icmVhayhjaW5vZGUpOwogfQogCisjaWYgMCAvLyBUT0RPIHJlbW92ZSA1MzMzCiAvKgogICog
VGhlIHByZXNlbmNlIG9mIGNpZnNfZGlyZWN0X2lvKCkgaW4gdGhlIGFkZHJlc3Mgc3BhY2Ugb3Bz
IHZlY3RvcgogICogYWxsb3dlcyBvcGVuKCkgT19ESVJFQ1QgZmxhZ3Mgd2hpY2ggd291bGQgaGF2
ZSBmYWlsZWQgb3RoZXJ3aXNlLgpAQCAtNTM3NSw2ICs1MzkwLDcgQEAgY2lmc19kaXJlY3RfaW8o
c3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKml0ZXIpCiAgICAgICAgICAqLwog
ICAgICAgICByZXR1cm4gLUVJTlZBTDsKIH0KKyNlbmRpZiAvLyBuZXRmcyBlbmQgcmVtb3ZlIDUz
MzMKIAogc3RhdGljIGludCBjaWZzX3N3YXBfYWN0aXZhdGUoc3RydWN0IHN3YXBfaW5mb19zdHJ1
Y3QgKnNpcywKIAkJCSAgICAgIHN0cnVjdCBmaWxlICpzd2FwX2ZpbGUsIHNlY3Rvcl90ICpzcGFu
KQpAQCAtNTQzNywyMiArNTQ1MywyMCBAQCBzdGF0aWMgdm9pZCBjaWZzX3N3YXBfZGVhY3RpdmF0
ZShzdHJ1Y3QgZmlsZSAqZmlsZSkKIH0KIAogY29uc3Qgc3RydWN0IGFkZHJlc3Nfc3BhY2Vfb3Bl
cmF0aW9ucyBjaWZzX2FkZHJfb3BzID0gewotCS5yZWFkX2ZvbGlvID0gY2lmc19yZWFkX2ZvbGlv
LAotCS5yZWFkYWhlYWQgPSBjaWZzX3JlYWRhaGVhZCwKLQkud3JpdGVwYWdlcyA9IGNpZnNfd3Jp
dGVwYWdlcywKLQkud3JpdGVfYmVnaW4gPSBjaWZzX3dyaXRlX2JlZ2luLAotCS53cml0ZV9lbmQg
PSBjaWZzX3dyaXRlX2VuZCwKLQkuZGlydHlfZm9saW8gPSBuZXRmc19kaXJ0eV9mb2xpbywKLQku
cmVsZWFzZV9mb2xpbyA9IGNpZnNfcmVsZWFzZV9mb2xpbywKLQkuZGlyZWN0X0lPID0gY2lmc19k
aXJlY3RfaW8sCi0JLmludmFsaWRhdGVfZm9saW8gPSBjaWZzX2ludmFsaWRhdGVfZm9saW8sCi0J
LmxhdW5kZXJfZm9saW8gPSBjaWZzX2xhdW5kZXJfZm9saW8sCi0JLm1pZ3JhdGVfZm9saW8gPSBm
aWxlbWFwX21pZ3JhdGVfZm9saW8sCisJLnJlYWRfZm9saW8JPSBuZXRmc19yZWFkX2ZvbGlvLAor
CS5yZWFkYWhlYWQJPSBuZXRmc19yZWFkYWhlYWQsCisJLndyaXRlcGFnZXMJPSBuZXRmc193cml0
ZXBhZ2VzLAorCS5kaXJ0eV9mb2xpbwk9IG5ldGZzX2RpcnR5X2ZvbGlvLAorCS5yZWxlYXNlX2Zv
bGlvCT0gbmV0ZnNfcmVsZWFzZV9mb2xpbywKKwkuZGlyZWN0X0lPCT0gbm9vcF9kaXJlY3RfSU8s
CisJLmludmFsaWRhdGVfZm9saW8gPSBuZXRmc19pbnZhbGlkYXRlX2ZvbGlvLAorCS5sYXVuZGVy
X2ZvbGlvCT0gbmV0ZnNfbGF1bmRlcl9mb2xpbywKKwkubWlncmF0ZV9mb2xpbwk9IGZpbGVtYXBf
bWlncmF0ZV9mb2xpbywKIAkvKgogCSAqIFRPRE86IGludmVzdGlnYXRlIGFuZCBpZiB1c2VmdWwg
d2UgY291bGQgYWRkIGFuIGlzX2RpcnR5X3dyaXRlYmFjawogCSAqIGhlbHBlciBpZiBuZWVkZWQK
IAkgKi8KLQkuc3dhcF9hY3RpdmF0ZSA9IGNpZnNfc3dhcF9hY3RpdmF0ZSwKKwkuc3dhcF9hY3Rp
dmF0ZQk9IGNpZnNfc3dhcF9hY3RpdmF0ZSwKIAkuc3dhcF9kZWFjdGl2YXRlID0gY2lmc19zd2Fw
X2RlYWN0aXZhdGUsCiB9OwogCkBAIC01NDYyLDEzICs1NDc2LDExIEBAIGNvbnN0IHN0cnVjdCBh
ZGRyZXNzX3NwYWNlX29wZXJhdGlvbnMgY2lmc19hZGRyX29wcyA9IHsKICAqIHRvIGxlYXZlIGNp
ZnNfcmVhZGFoZWFkIG91dCBvZiB0aGUgYWRkcmVzcyBzcGFjZSBvcGVyYXRpb25zLgogICovCiBj
b25zdCBzdHJ1Y3QgYWRkcmVzc19zcGFjZV9vcGVyYXRpb25zIGNpZnNfYWRkcl9vcHNfc21hbGxi
dWYgPSB7Ci0JLnJlYWRfZm9saW8gPSBjaWZzX3JlYWRfZm9saW8sCi0JLndyaXRlcGFnZXMgPSBj
aWZzX3dyaXRlcGFnZXMsCi0JLndyaXRlX2JlZ2luID0gY2lmc193cml0ZV9iZWdpbiwKLQkud3Jp
dGVfZW5kID0gY2lmc193cml0ZV9lbmQsCi0JLmRpcnR5X2ZvbGlvID0gbmV0ZnNfZGlydHlfZm9s
aW8sCi0JLnJlbGVhc2VfZm9saW8gPSBjaWZzX3JlbGVhc2VfZm9saW8sCi0JLmludmFsaWRhdGVf
Zm9saW8gPSBjaWZzX2ludmFsaWRhdGVfZm9saW8sCi0JLmxhdW5kZXJfZm9saW8gPSBjaWZzX2xh
dW5kZXJfZm9saW8sCi0JLm1pZ3JhdGVfZm9saW8gPSBmaWxlbWFwX21pZ3JhdGVfZm9saW8sCisJ
LnJlYWRfZm9saW8JPSBuZXRmc19yZWFkX2ZvbGlvLAorCS53cml0ZXBhZ2VzCT0gbmV0ZnNfd3Jp
dGVwYWdlcywKKwkuZGlydHlfZm9saW8JPSBuZXRmc19kaXJ0eV9mb2xpbywKKwkucmVsZWFzZV9m
b2xpbwk9IG5ldGZzX3JlbGVhc2VfZm9saW8sCisJLmludmFsaWRhdGVfZm9saW8gPSBuZXRmc19p
bnZhbGlkYXRlX2ZvbGlvLAorCS5sYXVuZGVyX2ZvbGlvCT0gbmV0ZnNfbGF1bmRlcl9mb2xpbywK
KwkubWlncmF0ZV9mb2xpbwk9IGZpbGVtYXBfbWlncmF0ZV9mb2xpbywKIH07CmRpZmYgLS1naXQg
YS9mcy9zbWIvY2xpZW50L2ZzY2FjaGUuYyBiL2ZzL3NtYi9jbGllbnQvZnNjYWNoZS5jCmluZGV4
IGM0YTNjYjczNjg4MS4uMjI4ZmU1N2JiZGUzIDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2Zz
Y2FjaGUuYworKysgYi9mcy9zbWIvY2xpZW50L2ZzY2FjaGUuYwpAQCAtMTM3LDYgKzEzNyw3IEBA
IHZvaWQgY2lmc19mc2NhY2hlX3JlbGVhc2VfaW5vZGVfY29va2llKHN0cnVjdCBpbm9kZSAqaW5v
ZGUpCiAJfQogfQogCisjaWYgMCAvLyBUT0RPIHJlbW92ZQogLyoKICAqIEZhbGxiYWNrIHBhZ2Ug
cmVhZGluZyBpbnRlcmZhY2UuCiAgKi8KQEAgLTI0NSwzICsyNDYsNCBAQCBpbnQgX19jaWZzX2Zz
Y2FjaGVfcXVlcnlfb2NjdXBhbmN5KHN0cnVjdCBpbm9kZSAqaW5vZGUsCiAJZnNjYWNoZV9lbmRf
b3BlcmF0aW9uKCZjcmVzKTsKIAlyZXR1cm4gcmV0OwogfQorI2VuZGlmCmRpZmYgLS1naXQgYS9m
cy9zbWIvY2xpZW50L2ZzY2FjaGUuaCBiL2ZzL3NtYi9jbGllbnQvZnNjYWNoZS5oCmluZGV4IGEz
ZDczNzIwOTE0Zi4uYzJjMDVhNzc4YTcxIDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2ZzY2Fj
aGUuaAorKysgYi9mcy9zbWIvY2xpZW50L2ZzY2FjaGUuaApAQCAtNzQsNiArNzQsNyBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgY2lmc19pbnZhbGlkYXRlX2NhY2hlKHN0cnVjdCBpbm9kZSAqaW5vZGUs
IHVuc2lnbmVkIGludCBmbGFncwogCQkJICAgaV9zaXplX3JlYWQoaW5vZGUpLCBmbGFncyk7CiB9
CiAKKyNpZiAwIC8vIFRPRE8gcmVtb3ZlCiBleHRlcm4gaW50IF9fY2lmc19mc2NhY2hlX3F1ZXJ5
X29jY3VwYW5jeShzdHJ1Y3QgaW5vZGUgKmlub2RlLAogCQkJCQkgIHBnb2ZmX3QgZmlyc3QsIHVu
c2lnbmVkIGludCBucl9wYWdlcywKIAkJCQkJICBwZ29mZl90ICpfZGF0YV9maXJzdCwKQEAgLTEw
OCw2ICsxMDksNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgY2lmc19yZWFkYWhlYWRfdG9fZnNjYWNo
ZShzdHJ1Y3QgaW5vZGUgKmlub2RlLAogCWlmIChjaWZzX2lub2RlX2Nvb2tpZShpbm9kZSkpCiAJ
CV9fY2lmc19yZWFkYWhlYWRfdG9fZnNjYWNoZShpbm9kZSwgcG9zLCBsZW4pOwogfQorI2VuZGlm
CiAKICNlbHNlIC8qIENPTkZJR19DSUZTX0ZTQ0FDSEUgKi8KIHN0YXRpYyBpbmxpbmUKQEAgLTEy
NSw2ICsxMjcsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgY2lmc19mc2NhY2hlX3VudXNlX2lub2Rl
X2Nvb2tpZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBib29sIHVwZAogc3RhdGljIGlubGluZSBzdHJ1
Y3QgZnNjYWNoZV9jb29raWUgKmNpZnNfaW5vZGVfY29va2llKHN0cnVjdCBpbm9kZSAqaW5vZGUp
IHsgcmV0dXJuIE5VTEw7IH0KIHN0YXRpYyBpbmxpbmUgdm9pZCBjaWZzX2ludmFsaWRhdGVfY2Fj
aGUoc3RydWN0IGlub2RlICppbm9kZSwgdW5zaWduZWQgaW50IGZsYWdzKSB7fQogCisjaWYgMCAv
LyBUT0RPIHJlbW92ZQogc3RhdGljIGlubGluZSBpbnQgY2lmc19mc2NhY2hlX3F1ZXJ5X29jY3Vw
YW5jeShzdHJ1Y3QgaW5vZGUgKmlub2RlLAogCQkJCQkgICAgICAgcGdvZmZfdCBmaXJzdCwgdW5z
aWduZWQgaW50IG5yX3BhZ2VzLAogCQkJCQkgICAgICAgcGdvZmZfdCAqX2RhdGFfZmlyc3QsCkBA
IC0xNDMsNiArMTQ2LDcgQEAgY2lmc19yZWFkcGFnZV9mcm9tX2ZzY2FjaGUoc3RydWN0IGlub2Rl
ICppbm9kZSwgc3RydWN0IHBhZ2UgKnBhZ2UpCiAKIHN0YXRpYyBpbmxpbmUKIHZvaWQgY2lmc19y
ZWFkYWhlYWRfdG9fZnNjYWNoZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBsb2ZmX3QgcG9zLCBzaXpl
X3QgbGVuKSB7fQorI2VuZGlmCiAKICNlbmRpZiAvKiBDT05GSUdfQ0lGU19GU0NBQ0hFICovCiAK
ZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvaW5vZGUuYyBiL2ZzL3NtYi9jbGllbnQvaW5vZGUu
YwppbmRleCBkMDJmOGJhMjljYjUuLjY2NmE1MjZmZDkxYSAxMDA2NDQKLS0tIGEvZnMvc21iL2Ns
aWVudC9pbm9kZS5jCisrKyBiL2ZzL3NtYi9jbGllbnQvaW5vZGUuYwpAQCAtMjcsMTQgKzI3LDI5
IEBACiAjaW5jbHVkZSAiY2lmc19pb2N0bC5oIgogI2luY2x1ZGUgImNhY2hlZF9kaXIuaCIKIAor
LyoKKyAqIFNldCBwYXJhbWV0ZXJzIGZvciB0aGUgbmV0ZnMgbGlicmFyeQorICovCitzdGF0aWMg
dm9pZCBjaWZzX3NldF9uZXRmc19jb250ZXh0KHN0cnVjdCBpbm9kZSAqaW5vZGUpCit7CisJc3Ry
dWN0IGNpZnNJbm9kZUluZm8gKmNpZnNfaSA9IENJRlNfSShpbm9kZSk7CisJc3RydWN0IGNpZnNf
c2JfaW5mbyAqY2lmc19zYiA9IENJRlNfU0IoaW5vZGUtPmlfc2IpOworCisJbmV0ZnNfaW5vZGVf
aW5pdCgmY2lmc19pLT5uZXRmcywgJmNpZnNfcmVxX29wcywgdHJ1ZSk7CisJaWYgKGNpZnNfc2It
Pm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VOVF9TVFJJQ1RfSU8pCisJCV9fc2V0X2JpdChORVRG
U19JQ1RYX1dSSVRFVEhST1VHSCwgJmNpZnNfaS0+bmV0ZnMuZmxhZ3MpOworfQorCiBzdGF0aWMg
dm9pZCBjaWZzX3NldF9vcHMoc3RydWN0IGlub2RlICppbm9kZSkKIHsKIAlzdHJ1Y3QgY2lmc19z
Yl9pbmZvICpjaWZzX3NiID0gQ0lGU19TQihpbm9kZS0+aV9zYik7CisJc3RydWN0IG5ldGZzX2lu
b2RlICppY3R4ID0gbmV0ZnNfaW5vZGUoaW5vZGUpOwogCiAJc3dpdGNoIChpbm9kZS0+aV9tb2Rl
ICYgU19JRk1UKSB7CiAJY2FzZSBTX0lGUkVHOgogCQlpbm9kZS0+aV9vcCA9ICZjaWZzX2ZpbGVf
aW5vZGVfb3BzOwogCQlpZiAoY2lmc19zYi0+bW50X2NpZnNfZmxhZ3MgJiBDSUZTX01PVU5UX0RJ
UkVDVF9JTykgeworCQkJc2V0X2JpdChORVRGU19JQ1RYX1VOQlVGRkVSRUQsICZpY3R4LT5mbGFn
cyk7CiAJCQlpZiAoY2lmc19zYi0+bW50X2NpZnNfZmxhZ3MgJiBDSUZTX01PVU5UX05PX0JSTCkK
IAkJCQlpbm9kZS0+aV9mb3AgPSAmY2lmc19maWxlX2RpcmVjdF9ub2JybF9vcHM7CiAJCQllbHNl
CkBAIC0yMTksOCArMjM0LDEwIEBAIGNpZnNfZmF0dHJfdG9faW5vZGUoc3RydWN0IGlub2RlICpp
bm9kZSwgc3RydWN0IGNpZnNfZmF0dHIgKmZhdHRyKQogCiAJaWYgKGZhdHRyLT5jZl9mbGFncyAm
IENJRlNfRkFUVFJfSlVOQ1RJT04pCiAJCWlub2RlLT5pX2ZsYWdzIHw9IFNfQVVUT01PVU5UOwot
CWlmIChpbm9kZS0+aV9zdGF0ZSAmIElfTkVXKQorCWlmIChpbm9kZS0+aV9zdGF0ZSAmIElfTkVX
KSB7CisJCWNpZnNfc2V0X25ldGZzX2NvbnRleHQoaW5vZGUpOwogCQljaWZzX3NldF9vcHMoaW5v
ZGUpOworCX0KIAlyZXR1cm4gMDsKIH0KIApkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9zbWIy
cGR1LmMgYi9mcy9zbWIvY2xpZW50L3NtYjJwZHUuYwppbmRleCBhOTdkOGY3ODllOTAuLjgyMjFj
MzM1M2MyZCAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9zbWIycGR1LmMKKysrIGIvZnMvc21i
L2NsaWVudC9zbWIycGR1LmMKQEAgLTQyNTgsMTAgKzQyNTgsMTIgQEAgc21iMl9uZXdfcmVhZF9y
ZXEodm9pZCAqKmJ1ZiwgdW5zaWduZWQgaW50ICp0b3RhbF9sZW4sCiAJcmVxLT5MZW5ndGggPSBj
cHVfdG9fbGUzMihpb19wYXJtcy0+bGVuZ3RoKTsKIAlyZXEtPk9mZnNldCA9IGNwdV90b19sZTY0
KGlvX3Bhcm1zLT5vZmZzZXQpOwogCi0JdHJhY2Vfc21iM19yZWFkX2VudGVyKDAgLyogeGlkICov
LAotCQkJaW9fcGFybXMtPnBlcnNpc3RlbnRfZmlkLAotCQkJaW9fcGFybXMtPnRjb24tPnRpZCwg
aW9fcGFybXMtPnRjb24tPnNlcy0+U3VpZCwKLQkJCWlvX3Bhcm1zLT5vZmZzZXQsIGlvX3Bhcm1z
LT5sZW5ndGgpOworCXRyYWNlX3NtYjNfcmVhZF9lbnRlcihyZGF0YSA/IHJkYXRhLT5ycmVxLT5k
ZWJ1Z19pZCA6IDAsCisJCQkgICAgICByZGF0YSA/IHJkYXRhLT5zdWJyZXEuZGVidWdfaW5kZXgg
OiAwLAorCQkJICAgICAgcmRhdGEgPyByZGF0YS0+eGlkIDogMCwKKwkJCSAgICAgIGlvX3Bhcm1z
LT5wZXJzaXN0ZW50X2ZpZCwKKwkJCSAgICAgIGlvX3Bhcm1zLT50Y29uLT50aWQsIGlvX3Bhcm1z
LT50Y29uLT5zZXMtPlN1aWQsCisJCQkgICAgICBpb19wYXJtcy0+b2Zmc2V0LCBpb19wYXJtcy0+
bGVuZ3RoKTsKICNpZmRlZiBDT05GSUdfQ0lGU19TTUJfRElSRUNUCiAJLyoKIAkgKiBJZiB3ZSB3
YW50IHRvIGRvIGEgUkRNQSB3cml0ZSwgZmlsbCBpbiBhbmQgYXBwZW5kCkBAIC00MzIzLDcgKzQz
MjUsNyBAQCBzdGF0aWMgdm9pZAogc21iMl9yZWFkdl9jYWxsYmFjayhzdHJ1Y3QgbWlkX3FfZW50
cnkgKm1pZCkKIHsKIAlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSA9IG1pZC0+Y2Fs
bGJhY2tfZGF0YTsKLQlzdHJ1Y3QgY2lmc190Y29uICp0Y29uID0gdGxpbmtfdGNvbihyZGF0YS0+
Y2ZpbGUtPnRsaW5rKTsKKwlzdHJ1Y3QgY2lmc190Y29uICp0Y29uID0gdGxpbmtfdGNvbihyZGF0
YS0+cmVxLT5jZmlsZS0+dGxpbmspOwogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9
IHJkYXRhLT5zZXJ2ZXI7CiAJc3RydWN0IHNtYjJfaGRyICpzaGRyID0KIAkJCQkoc3RydWN0IHNt
YjJfaGRyICopcmRhdGEtPmlvdlswXS5pb3ZfYmFzZTsKQEAgLTQzOTIsMTcgKzQzOTQsMzMgQEAg
c21iMl9yZWFkdl9jYWxsYmFjayhzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCkKICNlbmRpZgogCWlm
IChyZGF0YS0+cmVzdWx0ICYmIHJkYXRhLT5yZXN1bHQgIT0gLUVOT0RBVEEpIHsKIAkJY2lmc19z
dGF0c19mYWlsX2luYyh0Y29uLCBTTUIyX1JFQURfSEUpOwotCQl0cmFjZV9zbWIzX3JlYWRfZXJy
KDAgLyogeGlkICovLAotCQkJCSAgICByZGF0YS0+Y2ZpbGUtPmZpZC5wZXJzaXN0ZW50X2ZpZCwK
KwkJdHJhY2Vfc21iM19yZWFkX2VycihyZGF0YS0+cnJlcS0+ZGVidWdfaWQsCisJCQkJICAgIHJk
YXRhLT5zdWJyZXEuZGVidWdfaW5kZXgsCisJCQkJICAgIHJkYXRhLT54aWQsCisJCQkJICAgIHJk
YXRhLT5yZXEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQsCiAJCQkJICAgIHRjb24tPnRpZCwg
dGNvbi0+c2VzLT5TdWlkLCByZGF0YS0+c3VicmVxLnN0YXJ0LAogCQkJCSAgICByZGF0YS0+c3Vi
cmVxLmxlbiwgcmRhdGEtPnJlc3VsdCk7CiAJfSBlbHNlCi0JCXRyYWNlX3NtYjNfcmVhZF9kb25l
KDAgLyogeGlkICovLAotCQkJCSAgICAgcmRhdGEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQs
CisJCXRyYWNlX3NtYjNfcmVhZF9kb25lKHJkYXRhLT5ycmVxLT5kZWJ1Z19pZCwKKwkJCQkgICAg
IHJkYXRhLT5zdWJyZXEuZGVidWdfaW5kZXgsCisJCQkJICAgICByZGF0YS0+eGlkLAorCQkJCSAg
ICAgcmRhdGEtPnJlcS0+Y2ZpbGUtPmZpZC5wZXJzaXN0ZW50X2ZpZCwKIAkJCQkgICAgIHRjb24t
PnRpZCwgdGNvbi0+c2VzLT5TdWlkLAogCQkJCSAgICAgcmRhdGEtPnN1YnJlcS5zdGFydCwgcmRh
dGEtPmdvdF9ieXRlcyk7CiAKLQlxdWV1ZV93b3JrKGNpZnNpb2Rfd3EsICZyZGF0YS0+d29yayk7
CisJaWYgKHJkYXRhLT5yZXN1bHQgPT0gLUVOT0RBVEEpIHsKKwkJLyogV2UgbWF5IGhhdmUgZ290
IGFuIEVPRiBlcnJvciBiZWNhdXNlIGZhbGxvY2F0ZQorCQkgKiBmYWlsZWQgdG8gZW5sYXJnZSB0
aGUgZmlsZS4KKwkJICovCisJCWlmIChyZGF0YS0+c3VicmVxLnN0YXJ0IDwgcmRhdGEtPnN1YnJl
cS5ycmVxLT5pX3NpemUpCisJCQlyZGF0YS0+cmVzdWx0ID0gMDsKKwl9CisJaWYgKHJkYXRhLT5y
ZXN1bHQgPT0gMCB8fCByZGF0YS0+cmVzdWx0ID09IC1FQUdBSU4pCisJCWlvdl9pdGVyX2FkdmFu
Y2UoJnJkYXRhLT5zdWJyZXEuaW9faXRlciwgcmRhdGEtPmdvdF9ieXRlcyk7CisJcmRhdGEtPmhh
dmVfY3JlZGl0cyA9IGZhbHNlOworCW5ldGZzX3N1YnJlcV90ZXJtaW5hdGVkKCZyZGF0YS0+c3Vi
cmVxLAorCQkJCShyZGF0YS0+cmVzdWx0ID09IDAgfHwgcmRhdGEtPnJlc3VsdCA9PSAtRUFHQUlO
KSA/CisJCQkJcmRhdGEtPmdvdF9ieXRlcyA6IHJkYXRhLT5yZXN1bHQsIHRydWUpOwogCXJlbGVh
c2VfbWlkKG1pZCk7CiAJYWRkX2NyZWRpdHMoc2VydmVyLCAmY3JlZGl0cywgMCk7CiB9CkBAIC00
NDE4LDcgKzQ0MzYsNyBAQCBzbWIyX2FzeW5jX3JlYWR2KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVl
c3QgKnJkYXRhKQogCXN0cnVjdCBzbWJfcnFzdCBycXN0ID0geyAucnFfaW92ID0gcmRhdGEtPmlv
diwKIAkJCQkgLnJxX252ZWMgPSAxIH07CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVy
OwotCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHJkYXRhLT5jZmlsZS0+dGxp
bmspOworCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHJkYXRhLT5yZXEtPmNm
aWxlLT50bGluayk7CiAJdW5zaWduZWQgaW50IHRvdGFsX2xlbjsKIAlpbnQgY3JlZGl0X3JlcXVl
c3Q7CiAKQEAgLTQ0MjgsMTIgKzQ0NDYsMTIgQEAgc21iMl9hc3luY19yZWFkdihzdHJ1Y3QgY2lm
c19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKIAlpZiAoIXJkYXRhLT5zZXJ2ZXIpCiAJCXJkYXRhLT5z
ZXJ2ZXIgPSBjaWZzX3BpY2tfY2hhbm5lbCh0Y29uLT5zZXMpOwogCi0JaW9fcGFybXMudGNvbiA9
IHRsaW5rX3Rjb24ocmRhdGEtPmNmaWxlLT50bGluayk7CisJaW9fcGFybXMudGNvbiA9IHRsaW5r
X3Rjb24ocmRhdGEtPnJlcS0+Y2ZpbGUtPnRsaW5rKTsKIAlpb19wYXJtcy5zZXJ2ZXIgPSBzZXJ2
ZXIgPSByZGF0YS0+c2VydmVyOwogCWlvX3Bhcm1zLm9mZnNldCA9IHJkYXRhLT5zdWJyZXEuc3Rh
cnQ7CiAJaW9fcGFybXMubGVuZ3RoID0gcmRhdGEtPnN1YnJlcS5sZW47Ci0JaW9fcGFybXMucGVy
c2lzdGVudF9maWQgPSByZGF0YS0+Y2ZpbGUtPmZpZC5wZXJzaXN0ZW50X2ZpZDsKLQlpb19wYXJt
cy52b2xhdGlsZV9maWQgPSByZGF0YS0+Y2ZpbGUtPmZpZC52b2xhdGlsZV9maWQ7CisJaW9fcGFy
bXMucGVyc2lzdGVudF9maWQgPSByZGF0YS0+cmVxLT5jZmlsZS0+ZmlkLnBlcnNpc3RlbnRfZmlk
OworCWlvX3Bhcm1zLnZvbGF0aWxlX2ZpZCA9IHJkYXRhLT5yZXEtPmNmaWxlLT5maWQudm9sYXRp
bGVfZmlkOwogCWlvX3Bhcm1zLnBpZCA9IHJkYXRhLT5waWQ7CiAKIAlyYyA9IHNtYjJfbmV3X3Jl
YWRfcmVxKApAQCAtNDQ2NywxNSArNDQ4NSwxNSBAQCBzbWIyX2FzeW5jX3JlYWR2KHN0cnVjdCBj
aWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKQogCQlmbGFncyB8PSBDSUZTX0hBU19DUkVESVRTOwog
CX0KIAotCWNpZnNfZ2V0X3JlYWRkYXRhKHJkYXRhKTsKIAlyYyA9IGNpZnNfY2FsbF9hc3luYyhz
ZXJ2ZXIsICZycXN0LAogCQkJICAgICBjaWZzX3JlYWR2X3JlY2VpdmUsIHNtYjJfcmVhZHZfY2Fs
bGJhY2ssCiAJCQkgICAgIHNtYjNfaGFuZGxlX3JlYWRfZGF0YSwgcmRhdGEsIGZsYWdzLAogCQkJ
ICAgICAmcmRhdGEtPmNyZWRpdHMpOwogCWlmIChyYykgewotCQljaWZzX3B1dF9yZWFkZGF0YShy
ZGF0YSk7CiAJCWNpZnNfc3RhdHNfZmFpbF9pbmMoaW9fcGFybXMudGNvbiwgU01CMl9SRUFEX0hF
KTsKLQkJdHJhY2Vfc21iM19yZWFkX2VycigwIC8qIHhpZCAqLywgaW9fcGFybXMucGVyc2lzdGVu
dF9maWQsCisJCXRyYWNlX3NtYjNfcmVhZF9lcnIocmRhdGEtPnJyZXEtPmRlYnVnX2lkLAorCQkJ
CSAgICByZGF0YS0+c3VicmVxLmRlYnVnX2luZGV4LAorCQkJCSAgICByZGF0YS0+eGlkLCBpb19w
YXJtcy5wZXJzaXN0ZW50X2ZpZCwKIAkJCQkgICAgaW9fcGFybXMudGNvbi0+dGlkLAogCQkJCSAg
ICBpb19wYXJtcy50Y29uLT5zZXMtPlN1aWQsCiAJCQkJICAgIGlvX3Bhcm1zLm9mZnNldCwgaW9f
cGFybXMubGVuZ3RoLCByYyk7CkBAIC00NTI2LDIyICs0NTQ0LDIzIEBAIFNNQjJfcmVhZChjb25z
dCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3QgY2lmc19pb19wYXJtcyAqaW9fcGFybXMsCiAJCWlm
IChyYyAhPSAtRU5PREFUQSkgewogCQkJY2lmc19zdGF0c19mYWlsX2luYyhpb19wYXJtcy0+dGNv
biwgU01CMl9SRUFEX0hFKTsKIAkJCWNpZnNfZGJnKFZGUywgIlNlbmQgZXJyb3IgaW4gcmVhZCA9
ICVkXG4iLCByYyk7Ci0JCQl0cmFjZV9zbWIzX3JlYWRfZXJyKHhpZCwKKwkJCXRyYWNlX3NtYjNf
cmVhZF9lcnIoMCwgMCwgeGlkLAogCQkJCQkgICAgcmVxLT5QZXJzaXN0ZW50RmlsZUlkLAogCQkJ
CQkgICAgaW9fcGFybXMtPnRjb24tPnRpZCwgc2VzLT5TdWlkLAogCQkJCQkgICAgaW9fcGFybXMt
Pm9mZnNldCwgaW9fcGFybXMtPmxlbmd0aCwKIAkJCQkJICAgIHJjKTsKIAkJfSBlbHNlCi0JCQl0
cmFjZV9zbWIzX3JlYWRfZG9uZSh4aWQsIHJlcS0+UGVyc2lzdGVudEZpbGVJZCwgaW9fcGFybXMt
PnRjb24tPnRpZCwKKwkJCXRyYWNlX3NtYjNfcmVhZF9kb25lKDAsIDAsIHhpZCwKKwkJCQkJICAg
ICByZXEtPlBlcnNpc3RlbnRGaWxlSWQsIGlvX3Bhcm1zLT50Y29uLT50aWQsCiAJCQkJCSAgICAg
c2VzLT5TdWlkLCBpb19wYXJtcy0+b2Zmc2V0LCAwKTsKIAkJZnJlZV9yc3BfYnVmKHJlc3BfYnVm
dHlwZSwgcnNwX2lvdi5pb3ZfYmFzZSk7CiAJCWNpZnNfc21hbGxfYnVmX3JlbGVhc2UocmVxKTsK
IAkJcmV0dXJuIHJjID09IC1FTk9EQVRBID8gMCA6IHJjOwogCX0gZWxzZQotCQl0cmFjZV9zbWIz
X3JlYWRfZG9uZSh4aWQsCi0JCQkJICAgIHJlcS0+UGVyc2lzdGVudEZpbGVJZCwKLQkJCQkgICAg
aW9fcGFybXMtPnRjb24tPnRpZCwgc2VzLT5TdWlkLAotCQkJCSAgICBpb19wYXJtcy0+b2Zmc2V0
LCBpb19wYXJtcy0+bGVuZ3RoKTsKKwkJdHJhY2Vfc21iM19yZWFkX2RvbmUoMCwgMCwgeGlkLAor
CQkJCSAgICAgcmVxLT5QZXJzaXN0ZW50RmlsZUlkLAorCQkJCSAgICAgaW9fcGFybXMtPnRjb24t
PnRpZCwgc2VzLT5TdWlkLAorCQkJCSAgICAgaW9fcGFybXMtPm9mZnNldCwgaW9fcGFybXMtPmxl
bmd0aCk7CiAKIAljaWZzX3NtYWxsX2J1Zl9yZWxlYXNlKHJlcSk7CiAKQEAgLTQ1NzUsMTEgKzQ1
OTQsMTIgQEAgc3RhdGljIHZvaWQKIHNtYjJfd3JpdGV2X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9l
bnRyeSAqbWlkKQogewogCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhID0gbWlkLT5j
YWxsYmFja19kYXRhOwotCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHdkYXRh
LT5jZmlsZS0+dGxpbmspOworCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHdk
YXRhLT5yZXEtPmNmaWxlLT50bGluayk7CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVy
ID0gd2RhdGEtPnNlcnZlcjsKLQl1bnNpZ25lZCBpbnQgd3JpdHRlbjsKIAlzdHJ1Y3Qgc21iMl93
cml0ZV9yc3AgKnJzcCA9IChzdHJ1Y3Qgc21iMl93cml0ZV9yc3AgKiltaWQtPnJlc3BfYnVmOwog
CXN0cnVjdCBjaWZzX2NyZWRpdHMgY3JlZGl0cyA9IHsgLnZhbHVlID0gMCwgLmluc3RhbmNlID0g
MCB9OworCXNzaXplX3QgcmVzdWx0ID0gMDsKKwlzaXplX3Qgd3JpdHRlbjsKIAogCVdBUk5fT05D
RSh3ZGF0YS0+c2VydmVyICE9IG1pZC0+c2VydmVyLAogCQkgICJ3ZGF0YSBzZXJ2ZXIgJXAgIT0g
bWlkIHNlcnZlciAlcCIsCkBAIC00NTg5LDggKzQ2MDksOCBAQCBzbWIyX3dyaXRldl9jYWxsYmFj
ayhzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCkKIAljYXNlIE1JRF9SRVNQT05TRV9SRUNFSVZFRDoK
IAkJY3JlZGl0cy52YWx1ZSA9IGxlMTZfdG9fY3B1KHJzcC0+aGRyLkNyZWRpdFJlcXVlc3QpOwog
CQljcmVkaXRzLmluc3RhbmNlID0gc2VydmVyLT5yZWNvbm5lY3RfaW5zdGFuY2U7Ci0JCXdkYXRh
LT5yZXN1bHQgPSBzbWIyX2NoZWNrX3JlY2VpdmUobWlkLCBzZXJ2ZXIsIDApOwotCQlpZiAod2Rh
dGEtPnJlc3VsdCAhPSAwKQorCQlyZXN1bHQgPSBzbWIyX2NoZWNrX3JlY2VpdmUobWlkLCBzZXJ2
ZXIsIDApOworCQlpZiAocmVzdWx0ICE9IDApCiAJCQlicmVhazsKIAogCQl3cml0dGVuID0gbGUz
Ml90b19jcHUocnNwLT5EYXRhTGVuZ3RoKTsKQEAgLTQ2MDcsMTcgKzQ2MjcsMTggQEAgc21iMl93
cml0ZXZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiAJCQl3ZGF0YS0+cmVzdWx0
ID0gLUVOT1NQQzsKIAkJZWxzZQogCQkJd2RhdGEtPnN1YnJlcS5sZW4gPSB3cml0dGVuOworCQlp
b3ZfaXRlcl9hZHZhbmNlKCZ3ZGF0YS0+c3VicmVxLmlvX2l0ZXIsIHdyaXR0ZW4pOwogCQlicmVh
azsKIAljYXNlIE1JRF9SRVFVRVNUX1NVQk1JVFRFRDoKIAljYXNlIE1JRF9SRVRSWV9ORUVERUQ6
Ci0JCXdkYXRhLT5yZXN1bHQgPSAtRUFHQUlOOworCQlyZXN1bHQgPSAtRUFHQUlOOwogCQlicmVh
azsKIAljYXNlIE1JRF9SRVNQT05TRV9NQUxGT1JNRUQ6CiAJCWNyZWRpdHMudmFsdWUgPSBsZTE2
X3RvX2NwdShyc3AtPmhkci5DcmVkaXRSZXF1ZXN0KTsKIAkJY3JlZGl0cy5pbnN0YW5jZSA9IHNl
cnZlci0+cmVjb25uZWN0X2luc3RhbmNlOwogCQlmYWxsdGhyb3VnaDsKIAlkZWZhdWx0OgotCQl3
ZGF0YS0+cmVzdWx0ID0gLUVJTzsKKwkJcmVzdWx0ID0gLUVJTzsKIAkJYnJlYWs7CiAJfQogI2lm
ZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QKQEAgLTQ2MzMsMTAgKzQ2NTQsMTAgQEAgc21iMl93
cml0ZXZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiAJCXdkYXRhLT5tciA9IE5V
TEw7CiAJfQogI2VuZGlmCi0JaWYgKHdkYXRhLT5yZXN1bHQpIHsKKwlpZiAocmVzdWx0KSB7CiAJ
CWNpZnNfc3RhdHNfZmFpbF9pbmModGNvbiwgU01CMl9XUklURV9IRSk7CiAJCXRyYWNlX3NtYjNf
d3JpdGVfZXJyKDAgLyogbm8geGlkICovLAotCQkJCSAgICAgd2RhdGEtPmNmaWxlLT5maWQucGVy
c2lzdGVudF9maWQsCisJCQkJICAgICB3ZGF0YS0+cmVxLT5jZmlsZS0+ZmlkLnBlcnNpc3RlbnRf
ZmlkLAogCQkJCSAgICAgdGNvbi0+dGlkLCB0Y29uLT5zZXMtPlN1aWQsIHdkYXRhLT5zdWJyZXEu
c3RhcnQsCiAJCQkJICAgICB3ZGF0YS0+c3VicmVxLmxlbiwgd2RhdGEtPnJlc3VsdCk7CiAJCWlm
ICh3ZGF0YS0+cmVzdWx0ID09IC1FTk9TUEMpCkBAIC00NjQ0LDExICs0NjY1LDExIEBAIHNtYjJf
d3JpdGV2X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCQkJCSAgICAgdGNvbi0+
dHJlZV9uYW1lKTsKIAl9IGVsc2UKIAkJdHJhY2Vfc21iM193cml0ZV9kb25lKDAgLyogbm8geGlk
ICovLAotCQkJCSAgICAgIHdkYXRhLT5jZmlsZS0+ZmlkLnBlcnNpc3RlbnRfZmlkLAorCQkJCSAg
ICAgIHdkYXRhLT5yZXEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQsCiAJCQkJICAgICAgdGNv
bi0+dGlkLCB0Y29uLT5zZXMtPlN1aWQsCiAJCQkJICAgICAgd2RhdGEtPnN1YnJlcS5zdGFydCwg
d2RhdGEtPnN1YnJlcS5sZW4pOwogCi0JcXVldWVfd29yayhjaWZzaW9kX3dxLCAmd2RhdGEtPndv
cmspOworCWNpZnNfd3JpdGVfc3VicmVxdWVzdF90ZXJtaW5hdGVkKHdkYXRhLCByZXN1bHQgPzog
d3JpdHRlbiwgdHJ1ZSk7CiAJcmVsZWFzZV9taWQobWlkKTsKIAlhZGRfY3JlZGl0cyhzZXJ2ZXIs
ICZjcmVkaXRzLCAwKTsKIH0KQEAgLTQ2NjAsNyArNDY4MSw3IEBAIHNtYjJfYXN5bmNfd3JpdGV2
KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCWludCByYyA9IC1FQUNDRVMsIGZs
YWdzID0gMDsKIAlzdHJ1Y3Qgc21iMl93cml0ZV9yZXEgKnJlcSA9IE5VTEw7CiAJc3RydWN0IHNt
YjJfaGRyICpzaGRyOwotCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHdkYXRh
LT5jZmlsZS0+dGxpbmspOworCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHdk
YXRhLT5yZXEtPmNmaWxlLT50bGluayk7CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVy
ID0gd2RhdGEtPnNlcnZlcjsKIAlzdHJ1Y3Qga3ZlYyBpb3ZbMV07CiAJc3RydWN0IHNtYl9ycXN0
IHJxc3QgPSB7IH07CkBAIC00NjgxLDggKzQ3MDIsOCBAQCBzbWIyX2FzeW5jX3dyaXRldihzdHJ1
Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKIAkJLnNlcnZlciA9IHNlcnZlciwKIAkJLm9m
ZnNldCA9IHdkYXRhLT5zdWJyZXEuc3RhcnQsCiAJCS5sZW5ndGggPSB3ZGF0YS0+c3VicmVxLmxl
biwKLQkJLnBlcnNpc3RlbnRfZmlkID0gd2RhdGEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQs
Ci0JCS52b2xhdGlsZV9maWQgPSB3ZGF0YS0+Y2ZpbGUtPmZpZC52b2xhdGlsZV9maWQsCisJCS5w
ZXJzaXN0ZW50X2ZpZCA9IHdkYXRhLT5yZXEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQsCisJ
CS52b2xhdGlsZV9maWQgPSB3ZGF0YS0+cmVxLT5jZmlsZS0+ZmlkLnZvbGF0aWxlX2ZpZCwKIAkJ
LnBpZCA9IHdkYXRhLT5waWQsCiAJfTsKIAlpb19wYXJtcyA9ICZfaW9fcGFybXM7CkBAIC00Njkw
LDcgKzQ3MTEsNyBAQCBzbWIyX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0
ICp3ZGF0YSkKIAlyYyA9IHNtYjJfcGxhaW5fcmVxX2luaXQoU01CMl9XUklURSwgdGNvbiwgc2Vy
dmVyLAogCQkJCSAodm9pZCAqKikgJnJlcSwgJnRvdGFsX2xlbik7CiAJaWYgKHJjKQotCQlyZXR1
cm4gcmM7CisJCWdvdG8gb3V0OwogCiAJaWYgKHNtYjNfZW5jcnlwdGlvbl9yZXF1aXJlZCh0Y29u
KSkKIAkJZmxhZ3MgfD0gQ0lGU19UUkFOU0ZPUk1fUkVROwpAQCAtNDc4Nyw3ICs0ODA4LDYgQEAg
c21iMl9hc3luY193cml0ZXYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEpCiAJCWZs
YWdzIHw9IENJRlNfSEFTX0NSRURJVFM7CiAJfQogCi0JY2lmc19nZXRfd3JpdGVkYXRhKHdkYXRh
KTsKIAlyYyA9IGNpZnNfY2FsbF9hc3luYyhzZXJ2ZXIsICZycXN0LCBOVUxMLCBzbWIyX3dyaXRl
dl9jYWxsYmFjaywgTlVMTCwKIAkJCSAgICAgd2RhdGEsIGZsYWdzLCAmd2RhdGEtPmNyZWRpdHMp
OwogCkBAIC00Nzk5LDEyICs0ODE5LDE0IEBAIHNtYjJfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZz
X2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCQkJCSAgICAgaW9fcGFybXMtPm9mZnNldCwKIAkJCQkg
ICAgIGlvX3Bhcm1zLT5sZW5ndGgsCiAJCQkJICAgICByYyk7Ci0JCWNpZnNfcHV0X3dyaXRlZGF0
YSh3ZGF0YSk7CiAJCWNpZnNfc3RhdHNfZmFpbF9pbmModGNvbiwgU01CMl9XUklURV9IRSk7CiAJ
fQogCiBhc3luY193cml0ZXZfb3V0OgogCWNpZnNfc21hbGxfYnVmX3JlbGVhc2UocmVxKTsKK291
dDoKKwlpZiAocmMpCisJCWNpZnNfd3JpdGVfc3VicmVxdWVzdF90ZXJtaW5hdGVkKHdkYXRhLCBy
YywgdHJ1ZSk7CiAJcmV0dXJuIHJjOwogfQogCmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L3Ry
YWNlLmggYi9mcy9zbWIvY2xpZW50L3RyYWNlLmgKaW5kZXggNTIyZmEzODdmY2ZkLi5iN2FhNWU5
MzViMjAgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvdHJhY2UuaAorKysgYi9mcy9zbWIvY2xp
ZW50L3RyYWNlLmgKQEAgLTIxLDYgKzIxLDYyIEBACiAKIC8qIEZvciBsb2dnaW5nIGVycm9ycyBp
biByZWFkIG9yIHdyaXRlICovCiBERUNMQVJFX0VWRU5UX0NMQVNTKHNtYjNfcndfZXJyX2NsYXNz
LAorCVRQX1BST1RPKHVuc2lnbmVkIGludCBycmVxX2RlYnVnX2lkLAorCQkgdW5zaWduZWQgaW50
IHJyZXFfZGVidWdfaW5kZXgsCisJCSB1bnNpZ25lZCBpbnQgeGlkLAorCQkgX191NjQJZmlkLAor
CQkgX191MzIJdGlkLAorCQkgX191NjQJc2VzaWQsCisJCSBfX3U2NAlvZmZzZXQsCisJCSBfX3Uz
MglsZW4sCisJCSBpbnQJcmMpLAorCVRQX0FSR1MocnJlcV9kZWJ1Z19pZCwgcnJlcV9kZWJ1Z19p
bmRleCwKKwkJeGlkLCBmaWQsIHRpZCwgc2VzaWQsIG9mZnNldCwgbGVuLCByYyksCisJVFBfU1RS
VUNUX19lbnRyeSgKKwkJX19maWVsZCh1bnNpZ25lZCBpbnQsIHJyZXFfZGVidWdfaWQpCisJCV9f
ZmllbGQodW5zaWduZWQgaW50LCBycmVxX2RlYnVnX2luZGV4KQorCQlfX2ZpZWxkKHVuc2lnbmVk
IGludCwgeGlkKQorCQlfX2ZpZWxkKF9fdTY0LCBmaWQpCisJCV9fZmllbGQoX191MzIsIHRpZCkK
KwkJX19maWVsZChfX3U2NCwgc2VzaWQpCisJCV9fZmllbGQoX191NjQsIG9mZnNldCkKKwkJX19m
aWVsZChfX3UzMiwgbGVuKQorCQlfX2ZpZWxkKGludCwgcmMpCisJKSwKKwlUUF9mYXN0X2Fzc2ln
bigKKwkJX19lbnRyeS0+cnJlcV9kZWJ1Z19pZCA9IHJyZXFfZGVidWdfaWQ7CisJCV9fZW50cnkt
PnJyZXFfZGVidWdfaW5kZXggPSBycmVxX2RlYnVnX2luZGV4OworCQlfX2VudHJ5LT54aWQgPSB4
aWQ7CisJCV9fZW50cnktPmZpZCA9IGZpZDsKKwkJX19lbnRyeS0+dGlkID0gdGlkOworCQlfX2Vu
dHJ5LT5zZXNpZCA9IHNlc2lkOworCQlfX2VudHJ5LT5vZmZzZXQgPSBvZmZzZXQ7CisJCV9fZW50
cnktPmxlbiA9IGxlbjsKKwkJX19lbnRyeS0+cmMgPSByYzsKKwkpLAorCVRQX3ByaW50aygiXHRS
PSUwOHhbJXhdIHhpZD0ldSBzaWQ9MHglbGx4IHRpZD0weCV4IGZpZD0weCVsbHggb2Zmc2V0PTB4
JWxseCBsZW49MHgleCByYz0lZCIsCisJCSAgX19lbnRyeS0+cnJlcV9kZWJ1Z19pZCwgX19lbnRy
eS0+cnJlcV9kZWJ1Z19pbmRleCwKKwkJICBfX2VudHJ5LT54aWQsIF9fZW50cnktPnNlc2lkLCBf
X2VudHJ5LT50aWQsIF9fZW50cnktPmZpZCwKKwkJICBfX2VudHJ5LT5vZmZzZXQsIF9fZW50cnkt
PmxlbiwgX19lbnRyeS0+cmMpCispCisKKyNkZWZpbmUgREVGSU5FX1NNQjNfUldfRVJSX0VWRU5U
KG5hbWUpICAgICAgICAgIFwKK0RFRklORV9FVkVOVChzbWIzX3J3X2Vycl9jbGFzcywgc21iM18j
I25hbWUsICAgIFwKKwlUUF9QUk9UTyh1bnNpZ25lZCBpbnQgcnJlcV9kZWJ1Z19pZCwJXAorCQkg
dW5zaWduZWQgaW50IHJyZXFfZGVidWdfaW5kZXgsCQlcCisJCSB1bnNpZ25lZCBpbnQgeGlkLAkJ
CVwKKwkJIF9fdTY0CWZpZCwJCQkJXAorCQkgX191MzIJdGlkLAkJCQlcCisJCSBfX3U2NAlzZXNp
ZCwJCQkJXAorCQkgX191NjQJb2Zmc2V0LAkJCQlcCisJCSBfX3UzMglsZW4sCQkJCVwKKwkJIGlu
dAlyYyksCQkJCVwKKwlUUF9BUkdTKHJyZXFfZGVidWdfaWQsIHJyZXFfZGVidWdfaW5kZXgsIHhp
ZCwgZmlkLCB0aWQsIHNlc2lkLCBvZmZzZXQsIGxlbiwgcmMpKQorCitERUZJTkVfU01CM19SV19F
UlJfRVZFTlQocmVhZF9lcnIpOworCisvKiBGb3IgbG9nZ2luZyBlcnJvcnMgaW4gb3RoZXIgZmls
ZSBJL08gb3BzICovCitERUNMQVJFX0VWRU5UX0NMQVNTKHNtYjNfb3RoZXJfZXJyX2NsYXNzLAog
CVRQX1BST1RPKHVuc2lnbmVkIGludCB4aWQsCiAJCV9fdTY0CWZpZCwKIAkJX191MzIJdGlkLApA
QCAtNTIsOCArMTA4LDggQEAgREVDTEFSRV9FVkVOVF9DTEFTUyhzbWIzX3J3X2Vycl9jbGFzcywK
IAkJX19lbnRyeS0+b2Zmc2V0LCBfX2VudHJ5LT5sZW4sIF9fZW50cnktPnJjKQogKQogCi0jZGVm
aW5lIERFRklORV9TTUIzX1JXX0VSUl9FVkVOVChuYW1lKSAgICAgICAgICBcCi1ERUZJTkVfRVZF
TlQoc21iM19yd19lcnJfY2xhc3MsIHNtYjNfIyNuYW1lLCAgICBcCisjZGVmaW5lIERFRklORV9T
TUIzX09USEVSX0VSUl9FVkVOVChuYW1lKQlcCitERUZJTkVfRVZFTlQoc21iM19vdGhlcl9lcnJf
Y2xhc3MsIHNtYjNfIyNuYW1lLCBcCiAJVFBfUFJPVE8odW5zaWduZWQgaW50IHhpZCwJCVwKIAkJ
X191NjQJZmlkLAkJCVwKIAkJX191MzIJdGlkLAkJCVwKQEAgLTYzLDE1ICsxMTksNjcgQEAgREVG
SU5FX0VWRU5UKHNtYjNfcndfZXJyX2NsYXNzLCBzbWIzXyMjbmFtZSwgICAgXAogCQlpbnQJcmMp
LAkJCVwKIAlUUF9BUkdTKHhpZCwgZmlkLCB0aWQsIHNlc2lkLCBvZmZzZXQsIGxlbiwgcmMpKQog
Ci1ERUZJTkVfU01CM19SV19FUlJfRVZFTlQod3JpdGVfZXJyKTsKLURFRklORV9TTUIzX1JXX0VS
Ul9FVkVOVChyZWFkX2Vycik7Ci1ERUZJTkVfU01CM19SV19FUlJfRVZFTlQocXVlcnlfZGlyX2Vy
cik7Ci1ERUZJTkVfU01CM19SV19FUlJfRVZFTlQoemVyb19lcnIpOwotREVGSU5FX1NNQjNfUldf
RVJSX0VWRU5UKGZhbGxvY19lcnIpOworREVGSU5FX1NNQjNfT1RIRVJfRVJSX0VWRU5UKHdyaXRl
X2Vycik7CitERUZJTkVfU01CM19PVEhFUl9FUlJfRVZFTlQocXVlcnlfZGlyX2Vycik7CitERUZJ
TkVfU01CM19PVEhFUl9FUlJfRVZFTlQoemVyb19lcnIpOworREVGSU5FX1NNQjNfT1RIRVJfRVJS
X0VWRU5UKGZhbGxvY19lcnIpOwogCiAKIC8qIEZvciBsb2dnaW5nIHN1Y2Nlc3NmdWwgcmVhZCBv
ciB3cml0ZSAqLwogREVDTEFSRV9FVkVOVF9DTEFTUyhzbWIzX3J3X2RvbmVfY2xhc3MsCisJVFBf
UFJPVE8odW5zaWduZWQgaW50IHJyZXFfZGVidWdfaWQsCisJCSB1bnNpZ25lZCBpbnQgcnJlcV9k
ZWJ1Z19pbmRleCwKKwkJIHVuc2lnbmVkIGludCB4aWQsCisJCSBfX3U2NAlmaWQsCisJCSBfX3Uz
Mgl0aWQsCisJCSBfX3U2NAlzZXNpZCwKKwkJIF9fdTY0CW9mZnNldCwKKwkJIF9fdTMyCWxlbiks
CisJVFBfQVJHUyhycmVxX2RlYnVnX2lkLCBycmVxX2RlYnVnX2luZGV4LAorCQl4aWQsIGZpZCwg
dGlkLCBzZXNpZCwgb2Zmc2V0LCBsZW4pLAorCVRQX1NUUlVDVF9fZW50cnkoCisJCV9fZmllbGQo
dW5zaWduZWQgaW50LCBycmVxX2RlYnVnX2lkKQorCQlfX2ZpZWxkKHVuc2lnbmVkIGludCwgcnJl
cV9kZWJ1Z19pbmRleCkKKwkJX19maWVsZCh1bnNpZ25lZCBpbnQsIHhpZCkKKwkJX19maWVsZChf
X3U2NCwgZmlkKQorCQlfX2ZpZWxkKF9fdTMyLCB0aWQpCisJCV9fZmllbGQoX191NjQsIHNlc2lk
KQorCQlfX2ZpZWxkKF9fdTY0LCBvZmZzZXQpCisJCV9fZmllbGQoX191MzIsIGxlbikKKwkpLAor
CVRQX2Zhc3RfYXNzaWduKAorCQlfX2VudHJ5LT5ycmVxX2RlYnVnX2lkID0gcnJlcV9kZWJ1Z19p
ZDsKKwkJX19lbnRyeS0+cnJlcV9kZWJ1Z19pbmRleCA9IHJyZXFfZGVidWdfaW5kZXg7CisJCV9f
ZW50cnktPnhpZCA9IHhpZDsKKwkJX19lbnRyeS0+ZmlkID0gZmlkOworCQlfX2VudHJ5LT50aWQg
PSB0aWQ7CisJCV9fZW50cnktPnNlc2lkID0gc2VzaWQ7CisJCV9fZW50cnktPm9mZnNldCA9IG9m
ZnNldDsKKwkJX19lbnRyeS0+bGVuID0gbGVuOworCSksCisJVFBfcHJpbnRrKCJSPSUwOHhbJXhd
IHhpZD0ldSBzaWQ9MHglbGx4IHRpZD0weCV4IGZpZD0weCVsbHggb2Zmc2V0PTB4JWxseCBsZW49
MHgleCIsCisJCSAgX19lbnRyeS0+cnJlcV9kZWJ1Z19pZCwgX19lbnRyeS0+cnJlcV9kZWJ1Z19p
bmRleCwKKwkJICBfX2VudHJ5LT54aWQsIF9fZW50cnktPnNlc2lkLCBfX2VudHJ5LT50aWQsIF9f
ZW50cnktPmZpZCwKKwkJICBfX2VudHJ5LT5vZmZzZXQsIF9fZW50cnktPmxlbikKKykKKworI2Rl
ZmluZSBERUZJTkVfU01CM19SV19ET05FX0VWRU5UKG5hbWUpICAgICAgICAgXAorREVGSU5FX0VW
RU5UKHNtYjNfcndfZG9uZV9jbGFzcywgc21iM18jI25hbWUsICAgXAorCVRQX1BST1RPKHVuc2ln
bmVkIGludCBycmVxX2RlYnVnX2lkLAlcCisJCSB1bnNpZ25lZCBpbnQgcnJlcV9kZWJ1Z19pbmRl
eCwJXAorCQkgdW5zaWduZWQgaW50IHhpZCwJCVwKKwkJX191NjQJZmlkLAkJCVwKKwkJX191MzIJ
dGlkLAkJCVwKKwkJX191NjQJc2VzaWQsCQkJXAorCQlfX3U2NAlvZmZzZXQsCQkJXAorCQlfX3Uz
MglsZW4pLAkJCVwKKwlUUF9BUkdTKHJyZXFfZGVidWdfaWQsIHJyZXFfZGVidWdfaW5kZXgsIHhp
ZCwgZmlkLCB0aWQsIHNlc2lkLCBvZmZzZXQsIGxlbikpCisKK0RFRklORV9TTUIzX1JXX0RPTkVf
RVZFTlQocmVhZF9lbnRlcik7CitERUZJTkVfU01CM19SV19ET05FX0VWRU5UKHJlYWRfZG9uZSk7
CisKKy8qIEZvciBsb2dnaW5nIHN1Y2Nlc3NmdWwgb3RoZXIgb3AgKi8KK0RFQ0xBUkVfRVZFTlRf
Q0xBU1Moc21iM19vdGhlcl9kb25lX2NsYXNzLAogCVRQX1BST1RPKHVuc2lnbmVkIGludCB4aWQs
CiAJCV9fdTY0CWZpZCwKIAkJX191MzIJdGlkLApAQCAtMTAwLDggKzIwOCw4IEBAIERFQ0xBUkVf
RVZFTlRfQ0xBU1Moc21iM19yd19kb25lX2NsYXNzLAogCQlfX2VudHJ5LT5vZmZzZXQsIF9fZW50
cnktPmxlbikKICkKIAotI2RlZmluZSBERUZJTkVfU01CM19SV19ET05FX0VWRU5UKG5hbWUpICAg
ICAgICAgXAotREVGSU5FX0VWRU5UKHNtYjNfcndfZG9uZV9jbGFzcywgc21iM18jI25hbWUsICAg
XAorI2RlZmluZSBERUZJTkVfU01CM19PVEhFUl9ET05FX0VWRU5UKG5hbWUpICAgICAgICAgXAor
REVGSU5FX0VWRU5UKHNtYjNfb3RoZXJfZG9uZV9jbGFzcywgc21iM18jI25hbWUsICAgXAogCVRQ
X1BST1RPKHVuc2lnbmVkIGludCB4aWQsCQlcCiAJCV9fdTY0CWZpZCwJCQlcCiAJCV9fdTMyCXRp
ZCwJCQlcCkBAIC0xMTAsMTYgKzIxOCwxNCBAQCBERUZJTkVfRVZFTlQoc21iM19yd19kb25lX2Ns
YXNzLCBzbWIzXyMjbmFtZSwgICBcCiAJCV9fdTMyCWxlbiksCQkJXAogCVRQX0FSR1MoeGlkLCBm
aWQsIHRpZCwgc2VzaWQsIG9mZnNldCwgbGVuKSkKIAotREVGSU5FX1NNQjNfUldfRE9ORV9FVkVO
VCh3cml0ZV9lbnRlcik7Ci1ERUZJTkVfU01CM19SV19ET05FX0VWRU5UKHJlYWRfZW50ZXIpOwot
REVGSU5FX1NNQjNfUldfRE9ORV9FVkVOVChxdWVyeV9kaXJfZW50ZXIpOwotREVGSU5FX1NNQjNf
UldfRE9ORV9FVkVOVCh6ZXJvX2VudGVyKTsKLURFRklORV9TTUIzX1JXX0RPTkVfRVZFTlQoZmFs
bG9jX2VudGVyKTsKLURFRklORV9TTUIzX1JXX0RPTkVfRVZFTlQod3JpdGVfZG9uZSk7Ci1ERUZJ
TkVfU01CM19SV19ET05FX0VWRU5UKHJlYWRfZG9uZSk7Ci1ERUZJTkVfU01CM19SV19ET05FX0VW
RU5UKHF1ZXJ5X2Rpcl9kb25lKTsKLURFRklORV9TTUIzX1JXX0RPTkVfRVZFTlQoemVyb19kb25l
KTsKLURFRklORV9TTUIzX1JXX0RPTkVfRVZFTlQoZmFsbG9jX2RvbmUpOworREVGSU5FX1NNQjNf
T1RIRVJfRE9ORV9FVkVOVCh3cml0ZV9lbnRlcik7CitERUZJTkVfU01CM19PVEhFUl9ET05FX0VW
RU5UKHF1ZXJ5X2Rpcl9lbnRlcik7CitERUZJTkVfU01CM19PVEhFUl9ET05FX0VWRU5UKHplcm9f
ZW50ZXIpOworREVGSU5FX1NNQjNfT1RIRVJfRE9ORV9FVkVOVChmYWxsb2NfZW50ZXIpOworREVG
SU5FX1NNQjNfT1RIRVJfRE9ORV9FVkVOVCh3cml0ZV9kb25lKTsKK0RFRklORV9TTUIzX09USEVS
X0RPTkVfRVZFTlQocXVlcnlfZGlyX2RvbmUpOworREVGSU5FX1NNQjNfT1RIRVJfRE9ORV9FVkVO
VCh6ZXJvX2RvbmUpOworREVGSU5FX1NNQjNfT1RIRVJfRE9ORV9FVkVOVChmYWxsb2NfZG9uZSk7
CiAKIC8qIEZvciBsb2dnaW5nIHN1Y2Nlc3NmdWwgc2V0IEVPRiAodHJ1bmNhdGUpICovCiBERUNM
QVJFX0VWRU5UX0NMQVNTKHNtYjNfZW9mX2NsYXNzLApkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVu
dC90cmFuc3BvcnQuYyBiL2ZzL3NtYi9jbGllbnQvdHJhbnNwb3J0LmMKaW5kZXggNWNmNjUzNDYz
YzU1Li5jNzJmYjI0M2MxNTkgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvdHJhbnNwb3J0LmMK
KysrIGIvZnMvc21iL2NsaWVudC90cmFuc3BvcnQuYwpAQCAtMTc5OCw4ICsxNzk4LDExIEBAIGNp
ZnNfcmVhZHZfcmVjZWl2ZShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIHN0cnVjdCBt
aWRfcV9lbnRyeSAqbWlkKQogCQlsZW5ndGggPSBkYXRhX2xlbjsgLyogQW4gUkRNQSByZWFkIGlz
IGFscmVhZHkgZG9uZS4gKi8KIAllbHNlCiAjZW5kaWYKKwl7CiAJCWxlbmd0aCA9IGNpZnNfcmVh
ZF9pdGVyX2Zyb21fc29ja2V0KHNlcnZlciwgJnJkYXRhLT5zdWJyZXEuaW9faXRlciwKIAkJCQkJ
CSAgICBkYXRhX2xlbik7CisJCWlvdl9pdGVyX3JldmVydCgmcmRhdGEtPnN1YnJlcS5pb19pdGVy
LCBkYXRhX2xlbik7CisJfQogCWlmIChsZW5ndGggPiAwKQogCQlyZGF0YS0+Z290X2J5dGVzICs9
IGxlbmd0aDsKIAlzZXJ2ZXItPnRvdGFsX3JlYWQgKz0gbGVuZ3RoOwotLSAKMi40MC4xCgo=
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0004-cifs-Replace-cifs_writedata-with-a-wrapper-around-ne.patch"
Content-Disposition: attachment; 
	filename="0004-cifs-Replace-cifs_writedata-with-a-wrapper-around-ne.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn4660>
X-Attachment-Id: f_lrpgn4660

RnJvbSBmNzRkYjMzMzdjMjdiMzljNTQyNTU5ZmQ2YzlkODQyYjhhYTRkNmM5IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTY6Mjc6NDEgKzAxMDAKU3ViamVjdDogW1BBVENIIDA0LzEy
XSBjaWZzOiBSZXBsYWNlIGNpZnNfd3JpdGVkYXRhIHdpdGggYSB3cmFwcGVyIGFyb3VuZAogbmV0
ZnNfaW9fc3VicmVxdWVzdAoKUmVwbGFjZSB0aGUgY2lmc193cml0ZWRhdGEgc3RydWN0IHdpdGgg
dGhlIHNhbWUgd3JhcHBlciBhcm91bmQKbmV0ZnNfaW9fc3VicmVxdWVzdCB0aGF0IHdhcyB1c2Vk
IHRvIHJlcGxhY2UgY2lmc19yZWFkZGF0YS4KClNpZ25lZC1vZmYtYnk6IERhdmlkIEhvd2VsbHMg
PGRob3dlbGxzQHJlZGhhdC5jb20+CmNjOiBTaHlhbSBQcmFzYWQgTiA8bnNwbWFuZ2Fsb3JlQGdt
YWlsLmNvbT4KY2M6IFJvaGl0aCBTdXJhYmF0dHVsYSA8cm9oaXRocy5tc2Z0QGdtYWlsLmNvbT4K
Y2M6IEplZmYgTGF5dG9uIDxqbGF5dG9uQGtlcm5lbC5vcmc+CmNjOiBsaW51eC1jaWZzQHZnZXIu
a2VybmVsLm9yZwpjYzogbGludXgtY2FjaGVmc0ByZWRoYXQuY29tCmNjOiBsaW51eC1mc2RldmVs
QHZnZXIua2VybmVsLm9yZwpjYzogbGludXgtbW1Aa3ZhY2sub3JnCi0tLQogZnMvc21iL2NsaWVu
dC9jaWZzZ2xvYi5oICB8IDMwICsrKy0tLS0tLS0tLS0tLQogZnMvc21iL2NsaWVudC9jaWZzcHJv
dG8uaCB8IDE2ICsrKysrKy0tCiBmcy9zbWIvY2xpZW50L2NpZnNzbWIuYyAgIHwgIDkgKystLS0K
IGZzL3NtYi9jbGllbnQvZmlsZS5jICAgICAgfCA3OSArKysrKysrKysrKysrKysrLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KIGZzL3NtYi9jbGllbnQvc21iMnBkdS5jICAgfCAgOSArKy0tLQogZnMv
c21iL2NsaWVudC9zbWIycHJvdG8uaCB8ICAzICstCiA2IGZpbGVzIGNoYW5nZWQsIDU4IGluc2Vy
dGlvbnMoKyksIDg4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lm
c2dsb2IuaCBiL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaAppbmRleCBhN2FhNzVkZjM4YTMuLjZi
NDM0ZTBlMGRjNSAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oCisrKyBiL2Zz
L3NtYi9jbGllbnQvY2lmc2dsb2IuaApAQCAtMjU1LDcgKzI1NSw2IEBAIHN0cnVjdCBjaWZzX2Zh
dHRyOwogc3RydWN0IHNtYjNfZnNfY29udGV4dDsKIHN0cnVjdCBjaWZzX2ZpZDsKIHN0cnVjdCBj
aWZzX2lvX3N1YnJlcXVlc3Q7Ci1zdHJ1Y3QgY2lmc193cml0ZWRhdGE7CiBzdHJ1Y3QgY2lmc19p
b19wYXJtczsKIHN0cnVjdCBjaWZzX3NlYXJjaF9pbmZvOwogc3RydWN0IGNpZnNJbm9kZUluZm87
CkBAIC00MzQsOCArNDMzLDcgQEAgc3RydWN0IHNtYl92ZXJzaW9uX29wZXJhdGlvbnMgewogCS8q
IGFzeW5jIHJlYWQgZnJvbSB0aGUgc2VydmVyICovCiAJaW50ICgqYXN5bmNfcmVhZHYpKHN0cnVj
dCBjaWZzX2lvX3N1YnJlcXVlc3QgKik7CiAJLyogYXN5bmMgd3JpdGUgdG8gdGhlIHNlcnZlciAq
LwotCWludCAoKmFzeW5jX3dyaXRldikoc3RydWN0IGNpZnNfd3JpdGVkYXRhICosCi0JCQkgICAg
dm9pZCAoKnJlbGVhc2UpKHN0cnVjdCBrcmVmICopKTsKKwlpbnQgKCphc3luY193cml0ZXYpKHN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKik7CiAJLyogc3luYyByZWFkIGZyb20gdGhlIHNlcnZl
ciAqLwogCWludCAoKnN5bmNfcmVhZCkoY29uc3QgdW5zaWduZWQgaW50LCBzdHJ1Y3QgY2lmc19m
aWQgKiwKIAkJCSBzdHJ1Y3QgY2lmc19pb19wYXJtcyAqLCB1bnNpZ25lZCBpbnQgKiwgY2hhciAq
KiwKQEAgLTE0NzQsMzUgKzE0NzIsMTcgQEAgc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCB7CiAj
ZW5kaWYKIAlzdHJ1Y3QgY2lmc19jcmVkaXRzCQljcmVkaXRzOwogCi0JLy8gVE9ETzogUmVtb3Zl
IGZvbGxvd2luZyBlbGVtZW50cwotCXN0cnVjdCBsaXN0X2hlYWQJCWxpc3Q7Ci0Jc3RydWN0IGNv
bXBsZXRpb24JCWRvbmU7Ci0Jc3RydWN0IHdvcmtfc3RydWN0CQl3b3JrOwotCXN0cnVjdCBpb3Zf
aXRlcgkJCWl0ZXI7Ci0JX191NjQJCQkJb2Zmc2V0OwotCXVuc2lnbmVkIGludAkJCWJ5dGVzOwot
fTsKKwllbnVtIHdyaXRlYmFja19zeW5jX21vZGVzCXN5bmNfbW9kZTsKKwlib29sCQkJCXVuY2Fj
aGVkOworCXN0cnVjdCBiaW9fdmVjCQkJKmJ2OwogCi0vKiBhc3luY2hyb25vdXMgd3JpdGUgc3Vw
cG9ydCAqLwotc3RydWN0IGNpZnNfd3JpdGVkYXRhIHsKLQlzdHJ1Y3Qga3JlZgkJCXJlZmNvdW50
OworCS8vIFRPRE86IFJlbW92ZSBmb2xsb3dpbmcgZWxlbWVudHMKIAlzdHJ1Y3QgbGlzdF9oZWFk
CQlsaXN0OwogCXN0cnVjdCBjb21wbGV0aW9uCQlkb25lOwotCWVudW0gd3JpdGViYWNrX3N5bmNf
bW9kZXMJc3luY19tb2RlOwogCXN0cnVjdCB3b3JrX3N0cnVjdAkJd29yazsKLQlzdHJ1Y3QgY2lm
c0ZpbGVJbmZvCQkqY2ZpbGU7Ci0Jc3RydWN0IGNpZnNfYWlvX2N0eAkJKmN0eDsKIAlzdHJ1Y3Qg
aW92X2l0ZXIJCQlpdGVyOwotCXN0cnVjdCBiaW9fdmVjCQkJKmJ2OwogCV9fdTY0CQkJCW9mZnNl
dDsKLQlwaWRfdAkJCQlwaWQ7CiAJdW5zaWduZWQgaW50CQkJYnl0ZXM7Ci0JaW50CQkJCXJlc3Vs
dDsKLQlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvCQkqc2VydmVyOwotI2lmZGVmIENPTkZJR19DSUZT
X1NNQl9ESVJFQ1QKLQlzdHJ1Y3Qgc21iZF9tcgkJCSptcjsKLSNlbmRpZgotCXN0cnVjdCBjaWZz
X2NyZWRpdHMJCWNyZWRpdHM7CiB9OwogCiAvKgpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9j
aWZzcHJvdG8uaCBiL2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmgKaW5kZXggNTAzM2YxYjFiZmUz
Li45ZmY3NTlkNDg1N2EgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmgKKysr
IGIvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8uaApAQCAtNjA3LDExICs2MDcsMTkgQEAgc3RhdGlj
IGlubGluZSB2b2lkIGNpZnNfcHV0X3JlYWRkYXRhKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3Qg
KnJkYXRhKQogaW50IGNpZnNfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAq
cmRhdGEpOwogaW50IGNpZnNfcmVhZHZfcmVjZWl2ZShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpz
ZXJ2ZXIsIHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKTsKIAotaW50IGNpZnNfYXN5bmNfd3JpdGV2
KHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEsCi0JCSAgICAgIHZvaWQgKCpyZWxlYXNlKShz
dHJ1Y3Qga3JlZiAqa3JlZikpOworaW50IGNpZnNfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKndkYXRhKTsKIHZvaWQgY2lmc193cml0ZXZfY29tcGxldGUoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKTsKLXN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqY2lmc193cml0ZWRhdGFf
YWxsb2Mod29ya19mdW5jX3QgY29tcGxldGUpOwotdm9pZCBjaWZzX3dyaXRlZGF0YV9yZWxlYXNl
KHN0cnVjdCBrcmVmICpyZWZjb3VudCk7CitzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpjaWZz
X3dyaXRlZGF0YV9hbGxvYyh3b3JrX2Z1bmNfdCBjb21wbGV0ZSk7Cit2b2lkIGNpZnNfd3JpdGVk
YXRhX3JlbGVhc2Uoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEpOworc3RhdGljIGlu
bGluZSB2b2lkIGNpZnNfZ2V0X3dyaXRlZGF0YShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3
ZGF0YSkKK3sKKwlyZWZjb3VudF9pbmMoJndkYXRhLT5zdWJyZXEucmVmKTsKK30KK3N0YXRpYyBp
bmxpbmUgdm9pZCBjaWZzX3B1dF93cml0ZWRhdGEoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAq
d2RhdGEpCit7CisJaWYgKHJlZmNvdW50X2RlY19hbmRfdGVzdCgmd2RhdGEtPnN1YnJlcS5yZWYp
KQorCQljaWZzX3dyaXRlZGF0YV9yZWxlYXNlKHdkYXRhKTsKK30KIGludCBjaWZzX3F1ZXJ5X21m
X3N5bWxpbmsodW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwKIAkJCSAg
c3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYiwKIAkJCSAgY29uc3QgdW5zaWduZWQgY2hhciAq
cGF0aCwgY2hhciAqcGJ1ZiwKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc3NtYi5jIGIv
ZnMvc21iL2NsaWVudC9jaWZzc21iLmMKaW5kZXggMmQxMGMwN2MxMjk1Li4xZWFkODY3YTBmNGEg
MTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvY2lmc3NtYi5jCisrKyBiL2ZzL3NtYi9jbGllbnQv
Y2lmc3NtYi5jCkBAIC0xNjEyLDcgKzE2MTIsNyBAQCBDSUZTU01CV3JpdGUoY29uc3QgdW5zaWdu
ZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfaW9fcGFybXMgKmlvX3Bhcm1zLAogc3RhdGljIHZvaWQK
IGNpZnNfd3JpdGV2X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogewotCXN0cnVj
dCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEgPSBtaWQtPmNhbGxiYWNrX2RhdGE7CisJc3RydWN0IGNp
ZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEgPSBtaWQtPmNhbGxiYWNrX2RhdGE7CiAJc3RydWN0IGNp
ZnNfdGNvbiAqdGNvbiA9IHRsaW5rX3Rjb24od2RhdGEtPmNmaWxlLT50bGluayk7CiAJdW5zaWdu
ZWQgaW50IHdyaXR0ZW47CiAJV1JJVEVfUlNQICpzbWIgPSAoV1JJVEVfUlNQICopbWlkLT5yZXNw
X2J1ZjsKQEAgLTE2NTcsOCArMTY1Nyw3IEBAIGNpZnNfd3JpdGV2X2NhbGxiYWNrKHN0cnVjdCBt
aWRfcV9lbnRyeSAqbWlkKQogCiAvKiBjaWZzX2FzeW5jX3dyaXRldiAtIHNlbmQgYW4gYXN5bmMg
d3JpdGUsIGFuZCBzZXQgdXAgbWlkIHRvIGhhbmRsZSByZXN1bHQgKi8KIGludAotY2lmc19hc3lu
Y193cml0ZXYoc3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSwKLQkJICB2b2lkICgqcmVsZWFz
ZSkoc3RydWN0IGtyZWYgKmtyZWYpKQorY2lmc19hc3luY193cml0ZXYoc3RydWN0IGNpZnNfaW9f
c3VicmVxdWVzdCAqd2RhdGEpCiB7CiAJaW50IHJjID0gLUVBQ0NFUzsKIAlXUklURV9SRVEgKnNt
YiA9IE5VTEw7CkBAIC0xNzI1LDE0ICsxNzI0LDE0IEBAIGNpZnNfYXN5bmNfd3JpdGV2KHN0cnVj
dCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEsCiAJCWlvdlsxXS5pb3ZfbGVuICs9IDQ7IC8qIHBhZCBi
aWdnZXIgYnkgZm91ciBieXRlcyAqLwogCX0KIAotCWtyZWZfZ2V0KCZ3ZGF0YS0+cmVmY291bnQp
OworCWNpZnNfZ2V0X3dyaXRlZGF0YSh3ZGF0YSk7CiAJcmMgPSBjaWZzX2NhbGxfYXN5bmModGNv
bi0+c2VzLT5zZXJ2ZXIsICZycXN0LCBOVUxMLAogCQkJICAgICBjaWZzX3dyaXRldl9jYWxsYmFj
aywgTlVMTCwgd2RhdGEsIDAsIE5VTEwpOwogCiAJaWYgKHJjID09IDApCiAJCWNpZnNfc3RhdHNf
aW5jKCZ0Y29uLT5zdGF0cy5jaWZzX3N0YXRzLm51bV93cml0ZXMpOwogCWVsc2UKLQkJa3JlZl9w
dXQoJndkYXRhLT5yZWZjb3VudCwgcmVsZWFzZSk7CisJCWNpZnNfcHV0X3dyaXRlZGF0YSh3ZGF0
YSk7CiAKIGFzeW5jX3dyaXRldl9vdXQ6CiAJY2lmc19zbWFsbF9idWZfcmVsZWFzZShzbWIpOwpk
aWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9zbWIvY2xpZW50L2ZpbGUuYwpp
bmRleCA3ZTBiYjNlZWI4N2IuLjQ3OTBkYzU1MGI4MCAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVu
dC9maWxlLmMKKysrIGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAgLTI0MTMsMTAgKzI0MTMsMTAg
QEAgY2lmc19nZXRfcmVhZGFibGVfcGF0aChzdHJ1Y3QgY2lmc190Y29uICp0Y29uLCBjb25zdCBj
aGFyICpuYW1lLAogfQogCiB2b2lkCi1jaWZzX3dyaXRlZGF0YV9yZWxlYXNlKHN0cnVjdCBrcmVm
ICpyZWZjb3VudCkKK2NpZnNfd3JpdGVkYXRhX3JlbGVhc2Uoc3RydWN0IGNpZnNfaW9fc3VicmVx
dWVzdCAqd2RhdGEpCiB7Ci0Jc3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSA9IGNvbnRhaW5l
cl9vZihyZWZjb3VudCwKLQkJCQkJc3RydWN0IGNpZnNfd3JpdGVkYXRhLCByZWZjb3VudCk7CisJ
aWYgKHdkYXRhLT51bmNhY2hlZCkKKwkJa3JlZl9wdXQoJndkYXRhLT5jdHgtPnJlZmNvdW50LCBj
aWZzX2Fpb19jdHhfcmVsZWFzZSk7CiAjaWZkZWYgQ09ORklHX0NJRlNfU01CX0RJUkVDVAogCWlm
ICh3ZGF0YS0+bXIpIHsKIAkJc21iZF9kZXJlZ2lzdGVyX21yKHdkYXRhLT5tcik7CkBAIC0yNDM1
LDcgKzI0MzUsNyBAQCBjaWZzX3dyaXRlZGF0YV9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWZjb3Vu
dCkKICAqIHBvc3NpYmxlIHRoYXQgdGhlIHBhZ2Ugd2FzIHJlZGlydGllZCBzbyByZS1jbGVhbiB0
aGUgcGFnZS4KICAqLwogc3RhdGljIHZvaWQKLWNpZnNfd3JpdGV2X3JlcXVldWUoc3RydWN0IGNp
ZnNfd3JpdGVkYXRhICp3ZGF0YSkKK2NpZnNfd3JpdGV2X3JlcXVldWUoc3RydWN0IGNpZnNfaW9f
c3VicmVxdWVzdCAqd2RhdGEpCiB7CiAJaW50IHJjID0gMDsKIAlzdHJ1Y3QgaW5vZGUgKmlub2Rl
ID0gZF9pbm9kZSh3ZGF0YS0+Y2ZpbGUtPmRlbnRyeSk7CkBAIC0yNDQ1LDcgKzI0NDUsNyBAQCBj
aWZzX3dyaXRldl9yZXF1ZXVlKHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEpCiAKIAlzZXJ2
ZXIgPSB0bGlua190Y29uKHdkYXRhLT5jZmlsZS0+dGxpbmspLT5zZXMtPnNlcnZlcjsKIAlkbyB7
Ci0JCXN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEyOworCQlzdHJ1Y3QgY2lmc19pb19zdWJy
ZXF1ZXN0ICp3ZGF0YTI7CiAJCXVuc2lnbmVkIGludCB3c2l6ZSwgY3VyX2xlbjsKIAogCQl3c2l6
ZSA9IHNlcnZlci0+b3BzLT53cF9yZXRyeV9zaXplKGlub2RlKTsKQEAgLTI0NjgsNyArMjQ2OCw3
IEBAIGNpZnNfd3JpdGV2X3JlcXVldWUoc3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSkKIAkJ
d2RhdGEyLT5zeW5jX21vZGUgPSB3ZGF0YS0+c3luY19tb2RlOwogCQl3ZGF0YTItPm9mZnNldAk9
IGZwb3M7CiAJCXdkYXRhMi0+Ynl0ZXMJPSBjdXJfbGVuOwotCQl3ZGF0YTItPml0ZXIJPSB3ZGF0
YS0+aXRlcjsKKwkJd2RhdGEyLT5pdGVyID0gd2RhdGEtPml0ZXI7CiAKIAkJaW92X2l0ZXJfYWR2
YW5jZSgmd2RhdGEyLT5pdGVyLCBmcG9zIC0gd2RhdGEtPm9mZnNldCk7CiAJCWlvdl9pdGVyX3Ry
dW5jYXRlKCZ3ZGF0YTItPml0ZXIsIHdkYXRhMi0+Ynl0ZXMpOwpAQCAtMjQ5MCwxMSArMjQ5MCwx
MCBAQCBjaWZzX3dyaXRldl9yZXF1ZXVlKHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEpCiAJ
CQkJcmMgPSAtRUJBREY7CiAJCX0gZWxzZSB7CiAJCQl3ZGF0YTItPnBpZCA9IHdkYXRhMi0+Y2Zp
bGUtPnBpZDsKLQkJCXJjID0gc2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0YTIsCi0JCQkJ
CQkgICAgICAgY2lmc193cml0ZWRhdGFfcmVsZWFzZSk7CisJCQlyYyA9IHNlcnZlci0+b3BzLT5h
c3luY193cml0ZXYod2RhdGEyKTsKIAkJfQogCi0JCWtyZWZfcHV0KCZ3ZGF0YTItPnJlZmNvdW50
LCBjaWZzX3dyaXRlZGF0YV9yZWxlYXNlKTsKKwkJY2lmc19wdXRfd3JpdGVkYXRhKHdkYXRhMik7
CiAJCWlmIChyYykgewogCQkJaWYgKGlzX3JldHJ5YWJsZV9lcnJvcihyYykpCiAJCQkJY29udGlu
dWU7CkBAIC0yNTEzLDE0ICsyNTEyLDE0IEBAIGNpZnNfd3JpdGV2X3JlcXVldWUoc3RydWN0IGNp
ZnNfd3JpdGVkYXRhICp3ZGF0YSkKIAogCWlmIChyYyAhPSAwICYmICFpc19yZXRyeWFibGVfZXJy
b3IocmMpKQogCQltYXBwaW5nX3NldF9lcnJvcihpbm9kZS0+aV9tYXBwaW5nLCByYyk7Ci0Ja3Jl
Zl9wdXQoJndkYXRhLT5yZWZjb3VudCwgY2lmc193cml0ZWRhdGFfcmVsZWFzZSk7CisJY2lmc19w
dXRfd3JpdGVkYXRhKHdkYXRhKTsKIH0KIAogdm9pZAogY2lmc193cml0ZXZfY29tcGxldGUoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEg
PSBjb250YWluZXJfb2Yod29yaywKLQkJCQkJCXN0cnVjdCBjaWZzX3dyaXRlZGF0YSwgd29yayk7
CisJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEgPSBjb250YWluZXJfb2Yod29yaywK
KwkJCQkJCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QsIHdvcmspOwogCXN0cnVjdCBpbm9kZSAq
aW5vZGUgPSBkX2lub2RlKHdkYXRhLT5jZmlsZS0+ZGVudHJ5KTsKIAogCWlmICh3ZGF0YS0+cmVz
dWx0ID09IDApIHsKQEAgLTI1NDEsMTYgKzI1NDAsMTYgQEAgY2lmc193cml0ZXZfY29tcGxldGUo
c3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCiAJaWYgKHdkYXRhLT5yZXN1bHQgIT0gLUVBR0FJ
TikKIAkJbWFwcGluZ19zZXRfZXJyb3IoaW5vZGUtPmlfbWFwcGluZywgd2RhdGEtPnJlc3VsdCk7
Ci0Ja3JlZl9wdXQoJndkYXRhLT5yZWZjb3VudCwgY2lmc193cml0ZWRhdGFfcmVsZWFzZSk7CisJ
Y2lmc19wdXRfd3JpdGVkYXRhKHdkYXRhKTsKIH0KIAotc3RydWN0IGNpZnNfd3JpdGVkYXRhICpj
aWZzX3dyaXRlZGF0YV9hbGxvYyh3b3JrX2Z1bmNfdCBjb21wbGV0ZSkKK3N0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKmNpZnNfd3JpdGVkYXRhX2FsbG9jKHdvcmtfZnVuY190IGNvbXBsZXRlKQog
ewotCXN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGE7CisJc3RydWN0IGNpZnNfaW9fc3VicmVx
dWVzdCAqd2RhdGE7CiAKIAl3ZGF0YSA9IGt6YWxsb2Moc2l6ZW9mKCp3ZGF0YSksIEdGUF9OT0ZT
KTsKIAlpZiAod2RhdGEgIT0gTlVMTCkgewotCQlrcmVmX2luaXQoJndkYXRhLT5yZWZjb3VudCk7
CisJCXJlZmNvdW50X3NldCgmd2RhdGEtPnN1YnJlcS5yZWYsIDEpOwogCQlJTklUX0xJU1RfSEVB
RCgmd2RhdGEtPmxpc3QpOwogCQlpbml0X2NvbXBsZXRpb24oJndkYXRhLT5kb25lKTsKIAkJSU5J
VF9XT1JLKCZ3ZGF0YS0+d29yaywgY29tcGxldGUpOwpAQCAtMjczMSw3ICsyNzMwLDcgQEAgc3Rh
dGljIHNzaXplX3QgY2lmc193cml0ZV9iYWNrX2Zyb21fbG9ja2VkX2ZvbGlvKHN0cnVjdCBhZGRy
ZXNzX3NwYWNlICptYXBwaW5nLAogewogCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBtYXBwaW5nLT5o
b3N0OwogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlcjsKLQlzdHJ1Y3QgY2lmc193cml0
ZWRhdGEgKndkYXRhOworCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhOwogCXN0cnVj
dCBjaWZzX3NiX2luZm8gKmNpZnNfc2IgPSBDSUZTX1NCKGlub2RlLT5pX3NiKTsKIAlzdHJ1Y3Qg
Y2lmc19jcmVkaXRzIGNyZWRpdHNfb25fc3RhY2s7CiAJc3RydWN0IGNpZnNfY3JlZGl0cyAqY3Jl
ZGl0cyA9ICZjcmVkaXRzX29uX3N0YWNrOwpAQCAtMjgyMywxMCArMjgyMiw5IEBAIHN0YXRpYyBz
c2l6ZV90IGNpZnNfd3JpdGVfYmFja19mcm9tX2xvY2tlZF9mb2xpbyhzdHJ1Y3QgYWRkcmVzc19z
cGFjZSAqbWFwcGluZywKIAkJaWYgKHdkYXRhLT5jZmlsZS0+aW52YWxpZEhhbmRsZSkKIAkJCXJj
ID0gLUVBR0FJTjsKIAkJZWxzZQotCQkJcmMgPSB3ZGF0YS0+c2VydmVyLT5vcHMtPmFzeW5jX3dy
aXRldih3ZGF0YSwKLQkJCQkJCQkgICAgICBjaWZzX3dyaXRlZGF0YV9yZWxlYXNlKTsKKwkJCXJj
ID0gd2RhdGEtPnNlcnZlci0+b3BzLT5hc3luY193cml0ZXYod2RhdGEpOwogCQlpZiAocmMgPj0g
MCkgewotCQkJa3JlZl9wdXQoJndkYXRhLT5yZWZjb3VudCwgY2lmc193cml0ZWRhdGFfcmVsZWFz
ZSk7CisJCQljaWZzX3B1dF93cml0ZWRhdGEod2RhdGEpOwogCQkJZ290byBlcnJfY2xvc2U7CiAJ
CX0KIAl9IGVsc2UgewpAQCAtMjgzNiw3ICsyODM0LDcgQEAgc3RhdGljIHNzaXplX3QgY2lmc193
cml0ZV9iYWNrX2Zyb21fbG9ja2VkX2ZvbGlvKHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5n
LAogCX0KIAogZXJyX3dkYXRhOgotCWtyZWZfcHV0KCZ3ZGF0YS0+cmVmY291bnQsIGNpZnNfd3Jp
dGVkYXRhX3JlbGVhc2UpOworCWNpZnNfcHV0X3dyaXRlZGF0YSh3ZGF0YSk7CiBlcnJfdW5jcmVk
aXQ6CiAJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYoc2VydmVyLCBjcmVkaXRzLCAwKTsKIGVycl9j
bG9zZToKQEAgLTMyMjUsMjMgKzMyMjMsMTMgQEAgaW50IGNpZnNfZmx1c2goc3RydWN0IGZpbGUg
KmZpbGUsIGZsX293bmVyX3QgaWQpCiAJcmV0dXJuIHJjOwogfQogCi1zdGF0aWMgdm9pZAotY2lm
c191bmNhY2hlZF93cml0ZWRhdGFfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmY291bnQpCi17Ci0J
c3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSA9IGNvbnRhaW5lcl9vZihyZWZjb3VudCwKLQkJ
CQkJc3RydWN0IGNpZnNfd3JpdGVkYXRhLCByZWZjb3VudCk7Ci0KLQlrcmVmX3B1dCgmd2RhdGEt
PmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLQljaWZzX3dyaXRlZGF0YV9y
ZWxlYXNlKHJlZmNvdW50KTsKLX0KLQogc3RhdGljIHZvaWQgY29sbGVjdF91bmNhY2hlZF93cml0
ZV9kYXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCk7CiAKIHN0YXRpYyB2b2lkCiBjaWZzX3Vu
Y2FjaGVkX3dyaXRldl9jb21wbGV0ZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3Ry
dWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSA9IGNvbnRhaW5lcl9vZih3b3JrLAotCQkJCQlzdHJ1
Y3QgY2lmc193cml0ZWRhdGEsIHdvcmspOworCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndk
YXRhID0gY29udGFpbmVyX29mKHdvcmssCisJCQkJCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3Qs
IHdvcmspOwogCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBkX2lub2RlKHdkYXRhLT5jZmlsZS0+ZGVu
dHJ5KTsKIAlzdHJ1Y3QgY2lmc0lub2RlSW5mbyAqY2lmc2kgPSBDSUZTX0koaW5vZGUpOwogCkBA
IC0zMjU0LDExICszMjQyLDExIEBAIGNpZnNfdW5jYWNoZWRfd3JpdGV2X2NvbXBsZXRlKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykKIAljb21wbGV0ZSgmd2RhdGEtPmRvbmUpOwogCWNvbGxlY3Rf
dW5jYWNoZWRfd3JpdGVfZGF0YSh3ZGF0YS0+Y3R4KTsKIAkvKiB0aGUgYmVsb3cgY2FsbCBjYW4g
cG9zc2libHkgZnJlZSB0aGUgbGFzdCByZWYgdG8gYWlvIGN0eCAqLwotCWtyZWZfcHV0KCZ3ZGF0
YS0+cmVmY291bnQsIGNpZnNfdW5jYWNoZWRfd3JpdGVkYXRhX3JlbGVhc2UpOworCWNpZnNfcHV0
X3dyaXRlZGF0YSh3ZGF0YSk7CiB9CiAKIHN0YXRpYyBpbnQKLWNpZnNfcmVzZW5kX3dkYXRhKHN0
cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEsIHN0cnVjdCBsaXN0X2hlYWQgKndkYXRhX2xpc3Qs
CitjaWZzX3Jlc2VuZF93ZGF0YShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSwgc3Ry
dWN0IGxpc3RfaGVhZCAqd2RhdGFfbGlzdCwKIAlzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCiB7
CiAJdW5zaWduZWQgaW50IHdzaXplOwpAQCAtMzMwNyw4ICszMjk1LDcgQEAgY2lmc19yZXNlbmRf
d2RhdGEoc3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSwgc3RydWN0IGxpc3RfaGVhZCAqd2Rh
dGFfbGlzdCwKIAkJCQkJd2RhdGEtPm1yID0gTlVMTDsKIAkJCQl9CiAjZW5kaWYKLQkJCQlyYyA9
IHNlcnZlci0+b3BzLT5hc3luY193cml0ZXYod2RhdGEsCi0JCQkJCWNpZnNfdW5jYWNoZWRfd3Jp
dGVkYXRhX3JlbGVhc2UpOworCQkJCXJjID0gc2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0
YSk7CiAJCQl9CiAJCX0KIApAQCAtMzMyMyw3ICszMzEwLDcgQEAgY2lmc19yZXNlbmRfd2RhdGEo
c3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSwgc3RydWN0IGxpc3RfaGVhZCAqd2RhdGFfbGlz
dCwKIAl9IHdoaWxlIChyYyA9PSAtRUFHQUlOKTsKIAogZmFpbDoKLQlrcmVmX3B1dCgmd2RhdGEt
PnJlZmNvdW50LCBjaWZzX3VuY2FjaGVkX3dyaXRlZGF0YV9yZWxlYXNlKTsKKwljaWZzX3B1dF93
cml0ZWRhdGEod2RhdGEpOwogCXJldHVybiByYzsKIH0KIApAQCAtMzM3NSw3ICszMzYyLDcgQEAg
Y2lmc193cml0ZV9mcm9tX2l0ZXIobG9mZl90IGZwb3MsIHNpemVfdCBsZW4sIHN0cnVjdCBpb3Zf
aXRlciAqZnJvbSwKIHsKIAlpbnQgcmMgPSAwOwogCXNpemVfdCBjdXJfbGVuLCBtYXhfbGVuOwot
CXN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGE7CisJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVz
dCAqd2RhdGE7CiAJcGlkX3QgcGlkOwogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlcjsK
IAl1bnNpZ25lZCBpbnQgeGlkLCBtYXhfc2VncyA9IElOVF9NQVg7CkBAIC0zNDM5LDYgKzM0MjYs
NyBAQCBjaWZzX3dyaXRlX2Zyb21faXRlcihsb2ZmX3QgZnBvcywgc2l6ZV90IGxlbiwgc3RydWN0
IGlvdl9pdGVyICpmcm9tLAogCQkJYnJlYWs7CiAJCX0KIAorCQl3ZGF0YS0+dW5jYWNoZWQJPSB0
cnVlOwogCQl3ZGF0YS0+c3luY19tb2RlID0gV0JfU1lOQ19BTEw7CiAJCXdkYXRhLT5vZmZzZXQJ
PSAoX191NjQpZnBvczsKIAkJd2RhdGEtPmNmaWxlCT0gY2lmc0ZpbGVJbmZvX2dldChvcGVuX2Zp
bGUpOwpAQCAtMzQ1OCwxNCArMzQ0NiwxMiBAQCBjaWZzX3dyaXRlX2Zyb21faXRlcihsb2ZmX3Qg
ZnBvcywgc2l6ZV90IGxlbiwgc3RydWN0IGlvdl9pdGVyICpmcm9tLAogCQkJaWYgKHdkYXRhLT5j
ZmlsZS0+aW52YWxpZEhhbmRsZSkKIAkJCQlyYyA9IC1FQUdBSU47CiAJCQllbHNlCi0JCQkJcmMg
PSBzZXJ2ZXItPm9wcy0+YXN5bmNfd3JpdGV2KHdkYXRhLAotCQkJCQljaWZzX3VuY2FjaGVkX3dy
aXRlZGF0YV9yZWxlYXNlKTsKKwkJCQlyYyA9IHNlcnZlci0+b3BzLT5hc3luY193cml0ZXYod2Rh
dGEpOwogCQl9CiAKIAkJaWYgKHJjKSB7CiAJCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2
ZXIsICZ3ZGF0YS0+Y3JlZGl0cywgMCk7Ci0JCQlrcmVmX3B1dCgmd2RhdGEtPnJlZmNvdW50LAot
CQkJCSBjaWZzX3VuY2FjaGVkX3dyaXRlZGF0YV9yZWxlYXNlKTsKKwkJCWNpZnNfcHV0X3dyaXRl
ZGF0YSh3ZGF0YSk7CiAJCQlpZiAocmMgPT0gLUVBR0FJTikKIAkJCQljb250aW51ZTsKIAkJCWJy
ZWFrOwpAQCAtMzQ4Myw3ICszNDY5LDcgQEAgY2lmc193cml0ZV9mcm9tX2l0ZXIobG9mZl90IGZw
b3MsIHNpemVfdCBsZW4sIHN0cnVjdCBpb3ZfaXRlciAqZnJvbSwKIAogc3RhdGljIHZvaWQgY29s
bGVjdF91bmNhY2hlZF93cml0ZV9kYXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCkKIHsKLQlz
dHJ1Y3QgY2lmc193cml0ZWRhdGEgKndkYXRhLCAqdG1wOworCXN0cnVjdCBjaWZzX2lvX3N1YnJl
cXVlc3QgKndkYXRhLCAqdG1wOwogCXN0cnVjdCBjaWZzX3Rjb24gKnRjb247CiAJc3RydWN0IGNp
ZnNfc2JfaW5mbyAqY2lmc19zYjsKIAlzdHJ1Y3QgZGVudHJ5ICpkZW50cnkgPSBjdHgtPmNmaWxl
LT5kZW50cnk7CkBAIC0zNTM4LDggKzM1MjQsNyBAQCBzdGF0aWMgdm9pZCBjb2xsZWN0X3VuY2Fj
aGVkX3dyaXRlX2RhdGEoc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4KQogCQkJCQkJY3R4LT5jZmls
ZSwgY2lmc19zYiwgJnRtcF9saXN0LAogCQkJCQkJY3R4KTsKIAotCQkJCQlrcmVmX3B1dCgmd2Rh
dGEtPnJlZmNvdW50LAotCQkJCQkJY2lmc191bmNhY2hlZF93cml0ZWRhdGFfcmVsZWFzZSk7CisJ
CQkJCWNpZnNfcHV0X3dyaXRlZGF0YSh3ZGF0YSk7CiAJCQkJfQogCiAJCQkJbGlzdF9zcGxpY2Uo
JnRtcF9saXN0LCAmY3R4LT5saXN0KTsKQEAgLTM1NDcsNyArMzUzMiw3IEBAIHN0YXRpYyB2b2lk
IGNvbGxlY3RfdW5jYWNoZWRfd3JpdGVfZGF0YShzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCiAJ
CQl9CiAJCX0KIAkJbGlzdF9kZWxfaW5pdCgmd2RhdGEtPmxpc3QpOwotCQlrcmVmX3B1dCgmd2Rh
dGEtPnJlZmNvdW50LCBjaWZzX3VuY2FjaGVkX3dyaXRlZGF0YV9yZWxlYXNlKTsKKwkJY2lmc19w
dXRfd3JpdGVkYXRhKHdkYXRhKTsKIAl9CiAKIAljaWZzX3N0YXRzX2J5dGVzX3dyaXR0ZW4odGNv
biwgY3R4LT50b3RhbF9sZW4pOwpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9zbWIycGR1LmMg
Yi9mcy9zbWIvY2xpZW50L3NtYjJwZHUuYwppbmRleCAzNWFmYzdlNTAwYTQuLjE2YWY0ZDJmY2Vj
MiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9zbWIycGR1LmMKKysrIGIvZnMvc21iL2NsaWVu
dC9zbWIycGR1LmMKQEAgLTQ1NzQsNyArNDU3NCw3IEBAIFNNQjJfcmVhZChjb25zdCB1bnNpZ25l
ZCBpbnQgeGlkLCBzdHJ1Y3QgY2lmc19pb19wYXJtcyAqaW9fcGFybXMsCiBzdGF0aWMgdm9pZAog
c21iMl93cml0ZXZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiB7Ci0Jc3RydWN0
IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSA9IG1pZC0+Y2FsbGJhY2tfZGF0YTsKKwlzdHJ1Y3QgY2lm
c19pb19zdWJyZXF1ZXN0ICp3ZGF0YSA9IG1pZC0+Y2FsbGJhY2tfZGF0YTsKIAlzdHJ1Y3QgY2lm
c190Y29uICp0Y29uID0gdGxpbmtfdGNvbih3ZGF0YS0+Y2ZpbGUtPnRsaW5rKTsKIAlzdHJ1Y3Qg
VENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIgPSB3ZGF0YS0+c2VydmVyOwogCXVuc2lnbmVkIGludCB3
cml0dGVuOwpAQCAtNDY1NSw4ICs0NjU1LDcgQEAgc21iMl93cml0ZXZfY2FsbGJhY2soc3RydWN0
IG1pZF9xX2VudHJ5ICptaWQpCiAKIC8qIHNtYjJfYXN5bmNfd3JpdGV2IC0gc2VuZCBhbiBhc3lu
YyB3cml0ZSwgYW5kIHNldCB1cCBtaWQgdG8gaGFuZGxlIHJlc3VsdCAqLwogaW50Ci1zbWIyX2Fz
eW5jX3dyaXRldihzdHJ1Y3QgY2lmc193cml0ZWRhdGEgKndkYXRhLAotCQkgIHZvaWQgKCpyZWxl
YXNlKShzdHJ1Y3Qga3JlZiAqa3JlZikpCitzbWIyX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lmc19p
b19zdWJyZXF1ZXN0ICp3ZGF0YSkKIHsKIAlpbnQgcmMgPSAtRUFDQ0VTLCBmbGFncyA9IDA7CiAJ
c3RydWN0IHNtYjJfd3JpdGVfcmVxICpyZXEgPSBOVUxMOwpAQCAtNDc4OCw3ICs0Nzg3LDcgQEAg
c21iMl9hc3luY193cml0ZXYoc3RydWN0IGNpZnNfd3JpdGVkYXRhICp3ZGF0YSwKIAkJZmxhZ3Mg
fD0gQ0lGU19IQVNfQ1JFRElUUzsKIAl9CiAKLQlrcmVmX2dldCgmd2RhdGEtPnJlZmNvdW50KTsK
KwljaWZzX2dldF93cml0ZWRhdGEod2RhdGEpOwogCXJjID0gY2lmc19jYWxsX2FzeW5jKHNlcnZl
ciwgJnJxc3QsIE5VTEwsIHNtYjJfd3JpdGV2X2NhbGxiYWNrLCBOVUxMLAogCQkJICAgICB3ZGF0
YSwgZmxhZ3MsICZ3ZGF0YS0+Y3JlZGl0cyk7CiAKQEAgLTQ4MDAsNyArNDc5OSw3IEBAIHNtYjJf
YXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEsCiAJCQkJICAgICBpb19w
YXJtcy0+b2Zmc2V0LAogCQkJCSAgICAgaW9fcGFybXMtPmxlbmd0aCwKIAkJCQkgICAgIHJjKTsK
LQkJa3JlZl9wdXQoJndkYXRhLT5yZWZjb3VudCwgcmVsZWFzZSk7CisJCWNpZnNfcHV0X3dyaXRl
ZGF0YSh3ZGF0YSk7CiAJCWNpZnNfc3RhdHNfZmFpbF9pbmModGNvbiwgU01CMl9XUklURV9IRSk7
CiAJfQogCmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L3NtYjJwcm90by5oIGIvZnMvc21iL2Ns
aWVudC9zbWIycHJvdG8uaAppbmRleCA2MTE2YTgwM2Y2Y2YuLjI3M2YwOGMxYjM2NyAxMDA2NDQK
LS0tIGEvZnMvc21iL2NsaWVudC9zbWIycHJvdG8uaAorKysgYi9mcy9zbWIvY2xpZW50L3NtYjJw
cm90by5oCkBAIC0yMDUsOCArMjA1LDcgQEAgZXh0ZXJuIGludCBTTUIyX2dldF9zcnZfbnVtKGNv
bnN0IHVuc2lnbmVkIGludCB4aWQsIHN0cnVjdCBjaWZzX3Rjb24gKnRjb24sCiBleHRlcm4gaW50
IHNtYjJfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEpOwogZXh0
ZXJuIGludCBTTUIyX3JlYWQoY29uc3QgdW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfaW9f
cGFybXMgKmlvX3Bhcm1zLAogCQkgICAgIHVuc2lnbmVkIGludCAqbmJ5dGVzLCBjaGFyICoqYnVm
LCBpbnQgKmJ1Zl90eXBlKTsKLWV4dGVybiBpbnQgc21iMl9hc3luY193cml0ZXYoc3RydWN0IGNp
ZnNfd3JpdGVkYXRhICp3ZGF0YSwKLQkJCSAgICAgdm9pZCAoKnJlbGVhc2UpKHN0cnVjdCBrcmVm
ICprcmVmKSk7CitleHRlcm4gaW50IHNtYjJfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX2lvX3N1
YnJlcXVlc3QgKndkYXRhKTsKIGV4dGVybiBpbnQgU01CMl93cml0ZShjb25zdCB1bnNpZ25lZCBp
bnQgeGlkLCBzdHJ1Y3QgY2lmc19pb19wYXJtcyAqaW9fcGFybXMsCiAJCSAgICAgIHVuc2lnbmVk
IGludCAqbmJ5dGVzLCBzdHJ1Y3Qga3ZlYyAqaW92LCBpbnQgbl92ZWMpOwogZXh0ZXJuIGludCBT
TUIyX2VjaG8oc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyKTsKLS0gCjIuNDAuMQoK
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0006-cifs-Make-wait_mtu_credits-take-size_t-args.patch"
Content-Disposition: attachment; 
	filename="0006-cifs-Make-wait_mtu_credits-take-size_t-args.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46a2>
X-Attachment-Id: f_lrpgn46a2

RnJvbSA3NDVjMDJkOWRiZTU0NGFlOTE5Y2NlN2U1MmJlODQ5MDE4YmY2N2ZmIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTg6MjA6MzkgKzAxMDAKU3ViamVjdDogW1BBVENIIDA2LzEy
XSBjaWZzOiBNYWtlIHdhaXRfbXR1X2NyZWRpdHMgdGFrZSBzaXplX3QgYXJncwoKTWFrZSB0aGUg
d2FpdF9tdHVfY3JlZGl0cyBmdW5jdGlvbnMgdXNlIHNpemVfdCBmb3IgdGhlIHNpemUgYW5kIG51
bQphcmd1bWVudHMgcmF0aGVyIHRoYW4gdW5zaWduZWQgaW50IGFzIG5ldGZzbGliIHVzZXMgc2l6
ZV90L3NzaXplX3QgZm9yCmFyZ3VtZW50cyBhbmQgcmV0dXJuIHZhbHVlcyB0byBhbGxvdyBmb3Ig
ZXh0cmEgY2FwYWNpdHkuCgpTaWduZWQtb2ZmLWJ5OiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0By
ZWRoYXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1hbmdhbG9yZUBnbWFpbC5jb20+CmNj
OiBSb2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBnbWFpbC5jb20+CmNjOiBKZWZmIExh
eXRvbiA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgtY2lmc0B2Z2VyLmtlcm5lbC5vcmcK
Y2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGludXgtZnNkZXZlbEB2Z2VyLmtlcm5l
bC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZzL3NtYi9jbGllbnQvY2lmc2dsb2Iu
aCAgfCAgNCArKy0tCiBmcy9zbWIvY2xpZW50L2NpZnNwcm90by5oIHwgIDIgKy0KIGZzL3NtYi9j
bGllbnQvZmlsZS5jICAgICAgfCAxOCArKysrKysrKysrLS0tLS0tLS0KIGZzL3NtYi9jbGllbnQv
c21iMm9wcy5jICAgfCAgNCArKy0tCiBmcy9zbWIvY2xpZW50L3RyYW5zcG9ydC5jIHwgIDQgKyst
LQogNSBmaWxlcyBjaGFuZ2VkLCAxNyBpbnNlcnRpb25zKCspLCAxNSBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmggYi9mcy9zbWIvY2xpZW50L2NpZnNn
bG9iLmgKaW5kZXggYzRjZGMwMTI5MDAwLi4zNDE0NTFlMWY5NDQgMTAwNjQ0Ci0tLSBhL2ZzL3Nt
Yi9jbGllbnQvY2lmc2dsb2IuaAorKysgYi9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmgKQEAgLTUy
OCw4ICs1MjgsOCBAQCBzdHJ1Y3Qgc21iX3ZlcnNpb25fb3BlcmF0aW9ucyB7CiAJLyogd3JpdGVw
YWdlcyByZXRyeSBzaXplICovCiAJdW5zaWduZWQgaW50ICgqd3BfcmV0cnlfc2l6ZSkoc3RydWN0
IGlub2RlICopOwogCS8qIGdldCBtdHUgY3JlZGl0cyAqLwotCWludCAoKndhaXRfbXR1X2NyZWRp
dHMpKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKiwgdW5zaWduZWQgaW50LAotCQkJCXVuc2lnbmVk
IGludCAqLCBzdHJ1Y3QgY2lmc19jcmVkaXRzICopOworCWludCAoKndhaXRfbXR1X2NyZWRpdHMp
KHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKiwgc2l6ZV90LAorCQkJCXNpemVfdCAqLCBzdHJ1Y3Qg
Y2lmc19jcmVkaXRzICopOwogCS8qIGFkanVzdCBwcmV2aW91c2x5IHRha2VuIG10dSBjcmVkaXRz
IHRvIHJlcXVlc3Qgc2l6ZSAqLwogCWludCAoKmFkanVzdF9jcmVkaXRzKShzdHJ1Y3QgVENQX1Nl
cnZlcl9JbmZvICpzZXJ2ZXIsCiAJCQkgICAgICBzdHJ1Y3QgY2lmc19jcmVkaXRzICpjcmVkaXRz
LApkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8uaCBiL2ZzL3NtYi9jbGllbnQv
Y2lmc3Byb3RvLmgKaW5kZXggOWZmNzU5ZDQ4NTdhLi4wNGYzMThhMGEyZDcgMTAwNjQ0Ci0tLSBh
L2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmgKKysrIGIvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8u
aApAQCAtMTIxLDcgKzEyMSw3IEBAIGV4dGVybiBzdHJ1Y3QgbWlkX3FfZW50cnkgKmNpZnNfc2V0
dXBfYXN5bmNfcmVxdWVzdChzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICosCiBleHRlcm4gaW50IGNp
ZnNfY2hlY2tfcmVjZWl2ZShzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCwKIAkJCXN0cnVjdCBUQ1Bf
U2VydmVyX0luZm8gKnNlcnZlciwgYm9vbCBsb2dfZXJyb3IpOwogZXh0ZXJuIGludCBjaWZzX3dh
aXRfbXR1X2NyZWRpdHMoc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLAotCQkJCSB1bnNp
Z25lZCBpbnQgc2l6ZSwgdW5zaWduZWQgaW50ICpudW0sCisJCQkJIHNpemVfdCBzaXplLCBzaXpl
X3QgKm51bSwKIAkJCQkgc3RydWN0IGNpZnNfY3JlZGl0cyAqY3JlZGl0cyk7CiBleHRlcm4gaW50
IFNlbmRSZWNlaXZlMihjb25zdCB1bnNpZ25lZCBpbnQgLyogeGlkICovICwgc3RydWN0IGNpZnNf
c2VzICosCiAJCQlzdHJ1Y3Qga3ZlYyAqLCBpbnQgLyogbnZlYyB0byBzZW5kICovLApkaWZmIC0t
Z2l0IGEvZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9zbWIvY2xpZW50L2ZpbGUuYwppbmRleCBm
N2NiOGQ5YTM0NzcuLjE3NmZlNGVlNzc3NiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9maWxl
LmMKKysrIGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAgLTI3MzUsOSArMjczNSw5IEBAIHN0YXRp
YyBzc2l6ZV90IGNpZnNfd3JpdGVfYmFja19mcm9tX2xvY2tlZF9mb2xpbyhzdHJ1Y3QgYWRkcmVz
c19zcGFjZSAqbWFwcGluZywKIAlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHNfb25fc3RhY2s7
CiAJc3RydWN0IGNpZnNfY3JlZGl0cyAqY3JlZGl0cyA9ICZjcmVkaXRzX29uX3N0YWNrOwogCXN0
cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlID0gTlVMTDsKLQl1bnNpZ25lZCBpbnQgeGlkLCB3c2l6
ZSwgbGVuOworCXVuc2lnbmVkIGludCB4aWQsIGxlbjsKIAlsb2ZmX3QgaV9zaXplID0gaV9zaXpl
X3JlYWQoaW5vZGUpOwotCXNpemVfdCBtYXhfbGVuOworCXNpemVfdCBtYXhfbGVuLCB3c2l6ZTsK
IAlsb25nIGNvdW50ID0gd2JjLT5ucl90b193cml0ZTsKIAlpbnQgcmM7CiAKQEAgLTMyNDksNyAr
MzI0OSw3IEBAIHN0YXRpYyBpbnQKIGNpZnNfcmVzZW5kX3dkYXRhKHN0cnVjdCBjaWZzX2lvX3N1
YnJlcXVlc3QgKndkYXRhLCBzdHJ1Y3QgbGlzdF9oZWFkICp3ZGF0YV9saXN0LAogCXN0cnVjdCBj
aWZzX2Fpb19jdHggKmN0eCkKIHsKLQl1bnNpZ25lZCBpbnQgd3NpemU7CisJc2l6ZV90IHdzaXpl
OwogCXN0cnVjdCBjaWZzX2NyZWRpdHMgY3JlZGl0czsKIAlpbnQgcmM7CiAJc3RydWN0IFRDUF9T
ZXJ2ZXJfSW5mbyAqc2VydmVyID0gd2RhdGEtPnNlcnZlcjsKQEAgLTMzODMsNyArMzM4Myw4IEBA
IGNpZnNfd3JpdGVfZnJvbV9pdGVyKGxvZmZfdCBmcG9zLCBzaXplX3QgbGVuLCBzdHJ1Y3QgaW92
X2l0ZXIgKmZyb20sCiAJZG8gewogCQlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHNfb25fc3Rh
Y2s7CiAJCXN0cnVjdCBjaWZzX2NyZWRpdHMgKmNyZWRpdHMgPSAmY3JlZGl0c19vbl9zdGFjazsK
LQkJdW5zaWduZWQgaW50IHdzaXplLCBuc2VncyA9IDA7CisJCXVuc2lnbmVkIGludCBuc2VncyA9
IDA7CisJCXNpemVfdCB3c2l6ZTsKIAogCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpIHsK
IAkJCXJjID0gLUVJTlRSOwpAQCAtMzgyMCw3ICszODIxLDcgQEAgc3RhdGljIGludCBjaWZzX3Jl
c2VuZF9yZGF0YShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSwKIAkJCXN0cnVjdCBs
aXN0X2hlYWQgKnJkYXRhX2xpc3QsCiAJCQlzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCiB7Ci0J
dW5zaWduZWQgaW50IHJzaXplOworCXNpemVfdCByc2l6ZTsKIAlzdHJ1Y3QgY2lmc19jcmVkaXRz
IGNyZWRpdHM7CiAJaW50IHJjOwogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlcjsKQEAg
LTM4OTQsMTAgKzM4OTUsMTAgQEAgY2lmc19zZW5kX2FzeW5jX3JlYWQobG9mZl90IGZwb3MsIHNp
emVfdCBsZW4sIHN0cnVjdCBjaWZzRmlsZUluZm8gKm9wZW5fZmlsZSwKIAkJICAgICBzdHJ1Y3Qg
Y2lmc19haW9fY3R4ICpjdHgpCiB7CiAJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGE7
Ci0JdW5zaWduZWQgaW50IHJzaXplLCBuc2VncywgbWF4X3NlZ3MgPSBJTlRfTUFYOworCXVuc2ln
bmVkIGludCBuc2VncywgbWF4X3NlZ3MgPSBJTlRfTUFYOwogCXN0cnVjdCBjaWZzX2NyZWRpdHMg
Y3JlZGl0c19vbl9zdGFjazsKIAlzdHJ1Y3QgY2lmc19jcmVkaXRzICpjcmVkaXRzID0gJmNyZWRp
dHNfb25fc3RhY2s7Ci0Jc2l6ZV90IGN1cl9sZW4sIG1heF9sZW47CisJc2l6ZV90IGN1cl9sZW4s
IG1heF9sZW4sIHJzaXplOwogCWludCByYzsKIAlwaWRfdCBwaWQ7CiAJc3RydWN0IFRDUF9TZXJ2
ZXJfSW5mbyAqc2VydmVyOwpAQCAtNDQ5MywxMiArNDQ5NCwxMyBAQCBzdGF0aWMgdm9pZCBjaWZz
X3JlYWRhaGVhZChzdHJ1Y3QgcmVhZGFoZWFkX2NvbnRyb2wgKnJhY3RsKQogCSAqIENob3AgdGhl
IHJlYWRhaGVhZCByZXF1ZXN0IHVwIGludG8gcnNpemUtc2l6ZWQgcmVhZCByZXF1ZXN0cy4KIAkg
Ki8KIAl3aGlsZSAoKG5yX3BhZ2VzID0gcmFfcGFnZXMpKSB7Ci0JCXVuc2lnbmVkIGludCBpLCBy
c2l6ZTsKKwkJdW5zaWduZWQgaW50IGk7CiAJCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJk
YXRhOwogCQlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHNfb25fc3RhY2s7CiAJCXN0cnVjdCBj
aWZzX2NyZWRpdHMgKmNyZWRpdHMgPSAmY3JlZGl0c19vbl9zdGFjazsKIAkJc3RydWN0IGZvbGlv
ICpmb2xpbzsKIAkJcGdvZmZfdCBmc2l6ZTsKKwkJc2l6ZV90IHJzaXplOwogCiAJCS8qCiAJCSAq
IEZpbmQgb3V0IGlmIHdlIGhhdmUgYW55dGhpbmcgY2FjaGVkIGluIHRoZSByYW5nZSBvZgpkaWZm
IC0tZ2l0IGEvZnMvc21iL2NsaWVudC9zbWIyb3BzLmMgYi9mcy9zbWIvY2xpZW50L3NtYjJvcHMu
YwppbmRleCA0ZjIxOWJmOWI4NzQuLmM1Zjk5OWZkZjk0ZCAxMDA2NDQKLS0tIGEvZnMvc21iL2Ns
aWVudC9zbWIyb3BzLmMKKysrIGIvZnMvc21iL2NsaWVudC9zbWIyb3BzLmMKQEAgLTIxNiw4ICsy
MTYsOCBAQCBzbWIyX2dldF9jcmVkaXRzKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogfQogCiBz
dGF0aWMgaW50Ci1zbWIyX3dhaXRfbXR1X2NyZWRpdHMoc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAq
c2VydmVyLCB1bnNpZ25lZCBpbnQgc2l6ZSwKLQkJICAgICAgdW5zaWduZWQgaW50ICpudW0sIHN0
cnVjdCBjaWZzX2NyZWRpdHMgKmNyZWRpdHMpCitzbWIyX3dhaXRfbXR1X2NyZWRpdHMoc3RydWN0
IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzaXplX3Qgc2l6ZSwKKwkJICAgICAgc2l6ZV90ICpu
dW0sIHN0cnVjdCBjaWZzX2NyZWRpdHMgKmNyZWRpdHMpCiB7CiAJaW50IHJjID0gMDsKIAl1bnNp
Z25lZCBpbnQgc2NyZWRpdHMsIGluX2ZsaWdodDsKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQv
dHJhbnNwb3J0LmMgYi9mcy9zbWIvY2xpZW50L3RyYW5zcG9ydC5jCmluZGV4IDMwNDg1MTY1NzNl
OC4uNWNmNjUzNDYzYzU1IDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L3RyYW5zcG9ydC5jCisr
KyBiL2ZzL3NtYi9jbGllbnQvdHJhbnNwb3J0LmMKQEAgLTY4NCw4ICs2ODQsOCBAQCB3YWl0X2Zv
cl9jb21wb3VuZF9yZXF1ZXN0KHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgaW50IG51
bSwKIH0KIAogaW50Ci1jaWZzX3dhaXRfbXR1X2NyZWRpdHMoc3RydWN0IFRDUF9TZXJ2ZXJfSW5m
byAqc2VydmVyLCB1bnNpZ25lZCBpbnQgc2l6ZSwKLQkJICAgICAgdW5zaWduZWQgaW50ICpudW0s
IHN0cnVjdCBjaWZzX2NyZWRpdHMgKmNyZWRpdHMpCitjaWZzX3dhaXRfbXR1X2NyZWRpdHMoc3Ry
dWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzaXplX3Qgc2l6ZSwKKwkJICAgICAgc2l6ZV90
ICpudW0sIHN0cnVjdCBjaWZzX2NyZWRpdHMgKmNyZWRpdHMpCiB7CiAJKm51bSA9IHNpemU7CiAJ
Y3JlZGl0cy0+dmFsdWUgPSAwOwotLSAKMi40MC4xCgo=
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0010-cifs-Remove-some-code-that-s-no-longer-used-part-1.patch"
Content-Disposition: attachment; 
	filename="0010-cifs-Remove-some-code-that-s-no-longer-used-part-1.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46g9>
X-Attachment-Id: f_lrpgn46g9

RnJvbSAyYTdlNDQ5Mzk5ZmY1MDFhY2E5ZTYxZmU4ZGVhODY2MzZiZWU4NzE4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMjI6Mjc6MTUgKzAxMDAKU3ViamVjdDogW1BBVENIIDEwLzEy
XSBjaWZzOiBSZW1vdmUgc29tZSBjb2RlIHRoYXQncyBubyBsb25nZXIgdXNlZCwgcGFydCAxCgpS
ZW1vdmUgc29tZSBjb2RlIHRoYXQgd2FzICNpZidkIG91dCB3aXRoIHRoZSBuZXRmc2xpYiBjb252
ZXJzaW9uLiAgVGhpcyBpcwpzcGxpdCBpbnRvIHBhcnRzIGZvciBmaWxlLmMgYXMgdGhlIGRpZmYg
Z2VuZXJhdG9yIG90aGVyd2lzZSBwcm9kdWNlcyBhIGhhcmQKdG8gcmVhZCBkaWZmIGZvciBwYXJ0
IG9mIGl0IHdoZXJlIGEgYmlnIGNodW5rIGlzIGN1dCBvdXQuCgpTaWduZWQtb2ZmLWJ5OiBEYXZp
ZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1h
bmdhbG9yZUBnbWFpbC5jb20+CmNjOiBSb2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBn
bWFpbC5jb20+CmNjOiBKZWZmIExheXRvbiA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgt
Y2lmc0B2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGlu
dXgtZnNkZXZlbEB2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZz
L3NtYi9jbGllbnQvY2lmc2dsb2IuaCAgfCAgMTIgLQogZnMvc21iL2NsaWVudC9jaWZzcHJvdG8u
aCB8ICAyNSAtLQogZnMvc21iL2NsaWVudC9maWxlLmMgICAgICB8IDY0MCAtLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZnMvc21iL2NsaWVudC9mc2NhY2hlLmMgICB8IDEx
MSAtLS0tLS0tCiBmcy9zbWIvY2xpZW50L2ZzY2FjaGUuaCAgIHwgIDU4IC0tLS0KIDUgZmlsZXMg
Y2hhbmdlZCwgODQ2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lm
c2dsb2IuaCBiL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaAppbmRleCBiZTYxYjMwN2U0Y2QuLmE3
NWVjOGQzNTBlYSAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oCisrKyBiL2Zz
L3NtYi9jbGllbnQvY2lmc2dsb2IuaApAQCAtMTQ3OSwxOCArMTQ3OSw2IEBAIHN0cnVjdCBjaWZz
X2lvX3N1YnJlcXVlc3QgewogCXN0cnVjdCBzbWJkX21yCQkJKm1yOwogI2VuZGlmCiAJc3RydWN0
IGNpZnNfY3JlZGl0cwkJY3JlZGl0czsKLQotI2lmIDAgLy8gVE9ETzogUmVtb3ZlIGZvbGxvd2lu
ZyBlbGVtZW50cwotCXN0cnVjdCBsaXN0X2hlYWQJCWxpc3Q7Ci0Jc3RydWN0IGNvbXBsZXRpb24J
CWRvbmU7Ci0Jc3RydWN0IHdvcmtfc3RydWN0CQl3b3JrOwotCXN0cnVjdCBjaWZzRmlsZUluZm8J
CSpjZmlsZTsKLQlzdHJ1Y3QgYWRkcmVzc19zcGFjZQkJKm1hcHBpbmc7Ci0Jc3RydWN0IGNpZnNf
YWlvX2N0eAkJKmN0eDsKLQllbnVtIHdyaXRlYmFja19zeW5jX21vZGVzCXN5bmNfbW9kZTsKLQli
b29sCQkJCXVuY2FjaGVkOwotCXN0cnVjdCBiaW9fdmVjCQkJKmJ2OwotI2VuZGlmCiB9OwogCiAv
KgpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8uaCBiL2ZzL3NtYi9jbGllbnQv
Y2lmc3Byb3RvLmgKaW5kZXggN2FkZjA0MzkxMDZmLi5lMTk5Y2U1NGM5ZWMgMTAwNjQ0Ci0tLSBh
L2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmgKKysrIGIvZnMvc21iL2NsaWVudC9jaWZzcHJvdG8u
aApAQCAtNTk0LDM2ICs1OTQsMTEgQEAgdm9pZCBfX2NpZnNfcHV0X3NtYl9zZXMoc3RydWN0IGNp
ZnNfc2VzICpzZXMpOwogZXh0ZXJuIHN0cnVjdCBjaWZzX3NlcyAqCiBjaWZzX2dldF9zbWJfc2Vz
KHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgc3RydWN0IHNtYjNfZnNfY29udGV4dCAq
Y3R4KTsKIAotI2lmIDAgLy8gVE9ETyBSZW1vdmUKLXZvaWQgY2lmc19yZWFkZGF0YV9yZWxlYXNl
KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKTsKLXN0YXRpYyBpbmxpbmUgdm9pZCBj
aWZzX2dldF9yZWFkZGF0YShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKLXsKLQly
ZWZjb3VudF9pbmMoJnJkYXRhLT5zdWJyZXEucmVmKTsKLX0KLXN0YXRpYyBpbmxpbmUgdm9pZCBj
aWZzX3B1dF9yZWFkZGF0YShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKLXsKLQlp
ZiAocmVmY291bnRfZGVjX2FuZF90ZXN0KCZyZGF0YS0+c3VicmVxLnJlZikpCi0JCWNpZnNfcmVh
ZGRhdGFfcmVsZWFzZShyZGF0YSk7Ci19Ci0jZW5kaWYKIGludCBjaWZzX2FzeW5jX3JlYWR2KHN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKTsKIGludCBjaWZzX3JlYWR2X3JlY2VpdmUo
c3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCk7
CiAKIGludCBjaWZzX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0
YSk7CiB2b2lkIGNpZnNfd3JpdGV2X2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yayk7
Ci0jaWYgMCAvLyBUT0RPIFJlbW92ZQotc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqY2lmc193
cml0ZWRhdGFfYWxsb2Mod29ya19mdW5jX3QgY29tcGxldGUpOwotdm9pZCBjaWZzX3dyaXRlZGF0
YV9yZWxlYXNlKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKTsKLXN0YXRpYyBpbmxp
bmUgdm9pZCBjaWZzX2dldF93cml0ZWRhdGEoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2Rh
dGEpCi17Ci0JcmVmY291bnRfaW5jKCZ3ZGF0YS0+c3VicmVxLnJlZik7Ci19Ci1zdGF0aWMgaW5s
aW5lIHZvaWQgY2lmc19wdXRfd3JpdGVkYXRhKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndk
YXRhKQotewotCWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJndkYXRhLT5zdWJyZXEucmVmKSkK
LQkJY2lmc193cml0ZWRhdGFfcmVsZWFzZSh3ZGF0YSk7Ci19Ci0jZW5kaWYKIGludCBjaWZzX3F1
ZXJ5X21mX3N5bWxpbmsodW5zaWduZWQgaW50IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwK
IAkJCSAgc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYiwKIAkJCSAgY29uc3QgdW5zaWduZWQg
Y2hhciAqcGF0aCwgY2hhciAqcGJ1ZiwKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvZmlsZS5j
IGIvZnMvc21iL2NsaWVudC9maWxlLmMKaW5kZXggMjNkY2VjOWVjZmE0Li43OTI5NzNiNzM4YjYg
MTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvZmlsZS5jCisrKyBiL2ZzL3NtYi9jbGllbnQvZmls
ZS5jCkBAIC0zOTUsMTMzICszOTUsNiBAQCBjb25zdCBzdHJ1Y3QgbmV0ZnNfcmVxdWVzdF9vcHMg
Y2lmc19yZXFfb3BzID0gewogCS5jcmVhdGVfd3JpdGVfcmVxdWVzdHMJPSBjaWZzX2NyZWF0ZV93
cml0ZV9yZXF1ZXN0cywKIH07CiAKLSNpZiAwIC8vIFRPRE8gcmVtb3ZlIDM5NwotLyoKLSAqIFJl
bW92ZSB0aGUgZGlydHkgZmxhZ3MgZnJvbSBhIHNwYW4gb2YgcGFnZXMuCi0gKi8KLXN0YXRpYyB2
b2lkIGNpZnNfdW5kaXJ0eV9mb2xpb3Moc3RydWN0IGlub2RlICppbm9kZSwgbG9mZl90IHN0YXJ0
LCB1bnNpZ25lZCBpbnQgbGVuKQotewotCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0g
aW5vZGUtPmlfbWFwcGluZzsKLQlzdHJ1Y3QgZm9saW8gKmZvbGlvOwotCXBnb2ZmX3QgZW5kOwot
Ci0JWEFfU1RBVEUoeGFzLCAmbWFwcGluZy0+aV9wYWdlcywgc3RhcnQgLyBQQUdFX1NJWkUpOwot
Ci0JcmN1X3JlYWRfbG9jaygpOwotCi0JZW5kID0gKHN0YXJ0ICsgbGVuIC0gMSkgLyBQQUdFX1NJ
WkU7Ci0JeGFzX2Zvcl9lYWNoX21hcmtlZCgmeGFzLCBmb2xpbywgZW5kLCBQQUdFQ0FDSEVfVEFH
X0RJUlRZKSB7Ci0JCWlmICh4YXNfcmV0cnkoJnhhcywgZm9saW8pKQotCQkJY29udGludWU7Ci0J
CXhhc19wYXVzZSgmeGFzKTsKLQkJcmN1X3JlYWRfdW5sb2NrKCk7Ci0JCWZvbGlvX2xvY2soZm9s
aW8pOwotCQlmb2xpb19jbGVhcl9kaXJ0eV9mb3JfaW8oZm9saW8pOwotCQlmb2xpb191bmxvY2so
Zm9saW8pOwotCQlyY3VfcmVhZF9sb2NrKCk7Ci0JfQotCi0JcmN1X3JlYWRfdW5sb2NrKCk7Ci19
Ci0KLS8qCi0gKiBDb21wbGV0aW9uIG9mIHdyaXRlIHRvIHNlcnZlci4KLSAqLwotdm9pZCBjaWZz
X3BhZ2VzX3dyaXR0ZW5fYmFjayhzdHJ1Y3QgaW5vZGUgKmlub2RlLCBsb2ZmX3Qgc3RhcnQsIHVu
c2lnbmVkIGludCBsZW4pCi17Ci0Jc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcgPSBpbm9k
ZS0+aV9tYXBwaW5nOwotCXN0cnVjdCBmb2xpbyAqZm9saW87Ci0JcGdvZmZfdCBlbmQ7Ci0KLQlY
QV9TVEFURSh4YXMsICZtYXBwaW5nLT5pX3BhZ2VzLCBzdGFydCAvIFBBR0VfU0laRSk7Ci0KLQlp
ZiAoIWxlbikKLQkJcmV0dXJuOwotCi0JcmN1X3JlYWRfbG9jaygpOwotCi0JZW5kID0gKHN0YXJ0
ICsgbGVuIC0gMSkgLyBQQUdFX1NJWkU7Ci0JeGFzX2Zvcl9lYWNoKCZ4YXMsIGZvbGlvLCBlbmQp
IHsKLQkJaWYgKHhhc19yZXRyeSgmeGFzLCBmb2xpbykpCi0JCQljb250aW51ZTsKLQkJaWYgKCFm
b2xpb190ZXN0X3dyaXRlYmFjayhmb2xpbykpIHsKLQkJCVdBUk5fT05DRSgxLCAiYmFkICV4IEAl
bGx4IHBhZ2UgJWx4ICVseFxuIiwKLQkJCQkgIGxlbiwgc3RhcnQsIGZvbGlvX2luZGV4KGZvbGlv
KSwgZW5kKTsKLQkJCWNvbnRpbnVlOwotCQl9Ci0KLQkJZm9saW9fZGV0YWNoX3ByaXZhdGUoZm9s
aW8pOwotCQlmb2xpb19lbmRfd3JpdGViYWNrKGZvbGlvKTsKLQl9Ci0KLQlyY3VfcmVhZF91bmxv
Y2soKTsKLX0KLQotLyoKLSAqIEZhaWx1cmUgb2Ygd3JpdGUgdG8gc2VydmVyLgotICovCi12b2lk
IGNpZnNfcGFnZXNfd3JpdGVfZmFpbGVkKHN0cnVjdCBpbm9kZSAqaW5vZGUsIGxvZmZfdCBzdGFy
dCwgdW5zaWduZWQgaW50IGxlbikKLXsKLQlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZyA9
IGlub2RlLT5pX21hcHBpbmc7Ci0Jc3RydWN0IGZvbGlvICpmb2xpbzsKLQlwZ29mZl90IGVuZDsK
LQotCVhBX1NUQVRFKHhhcywgJm1hcHBpbmctPmlfcGFnZXMsIHN0YXJ0IC8gUEFHRV9TSVpFKTsK
LQotCWlmICghbGVuKQotCQlyZXR1cm47Ci0KLQlyY3VfcmVhZF9sb2NrKCk7Ci0KLQllbmQgPSAo
c3RhcnQgKyBsZW4gLSAxKSAvIFBBR0VfU0laRTsKLQl4YXNfZm9yX2VhY2goJnhhcywgZm9saW8s
IGVuZCkgewotCQlpZiAoeGFzX3JldHJ5KCZ4YXMsIGZvbGlvKSkKLQkJCWNvbnRpbnVlOwotCQlp
ZiAoIWZvbGlvX3Rlc3Rfd3JpdGViYWNrKGZvbGlvKSkgewotCQkJV0FSTl9PTkNFKDEsICJiYWQg
JXggQCVsbHggcGFnZSAlbHggJWx4XG4iLAotCQkJCSAgbGVuLCBzdGFydCwgZm9saW9faW5kZXgo
Zm9saW8pLCBlbmQpOwotCQkJY29udGludWU7Ci0JCX0KLQotCQlmb2xpb19zZXRfZXJyb3IoZm9s
aW8pOwotCQlmb2xpb19lbmRfd3JpdGViYWNrKGZvbGlvKTsKLQl9Ci0KLQlyY3VfcmVhZF91bmxv
Y2soKTsKLX0KLQotLyoKLSAqIFJlZGlydHkgcGFnZXMgYWZ0ZXIgYSB0ZW1wb3JhcnkgZmFpbHVy
ZS4KLSAqLwotdm9pZCBjaWZzX3BhZ2VzX3dyaXRlX3JlZGlydHkoc3RydWN0IGlub2RlICppbm9k
ZSwgbG9mZl90IHN0YXJ0LCB1bnNpZ25lZCBpbnQgbGVuKQotewotCXN0cnVjdCBhZGRyZXNzX3Nw
YWNlICptYXBwaW5nID0gaW5vZGUtPmlfbWFwcGluZzsKLQlzdHJ1Y3QgZm9saW8gKmZvbGlvOwot
CXBnb2ZmX3QgZW5kOwotCi0JWEFfU1RBVEUoeGFzLCAmbWFwcGluZy0+aV9wYWdlcywgc3RhcnQg
LyBQQUdFX1NJWkUpOwotCi0JaWYgKCFsZW4pCi0JCXJldHVybjsKLQotCXJjdV9yZWFkX2xvY2so
KTsKLQotCWVuZCA9IChzdGFydCArIGxlbiAtIDEpIC8gUEFHRV9TSVpFOwotCXhhc19mb3JfZWFj
aCgmeGFzLCBmb2xpbywgZW5kKSB7Ci0JCWlmICghZm9saW9fdGVzdF93cml0ZWJhY2soZm9saW8p
KSB7Ci0JCQlXQVJOX09OQ0UoMSwgImJhZCAleCBAJWxseCBwYWdlICVseCAlbHhcbiIsCi0JCQkJ
ICBsZW4sIHN0YXJ0LCBmb2xpb19pbmRleChmb2xpbyksIGVuZCk7Ci0JCQljb250aW51ZTsKLQkJ
fQotCi0JCWZpbGVtYXBfZGlydHlfZm9saW8oZm9saW8tPm1hcHBpbmcsIGZvbGlvKTsKLQkJZm9s
aW9fZW5kX3dyaXRlYmFjayhmb2xpbyk7Ci0JfQotCi0JcmN1X3JlYWRfdW5sb2NrKCk7Ci19Ci0j
ZW5kaWYgLy8gZW5kIG5ldGZzbGliIHJlbW92ZSAzOTcKLQogLyoKICAqIE1hcmsgYXMgaW52YWxp
ZCwgYWxsIG9wZW4gZmlsZXMgb24gdHJlZSBjb25uZWN0aW9ucyBzaW5jZSB0aGV5CiAgKiB3ZXJl
IGNsb3NlZCB3aGVuIHNlc3Npb24gdG8gc2VydmVyIHdhcyBsb3N0LgpAQCAtMjQ4Niw5MiArMjM1
OSw2IEBAIHZvaWQgY2lmc193cml0ZV9zdWJyZXF1ZXN0X3Rlcm1pbmF0ZWQoc3RydWN0IGNpZnNf
aW9fc3VicmVxdWVzdCAqd2RhdGEsIHNzaXplX3QKIAluZXRmc193cml0ZV9zdWJyZXF1ZXN0X3Rl
cm1pbmF0ZWQoJndkYXRhLT5zdWJyZXEsIHJlc3VsdCwgd2FzX2FzeW5jKTsKIH0KIAotI2lmIDAg
Ly8gVE9ETyByZW1vdmUgMjQ4Mwotc3RhdGljIHNzaXplX3QKLWNpZnNfd3JpdGUoc3RydWN0IGNp
ZnNGaWxlSW5mbyAqb3Blbl9maWxlLCBfX3UzMiBwaWQsIGNvbnN0IGNoYXIgKndyaXRlX2RhdGEs
Ci0JICAgc2l6ZV90IHdyaXRlX3NpemUsIGxvZmZfdCAqb2Zmc2V0KQotewotCWludCByYyA9IDA7
Ci0JdW5zaWduZWQgaW50IGJ5dGVzX3dyaXR0ZW4gPSAwOwotCXVuc2lnbmVkIGludCB0b3RhbF93
cml0dGVuOwotCXN0cnVjdCBjaWZzX3Rjb24gKnRjb247Ci0Jc3RydWN0IFRDUF9TZXJ2ZXJfSW5m
byAqc2VydmVyOwotCXVuc2lnbmVkIGludCB4aWQ7Ci0Jc3RydWN0IGRlbnRyeSAqZGVudHJ5ID0g
b3Blbl9maWxlLT5kZW50cnk7Ci0Jc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNpID0gQ0lGU19J
KGRfaW5vZGUoZGVudHJ5KSk7Ci0Jc3RydWN0IGNpZnNfaW9fcGFybXMgaW9fcGFybXMgPSB7MH07
Ci0KLQljaWZzX2RiZyhGWUksICJ3cml0ZSAlemQgYnl0ZXMgdG8gb2Zmc2V0ICVsbGQgb2YgJXBk
XG4iLAotCQkgd3JpdGVfc2l6ZSwgKm9mZnNldCwgZGVudHJ5KTsKLQotCXRjb24gPSB0bGlua190
Y29uKG9wZW5fZmlsZS0+dGxpbmspOwotCXNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOwotCi0J
aWYgKCFzZXJ2ZXItPm9wcy0+c3luY193cml0ZSkKLQkJcmV0dXJuIC1FTk9TWVM7Ci0KLQl4aWQg
PSBnZXRfeGlkKCk7Ci0KLQlmb3IgKHRvdGFsX3dyaXR0ZW4gPSAwOyB3cml0ZV9zaXplID4gdG90
YWxfd3JpdHRlbjsKLQkgICAgIHRvdGFsX3dyaXR0ZW4gKz0gYnl0ZXNfd3JpdHRlbikgewotCQly
YyA9IC1FQUdBSU47Ci0JCXdoaWxlIChyYyA9PSAtRUFHQUlOKSB7Ci0JCQlzdHJ1Y3Qga3ZlYyBp
b3ZbMl07Ci0JCQl1bnNpZ25lZCBpbnQgbGVuOwotCi0JCQlpZiAob3Blbl9maWxlLT5pbnZhbGlk
SGFuZGxlKSB7Ci0JCQkJLyogd2UgY291bGQgZGVhZGxvY2sgaWYgd2UgY2FsbGVkCi0JCQkJICAg
ZmlsZW1hcF9mZGF0YXdhaXQgZnJvbSBoZXJlIHNvIHRlbGwKLQkJCQkgICByZW9wZW5fZmlsZSBu
b3QgdG8gZmx1c2ggZGF0YSB0bwotCQkJCSAgIHNlcnZlciBub3cgKi8KLQkJCQlyYyA9IGNpZnNf
cmVvcGVuX2ZpbGUob3Blbl9maWxlLCBmYWxzZSk7Ci0JCQkJaWYgKHJjICE9IDApCi0JCQkJCWJy
ZWFrOwotCQkJfQotCi0JCQlsZW4gPSBtaW4oc2VydmVyLT5vcHMtPndwX3JldHJ5X3NpemUoZF9p
bm9kZShkZW50cnkpKSwKLQkJCQkgICh1bnNpZ25lZCBpbnQpd3JpdGVfc2l6ZSAtIHRvdGFsX3dy
aXR0ZW4pOwotCQkJLyogaW92WzBdIGlzIHJlc2VydmVkIGZvciBzbWIgaGVhZGVyICovCi0JCQlp
b3ZbMV0uaW92X2Jhc2UgPSAoY2hhciAqKXdyaXRlX2RhdGEgKyB0b3RhbF93cml0dGVuOwotCQkJ
aW92WzFdLmlvdl9sZW4gPSBsZW47Ci0JCQlpb19wYXJtcy5waWQgPSBwaWQ7Ci0JCQlpb19wYXJt
cy50Y29uID0gdGNvbjsKLQkJCWlvX3Bhcm1zLm9mZnNldCA9ICpvZmZzZXQ7Ci0JCQlpb19wYXJt
cy5sZW5ndGggPSBsZW47Ci0JCQlyYyA9IHNlcnZlci0+b3BzLT5zeW5jX3dyaXRlKHhpZCwgJm9w
ZW5fZmlsZS0+ZmlkLAotCQkJCQkmaW9fcGFybXMsICZieXRlc193cml0dGVuLCBpb3YsIDEpOwot
CQl9Ci0JCWlmIChyYyB8fCAoYnl0ZXNfd3JpdHRlbiA9PSAwKSkgewotCQkJaWYgKHRvdGFsX3dy
aXR0ZW4pCi0JCQkJYnJlYWs7Ci0JCQllbHNlIHsKLQkJCQlmcmVlX3hpZCh4aWQpOwotCQkJCXJl
dHVybiByYzsKLQkJCX0KLQkJfSBlbHNlIHsKLQkJCXNwaW5fbG9jaygmZF9pbm9kZShkZW50cnkp
LT5pX2xvY2spOwotCQkJY2lmc191cGRhdGVfZW9mKGNpZnNpLCAqb2Zmc2V0LCBieXRlc193cml0
dGVuKTsKLQkJCXNwaW5fdW5sb2NrKCZkX2lub2RlKGRlbnRyeSktPmlfbG9jayk7Ci0JCQkqb2Zm
c2V0ICs9IGJ5dGVzX3dyaXR0ZW47Ci0JCX0KLQl9Ci0KLQljaWZzX3N0YXRzX2J5dGVzX3dyaXR0
ZW4odGNvbiwgdG90YWxfd3JpdHRlbik7Ci0KLQlpZiAodG90YWxfd3JpdHRlbiA+IDApIHsKLQkJ
c3Bpbl9sb2NrKCZkX2lub2RlKGRlbnRyeSktPmlfbG9jayk7Ci0JCWlmICgqb2Zmc2V0ID4gZF9p
bm9kZShkZW50cnkpLT5pX3NpemUpIHsKLQkJCWlfc2l6ZV93cml0ZShkX2lub2RlKGRlbnRyeSks
ICpvZmZzZXQpOwotCQkJZF9pbm9kZShkZW50cnkpLT5pX2Jsb2NrcyA9ICg1MTIgLSAxICsgKm9m
ZnNldCkgPj4gOTsKLQkJfQotCQlzcGluX3VubG9jaygmZF9pbm9kZShkZW50cnkpLT5pX2xvY2sp
OwotCX0KLQltYXJrX2lub2RlX2RpcnR5X3N5bmMoZF9pbm9kZShkZW50cnkpKTsKLQlmcmVlX3hp
ZCh4aWQpOwotCXJldHVybiB0b3RhbF93cml0dGVuOwotfQotI2VuZGlmIC8vIGVuZCBuZXRmc2xp
YiByZW1vdmUgMjQ4MwotCiBzdHJ1Y3QgY2lmc0ZpbGVJbmZvICpmaW5kX3JlYWRhYmxlX2ZpbGUo
c3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNfaW5vZGUsCiAJCQkJCWJvb2wgZnN1aWRfb25seSkK
IHsKQEAgLTQ4MzEsMjkzICs0NjE4LDYgQEAgaW50IGNpZnNfZmlsZV9tbWFwKHN0cnVjdCBmaWxl
ICpmaWxlLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKIAlyZXR1cm4gcmM7CiB9CiAKLSNp
ZiAwIC8vIFRPRE8gcmVtb3ZlIDQ3OTQKLS8qCi0gKiBVbmxvY2sgYSBidW5jaCBvZiBmb2xpb3Mg
aW4gdGhlIHBhZ2VjYWNoZS4KLSAqLwotc3RhdGljIHZvaWQgY2lmc191bmxvY2tfZm9saW9zKHN0
cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nLCBwZ29mZl90IGZpcnN0LCBwZ29mZl90IGxhc3Qp
Ci17Ci0Jc3RydWN0IGZvbGlvICpmb2xpbzsKLQlYQV9TVEFURSh4YXMsICZtYXBwaW5nLT5pX3Bh
Z2VzLCBmaXJzdCk7Ci0KLQlyY3VfcmVhZF9sb2NrKCk7Ci0JeGFzX2Zvcl9lYWNoKCZ4YXMsIGZv
bGlvLCBsYXN0KSB7Ci0JCWZvbGlvX3VubG9jayhmb2xpbyk7Ci0JfQotCXJjdV9yZWFkX3VubG9j
aygpOwotfQotCi1zdGF0aWMgdm9pZCBjaWZzX3JlYWRhaGVhZF9jb21wbGV0ZShzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCi17Ci0Jc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPSBj
b250YWluZXJfb2Yod29yaywKLQkJCQkJCQlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0LCB3b3Jr
KTsKLQlzdHJ1Y3QgZm9saW8gKmZvbGlvOwotCXBnb2ZmX3QgbGFzdDsKLQlib29sIGdvb2QgPSBy
ZGF0YS0+cmVzdWx0ID09IDAgfHwgKHJkYXRhLT5yZXN1bHQgPT0gLUVBR0FJTiAmJiByZGF0YS0+
Z290X2J5dGVzKTsKLQotCVhBX1NUQVRFKHhhcywgJnJkYXRhLT5tYXBwaW5nLT5pX3BhZ2VzLCBy
ZGF0YS0+c3VicmVxLnN0YXJ0IC8gUEFHRV9TSVpFKTsKLQotCWlmIChnb29kKQotCQljaWZzX3Jl
YWRhaGVhZF90b19mc2NhY2hlKHJkYXRhLT5tYXBwaW5nLT5ob3N0LAotCQkJCQkgIHJkYXRhLT5z
dWJyZXEuc3RhcnQsIHJkYXRhLT5zdWJyZXEubGVuKTsKLQotCWlmIChpb3ZfaXRlcl9jb3VudCgm
cmRhdGEtPnN1YnJlcS5pb19pdGVyKSA+IDApCi0JCWlvdl9pdGVyX3plcm8oaW92X2l0ZXJfY291
bnQoJnJkYXRhLT5zdWJyZXEuaW9faXRlciksICZyZGF0YS0+c3VicmVxLmlvX2l0ZXIpOwotCi0J
bGFzdCA9IChyZGF0YS0+c3VicmVxLnN0YXJ0ICsgcmRhdGEtPnN1YnJlcS5sZW4gLSAxKSAvIFBB
R0VfU0laRTsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQl4YXNfZm9yX2VhY2goJnhhcywgZm9saW8s
IGxhc3QpIHsKLQkJaWYgKGdvb2QpIHsKLQkJCWZsdXNoX2RjYWNoZV9mb2xpbyhmb2xpbyk7Ci0J
CQlmb2xpb19tYXJrX3VwdG9kYXRlKGZvbGlvKTsKLQkJfQotCQlmb2xpb191bmxvY2soZm9saW8p
OwotCX0KLQlyY3VfcmVhZF91bmxvY2soKTsKLQotCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsK
LX0KLQotc3RhdGljIHZvaWQgY2lmc19yZWFkYWhlYWQoc3RydWN0IHJlYWRhaGVhZF9jb250cm9s
ICpyYWN0bCkKLXsKLQlzdHJ1Y3QgY2lmc0ZpbGVJbmZvICpvcGVuX2ZpbGUgPSByYWN0bC0+Zmls
ZS0+cHJpdmF0ZV9kYXRhOwotCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IgPSBDSUZTX0ZJ
TEVfU0IocmFjdGwtPmZpbGUpOwotCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlcjsKLQl1
bnNpZ25lZCBpbnQgeGlkLCBucl9wYWdlcywgY2FjaGVfbnJfcGFnZXMgPSAwOwotCXVuc2lnbmVk
IGludCByYV9wYWdlczsKLQlwZ29mZl90IG5leHRfY2FjaGVkID0gVUxPTkdfTUFYLCByYV9pbmRl
eDsKLQlib29sIGNhY2hpbmcgPSBmc2NhY2hlX2Nvb2tpZV9lbmFibGVkKGNpZnNfaW5vZGVfY29v
a2llKHJhY3RsLT5tYXBwaW5nLT5ob3N0KSkgJiYKLQkJY2lmc19pbm9kZV9jb29raWUocmFjdGwt
Pm1hcHBpbmctPmhvc3QpLT5jYWNoZV9wcml2OwotCWJvb2wgY2hlY2tfY2FjaGUgPSBjYWNoaW5n
OwotCXBpZF90IHBpZDsKLQlpbnQgcmMgPSAwOwotCi0JLyogTm90ZSB0aGF0IHJlYWRhaGVhZF9j
b3VudCgpIGxhZ3MgYmVoaW5kIG91ciBkZXF1ZXVpbmcgb2YgcGFnZXMgZnJvbQotCSAqIHRoZSBy
YWN0bCwgd28gd2UgaGF2ZSB0byBrZWVwIHRyYWNrIGZvciBvdXJzZWx2ZXMuCi0JICovCi0JcmFf
cGFnZXMgPSByZWFkYWhlYWRfY291bnQocmFjdGwpOwotCXJhX2luZGV4ID0gcmVhZGFoZWFkX2lu
ZGV4KHJhY3RsKTsKLQotCXhpZCA9IGdldF94aWQoKTsKLQotCWlmIChjaWZzX3NiLT5tbnRfY2lm
c19mbGFncyAmIENJRlNfTU9VTlRfUldQSURGT1JXQVJEKQotCQlwaWQgPSBvcGVuX2ZpbGUtPnBp
ZDsKLQllbHNlCi0JCXBpZCA9IGN1cnJlbnQtPnRnaWQ7Ci0KLQlzZXJ2ZXIgPSBjaWZzX3BpY2tf
Y2hhbm5lbCh0bGlua190Y29uKG9wZW5fZmlsZS0+dGxpbmspLT5zZXMpOwotCi0JY2lmc19kYmco
RllJLCAiJXM6IGZpbGU9JXAgbWFwcGluZz0lcCBudW1fcGFnZXM9JXVcbiIsCi0JCSBfX2Z1bmNf
XywgcmFjdGwtPmZpbGUsIHJhY3RsLT5tYXBwaW5nLCByYV9wYWdlcyk7Ci0KLQkvKgotCSAqIENo
b3AgdGhlIHJlYWRhaGVhZCByZXF1ZXN0IHVwIGludG8gcnNpemUtc2l6ZWQgcmVhZCByZXF1ZXN0
cy4KLQkgKi8KLQl3aGlsZSAoKG5yX3BhZ2VzID0gcmFfcGFnZXMpKSB7Ci0JCXVuc2lnbmVkIGlu
dCBpOwotCQlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YTsKLQkJc3RydWN0IGNpZnNf
Y3JlZGl0cyBjcmVkaXRzX29uX3N0YWNrOwotCQlzdHJ1Y3QgY2lmc19jcmVkaXRzICpjcmVkaXRz
ID0gJmNyZWRpdHNfb25fc3RhY2s7Ci0JCXN0cnVjdCBmb2xpbyAqZm9saW87Ci0JCXBnb2ZmX3Qg
ZnNpemU7Ci0JCXNpemVfdCByc2l6ZTsKLQotCQkvKgotCQkgKiBGaW5kIG91dCBpZiB3ZSBoYXZl
IGFueXRoaW5nIGNhY2hlZCBpbiB0aGUgcmFuZ2Ugb2YKLQkJICogaW50ZXJlc3QsIGFuZCBpZiBz
bywgd2hlcmUgdGhlIG5leHQgY2h1bmsgb2YgY2FjaGVkIGRhdGEgaXMuCi0JCSAqLwotCQlpZiAo
Y2FjaGluZykgewotCQkJaWYgKGNoZWNrX2NhY2hlKSB7Ci0JCQkJcmMgPSBjaWZzX2ZzY2FjaGVf
cXVlcnlfb2NjdXBhbmN5KAotCQkJCQlyYWN0bC0+bWFwcGluZy0+aG9zdCwgcmFfaW5kZXgsIG5y
X3BhZ2VzLAotCQkJCQkmbmV4dF9jYWNoZWQsICZjYWNoZV9ucl9wYWdlcyk7Ci0JCQkJaWYgKHJj
IDwgMCkKLQkJCQkJY2FjaGluZyA9IGZhbHNlOwotCQkJCWNoZWNrX2NhY2hlID0gZmFsc2U7Ci0J
CQl9Ci0KLQkJCWlmIChyYV9pbmRleCA9PSBuZXh0X2NhY2hlZCkgewotCQkJCS8qCi0JCQkJICog
VE9ETzogU2VuZCBhIHdob2xlIGJhdGNoIG9mIHBhZ2VzIHRvIGJlIHJlYWQKLQkJCQkgKiBieSB0
aGUgY2FjaGUuCi0JCQkJICovCi0JCQkJZm9saW8gPSByZWFkYWhlYWRfZm9saW8ocmFjdGwpOwot
CQkJCWZzaXplID0gZm9saW9fbnJfcGFnZXMoZm9saW8pOwotCQkJCXJhX3BhZ2VzIC09IGZzaXpl
OwotCQkJCXJhX2luZGV4ICs9IGZzaXplOwotCQkJCWlmIChjaWZzX3JlYWRwYWdlX2Zyb21fZnNj
YWNoZShyYWN0bC0+bWFwcGluZy0+aG9zdCwKLQkJCQkJCQkgICAgICAgJmZvbGlvLT5wYWdlKSA8
IDApIHsKLQkJCQkJLyoKLQkJCQkJICogVE9ETzogRGVhbCB3aXRoIGNhY2hlIHJlYWQgZmFpbHVy
ZQotCQkJCQkgKiBoZXJlLCBidXQgZm9yIHRoZSBtb21lbnQsIGRlbGVnYXRlCi0JCQkJCSAqIHRo
YXQgdG8gcmVhZHBhZ2UuCi0JCQkJCSAqLwotCQkJCQljYWNoaW5nID0gZmFsc2U7Ci0JCQkJfQot
CQkJCWZvbGlvX3VubG9jayhmb2xpbyk7Ci0JCQkJbmV4dF9jYWNoZWQgKz0gZnNpemU7Ci0JCQkJ
Y2FjaGVfbnJfcGFnZXMgLT0gZnNpemU7Ci0JCQkJaWYgKGNhY2hlX25yX3BhZ2VzID09IDApCi0J
CQkJCWNoZWNrX2NhY2hlID0gdHJ1ZTsKLQkJCQljb250aW51ZTsKLQkJCX0KLQkJfQotCi0JCWlm
IChvcGVuX2ZpbGUtPmludmFsaWRIYW5kbGUpIHsKLQkJCXJjID0gY2lmc19yZW9wZW5fZmlsZShv
cGVuX2ZpbGUsIHRydWUpOwotCQkJaWYgKHJjKSB7Ci0JCQkJaWYgKHJjID09IC1FQUdBSU4pCi0J
CQkJCWNvbnRpbnVlOwotCQkJCWJyZWFrOwotCQkJfQotCQl9Ci0KLQkJaWYgKGNpZnNfc2ItPmN0
eC0+cnNpemUgPT0gMCkKLQkJCWNpZnNfc2ItPmN0eC0+cnNpemUgPQotCQkJCXNlcnZlci0+b3Bz
LT5uZWdvdGlhdGVfcnNpemUodGxpbmtfdGNvbihvcGVuX2ZpbGUtPnRsaW5rKSwKLQkJCQkJCQkg
ICAgIGNpZnNfc2ItPmN0eCk7Ci0KLQkJcmMgPSBzZXJ2ZXItPm9wcy0+d2FpdF9tdHVfY3JlZGl0
cyhzZXJ2ZXIsIGNpZnNfc2ItPmN0eC0+cnNpemUsCi0JCQkJCQkgICAmcnNpemUsIGNyZWRpdHMp
OwotCQlpZiAocmMpCi0JCQlicmVhazsKLQkJbnJfcGFnZXMgPSBtaW5fdChzaXplX3QsIHJzaXpl
IC8gUEFHRV9TSVpFLCByYV9wYWdlcyk7Ci0JCWlmIChuZXh0X2NhY2hlZCAhPSBVTE9OR19NQVgp
Ci0JCQlucl9wYWdlcyA9IG1pbl90KHNpemVfdCwgbnJfcGFnZXMsIG5leHRfY2FjaGVkIC0gcmFf
aW5kZXgpOwotCi0JCS8qCi0JCSAqIEdpdmUgdXAgaW1tZWRpYXRlbHkgaWYgcnNpemUgaXMgdG9v
IHNtYWxsIHRvIHJlYWQgYW4gZW50aXJlCi0JCSAqIHBhZ2UuIFRoZSBWRlMgd2lsbCBmYWxsIGJh
Y2sgdG8gcmVhZHBhZ2UuIFdlIHNob3VsZCBuZXZlcgotCQkgKiByZWFjaCB0aGlzIHBvaW50IGhv
d2V2ZXIgc2luY2Ugd2Ugc2V0IHJhX3BhZ2VzIHRvIDAgd2hlbiB0aGUKLQkJICogcnNpemUgaXMg
c21hbGxlciB0aGFuIGEgY2FjaGUgcGFnZS4KLQkJICovCi0JCWlmICh1bmxpa2VseSghbnJfcGFn
ZXMpKSB7Ci0JCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIsIGNyZWRpdHMsIDApOwot
CQkJYnJlYWs7Ci0JCX0KLQotCQlyZGF0YSA9IGNpZnNfcmVhZGRhdGFfYWxsb2MoY2lmc19yZWFk
YWhlYWRfY29tcGxldGUpOwotCQlpZiAoIXJkYXRhKSB7Ci0JCQkvKiBiZXN0IHRvIGdpdmUgdXAg
aWYgd2UncmUgb3V0IG9mIG1lbSAqLwotCQkJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYoc2VydmVy
LCBjcmVkaXRzLCAwKTsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJcmRhdGEtPnN1YnJlcS5zdGFydAk9
IHJhX2luZGV4ICogUEFHRV9TSVpFOwotCQlyZGF0YS0+c3VicmVxLmxlbgk9IG5yX3BhZ2VzICog
UEFHRV9TSVpFOwotCQlyZGF0YS0+Y2ZpbGUJPSBjaWZzRmlsZUluZm9fZ2V0KG9wZW5fZmlsZSk7
Ci0JCXJkYXRhLT5zZXJ2ZXIJPSBzZXJ2ZXI7Ci0JCXJkYXRhLT5tYXBwaW5nCT0gcmFjdGwtPm1h
cHBpbmc7Ci0JCXJkYXRhLT5waWQJPSBwaWQ7Ci0JCXJkYXRhLT5jcmVkaXRzCT0gY3JlZGl0c19v
bl9zdGFjazsKLQotCQlmb3IgKGkgPSAwOyBpIDwgbnJfcGFnZXM7IGkrKykgewotCQkJaWYgKCFy
ZWFkYWhlYWRfZm9saW8ocmFjdGwpKQotCQkJCVdBUk5fT04oMSk7Ci0JCX0KLQkJcmFfcGFnZXMg
LT0gbnJfcGFnZXM7Ci0JCXJhX2luZGV4ICs9IG5yX3BhZ2VzOwotCi0JCWlvdl9pdGVyX3hhcnJh
eSgmcmRhdGEtPnN1YnJlcS5pb19pdGVyLCBJVEVSX0RFU1QsICZyZGF0YS0+bWFwcGluZy0+aV9w
YWdlcywKLQkJCQlyZGF0YS0+c3VicmVxLnN0YXJ0LCByZGF0YS0+c3VicmVxLmxlbik7Ci0KLQkJ
cmMgPSBhZGp1c3RfY3JlZGl0cyhzZXJ2ZXIsICZyZGF0YS0+Y3JlZGl0cywgcmRhdGEtPnN1YnJl
cS5sZW4pOwotCQlpZiAoIXJjKSB7Ci0JCQlpZiAocmRhdGEtPmNmaWxlLT5pbnZhbGlkSGFuZGxl
KQotCQkJCXJjID0gLUVBR0FJTjsKLQkJCWVsc2UKLQkJCQlyYyA9IHNlcnZlci0+b3BzLT5hc3lu
Y19yZWFkdihyZGF0YSk7Ci0JCX0KLQotCQlpZiAocmMpIHsKLQkJCWFkZF9jcmVkaXRzX2FuZF93
YWtlX2lmKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCAwKTsKLQkJCWNpZnNfdW5sb2NrX2ZvbGlv
cyhyZGF0YS0+bWFwcGluZywKLQkJCQkJICAgcmRhdGEtPnN1YnJlcS5zdGFydCAvIFBBR0VfU0la
RSwKLQkJCQkJICAgKHJkYXRhLT5zdWJyZXEuc3RhcnQgKyByZGF0YS0+c3VicmVxLmxlbiAtIDEp
IC8gUEFHRV9TSVpFKTsKLQkJCS8qIEZhbGxiYWNrIHRvIHRoZSByZWFkcGFnZSBpbiBlcnJvci9y
ZWNvbm5lY3QgY2FzZXMgKi8KLQkJCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsKLQkJCWJyZWFr
OwotCQl9Ci0KLQkJY2lmc19wdXRfcmVhZGRhdGEocmRhdGEpOwotCX0KLQotCWZyZWVfeGlkKHhp
ZCk7Ci19Ci0KLS8qCi0gKiBjaWZzX3JlYWRwYWdlX3dvcmtlciBtdXN0IGJlIGNhbGxlZCB3aXRo
IHRoZSBwYWdlIHBpbm5lZAotICovCi1zdGF0aWMgaW50IGNpZnNfcmVhZHBhZ2Vfd29ya2VyKHN0
cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgcGFnZSAqcGFnZSwKLQlsb2ZmX3QgKnBvZmZzZXQpCi17
Ci0Jc3RydWN0IGlub2RlICppbm9kZSA9IGZpbGVfaW5vZGUoZmlsZSk7Ci0Jc3RydWN0IHRpbWVz
cGVjNjQgYXRpbWUsIG10aW1lOwotCWNoYXIgKnJlYWRfZGF0YTsKLQlpbnQgcmM7Ci0KLQkvKiBJ
cyB0aGUgcGFnZSBjYWNoZWQ/ICovCi0JcmMgPSBjaWZzX3JlYWRwYWdlX2Zyb21fZnNjYWNoZShp
bm9kZSwgcGFnZSk7Ci0JaWYgKHJjID09IDApCi0JCWdvdG8gcmVhZF9jb21wbGV0ZTsKLQotCXJl
YWRfZGF0YSA9IGttYXAocGFnZSk7Ci0JLyogZm9yIHJlYWRzIG92ZXIgYSBjZXJ0YWluIHNpemUg
Y291bGQgaW5pdGlhdGUgYXN5bmMgcmVhZCBhaGVhZCAqLwotCi0JcmMgPSBjaWZzX3JlYWQoZmls
ZSwgcmVhZF9kYXRhLCBQQUdFX1NJWkUsIHBvZmZzZXQpOwotCi0JaWYgKHJjIDwgMCkKLQkJZ290
byBpb19lcnJvcjsKLQllbHNlCi0JCWNpZnNfZGJnKEZZSSwgIkJ5dGVzIHJlYWQgJWRcbiIsIHJj
KTsKLQotCS8qIHdlIGRvIG5vdCB3YW50IGF0aW1lIHRvIGJlIGxlc3MgdGhhbiBtdGltZSwgaXQg
YnJva2Ugc29tZSBhcHBzICovCi0JYXRpbWUgPSBpbm9kZV9zZXRfYXRpbWVfdG9fdHMoaW5vZGUs
IGN1cnJlbnRfdGltZShpbm9kZSkpOwotCW10aW1lID0gaW5vZGVfZ2V0X210aW1lKGlub2RlKTsK
LQlpZiAodGltZXNwZWM2NF9jb21wYXJlKCZhdGltZSwgJm10aW1lKSA8IDApCi0JCWlub2RlX3Nl
dF9hdGltZV90b190cyhpbm9kZSwgaW5vZGVfZ2V0X210aW1lKGlub2RlKSk7Ci0KLQlpZiAoUEFH
RV9TSVpFID4gcmMpCi0JCW1lbXNldChyZWFkX2RhdGEgKyByYywgMCwgUEFHRV9TSVpFIC0gcmMp
OwotCi0JZmx1c2hfZGNhY2hlX3BhZ2UocGFnZSk7Ci0JU2V0UGFnZVVwdG9kYXRlKHBhZ2UpOwot
CXJjID0gMDsKLQotaW9fZXJyb3I6Ci0Ja3VubWFwKHBhZ2UpOwotCi1yZWFkX2NvbXBsZXRlOgot
CXVubG9ja19wYWdlKHBhZ2UpOwotCXJldHVybiByYzsKLX0KLQotc3RhdGljIGludCBjaWZzX3Jl
YWRfZm9saW8oc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBmb2xpbyAqZm9saW8pCi17Ci0Jc3Ry
dWN0IHBhZ2UgKnBhZ2UgPSAmZm9saW8tPnBhZ2U7Ci0JbG9mZl90IG9mZnNldCA9IHBhZ2VfZmls
ZV9vZmZzZXQocGFnZSk7Ci0JaW50IHJjID0gLUVBQ0NFUzsKLQl1bnNpZ25lZCBpbnQgeGlkOwot
Ci0JeGlkID0gZ2V0X3hpZCgpOwotCi0JaWYgKGZpbGUtPnByaXZhdGVfZGF0YSA9PSBOVUxMKSB7
Ci0JCXJjID0gLUVCQURGOwotCQlmcmVlX3hpZCh4aWQpOwotCQlyZXR1cm4gcmM7Ci0JfQotCi0J
Y2lmc19kYmcoRllJLCAicmVhZF9mb2xpbyAlcCBhdCBvZmZzZXQgJWQgMHgleFxuIiwKLQkJIHBh
Z2UsIChpbnQpb2Zmc2V0LCAoaW50KW9mZnNldCk7Ci0KLQlyYyA9IGNpZnNfcmVhZHBhZ2Vfd29y
a2VyKGZpbGUsIHBhZ2UsICZvZmZzZXQpOwotCi0JZnJlZV94aWQoeGlkKTsKLQlyZXR1cm4gcmM7
Ci19Ci0jZW5kaWYgLy8gZW5kIG5ldGZzbGliIHJlbW92ZSA0Nzk0Ci0KIHN0YXRpYyBpbnQgaXNf
aW5vZGVfd3JpdGFibGUoc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNfaW5vZGUpCiB7CiAJc3Ry
dWN0IGNpZnNGaWxlSW5mbyAqb3Blbl9maWxlOwpAQCAtNTE2MywxMjUgKzQ2NjMsNiBAQCBib29s
IGlzX3NpemVfc2FmZV90b19jaGFuZ2Uoc3RydWN0IGNpZnNJbm9kZUluZm8gKmNpZnNJbm9kZSwg
X191NjQgZW5kX29mX2ZpbGUpCiAJCXJldHVybiB0cnVlOwogfQogCi0jaWYgMCAvLyBUT0RPIHJl
bW92ZSA1MTUyCi1zdGF0aWMgaW50IGNpZnNfd3JpdGVfYmVnaW4oc3RydWN0IGZpbGUgKmZpbGUs
IHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nLAotCQkJbG9mZl90IHBvcywgdW5zaWduZWQg
bGVuLAotCQkJc3RydWN0IHBhZ2UgKipwYWdlcCwgdm9pZCAqKmZzZGF0YSkKLXsKLQlpbnQgb25j
ZXRocnUgPSAwOwotCXBnb2ZmX3QgaW5kZXggPSBwb3MgPj4gUEFHRV9TSElGVDsKLQlsb2ZmX3Qg
b2Zmc2V0ID0gcG9zICYgKFBBR0VfU0laRSAtIDEpOwotCWxvZmZfdCBwYWdlX3N0YXJ0ID0gcG9z
ICYgUEFHRV9NQVNLOwotCWxvZmZfdCBpX3NpemU7Ci0Jc3RydWN0IHBhZ2UgKnBhZ2U7Ci0JaW50
IHJjID0gMDsKLQotCWNpZnNfZGJnKEZZSSwgIndyaXRlX2JlZ2luIGZyb20gJWxsZCBsZW4gJWRc
biIsIChsb25nIGxvbmcpcG9zLCBsZW4pOwotCi1zdGFydDoKLQlwYWdlID0gZ3JhYl9jYWNoZV9w
YWdlX3dyaXRlX2JlZ2luKG1hcHBpbmcsIGluZGV4KTsKLQlpZiAoIXBhZ2UpIHsKLQkJcmMgPSAt
RU5PTUVNOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlpZiAoUGFnZVVwdG9kYXRlKHBhZ2UpKQotCQln
b3RvIG91dDsKLQotCS8qCi0JICogSWYgd2Ugd3JpdGUgYSBmdWxsIHBhZ2UgaXQgd2lsbCBiZSB1
cCB0byBkYXRlLCBubyBuZWVkIHRvIHJlYWQgZnJvbQotCSAqIHRoZSBzZXJ2ZXIuIElmIHRoZSB3
cml0ZSBpcyBzaG9ydCwgd2UnbGwgZW5kIHVwIGRvaW5nIGEgc3luYyB3cml0ZQotCSAqIGluc3Rl
YWQuCi0JICovCi0JaWYgKGxlbiA9PSBQQUdFX1NJWkUpCi0JCWdvdG8gb3V0OwotCi0JLyoKLQkg
KiBvcHRpbWl6ZSBhd2F5IHRoZSByZWFkIHdoZW4gd2UgaGF2ZSBhbiBvcGxvY2ssIGFuZCB3ZSdy
ZSBub3QKLQkgKiBleHBlY3RpbmcgdG8gdXNlIGFueSBvZiB0aGUgZGF0YSB3ZSdkIGJlIHJlYWRp
bmcgaW4uIFRoYXQKLQkgKiBpcywgd2hlbiB0aGUgcGFnZSBsaWVzIGJleW9uZCB0aGUgRU9GLCBv
ciBzdHJhZGRsZXMgdGhlIEVPRgotCSAqIGFuZCB0aGUgd3JpdGUgd2lsbCBjb3ZlciBhbGwgb2Yg
dGhlIGV4aXN0aW5nIGRhdGEuCi0JICovCi0JaWYgKENJRlNfQ0FDSEVfUkVBRChDSUZTX0kobWFw
cGluZy0+aG9zdCkpKSB7Ci0JCWlfc2l6ZSA9IGlfc2l6ZV9yZWFkKG1hcHBpbmctPmhvc3QpOwot
CQlpZiAocGFnZV9zdGFydCA+PSBpX3NpemUgfHwKLQkJICAgIChvZmZzZXQgPT0gMCAmJiAocG9z
ICsgbGVuKSA+PSBpX3NpemUpKSB7Ci0JCQl6ZXJvX3VzZXJfc2VnbWVudHMocGFnZSwgMCwgb2Zm
c2V0LAotCQkJCQkgICBvZmZzZXQgKyBsZW4sCi0JCQkJCSAgIFBBR0VfU0laRSk7Ci0JCQkvKgot
CQkJICogUGFnZUNoZWNrZWQgbWVhbnMgdGhhdCB0aGUgcGFydHMgb2YgdGhlIHBhZ2UKLQkJCSAq
IHRvIHdoaWNoIHdlJ3JlIG5vdCB3cml0aW5nIGFyZSBjb25zaWRlcmVkIHVwCi0JCQkgKiB0byBk
YXRlLiBPbmNlIHRoZSBkYXRhIGlzIGNvcGllZCB0byB0aGUKLQkJCSAqIHBhZ2UsIGl0IGNhbiBi
ZSBzZXQgdXB0b2RhdGUuCi0JCQkgKi8KLQkJCVNldFBhZ2VDaGVja2VkKHBhZ2UpOwotCQkJZ290
byBvdXQ7Ci0JCX0KLQl9Ci0KLQlpZiAoKGZpbGUtPmZfZmxhZ3MgJiBPX0FDQ01PREUpICE9IE9f
V1JPTkxZICYmICFvbmNldGhydSkgewotCQkvKgotCQkgKiBtaWdodCBhcyB3ZWxsIHJlYWQgYSBw
YWdlLCBpdCBpcyBmYXN0IGVub3VnaC4gSWYgd2UgZ2V0Ci0JCSAqIGFuIGVycm9yLCB3ZSBkb24n
dCBuZWVkIHRvIHJldHVybiBpdC4gY2lmc193cml0ZV9lbmQgd2lsbAotCQkgKiBkbyBhIHN5bmMg
d3JpdGUgaW5zdGVhZCBzaW5jZSBQR191cHRvZGF0ZSBpc24ndCBzZXQuCi0JCSAqLwotCQljaWZz
X3JlYWRwYWdlX3dvcmtlcihmaWxlLCBwYWdlLCAmcGFnZV9zdGFydCk7Ci0JCXB1dF9wYWdlKHBh
Z2UpOwotCQlvbmNldGhydSA9IDE7Ci0JCWdvdG8gc3RhcnQ7Ci0JfSBlbHNlIHsKLQkJLyogd2Ug
Y291bGQgdHJ5IHVzaW5nIGFub3RoZXIgZmlsZSBoYW5kbGUgaWYgdGhlcmUgaXMgb25lIC0KLQkJ
ICAgYnV0IGhvdyB3b3VsZCB3ZSBsb2NrIGl0IHRvIHByZXZlbnQgY2xvc2Ugb2YgdGhhdCBoYW5k
bGUKLQkJICAgcmFjaW5nIHdpdGggdGhpcyByZWFkPyBJbiBhbnkgY2FzZQotCQkgICB0aGlzIHdp
bGwgYmUgd3JpdHRlbiBvdXQgYnkgd3JpdGVfZW5kIHNvIGlzIGZpbmUgKi8KLQl9Ci1vdXQ6Ci0J
KnBhZ2VwID0gcGFnZTsKLQlyZXR1cm4gcmM7Ci19Ci0KLXN0YXRpYyBib29sIGNpZnNfcmVsZWFz
ZV9mb2xpbyhzdHJ1Y3QgZm9saW8gKmZvbGlvLCBnZnBfdCBnZnApCi17Ci0JaWYgKGZvbGlvX3Rl
c3RfcHJpdmF0ZShmb2xpbykpCi0JCXJldHVybiAwOwotCWlmIChmb2xpb190ZXN0X2ZzY2FjaGUo
Zm9saW8pKSB7Ci0JCWlmIChjdXJyZW50X2lzX2tzd2FwZCgpIHx8ICEoZ2ZwICYgX19HRlBfRlMp
KQotCQkJcmV0dXJuIGZhbHNlOwotCQlmb2xpb193YWl0X2ZzY2FjaGUoZm9saW8pOwotCX0KLQlm
c2NhY2hlX25vdGVfcGFnZV9yZWxlYXNlKGNpZnNfaW5vZGVfY29va2llKGZvbGlvLT5tYXBwaW5n
LT5ob3N0KSk7Ci0JcmV0dXJuIHRydWU7Ci19Ci0KLXN0YXRpYyB2b2lkIGNpZnNfaW52YWxpZGF0
ZV9mb2xpbyhzdHJ1Y3QgZm9saW8gKmZvbGlvLCBzaXplX3Qgb2Zmc2V0LAotCQkJCSBzaXplX3Qg
bGVuZ3RoKQotewotCWZvbGlvX3dhaXRfZnNjYWNoZShmb2xpbyk7Ci19Ci0KLXN0YXRpYyBpbnQg
Y2lmc19sYXVuZGVyX2ZvbGlvKHN0cnVjdCBmb2xpbyAqZm9saW8pCi17Ci0JaW50IHJjID0gMDsK
LQlsb2ZmX3QgcmFuZ2Vfc3RhcnQgPSBmb2xpb19wb3MoZm9saW8pOwotCWxvZmZfdCByYW5nZV9l
bmQgPSByYW5nZV9zdGFydCArIGZvbGlvX3NpemUoZm9saW8pOwotCXN0cnVjdCB3cml0ZWJhY2tf
Y29udHJvbCB3YmMgPSB7Ci0JCS5zeW5jX21vZGUgPSBXQl9TWU5DX0FMTCwKLQkJLm5yX3RvX3dy
aXRlID0gMCwKLQkJLnJhbmdlX3N0YXJ0ID0gcmFuZ2Vfc3RhcnQsCi0JCS5yYW5nZV9lbmQgPSBy
YW5nZV9lbmQsCi0JfTsKLQotCWNpZnNfZGJnKEZZSSwgIkxhdW5kZXIgcGFnZTogJWx1XG4iLCBm
b2xpby0+aW5kZXgpOwotCi0JaWYgKGZvbGlvX2NsZWFyX2RpcnR5X2Zvcl9pbyhmb2xpbykpCi0J
CXJjID0gY2lmc193cml0ZXBhZ2VfbG9ja2VkKCZmb2xpby0+cGFnZSwgJndiYyk7Ci0KLQlmb2xp
b193YWl0X2ZzY2FjaGUoZm9saW8pOwotCXJldHVybiByYzsKLX0KLSNlbmRpZiAvLyBlbmQgbmV0
ZnNsaWIgcmVtb3ZlIDUxNTIKLQogdm9pZCBjaWZzX29wbG9ja19icmVhayhzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGNpZnNGaWxlSW5mbyAqY2ZpbGUgPSBjb250YWluZXJf
b2Yod29yaywgc3RydWN0IGNpZnNGaWxlSW5mbywKQEAgLTUzNzEsMjcgKzQ3NTIsNiBAQCB2b2lk
IGNpZnNfb3Bsb2NrX2JyZWFrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAljaWZzX2RvbmVf
b3Bsb2NrX2JyZWFrKGNpbm9kZSk7CiB9CiAKLSNpZiAwIC8vIFRPRE8gcmVtb3ZlIDUzMzMKLS8q
Ci0gKiBUaGUgcHJlc2VuY2Ugb2YgY2lmc19kaXJlY3RfaW8oKSBpbiB0aGUgYWRkcmVzcyBzcGFj
ZSBvcHMgdmVjdG9yCi0gKiBhbGxvd2VzIG9wZW4oKSBPX0RJUkVDVCBmbGFncyB3aGljaCB3b3Vs
ZCBoYXZlIGZhaWxlZCBvdGhlcndpc2UuCi0gKgotICogSW4gdGhlIG5vbi1jYWNoZWQgbW9kZSAo
bW91bnQgd2l0aCBjYWNoZT1ub25lKSwgd2Ugc2h1bnQgb2ZmIGRpcmVjdCByZWFkIGFuZCB3cml0
ZSByZXF1ZXN0cwotICogc28gdGhpcyBtZXRob2Qgc2hvdWxkIG5ldmVyIGJlIGNhbGxlZC4KLSAq
Ci0gKiBEaXJlY3QgSU8gaXMgbm90IHlldCBzdXBwb3J0ZWQgaW4gdGhlIGNhY2hlZCBtb2RlLgot
ICovCi1zdGF0aWMgc3NpemVfdAotY2lmc19kaXJlY3RfaW8oc3RydWN0IGtpb2NiICppb2NiLCBz
dHJ1Y3QgaW92X2l0ZXIgKml0ZXIpCi17Ci0gICAgICAgIC8qCi0gICAgICAgICAqIEZJWE1FCi0g
ICAgICAgICAqIEV2ZW50dWFsbHkgbmVlZCB0byBzdXBwb3J0IGRpcmVjdCBJTyBmb3Igbm9uIGZv
cmNlZGlyZWN0aW8gbW91bnRzCi0gICAgICAgICAqLwotICAgICAgICByZXR1cm4gLUVJTlZBTDsK
LX0KLSNlbmRpZiAvLyBuZXRmcyBlbmQgcmVtb3ZlIDUzMzMKLQogc3RhdGljIGludCBjaWZzX3N3
YXBfYWN0aXZhdGUoc3RydWN0IHN3YXBfaW5mb19zdHJ1Y3QgKnNpcywKIAkJCSAgICAgIHN0cnVj
dCBmaWxlICpzd2FwX2ZpbGUsIHNlY3Rvcl90ICpzcGFuKQogewpkaWZmIC0tZ2l0IGEvZnMvc21i
L2NsaWVudC9mc2NhY2hlLmMgYi9mcy9zbWIvY2xpZW50L2ZzY2FjaGUuYwppbmRleCAyMjhmZTU3
YmJkZTMuLmJkOTI4NDkyM2NjNiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9mc2NhY2hlLmMK
KysrIGIvZnMvc21iL2NsaWVudC9mc2NhY2hlLmMKQEAgLTEzNiwxMTQgKzEzNiwzIEBAIHZvaWQg
Y2lmc19mc2NhY2hlX3JlbGVhc2VfaW5vZGVfY29va2llKHN0cnVjdCBpbm9kZSAqaW5vZGUpCiAJ
CWNpZnNpLT5uZXRmcy5jYWNoZSA9IE5VTEw7CiAJfQogfQotCi0jaWYgMCAvLyBUT0RPIHJlbW92
ZQotLyoKLSAqIEZhbGxiYWNrIHBhZ2UgcmVhZGluZyBpbnRlcmZhY2UuCi0gKi8KLXN0YXRpYyBp
bnQgZnNjYWNoZV9mYWxsYmFja19yZWFkX3BhZ2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0
IHBhZ2UgKnBhZ2UpCi17Ci0Jc3RydWN0IG5ldGZzX2NhY2hlX3Jlc291cmNlcyBjcmVzOwotCXN0
cnVjdCBmc2NhY2hlX2Nvb2tpZSAqY29va2llID0gY2lmc19pbm9kZV9jb29raWUoaW5vZGUpOwot
CXN0cnVjdCBpb3ZfaXRlciBpdGVyOwotCXN0cnVjdCBiaW9fdmVjIGJ2ZWM7Ci0JaW50IHJldDsK
LQotCW1lbXNldCgmY3JlcywgMCwgc2l6ZW9mKGNyZXMpKTsKLQlidmVjX3NldF9wYWdlKCZidmVj
LCBwYWdlLCBQQUdFX1NJWkUsIDApOwotCWlvdl9pdGVyX2J2ZWMoJml0ZXIsIElURVJfREVTVCwg
JmJ2ZWMsIDEsIFBBR0VfU0laRSk7Ci0KLQlyZXQgPSBmc2NhY2hlX2JlZ2luX3JlYWRfb3BlcmF0
aW9uKCZjcmVzLCBjb29raWUpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0OwotCi0JcmV0
ID0gZnNjYWNoZV9yZWFkKCZjcmVzLCBwYWdlX29mZnNldChwYWdlKSwgJml0ZXIsIE5FVEZTX1JF
QURfSE9MRV9GQUlMLAotCQkJICAgTlVMTCwgTlVMTCk7Ci0JZnNjYWNoZV9lbmRfb3BlcmF0aW9u
KCZjcmVzKTsKLQlyZXR1cm4gcmV0OwotfQotCi0vKgotICogRmFsbGJhY2sgcGFnZSB3cml0aW5n
IGludGVyZmFjZS4KLSAqLwotc3RhdGljIGludCBmc2NhY2hlX2ZhbGxiYWNrX3dyaXRlX3BhZ2Vz
KHN0cnVjdCBpbm9kZSAqaW5vZGUsIGxvZmZfdCBzdGFydCwgc2l6ZV90IGxlbiwKLQkJCQkJYm9v
bCBub19zcGFjZV9hbGxvY2F0ZWRfeWV0KQotewotCXN0cnVjdCBuZXRmc19jYWNoZV9yZXNvdXJj
ZXMgY3JlczsKLQlzdHJ1Y3QgZnNjYWNoZV9jb29raWUgKmNvb2tpZSA9IGNpZnNfaW5vZGVfY29v
a2llKGlub2RlKTsKLQlzdHJ1Y3QgaW92X2l0ZXIgaXRlcjsKLQlpbnQgcmV0OwotCi0JbWVtc2V0
KCZjcmVzLCAwLCBzaXplb2YoY3JlcykpOwotCWlvdl9pdGVyX3hhcnJheSgmaXRlciwgSVRFUl9T
T1VSQ0UsICZpbm9kZS0+aV9tYXBwaW5nLT5pX3BhZ2VzLCBzdGFydCwgbGVuKTsKLQotCXJldCA9
IGZzY2FjaGVfYmVnaW5fd3JpdGVfb3BlcmF0aW9uKCZjcmVzLCBjb29raWUpOwotCWlmIChyZXQg
PCAwKQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gY3Jlcy5vcHMtPnByZXBhcmVfd3JpdGUoJmNy
ZXMsICZzdGFydCwgJmxlbiwgbGVuLCBpX3NpemVfcmVhZChpbm9kZSksCi0JCQkJICAgICAgbm9f
c3BhY2VfYWxsb2NhdGVkX3lldCk7Ci0JaWYgKHJldCA9PSAwKQotCQlyZXQgPSBmc2NhY2hlX3dy
aXRlKCZjcmVzLCBzdGFydCwgJml0ZXIsIE5VTEwsIE5VTEwpOwotCWZzY2FjaGVfZW5kX29wZXJh
dGlvbigmY3Jlcyk7Ci0JcmV0dXJuIHJldDsKLX0KLQotLyoKLSAqIFJldHJpZXZlIGEgcGFnZSBm
cm9tIEZTLUNhY2hlCi0gKi8KLWludCBfX2NpZnNfcmVhZHBhZ2VfZnJvbV9mc2NhY2hlKHN0cnVj
dCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBwYWdlICpwYWdlKQotewotCWludCByZXQ7Ci0KLQljaWZz
X2RiZyhGWUksICIlczogKGZzYzolcCwgcDolcCwgaToweCVwXG4iLAotCQkgX19mdW5jX18sIGNp
ZnNfaW5vZGVfY29va2llKGlub2RlKSwgcGFnZSwgaW5vZGUpOwotCi0JcmV0ID0gZnNjYWNoZV9m
YWxsYmFja19yZWFkX3BhZ2UoaW5vZGUsIHBhZ2UpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4g
cmV0OwotCi0JLyogUmVhZCBjb21wbGV0ZWQgc3luY2hyb25vdXNseSAqLwotCVNldFBhZ2VVcHRv
ZGF0ZShwYWdlKTsKLQlyZXR1cm4gMDsKLX0KLQotdm9pZCBfX2NpZnNfcmVhZGFoZWFkX3RvX2Zz
Y2FjaGUoc3RydWN0IGlub2RlICppbm9kZSwgbG9mZl90IHBvcywgc2l6ZV90IGxlbikKLXsKLQlj
aWZzX2RiZyhGWUksICIlczogKGZzYzogJXAsIHA6ICVsbHgsIGw6ICV6eCwgaTogJXApXG4iLAot
CQkgX19mdW5jX18sIGNpZnNfaW5vZGVfY29va2llKGlub2RlKSwgcG9zLCBsZW4sIGlub2RlKTsK
LQotCWZzY2FjaGVfZmFsbGJhY2tfd3JpdGVfcGFnZXMoaW5vZGUsIHBvcywgbGVuLCB0cnVlKTsK
LX0KLQotLyoKLSAqIFF1ZXJ5IHRoZSBjYWNoZSBvY2N1cGFuY3kuCi0gKi8KLWludCBfX2NpZnNf
ZnNjYWNoZV9xdWVyeV9vY2N1cGFuY3koc3RydWN0IGlub2RlICppbm9kZSwKLQkJCQkgICBwZ29m
Zl90IGZpcnN0LCB1bnNpZ25lZCBpbnQgbnJfcGFnZXMsCi0JCQkJICAgcGdvZmZfdCAqX2RhdGFf
Zmlyc3QsCi0JCQkJICAgdW5zaWduZWQgaW50ICpfZGF0YV9ucl9wYWdlcykKLXsKLQlzdHJ1Y3Qg
bmV0ZnNfY2FjaGVfcmVzb3VyY2VzIGNyZXM7Ci0Jc3RydWN0IGZzY2FjaGVfY29va2llICpjb29r
aWUgPSBjaWZzX2lub2RlX2Nvb2tpZShpbm9kZSk7Ci0JbG9mZl90IHN0YXJ0LCBkYXRhX3N0YXJ0
OwotCXNpemVfdCBsZW4sIGRhdGFfbGVuOwotCWludCByZXQ7Ci0KLQlyZXQgPSBmc2NhY2hlX2Jl
Z2luX3JlYWRfb3BlcmF0aW9uKCZjcmVzLCBjb29raWUpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1
cm4gcmV0OwotCi0Jc3RhcnQgPSBmaXJzdCAqIFBBR0VfU0laRTsKLQlsZW4gPSBucl9wYWdlcyAq
IFBBR0VfU0laRTsKLQlyZXQgPSBjcmVzLm9wcy0+cXVlcnlfb2NjdXBhbmN5KCZjcmVzLCBzdGFy
dCwgbGVuLCBQQUdFX1NJWkUsCi0JCQkJCSZkYXRhX3N0YXJ0LCAmZGF0YV9sZW4pOwotCWlmIChy
ZXQgPT0gMCkgewotCQkqX2RhdGFfZmlyc3QgPSBkYXRhX3N0YXJ0IC8gUEFHRV9TSVpFOwotCQkq
X2RhdGFfbnJfcGFnZXMgPSBsZW4gLyBQQUdFX1NJWkU7Ci0JfQotCi0JZnNjYWNoZV9lbmRfb3Bl
cmF0aW9uKCZjcmVzKTsKLQlyZXR1cm4gcmV0OwotfQotI2VuZGlmCmRpZmYgLS1naXQgYS9mcy9z
bWIvY2xpZW50L2ZzY2FjaGUuaCBiL2ZzL3NtYi9jbGllbnQvZnNjYWNoZS5oCmluZGV4IGMyYzA1
YTc3OGE3MS4uZWNlMWE4MjZhZGI5IDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2ZzY2FjaGUu
aAorKysgYi9mcy9zbWIvY2xpZW50L2ZzY2FjaGUuaApAQCAtNzQsNDMgKzc0LDYgQEAgc3RhdGlj
IGlubGluZSB2b2lkIGNpZnNfaW52YWxpZGF0ZV9jYWNoZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCB1
bnNpZ25lZCBpbnQgZmxhZ3MKIAkJCSAgIGlfc2l6ZV9yZWFkKGlub2RlKSwgZmxhZ3MpOwogfQog
Ci0jaWYgMCAvLyBUT0RPIHJlbW92ZQotZXh0ZXJuIGludCBfX2NpZnNfZnNjYWNoZV9xdWVyeV9v
Y2N1cGFuY3koc3RydWN0IGlub2RlICppbm9kZSwKLQkJCQkJICBwZ29mZl90IGZpcnN0LCB1bnNp
Z25lZCBpbnQgbnJfcGFnZXMsCi0JCQkJCSAgcGdvZmZfdCAqX2RhdGFfZmlyc3QsCi0JCQkJCSAg
dW5zaWduZWQgaW50ICpfZGF0YV9ucl9wYWdlcyk7Ci0KLXN0YXRpYyBpbmxpbmUgaW50IGNpZnNf
ZnNjYWNoZV9xdWVyeV9vY2N1cGFuY3koc3RydWN0IGlub2RlICppbm9kZSwKLQkJCQkJICAgICAg
IHBnb2ZmX3QgZmlyc3QsIHVuc2lnbmVkIGludCBucl9wYWdlcywKLQkJCQkJICAgICAgIHBnb2Zm
X3QgKl9kYXRhX2ZpcnN0LAotCQkJCQkgICAgICAgdW5zaWduZWQgaW50ICpfZGF0YV9ucl9wYWdl
cykKLXsKLQlpZiAoIWNpZnNfaW5vZGVfY29va2llKGlub2RlKSkKLQkJcmV0dXJuIC1FTk9CVUZT
OwotCXJldHVybiBfX2NpZnNfZnNjYWNoZV9xdWVyeV9vY2N1cGFuY3koaW5vZGUsIGZpcnN0LCBu
cl9wYWdlcywKLQkJCQkJICAgICAgX2RhdGFfZmlyc3QsIF9kYXRhX25yX3BhZ2VzKTsKLX0KLQot
ZXh0ZXJuIGludCBfX2NpZnNfcmVhZHBhZ2VfZnJvbV9mc2NhY2hlKHN0cnVjdCBpbm9kZSAqcGlu
b2RlLCBzdHJ1Y3QgcGFnZSAqcHBhZ2UpOwotZXh0ZXJuIHZvaWQgX19jaWZzX3JlYWRhaGVhZF90
b19mc2NhY2hlKHN0cnVjdCBpbm9kZSAqcGlub2RlLCBsb2ZmX3QgcG9zLCBzaXplX3QgbGVuKTsK
LQotCi1zdGF0aWMgaW5saW5lIGludCBjaWZzX3JlYWRwYWdlX2Zyb21fZnNjYWNoZShzdHJ1Y3Qg
aW5vZGUgKmlub2RlLAotCQkJCQkgICAgIHN0cnVjdCBwYWdlICpwYWdlKQotewotCWlmIChjaWZz
X2lub2RlX2Nvb2tpZShpbm9kZSkpCi0JCXJldHVybiBfX2NpZnNfcmVhZHBhZ2VfZnJvbV9mc2Nh
Y2hlKGlub2RlLCBwYWdlKTsKLQlyZXR1cm4gLUVOT0JVRlM7Ci19Ci0KLXN0YXRpYyBpbmxpbmUg
dm9pZCBjaWZzX3JlYWRhaGVhZF90b19mc2NhY2hlKHN0cnVjdCBpbm9kZSAqaW5vZGUsCi0JCQkJ
CSAgICAgbG9mZl90IHBvcywgc2l6ZV90IGxlbikKLXsKLQlpZiAoY2lmc19pbm9kZV9jb29raWUo
aW5vZGUpKQotCQlfX2NpZnNfcmVhZGFoZWFkX3RvX2ZzY2FjaGUoaW5vZGUsIHBvcywgbGVuKTsK
LX0KLSNlbmRpZgotCiAjZWxzZSAvKiBDT05GSUdfQ0lGU19GU0NBQ0hFICovCiBzdGF0aWMgaW5s
aW5lCiB2b2lkIGNpZnNfZnNjYWNoZV9maWxsX2NvaGVyZW5jeShzdHJ1Y3QgaW5vZGUgKmlub2Rl
LApAQCAtMTI3LDI3ICs5MCw2IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBjaWZzX2ZzY2FjaGVfdW51
c2VfaW5vZGVfY29va2llKHN0cnVjdCBpbm9kZSAqaW5vZGUsIGJvb2wgdXBkCiBzdGF0aWMgaW5s
aW5lIHN0cnVjdCBmc2NhY2hlX2Nvb2tpZSAqY2lmc19pbm9kZV9jb29raWUoc3RydWN0IGlub2Rl
ICppbm9kZSkgeyByZXR1cm4gTlVMTDsgfQogc3RhdGljIGlubGluZSB2b2lkIGNpZnNfaW52YWxp
ZGF0ZV9jYWNoZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpIHt9CiAK
LSNpZiAwIC8vIFRPRE8gcmVtb3ZlCi1zdGF0aWMgaW5saW5lIGludCBjaWZzX2ZzY2FjaGVfcXVl
cnlfb2NjdXBhbmN5KHN0cnVjdCBpbm9kZSAqaW5vZGUsCi0JCQkJCSAgICAgICBwZ29mZl90IGZp
cnN0LCB1bnNpZ25lZCBpbnQgbnJfcGFnZXMsCi0JCQkJCSAgICAgICBwZ29mZl90ICpfZGF0YV9m
aXJzdCwKLQkJCQkJICAgICAgIHVuc2lnbmVkIGludCAqX2RhdGFfbnJfcGFnZXMpCi17Ci0JKl9k
YXRhX2ZpcnN0ID0gVUxPTkdfTUFYOwotCSpfZGF0YV9ucl9wYWdlcyA9IDA7Ci0JcmV0dXJuIC1F
Tk9CVUZTOwotfQotCi1zdGF0aWMgaW5saW5lIGludAotY2lmc19yZWFkcGFnZV9mcm9tX2ZzY2Fj
aGUoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IHBhZ2UgKnBhZ2UpCi17Ci0JcmV0dXJuIC1F
Tk9CVUZTOwotfQotCi1zdGF0aWMgaW5saW5lCi12b2lkIGNpZnNfcmVhZGFoZWFkX3RvX2ZzY2Fj
aGUoc3RydWN0IGlub2RlICppbm9kZSwgbG9mZl90IHBvcywgc2l6ZV90IGxlbikge30KLSNlbmRp
ZgotCiAjZW5kaWYgLyogQ09ORklHX0NJRlNfRlNDQUNIRSAqLwogCiAjZW5kaWYgLyogX0NJRlNf
RlNDQUNIRV9IICovCi0tIAoyLjQwLjEKCg==
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0002-cifs-Share-server-EOF-pos-with-netfslib.patch"
Content-Disposition: attachment; 
	filename="0002-cifs-Share-server-EOF-pos-with-netfslib.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46f7>
X-Attachment-Id: f_lrpgn46f7

RnJvbSBiYjhhOTg4MjgzYjMwNzQyM2VhMzBlYWIyMTEwNzVlNzI2NmM5Mzg0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBUdWUsIDE1IEZlYiAyMDIyIDE5OjIyOjE4ICswMDAwClN1YmplY3Q6IFtQQVRDSCAwMi8x
Ml0gY2lmczogU2hhcmUgc2VydmVyIEVPRiBwb3Mgd2l0aCBuZXRmc2xpYgoKVXNlIGNpZnNpLT5u
ZXRmc19jdHgucmVtb3RlX2lfc2l6ZSBpbnN0ZWFkIG9mIGNpZnNpLT5zZXJ2ZXJfZW9mIHNvIHRo
YXQKbmV0ZnNsaWIgY2FuIHJlZmVyIHRvIGl0IHRvLgoKU2lnbmVkLW9mZi1ieTogRGF2aWQgSG93
ZWxscyA8ZGhvd2VsbHNAcmVkaGF0LmNvbT4KY2M6IFNoeWFtIFByYXNhZCBOIDxuc3BtYW5nYWxv
cmVAZ21haWwuY29tPgpjYzogUm9oaXRoIFN1cmFiYXR0dWxhIDxyb2hpdGhzLm1zZnRAZ21haWwu
Y29tPgpjYzogSmVmZiBMYXl0b24gPGpsYXl0b25Aa2VybmVsLm9yZz4KY2M6IGxpbnV4LWNpZnNA
dmdlci5rZXJuZWwub3JnCmNjOiBsaW51eC1jYWNoZWZzQHJlZGhhdC5jb20KY2M6IGxpbnV4LWZz
ZGV2ZWxAdmdlci5rZXJuZWwub3JnCmNjOiBsaW51eC1tbUBrdmFjay5vcmcKLS0tCiBmcy9zbWIv
Y2xpZW50L2NpZnNmcy5jICAgfCAxNyArKysrKysrKysrKysrKy0tLQogZnMvc21iL2NsaWVudC9j
aWZzZ2xvYi5oIHwgIDEgLQogZnMvc21iL2NsaWVudC9maWxlLmMgICAgIHwgIDggKysrKy0tLS0K
IGZzL3NtYi9jbGllbnQvaW5vZGUuYyAgICB8ICA4ICsrKysrLS0tCiBmcy9zbWIvY2xpZW50L3Jl
YWRkaXIuYyAgfCAgMiArLQogZnMvc21iL2NsaWVudC9zbWIyb3BzLmMgIHwgMTggKysrKysrKysr
KysrKy0tLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDM3IGluc2VydGlvbnMoKyksIDE3IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc2ZzLmMgYi9mcy9zbWIvY2xpZW50
L2NpZnNmcy5jCmluZGV4IGU5MDJkZTRlNDc1YS4uMmE0YTRlM2E4NzUxIDEwMDY0NAotLS0gYS9m
cy9zbWIvY2xpZW50L2NpZnNmcy5jCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lmc2ZzLmMKQEAgLTM5
Niw3ICszOTYsNyBAQCBjaWZzX2FsbG9jX2lub2RlKHN0cnVjdCBzdXBlcl9ibG9jayAqc2IpCiAJ
c3Bpbl9sb2NrX2luaXQoJmNpZnNfaW5vZGUtPndyaXRlcnNfbG9jayk7CiAJY2lmc19pbm9kZS0+
d3JpdGVycyA9IDA7CiAJY2lmc19pbm9kZS0+bmV0ZnMuaW5vZGUuaV9ibGtiaXRzID0gMTQ7ICAv
KiAyKioxNCA9IENJRlNfTUFYX01TR1NJWkUgKi8KLQljaWZzX2lub2RlLT5zZXJ2ZXJfZW9mID0g
MDsKKwljaWZzX2lub2RlLT5uZXRmcy5yZW1vdGVfaV9zaXplID0gMDsKIAljaWZzX2lub2RlLT51
bmlxdWVpZCA9IDA7CiAJY2lmc19pbm9kZS0+Y3JlYXRldGltZSA9IDA7CiAJY2lmc19pbm9kZS0+
ZXBvY2ggPSAwOwpAQCAtMTM4MCw2ICsxMzgwLDcgQEAgc3NpemVfdCBjaWZzX2ZpbGVfY29weWNo
dW5rX3JhbmdlKHVuc2lnbmVkIGludCB4aWQsCiAJc3RydWN0IGlub2RlICpzcmNfaW5vZGUgPSBm
aWxlX2lub2RlKHNyY19maWxlKTsKIAlzdHJ1Y3QgaW5vZGUgKnRhcmdldF9pbm9kZSA9IGZpbGVf
aW5vZGUoZHN0X2ZpbGUpOwogCXN0cnVjdCBjaWZzSW5vZGVJbmZvICpzcmNfY2lmc2kgPSBDSUZT
X0koc3JjX2lub2RlKTsKKwlzdHJ1Y3QgY2lmc0lub2RlSW5mbyAqdGFyZ2V0X2NpZnNpID0gQ0lG
U19JKHRhcmdldF9pbm9kZSk7CiAJc3RydWN0IGNpZnNGaWxlSW5mbyAqc21iX2ZpbGVfc3JjOwog
CXN0cnVjdCBjaWZzRmlsZUluZm8gKnNtYl9maWxlX3RhcmdldDsKIAlzdHJ1Y3QgY2lmc190Y29u
ICpzcmNfdGNvbjsKQEAgLTE0MjgsNyArMTQyOSw3IEBAIHNzaXplX3QgY2lmc19maWxlX2NvcHlj
aHVua19yYW5nZSh1bnNpZ25lZCBpbnQgeGlkLAogCSAqIEFkdmFuY2UgdGhlIEVPRiBtYXJrZXIg
YWZ0ZXIgdGhlIGZsdXNoIGFib3ZlIHRvIHRoZSBlbmQgb2YgdGhlIHJhbmdlCiAJICogaWYgaXQn
cyBzaG9ydCBvZiB0aGF0LgogCSAqLwotCWlmIChzcmNfY2lmc2ktPnNlcnZlcl9lb2YgPCBvZmYg
KyBsZW4pIHsKKwlpZiAoc3JjX2NpZnNpLT5uZXRmcy5yZW1vdGVfaV9zaXplIDwgb2ZmICsgbGVu
KSB7CiAJCXJjID0gY2lmc19wcmVjb3B5X3NldF9lb2Yoc3JjX2lub2RlLCBzcmNfY2lmc2ksIHNy
Y190Y29uLCB4aWQsIG9mZiArIGxlbik7CiAJCWlmIChyYyA8IDApCiAJCQlnb3RvIHVubG9jazsK
QEAgLTE0NTIsMTIgKzE0NTMsMjIgQEAgc3NpemVfdCBjaWZzX2ZpbGVfY29weWNodW5rX3Jhbmdl
KHVuc2lnbmVkIGludCB4aWQsCiAJLyogRGlzY2FyZCBhbGwgdGhlIGZvbGlvcyB0aGF0IG92ZXJs
YXAgdGhlIGRlc3RpbmF0aW9uIHJlZ2lvbi4gKi8KIAl0cnVuY2F0ZV9pbm9kZV9wYWdlc19yYW5n
ZSgmdGFyZ2V0X2lub2RlLT5pX2RhdGEsIGZzdGFydCwgZmVuZCk7CiAKKwlmc2NhY2hlX2ludmFs
aWRhdGUoY2lmc19pbm9kZV9jb29raWUodGFyZ2V0X2lub2RlKSwgTlVMTCwKKwkJCSAgIGlfc2l6
ZV9yZWFkKHRhcmdldF9pbm9kZSksIDApOworCiAJcmMgPSBmaWxlX21vZGlmaWVkKGRzdF9maWxl
KTsKIAlpZiAoIXJjKSB7CiAJCXJjID0gdGFyZ2V0X3Rjb24tPnNlcy0+c2VydmVyLT5vcHMtPmNv
cHljaHVua19yYW5nZSh4aWQsCiAJCQlzbWJfZmlsZV9zcmMsIHNtYl9maWxlX3RhcmdldCwgb2Zm
LCBsZW4sIGRlc3RvZmYpOwotCQlpZiAocmMgPiAwICYmIGRlc3RvZmYgKyByYyA+IGlfc2l6ZV9y
ZWFkKHRhcmdldF9pbm9kZSkpCisJCWlmIChyYyA+IDAgJiYgZGVzdG9mZiArIHJjID4gaV9zaXpl
X3JlYWQodGFyZ2V0X2lub2RlKSkgewogCQkJdHJ1bmNhdGVfc2V0c2l6ZSh0YXJnZXRfaW5vZGUs
IGRlc3RvZmYgKyByYyk7CisJCQluZXRmc19yZXNpemVfZmlsZSgmdGFyZ2V0X2NpZnNpLT5uZXRm
cywKKwkJCQkJICBpX3NpemVfcmVhZCh0YXJnZXRfaW5vZGUpLCB0cnVlKTsKKwkJCWZzY2FjaGVf
cmVzaXplX2Nvb2tpZShjaWZzX2lub2RlX2Nvb2tpZSh0YXJnZXRfaW5vZGUpLAorCQkJCQkgICAg
ICBpX3NpemVfcmVhZCh0YXJnZXRfaW5vZGUpKTsKKwkJfQorCQlpZiAocmMgPiAwICYmIGRlc3Rv
ZmYgKyByYyA+IHRhcmdldF9jaWZzaS0+bmV0ZnMuemVyb19wb2ludCkKKwkJCXRhcmdldF9jaWZz
aS0+bmV0ZnMuemVyb19wb2ludCA9IGRlc3RvZmYgKyByYzsKIAl9CiAKIAlmaWxlX2FjY2Vzc2Vk
KHNyY19maWxlKTsKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaCBiL2ZzL3Nt
Yi9jbGllbnQvY2lmc2dsb2IuaAppbmRleCBhYWJlZjFhMzkwMzIuLmE3YWE3NWRmMzhhMyAxMDA2
NDQKLS0tIGEvZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lm
c2dsb2IuaApAQCAtMTU2Myw3ICsxNTYzLDYgQEAgc3RydWN0IGNpZnNJbm9kZUluZm8gewogCXNw
aW5sb2NrX3Qgd3JpdGVyc19sb2NrOwogCXVuc2lnbmVkIGludCB3cml0ZXJzOwkJLyogTnVtYmVy
IG9mIHdyaXRlcnMgb24gdGhpcyBpbm9kZSAqLwogCXVuc2lnbmVkIGxvbmcgdGltZTsJCS8qIGpp
ZmZpZXMgb2YgbGFzdCB1cGRhdGUgb2YgaW5vZGUgKi8KLQl1NjQgIHNlcnZlcl9lb2Y7CQkvKiBj
dXJyZW50IGZpbGUgc2l6ZSBvbiBzZXJ2ZXIgLS0gcHJvdGVjdGVkIGJ5IGlfbG9jayAqLwogCXU2
NCAgdW5pcXVlaWQ7CQkJLyogc2VydmVyIGlub2RlIG51bWJlciAqLwogCXU2NCAgY3JlYXRldGlt
ZTsJCS8qIGNyZWF0aW9uIHRpbWUgb24gc2VydmVyICovCiAJX191OCBsZWFzZV9rZXlbU01CMl9M
RUFTRV9LRVlfU0laRV07CS8qIGxlYXNlIGtleSBmb3IgdGhpcyBpbm9kZSAqLwpkaWZmIC0tZ2l0
IGEvZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9zbWIvY2xpZW50L2ZpbGUuYwppbmRleCAyOThh
YmQ4MjM2MjUuLjdlMGJiM2VlYjg3YiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9maWxlLmMK
KysrIGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAgLTIxMjAsOCArMjEyMCw4IEBAIGNpZnNfdXBk
YXRlX2VvZihzdHJ1Y3QgY2lmc0lub2RlSW5mbyAqY2lmc2ksIGxvZmZfdCBvZmZzZXQsCiB7CiAJ
bG9mZl90IGVuZF9vZl93cml0ZSA9IG9mZnNldCArIGJ5dGVzX3dyaXR0ZW47CiAKLQlpZiAoZW5k
X29mX3dyaXRlID4gY2lmc2ktPnNlcnZlcl9lb2YpCi0JCWNpZnNpLT5zZXJ2ZXJfZW9mID0gZW5k
X29mX3dyaXRlOworCWlmIChlbmRfb2Zfd3JpdGUgPiBjaWZzaS0+bmV0ZnMucmVtb3RlX2lfc2l6
ZSkKKwkJbmV0ZnNfcmVzaXplX2ZpbGUoJmNpZnNpLT5uZXRmcywgZW5kX29mX3dyaXRlLCB0cnVl
KTsKIH0KIAogc3RhdGljIHNzaXplX3QKQEAgLTMyNDcsOCArMzI0Nyw4IEBAIGNpZnNfdW5jYWNo
ZWRfd3JpdGV2X2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogCXNwaW5fbG9j
aygmaW5vZGUtPmlfbG9jayk7CiAJY2lmc191cGRhdGVfZW9mKGNpZnNpLCB3ZGF0YS0+b2Zmc2V0
LCB3ZGF0YS0+Ynl0ZXMpOwotCWlmIChjaWZzaS0+c2VydmVyX2VvZiA+IGlub2RlLT5pX3NpemUp
Ci0JCWlfc2l6ZV93cml0ZShpbm9kZSwgY2lmc2ktPnNlcnZlcl9lb2YpOworCWlmIChjaWZzaS0+
bmV0ZnMucmVtb3RlX2lfc2l6ZSA+IGlub2RlLT5pX3NpemUpCisJCWlfc2l6ZV93cml0ZShpbm9k
ZSwgY2lmc2ktPm5ldGZzLnJlbW90ZV9pX3NpemUpOwogCXNwaW5fdW5sb2NrKCZpbm9kZS0+aV9s
b2NrKTsKIAogCWNvbXBsZXRlKCZ3ZGF0YS0+ZG9uZSk7CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xp
ZW50L2lub2RlLmMgYi9mcy9zbWIvY2xpZW50L2lub2RlLmMKaW5kZXggZjA5ODk0ODRmMmM2Li5k
MDJmOGJhMjljYjUgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvaW5vZGUuYworKysgYi9mcy9z
bWIvY2xpZW50L2lub2RlLmMKQEAgLTEwNCw3ICsxMDQsNyBAQCBjaWZzX3JldmFsaWRhdGVfY2Fj
aGUoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGNpZnNfZmF0dHIgKmZhdHRyKQogCWZhdHRy
LT5jZl9tdGltZSA9IHRpbWVzdGFtcF90cnVuY2F0ZShmYXR0ci0+Y2ZfbXRpbWUsIGlub2RlKTsK
IAltdGltZSA9IGlub2RlX2dldF9tdGltZShpbm9kZSk7CiAJaWYgKHRpbWVzcGVjNjRfZXF1YWwo
Jm10aW1lLCAmZmF0dHItPmNmX210aW1lKSAmJgotCSAgICBjaWZzX2ktPnNlcnZlcl9lb2YgPT0g
ZmF0dHItPmNmX2VvZikgeworCSAgICBjaWZzX2ktPm5ldGZzLnJlbW90ZV9pX3NpemUgPT0gZmF0
dHItPmNmX2VvZikgewogCQljaWZzX2RiZyhGWUksICIlczogaW5vZGUgJWxsdSBpcyB1bmNoYW5n
ZWRcbiIsCiAJCQkgX19mdW5jX18sIGNpZnNfaS0+dW5pcXVlaWQpOwogCQlyZXR1cm47CkBAIC0x
OTQsNyArMTk0LDcgQEAgY2lmc19mYXR0cl90b19pbm9kZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBz
dHJ1Y3QgY2lmc19mYXR0ciAqZmF0dHIpCiAJZWxzZQogCQljbGVhcl9iaXQoQ0lGU19JTk9fREVM
RVRFX1BFTkRJTkcsICZjaWZzX2ktPmZsYWdzKTsKIAotCWNpZnNfaS0+c2VydmVyX2VvZiA9IGZh
dHRyLT5jZl9lb2Y7CisJY2lmc19pLT5uZXRmcy5yZW1vdGVfaV9zaXplID0gZmF0dHItPmNmX2Vv
ZjsKIAkvKgogCSAqIENhbid0IHNhZmVseSBjaGFuZ2UgdGhlIGZpbGUgc2l6ZSBoZXJlIGlmIHRo
ZSBjbGllbnQgaXMgd3JpdGluZyB0bwogCSAqIGl0IGR1ZSB0byBwb3RlbnRpYWwgcmFjZXMuCkBA
IC0yODU4LDcgKzI4NTgsNyBAQCBjaWZzX3NldF9maWxlX3NpemUoc3RydWN0IGlub2RlICppbm9k
ZSwgc3RydWN0IGlhdHRyICphdHRycywKIAogc2V0X3NpemVfb3V0OgogCWlmIChyYyA9PSAwKSB7
Ci0JCWNpZnNJbm9kZS0+c2VydmVyX2VvZiA9IGF0dHJzLT5pYV9zaXplOworCQluZXRmc19yZXNp
emVfZmlsZSgmY2lmc0lub2RlLT5uZXRmcywgYXR0cnMtPmlhX3NpemUsIHRydWUpOwogCQljaWZz
X3NldHNpemUoaW5vZGUsIGF0dHJzLT5pYV9zaXplKTsKIAkJLyoKIAkJICogaV9ibG9ja3MgaXMg
bm90IHJlbGF0ZWQgdG8gKGlfc2l6ZSAvIGlfYmxrc2l6ZSksIGJ1dCBpbnN0ZWFkCkBAIC0zMDEx
LDYgKzMwMTEsNyBAQCBjaWZzX3NldGF0dHJfdW5peChzdHJ1Y3QgZGVudHJ5ICpkaXJlbnRyeSwg
c3RydWN0IGlhdHRyICphdHRycykKIAlpZiAoKGF0dHJzLT5pYV92YWxpZCAmIEFUVFJfU0laRSkg
JiYKIAkgICAgYXR0cnMtPmlhX3NpemUgIT0gaV9zaXplX3JlYWQoaW5vZGUpKSB7CiAJCXRydW5j
YXRlX3NldHNpemUoaW5vZGUsIGF0dHJzLT5pYV9zaXplKTsKKwkJbmV0ZnNfcmVzaXplX2ZpbGUo
JmNpZnNJbm9kZS0+bmV0ZnMsIGF0dHJzLT5pYV9zaXplLCB0cnVlKTsKIAkJZnNjYWNoZV9yZXNp
emVfY29va2llKGNpZnNfaW5vZGVfY29va2llKGlub2RlKSwgYXR0cnMtPmlhX3NpemUpOwogCX0K
IApAQCAtMzIxMCw2ICszMjExLDcgQEAgY2lmc19zZXRhdHRyX25vdW5peChzdHJ1Y3QgZGVudHJ5
ICpkaXJlbnRyeSwgc3RydWN0IGlhdHRyICphdHRycykKIAlpZiAoKGF0dHJzLT5pYV92YWxpZCAm
IEFUVFJfU0laRSkgJiYKIAkgICAgYXR0cnMtPmlhX3NpemUgIT0gaV9zaXplX3JlYWQoaW5vZGUp
KSB7CiAJCXRydW5jYXRlX3NldHNpemUoaW5vZGUsIGF0dHJzLT5pYV9zaXplKTsKKwkJbmV0ZnNf
cmVzaXplX2ZpbGUoJmNpZnNJbm9kZS0+bmV0ZnMsIGF0dHJzLT5pYV9zaXplLCB0cnVlKTsKIAkJ
ZnNjYWNoZV9yZXNpemVfY29va2llKGNpZnNfaW5vZGVfY29va2llKGlub2RlKSwgYXR0cnMtPmlh
X3NpemUpOwogCX0KIApkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9yZWFkZGlyLmMgYi9mcy9z
bWIvY2xpZW50L3JlYWRkaXIuYwppbmRleCA5NDI1NTQwMWIzOGQuLjNiMWIwMWQxMGY3ZCAxMDA2
NDQKLS0tIGEvZnMvc21iL2NsaWVudC9yZWFkZGlyLmMKKysrIGIvZnMvc21iL2NsaWVudC9yZWFk
ZGlyLmMKQEAgLTE0MSw3ICsxNDEsNyBAQCBjaWZzX3ByaW1lX2RjYWNoZShzdHJ1Y3QgZGVudHJ5
ICpwYXJlbnQsIHN0cnVjdCBxc3RyICpuYW1lLAogCQkJCQlpZiAobGlrZWx5KHJlcGFyc2VfaW5v
ZGVfbWF0Y2goaW5vZGUsIGZhdHRyKSkpIHsKIAkJCQkJCWZhdHRyLT5jZl9tb2RlID0gaW5vZGUt
PmlfbW9kZTsKIAkJCQkJCWZhdHRyLT5jZl9yZGV2ID0gaW5vZGUtPmlfcmRldjsKLQkJCQkJCWZh
dHRyLT5jZl9lb2YgPSBDSUZTX0koaW5vZGUpLT5zZXJ2ZXJfZW9mOworCQkJCQkJZmF0dHItPmNm
X2VvZiA9IENJRlNfSShpbm9kZSktPm5ldGZzLnJlbW90ZV9pX3NpemU7CiAJCQkJCQlmYXR0ci0+
Y2Zfc3ltbGlua190YXJnZXQgPSBOVUxMOwogCQkJCQl9IGVsc2UgewogCQkJCQkJQ0lGU19JKGlu
b2RlKS0+dGltZSA9IDA7CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L3NtYjJvcHMuYyBiL2Zz
L3NtYi9jbGllbnQvc21iMm9wcy5jCmluZGV4IDYxZDgxZTM1YTZiNC4uZTE2MWE0MWNiMjYyIDEw
MDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L3NtYjJvcHMuYworKysgYi9mcy9zbWIvY2xpZW50L3Nt
YjJvcHMuYwpAQCAtMzIxMyw2ICszMjEzLDkgQEAgc3RhdGljIGxvbmcgc21iM196ZXJvX3Jhbmdl
KHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgY2lmc190Y29uICp0Y29uLAogCQkJCSAgY2ZpbGUt
PmZpZC52b2xhdGlsZV9maWQsIGNmaWxlLT5waWQsIG5ld19zaXplKTsKIAkJaWYgKHJjID49IDAp
IHsKIAkJCXRydW5jYXRlX3NldHNpemUoaW5vZGUsIG5ld19zaXplKTsKKwkJCW5ldGZzX3Jlc2l6
ZV9maWxlKCZjaWZzaS0+bmV0ZnMsIG5ld19zaXplLCB0cnVlKTsKKwkJCWlmIChvZmZzZXQgPCBj
aWZzaS0+bmV0ZnMuemVyb19wb2ludCkKKwkJCQljaWZzaS0+bmV0ZnMuemVyb19wb2ludCA9IG9m
ZnNldDsKIAkJCWZzY2FjaGVfcmVzaXplX2Nvb2tpZShjaWZzX2lub2RlX2Nvb2tpZShpbm9kZSks
IG5ld19zaXplKTsKIAkJfQogCX0KQEAgLTM0MzYsNyArMzQzOSw3IEBAIHN0YXRpYyBsb25nIHNt
YjNfc2ltcGxlX2ZhbGxvYyhzdHJ1Y3QgZmlsZSAqZmlsZSwgc3RydWN0IGNpZnNfdGNvbiAqdGNv
biwKIAkJcmMgPSBTTUIyX3NldF9lb2YoeGlkLCB0Y29uLCBjZmlsZS0+ZmlkLnBlcnNpc3RlbnRf
ZmlkLAogCQkJCSAgY2ZpbGUtPmZpZC52b2xhdGlsZV9maWQsIGNmaWxlLT5waWQsIG5ld19lb2Yp
OwogCQlpZiAocmMgPT0gMCkgewotCQkJY2lmc2ktPnNlcnZlcl9lb2YgPSBuZXdfZW9mOworCQkJ
bmV0ZnNfcmVzaXplX2ZpbGUoJmNpZnNpLT5uZXRmcywgbmV3X2VvZiwgdHJ1ZSk7CiAJCQljaWZz
X3NldHNpemUoaW5vZGUsIG5ld19lb2YpOwogCQkJY2lmc190cnVuY2F0ZV9wYWdlKGlub2RlLT5p
X21hcHBpbmcsIGlub2RlLT5pX3NpemUpOwogCQkJdHJ1bmNhdGVfc2V0c2l6ZShpbm9kZSwgbmV3
X2VvZik7CkBAIC0zNTI4LDggKzM1MzEsOSBAQCBzdGF0aWMgbG9uZyBzbWIzX2NvbGxhcHNlX3Jh
bmdlKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgY2lmc190Y29uICp0Y29uLAogCWludCByYzsK
IAl1bnNpZ25lZCBpbnQgeGlkOwogCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBmaWxlX2lub2RlKGZp
bGUpOwotCXN0cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwog
CXN0cnVjdCBjaWZzSW5vZGVJbmZvICpjaWZzaSA9IENJRlNfSShpbm9kZSk7CisJc3RydWN0IGNp
ZnNGaWxlSW5mbyAqY2ZpbGUgPSBmaWxlLT5wcml2YXRlX2RhdGE7CisJc3RydWN0IG5ldGZzX2lu
b2RlICppY3R4ID0gJmNpZnNpLT5uZXRmczsKIAlsb2ZmX3Qgb2xkX2VvZiwgbmV3X2VvZjsKIAog
CXhpZCA9IGdldF94aWQoKTsKQEAgLTM1NDksNiArMzU1Myw3IEBAIHN0YXRpYyBsb25nIHNtYjNf
Y29sbGFwc2VfcmFuZ2Uoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBjaWZzX3Rjb24gKnRjb24s
CiAJCWdvdG8gb3V0XzI7CiAKIAl0cnVuY2F0ZV9wYWdlY2FjaGVfcmFuZ2UoaW5vZGUsIG9mZiwg
b2xkX2VvZik7CisJaWN0eC0+emVyb19wb2ludCA9IG9sZF9lb2Y7CiAKIAlyYyA9IHNtYjJfY29w
eWNodW5rX3JhbmdlKHhpZCwgY2ZpbGUsIGNmaWxlLCBvZmYgKyBsZW4sCiAJCQkJICBvbGRfZW9m
IC0gb2ZmIC0gbGVuLCBvZmYpOwpAQCAtMzU2Myw5ICszNTY4LDEwIEBAIHN0YXRpYyBsb25nIHNt
YjNfY29sbGFwc2VfcmFuZ2Uoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBjaWZzX3Rjb24gKnRj
b24sCiAKIAlyYyA9IDA7CiAKLQljaWZzaS0+c2VydmVyX2VvZiA9IGlfc2l6ZV9yZWFkKGlub2Rl
KSAtIGxlbjsKLQl0cnVuY2F0ZV9zZXRzaXplKGlub2RlLCBjaWZzaS0+c2VydmVyX2VvZik7Ci0J
ZnNjYWNoZV9yZXNpemVfY29va2llKGNpZnNfaW5vZGVfY29va2llKGlub2RlKSwgY2lmc2ktPnNl
cnZlcl9lb2YpOworCXRydW5jYXRlX3NldHNpemUoaW5vZGUsIG5ld19lb2YpOworCW5ldGZzX3Jl
c2l6ZV9maWxlKCZjaWZzaS0+bmV0ZnMsIG5ld19lb2YsIHRydWUpOworCWljdHgtPnplcm9fcG9p
bnQgPSBuZXdfZW9mOworCWZzY2FjaGVfcmVzaXplX2Nvb2tpZShjaWZzX2lub2RlX2Nvb2tpZShp
bm9kZSksIG5ld19lb2YpOwogb3V0XzI6CiAJZmlsZW1hcF9pbnZhbGlkYXRlX3VubG9jayhpbm9k
ZS0+aV9tYXBwaW5nKTsKICBvdXQ6CkBAIC0zNTgxLDYgKzM1ODcsNyBAQCBzdGF0aWMgbG9uZyBz
bWIzX2luc2VydF9yYW5nZShzdHJ1Y3QgZmlsZSAqZmlsZSwgc3RydWN0IGNpZnNfdGNvbiAqdGNv
biwKIAl1bnNpZ25lZCBpbnQgeGlkOwogCXN0cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlID0gZmls
ZS0+cHJpdmF0ZV9kYXRhOwogCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBmaWxlX2lub2RlKGZpbGUp
OworCXN0cnVjdCBjaWZzSW5vZGVJbmZvICpjaWZzaSA9IENJRlNfSShpbm9kZSk7CiAJX191NjQg
Y291bnQsIG9sZF9lb2YsIG5ld19lb2Y7CiAKIAl4aWQgPSBnZXRfeGlkKCk7CkBAIC0zNjA4LDYg
KzM2MTUsNyBAQCBzdGF0aWMgbG9uZyBzbWIzX2luc2VydF9yYW5nZShzdHJ1Y3QgZmlsZSAqZmls
ZSwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwKIAkJZ290byBvdXRfMjsKIAogCXRydW5jYXRlX3Nl
dHNpemUoaW5vZGUsIG5ld19lb2YpOworCW5ldGZzX3Jlc2l6ZV9maWxlKCZjaWZzaS0+bmV0ZnMs
IGlfc2l6ZV9yZWFkKGlub2RlKSwgdHJ1ZSk7CiAJZnNjYWNoZV9yZXNpemVfY29va2llKGNpZnNf
aW5vZGVfY29va2llKGlub2RlKSwgaV9zaXplX3JlYWQoaW5vZGUpKTsKIAogCXJjID0gc21iMl9j
b3B5Y2h1bmtfcmFuZ2UoeGlkLCBjZmlsZSwgY2ZpbGUsIG9mZiwgY291bnQsIG9mZiArIGxlbik7
Ci0tIAoyLjQwLjEKCg==
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0001-cifs-Replace-cifs_readdata-with-a-wrapper-around-net.patch"
Content-Disposition: attachment; 
	filename="0001-cifs-Replace-cifs_readdata-with-a-wrapper-around-net.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46e6>
X-Attachment-Id: f_lrpgn46e6

RnJvbSA5OTE3ZjQ4ZjFlZTNhN2EzYWQ2NDlhODYwNzRiNWQ3Njg1NjE0YjRhIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBXZWQsIDkgTWFyIDIwMjIgMTE6MDE6MTIgKzAwMDAKU3ViamVjdDogW1BBVENIIDAxLzEy
XSBjaWZzOiBSZXBsYWNlIGNpZnNfcmVhZGRhdGEgd2l0aCBhIHdyYXBwZXIgYXJvdW5kCiBuZXRm
c19pb19zdWJyZXF1ZXN0CgpOZXRmc2xpYiBoYXMgYSBmYWNpbGl0eSB3aGVyZWJ5IHRoZSBhbGxv
Y2F0aW9uIGZvciBuZXRmc19pb19zdWJyZXF1ZXN0IGNhbgpiZSBpbmNyZWFzZWQgdG8gc28gdGhh
dCBmaWxlc3lzdGVtLXNwZWNpZmljIGRhdGEgY2FuIGJlIHRhZ2dlZCBvbiB0aGUgZW5kLgoKUHJl
cGFyZSB0byB1c2UgdGhpcyBieSBtYWtpbmcgYSBzdHJ1Y3QsIGNpZnNfaW9fc3VicmVxdWVzdCwg
dGhhdCB3cmFwcwpuZXRmc19pb19zdWJyZXF1ZXN0LCBhbmQgYWJzb3JiIHN0cnVjdCBjaWZzX3Jl
YWRkYXRhIGludG8gaXQuCgpTaWduZWQtb2ZmLWJ5OiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0By
ZWRoYXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1hbmdhbG9yZUBnbWFpbC5jb20+CmNj
OiBSb2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBnbWFpbC5jb20+CmNjOiBKZWZmIExh
eXRvbiA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgtY2lmc0B2Z2VyLmtlcm5lbC5vcmcK
Y2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGludXgtZnNkZXZlbEB2Z2VyLmtlcm5l
bC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZzL3NtYi9jbGllbnQvY2lmc2dsb2Iu
aCAgfCAyMiArKysrKysrKysrLS0tLS0tLS0tCiBmcy9zbWIvY2xpZW50L2NpZnNwcm90by5oIHwg
MTMgKysrKysrKysrLS0KIGZzL3NtYi9jbGllbnQvY2lmc3NtYi5jICAgfCAxMSArKysrLS0tLS0t
CiBmcy9zbWIvY2xpZW50L2ZpbGUuYyAgICAgIHwgNDYgKysrKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tCiBmcy9zbWIvY2xpZW50L3NtYjJvcHMuYyAgIHwgIDIgKy0KIGZzL3Nt
Yi9jbGllbnQvc21iMnBkdS5jICAgfCAxMiArKysrKy0tLS0tCiBmcy9zbWIvY2xpZW50L3NtYjJw
cm90by5oIHwgIDIgKy0KIGZzL3NtYi9jbGllbnQvdHJhbnNwb3J0LmMgfCAgNCArKy0tCiA4IGZp
bGVzIGNoYW5nZWQsIDU5IGluc2VydGlvbnMoKyksIDUzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaCBiL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaApp
bmRleCAyMDAzNmZiMTZjZWMuLmFhYmVmMWEzOTAzMiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVu
dC9jaWZzZ2xvYi5oCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaApAQCAtMjU0LDcgKzI1
NCw3IEBAIHN0cnVjdCBkZnNfaW5mbzNfcGFyYW07CiBzdHJ1Y3QgY2lmc19mYXR0cjsKIHN0cnVj
dCBzbWIzX2ZzX2NvbnRleHQ7CiBzdHJ1Y3QgY2lmc19maWQ7Ci1zdHJ1Y3QgY2lmc19yZWFkZGF0
YTsKK3N0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3Q7CiBzdHJ1Y3QgY2lmc193cml0ZWRhdGE7CiBz
dHJ1Y3QgY2lmc19pb19wYXJtczsKIHN0cnVjdCBjaWZzX3NlYXJjaF9pbmZvOwpAQCAtNDMyLDcg
KzQzMiw3IEBAIHN0cnVjdCBzbWJfdmVyc2lvbl9vcGVyYXRpb25zIHsKIAkvKiBzZW5kIGEgZmx1
c2ggcmVxdWVzdCB0byB0aGUgc2VydmVyICovCiAJaW50ICgqZmx1c2gpKGNvbnN0IHVuc2lnbmVk
IGludCwgc3RydWN0IGNpZnNfdGNvbiAqLCBzdHJ1Y3QgY2lmc19maWQgKik7CiAJLyogYXN5bmMg
cmVhZCBmcm9tIHRoZSBzZXJ2ZXIgKi8KLQlpbnQgKCphc3luY19yZWFkdikoc3RydWN0IGNpZnNf
cmVhZGRhdGEgKik7CisJaW50ICgqYXN5bmNfcmVhZHYpKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVl
c3QgKik7CiAJLyogYXN5bmMgd3JpdGUgdG8gdGhlIHNlcnZlciAqLwogCWludCAoKmFzeW5jX3dy
aXRldikoc3RydWN0IGNpZnNfd3JpdGVkYXRhICosCiAJCQkgICAgdm9pZCAoKnJlbGVhc2UpKHN0
cnVjdCBrcmVmICopKTsKQEAgLTE0NTksMjYgKzE0NTksMjggQEAgc3RydWN0IGNpZnNfYWlvX2N0
eCB7CiB9OwogCiAvKiBhc3luY2hyb25vdXMgcmVhZCBzdXBwb3J0ICovCi1zdHJ1Y3QgY2lmc19y
ZWFkZGF0YSB7Ci0Jc3RydWN0IGtyZWYJCQlyZWZjb3VudDsKLQlzdHJ1Y3QgbGlzdF9oZWFkCQls
aXN0OwotCXN0cnVjdCBjb21wbGV0aW9uCQlkb25lOworc3RydWN0IGNpZnNfaW9fc3VicmVxdWVz
dCB7CisJc3RydWN0IG5ldGZzX2lvX3N1YnJlcXVlc3QJc3VicmVxOwogCXN0cnVjdCBjaWZzRmls
ZUluZm8JCSpjZmlsZTsKIAlzdHJ1Y3QgYWRkcmVzc19zcGFjZQkJKm1hcHBpbmc7CiAJc3RydWN0
IGNpZnNfYWlvX2N0eAkJKmN0eDsKLQlfX3U2NAkJCQlvZmZzZXQ7CiAJc3NpemVfdAkJCQlnb3Rf
Ynl0ZXM7Ci0JdW5zaWduZWQgaW50CQkJYnl0ZXM7CiAJcGlkX3QJCQkJcGlkOwogCWludAkJCQly
ZXN1bHQ7Ci0Jc3RydWN0IHdvcmtfc3RydWN0CQl3b3JrOwotCXN0cnVjdCBpb3ZfaXRlcgkJCWl0
ZXI7CiAJc3RydWN0IGt2ZWMJCQlpb3ZbMl07CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbwkJKnNl
cnZlcjsKICNpZmRlZiBDT05GSUdfQ0lGU19TTUJfRElSRUNUCiAJc3RydWN0IHNtYmRfbXIJCQkq
bXI7CiAjZW5kaWYKIAlzdHJ1Y3QgY2lmc19jcmVkaXRzCQljcmVkaXRzOworCisJLy8gVE9ETzog
UmVtb3ZlIGZvbGxvd2luZyBlbGVtZW50cworCXN0cnVjdCBsaXN0X2hlYWQJCWxpc3Q7CisJc3Ry
dWN0IGNvbXBsZXRpb24JCWRvbmU7CisJc3RydWN0IHdvcmtfc3RydWN0CQl3b3JrOworCXN0cnVj
dCBpb3ZfaXRlcgkJCWl0ZXI7CisJX191NjQJCQkJb2Zmc2V0OworCXVuc2lnbmVkIGludAkJCWJ5
dGVzOwogfTsKIAogLyogYXN5bmNocm9ub3VzIHdyaXRlIHN1cHBvcnQgKi8KZGlmZiAtLWdpdCBh
L2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmggYi9mcy9zbWIvY2xpZW50L2NpZnNwcm90by5oCmlu
ZGV4IGE4NDFiZjQ5NjdmYS4uNTAzM2YxYjFiZmUzIDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50
L2NpZnNwcm90by5oCisrKyBiL2ZzL3NtYi9jbGllbnQvY2lmc3Byb3RvLmgKQEAgLTU5NCw4ICs1
OTQsMTcgQEAgdm9pZCBfX2NpZnNfcHV0X3NtYl9zZXMoc3RydWN0IGNpZnNfc2VzICpzZXMpOwog
ZXh0ZXJuIHN0cnVjdCBjaWZzX3NlcyAqCiBjaWZzX2dldF9zbWJfc2VzKHN0cnVjdCBUQ1BfU2Vy
dmVyX0luZm8gKnNlcnZlciwgc3RydWN0IHNtYjNfZnNfY29udGV4dCAqY3R4KTsKIAotdm9pZCBj
aWZzX3JlYWRkYXRhX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZmNvdW50KTsKLWludCBjaWZzX2Fz
eW5jX3JlYWR2KHN0cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YSk7Cit2b2lkIGNpZnNfcmVhZGRh
dGFfcmVsZWFzZShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSk7CitzdGF0aWMgaW5s
aW5lIHZvaWQgY2lmc19nZXRfcmVhZGRhdGEoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRh
dGEpCit7CisJcmVmY291bnRfaW5jKCZyZGF0YS0+c3VicmVxLnJlZik7Cit9CitzdGF0aWMgaW5s
aW5lIHZvaWQgY2lmc19wdXRfcmVhZGRhdGEoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRh
dGEpCit7CisJaWYgKHJlZmNvdW50X2RlY19hbmRfdGVzdCgmcmRhdGEtPnN1YnJlcS5yZWYpKQor
CQljaWZzX3JlYWRkYXRhX3JlbGVhc2UocmRhdGEpOworfQoraW50IGNpZnNfYXN5bmNfcmVhZHYo
c3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEpOwogaW50IGNpZnNfcmVhZHZfcmVjZWl2
ZShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlk
KTsKIAogaW50IGNpZnNfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEs
CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L2NpZnNzbWIuYyBiL2ZzL3NtYi9jbGllbnQvY2lm
c3NtYi5jCmluZGV4IDAxZTg5MDcwZGY1YS4uMmQxMGMwN2MxMjk1IDEwMDY0NAotLS0gYS9mcy9z
bWIvY2xpZW50L2NpZnNzbWIuYworKysgYi9mcy9zbWIvY2xpZW50L2NpZnNzbWIuYwpAQCAtMjQs
NiArMjQsOCBAQAogI2luY2x1ZGUgPGxpbnV4L3N3YXAuaD4KICNpbmNsdWRlIDxsaW51eC90YXNr
X2lvX2FjY291bnRpbmdfb3BzLmg+CiAjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgorI2luY2x1
ZGUgPGxpbnV4L25ldGZzLmg+CisjaW5jbHVkZSA8dHJhY2UvZXZlbnRzL25ldGZzLmg+CiAjaW5j
bHVkZSAiY2lmc3BkdS5oIgogI2luY2x1ZGUgImNpZnNmcy5oIgogI2luY2x1ZGUgImNpZnNnbG9i
LmgiCkBAIC0xMjYyLDEyICsxMjY0LDExIEBAIENJRlNfb3Blbihjb25zdCB1bnNpZ25lZCBpbnQg
eGlkLCBzdHJ1Y3QgY2lmc19vcGVuX3Bhcm1zICpvcGFybXMsIGludCAqb3Bsb2NrLAogc3RhdGlj
IHZvaWQKIGNpZnNfcmVhZHZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiB7Ci0J
c3RydWN0IGNpZnNfcmVhZGRhdGEgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRhOworCXN0cnVj
dCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRhOwogCXN0cnVj
dCBjaWZzX3Rjb24gKnRjb24gPSB0bGlua190Y29uKHJkYXRhLT5jZmlsZS0+dGxpbmspOwogCXN0
cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2VydmVyOwogCXN0cnVj
dCBzbWJfcnFzdCBycXN0ID0geyAucnFfaW92ID0gcmRhdGEtPmlvdiwKIAkJCQkgLnJxX252ZWMg
PSAyLAotCQkJCSAucnFfaXRlcl9zaXplID0gaW92X2l0ZXJfY291bnQoJnJkYXRhLT5pdGVyKSwK
IAkJCQkgLnJxX2l0ZXIgPSByZGF0YS0+aXRlciB9OwogCXN0cnVjdCBjaWZzX2NyZWRpdHMgY3Jl
ZGl0cyA9IHsgLnZhbHVlID0gMSwgLmluc3RhbmNlID0gMCB9OwogCkBAIC0xMzEyLDcgKzEzMTMs
NyBAQCBjaWZzX3JlYWR2X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCiAvKiBj
aWZzX2FzeW5jX3JlYWR2IC0gc2VuZCBhbiBhc3luYyB3cml0ZSwgYW5kIHNldCB1cCBtaWQgdG8g
aGFuZGxlIHJlc3VsdCAqLwogaW50Ci1jaWZzX2FzeW5jX3JlYWR2KHN0cnVjdCBjaWZzX3JlYWRk
YXRhICpyZGF0YSkKK2NpZnNfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAq
cmRhdGEpCiB7CiAJaW50IHJjOwogCVJFQURfUkVRICpzbWIgPSBOVUxMOwpAQCAtMTM2NCwxNSAr
MTM2NSwxMSBAQCBjaWZzX2FzeW5jX3JlYWR2KHN0cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YSkK
IAlyZGF0YS0+aW92WzFdLmlvdl9iYXNlID0gKGNoYXIgKilzbWIgKyA0OwogCXJkYXRhLT5pb3Zb
MV0uaW92X2xlbiA9IGdldF9yZmMxMDAyX2xlbmd0aChzbWIpOwogCi0Ja3JlZl9nZXQoJnJkYXRh
LT5yZWZjb3VudCk7CiAJcmMgPSBjaWZzX2NhbGxfYXN5bmModGNvbi0+c2VzLT5zZXJ2ZXIsICZy
cXN0LCBjaWZzX3JlYWR2X3JlY2VpdmUsCiAJCQkgICAgIGNpZnNfcmVhZHZfY2FsbGJhY2ssIE5V
TEwsIHJkYXRhLCAwLCBOVUxMKTsKIAogCWlmIChyYyA9PSAwKQogCQljaWZzX3N0YXRzX2luYygm
dGNvbi0+c3RhdHMuY2lmc19zdGF0cy5udW1fcmVhZHMpOwotCWVsc2UKLQkJa3JlZl9wdXQoJnJk
YXRhLT5yZWZjb3VudCwgY2lmc19yZWFkZGF0YV9yZWxlYXNlKTsKLQogCWNpZnNfc21hbGxfYnVm
X3JlbGVhc2Uoc21iKTsKIAlyZXR1cm4gcmM7CiB9CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50
L2ZpbGUuYyBiL2ZzL3NtYi9jbGllbnQvZmlsZS5jCmluZGV4IDNhMjEzNDMyNzc1Yi4uMjk4YWJk
ODIzNjI1IDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2ZpbGUuYworKysgYi9mcy9zbWIvY2xp
ZW50L2ZpbGUuYwpAQCAtMjk1MSw3ICsyOTUxLDcgQEAgc3RhdGljIGludCBjaWZzX3dyaXRlcGFn
ZXNfcmVnaW9uKHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nLAogCQkJY29udGludWU7CiAJ
CX0KIAotCQlmb2xpb19iYXRjaF9yZWxlYXNlKCZmYmF0Y2gpOwkJCisJCWZvbGlvX2JhdGNoX3Jl
bGVhc2UoJmZiYXRjaCk7CiAJCWNvbmRfcmVzY2hlZCgpOwogCX0gd2hpbGUgKHdiYy0+bnJfdG9f
d3JpdGUgPiAwKTsKIApAQCAtMzc4NSwxMyArMzc4NSwxMyBAQCBjaWZzX3N0cmljdF93cml0ZXYo
c3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20pCiAJcmV0dXJuIHdyaXR0
ZW47CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY2lmc19yZWFkZGF0YSAqY2lmc19yZWFkZGF0YV9hbGxv
Yyh3b3JrX2Z1bmNfdCBjb21wbGV0ZSkKK3N0YXRpYyBzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0
ICpjaWZzX3JlYWRkYXRhX2FsbG9jKHdvcmtfZnVuY190IGNvbXBsZXRlKQogewotCXN0cnVjdCBj
aWZzX3JlYWRkYXRhICpyZGF0YTsKKwlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YTsK
IAogCXJkYXRhID0ga3phbGxvYyhzaXplb2YoKnJkYXRhKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKHJk
YXRhKSB7Ci0JCWtyZWZfaW5pdCgmcmRhdGEtPnJlZmNvdW50KTsKKwkJcmVmY291bnRfc2V0KCZy
ZGF0YS0+c3VicmVxLnJlZiwgMSk7CiAJCUlOSVRfTElTVF9IRUFEKCZyZGF0YS0+bGlzdCk7CiAJ
CWluaXRfY29tcGxldGlvbigmcmRhdGEtPmRvbmUpOwogCQlJTklUX1dPUksoJnJkYXRhLT53b3Jr
LCBjb21wbGV0ZSk7CkBAIC0zODAxLDExICszODAxLDggQEAgc3RhdGljIHN0cnVjdCBjaWZzX3Jl
YWRkYXRhICpjaWZzX3JlYWRkYXRhX2FsbG9jKHdvcmtfZnVuY190IGNvbXBsZXRlKQogfQogCiB2
b2lkCi1jaWZzX3JlYWRkYXRhX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZmNvdW50KQorY2lmc19y
ZWFkZGF0YV9yZWxlYXNlKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKQogewotCXN0
cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YSA9IGNvbnRhaW5lcl9vZihyZWZjb3VudCwKLQkJCQkJ
c3RydWN0IGNpZnNfcmVhZGRhdGEsIHJlZmNvdW50KTsKLQogCWlmIChyZGF0YS0+Y3R4KQogCQlr
cmVmX3B1dCgmcmRhdGEtPmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKICNp
ZmRlZiBDT05GSUdfQ0lGU19TTUJfRElSRUNUCkBAIC0zODI1LDE2ICszODIyLDE2IEBAIHN0YXRp
YyB2b2lkIGNvbGxlY3RfdW5jYWNoZWRfcmVhZF9kYXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0
eCk7CiBzdGF0aWMgdm9pZAogY2lmc191bmNhY2hlZF9yZWFkdl9jb21wbGV0ZShzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGNpZnNfcmVhZGRhdGEgKnJkYXRhID0gY29udGFp
bmVyX29mKHdvcmssCi0JCQkJCQlzdHJ1Y3QgY2lmc19yZWFkZGF0YSwgd29yayk7CisJc3RydWN0
IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPQorCQljb250YWluZXJfb2Yod29yaywgc3RydWN0
IGNpZnNfaW9fc3VicmVxdWVzdCwgd29yayk7CiAKIAljb21wbGV0ZSgmcmRhdGEtPmRvbmUpOwog
CWNvbGxlY3RfdW5jYWNoZWRfcmVhZF9kYXRhKHJkYXRhLT5jdHgpOwogCS8qIHRoZSBiZWxvdyBj
YWxsIGNhbiBwb3NzaWJseSBmcmVlIHRoZSBsYXN0IHJlZiB0byBhaW8gY3R4ICovCi0Ja3JlZl9w
dXQoJnJkYXRhLT5yZWZjb3VudCwgY2lmc19yZWFkZGF0YV9yZWxlYXNlKTsKKwljaWZzX3B1dF9y
ZWFkZGF0YShyZGF0YSk7CiB9CiAKLXN0YXRpYyBpbnQgY2lmc19yZXNlbmRfcmRhdGEoc3RydWN0
IGNpZnNfcmVhZGRhdGEgKnJkYXRhLAorc3RhdGljIGludCBjaWZzX3Jlc2VuZF9yZGF0YShzdHJ1
Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSwKIAkJCXN0cnVjdCBsaXN0X2hlYWQgKnJkYXRh
X2xpc3QsCiAJCQlzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCiB7CkBAIC0zOTAyLDcgKzM4OTks
NyBAQCBzdGF0aWMgaW50IGNpZnNfcmVzZW5kX3JkYXRhKHN0cnVjdCBjaWZzX3JlYWRkYXRhICpy
ZGF0YSwKIAl9IHdoaWxlIChyYyA9PSAtRUFHQUlOKTsKIAogZmFpbDoKLQlrcmVmX3B1dCgmcmRh
dGEtPnJlZmNvdW50LCBjaWZzX3JlYWRkYXRhX3JlbGVhc2UpOworCWNpZnNfcHV0X3JlYWRkYXRh
KHJkYXRhKTsKIAlyZXR1cm4gcmM7CiB9CiAKQEAgLTM5MTEsNyArMzkwOCw3IEBAIGNpZnNfc2Vu
ZF9hc3luY19yZWFkKGxvZmZfdCBmcG9zLCBzaXplX3QgbGVuLCBzdHJ1Y3QgY2lmc0ZpbGVJbmZv
ICpvcGVuX2ZpbGUsCiAJCSAgICAgc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYiwgc3RydWN0
IGxpc3RfaGVhZCAqcmRhdGFfbGlzdCwKIAkJICAgICBzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgp
CiB7Ci0Jc3RydWN0IGNpZnNfcmVhZGRhdGEgKnJkYXRhOworCXN0cnVjdCBjaWZzX2lvX3N1YnJl
cXVlc3QgKnJkYXRhOwogCXVuc2lnbmVkIGludCByc2l6ZSwgbnNlZ3MsIG1heF9zZWdzID0gSU5U
X01BWDsKIAlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHNfb25fc3RhY2s7CiAJc3RydWN0IGNp
ZnNfY3JlZGl0cyAqY3JlZGl0cyA9ICZjcmVkaXRzX29uX3N0YWNrOwpAQCAtMzk5Myw3ICszOTkw
LDcgQEAgY2lmc19zZW5kX2FzeW5jX3JlYWQobG9mZl90IGZwb3MsIHNpemVfdCBsZW4sIHN0cnVj
dCBjaWZzRmlsZUluZm8gKm9wZW5fZmlsZSwKIAogCQlpZiAocmMpIHsKIAkJCWFkZF9jcmVkaXRz
X2FuZF93YWtlX2lmKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCAwKTsKLQkJCWtyZWZfcHV0KCZy
ZGF0YS0+cmVmY291bnQsIGNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCQljaWZzX3B1dF9yZWFk
ZGF0YShyZGF0YSk7CiAJCQlpZiAocmMgPT0gLUVBR0FJTikKIAkJCQljb250aW51ZTsKIAkJCWJy
ZWFrOwpAQCAtNDAxMSw3ICs0MDA4LDcgQEAgY2lmc19zZW5kX2FzeW5jX3JlYWQobG9mZl90IGZw
b3MsIHNpemVfdCBsZW4sIHN0cnVjdCBjaWZzRmlsZUluZm8gKm9wZW5fZmlsZSwKIHN0YXRpYyB2
b2lkCiBjb2xsZWN0X3VuY2FjaGVkX3JlYWRfZGF0YShzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgp
CiB7Ci0Jc3RydWN0IGNpZnNfcmVhZGRhdGEgKnJkYXRhLCAqdG1wOworCXN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKnJkYXRhLCAqdG1wOwogCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2I7
CiAJaW50IHJjOwogCkBAIC00MDU3LDggKzQwNTQsNyBAQCBjb2xsZWN0X3VuY2FjaGVkX3JlYWRf
ZGF0YShzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCiAJCQkJCQlyZGF0YS0+Y2ZpbGUsIGNpZnNf
c2IsCiAJCQkJCQkmdG1wX2xpc3QsIGN0eCk7CiAKLQkJCQkJa3JlZl9wdXQoJnJkYXRhLT5yZWZj
b3VudCwKLQkJCQkJCWNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCQkJCWNpZnNfcHV0X3JlYWRk
YXRhKHJkYXRhKTsKIAkJCQl9CiAKIAkJCQlsaXN0X3NwbGljZSgmdG1wX2xpc3QsICZjdHgtPmxp
c3QpOwpAQCAtNDA3NCw3ICs0MDcwLDcgQEAgY29sbGVjdF91bmNhY2hlZF9yZWFkX2RhdGEoc3Ry
dWN0IGNpZnNfYWlvX2N0eCAqY3R4KQogCQkJY3R4LT50b3RhbF9sZW4gKz0gcmRhdGEtPmdvdF9i
eXRlczsKIAkJfQogCQlsaXN0X2RlbF9pbml0KCZyZGF0YS0+bGlzdCk7Ci0JCWtyZWZfcHV0KCZy
ZGF0YS0+cmVmY291bnQsIGNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCWNpZnNfcHV0X3JlYWRk
YXRhKHJkYXRhKTsKIAl9CiAKIAkvKiBtYXNrIG5vZGF0YSBjYXNlICovCkBAIC00NDQ2LDggKzQ0
NDIsOCBAQCBzdGF0aWMgdm9pZCBjaWZzX3VubG9ja19mb2xpb3Moc3RydWN0IGFkZHJlc3Nfc3Bh
Y2UgKm1hcHBpbmcsIHBnb2ZmX3QgZmlyc3QsIHBnbwogCiBzdGF0aWMgdm9pZCBjaWZzX3JlYWRh
aGVhZF9jb21wbGV0ZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGNpZnNf
cmVhZGRhdGEgKnJkYXRhID0gY29udGFpbmVyX29mKHdvcmssCi0JCQkJCQkgICBzdHJ1Y3QgY2lm
c19yZWFkZGF0YSwgd29yayk7CisJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPSBj
b250YWluZXJfb2Yod29yaywKKwkJCQkJCQlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0LCB3b3Jr
KTsKIAlzdHJ1Y3QgZm9saW8gKmZvbGlvOwogCXBnb2ZmX3QgbGFzdDsKIAlib29sIGdvb2QgPSBy
ZGF0YS0+cmVzdWx0ID09IDAgfHwgKHJkYXRhLT5yZXN1bHQgPT0gLUVBR0FJTiAmJiByZGF0YS0+
Z290X2J5dGVzKTsKQEAgLTQ0NzMsNyArNDQ2OSw3IEBAIHN0YXRpYyB2b2lkIGNpZnNfcmVhZGFo
ZWFkX2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAl9CiAJcmN1X3JlYWRfdW5s
b2NrKCk7CiAKLQlrcmVmX3B1dCgmcmRhdGEtPnJlZmNvdW50LCBjaWZzX3JlYWRkYXRhX3JlbGVh
c2UpOworCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsKIH0KIAogc3RhdGljIHZvaWQgY2lmc19y
ZWFkYWhlYWQoc3RydWN0IHJlYWRhaGVhZF9jb250cm9sICpyYWN0bCkKQEAgLTQ1MTMsNyArNDUw
OSw3IEBAIHN0YXRpYyB2b2lkIGNpZnNfcmVhZGFoZWFkKHN0cnVjdCByZWFkYWhlYWRfY29udHJv
bCAqcmFjdGwpCiAJICovCiAJd2hpbGUgKChucl9wYWdlcyA9IHJhX3BhZ2VzKSkgewogCQl1bnNp
Z25lZCBpbnQgaSwgcnNpemU7Ci0JCXN0cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YTsKKwkJc3Ry
dWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGE7CiAJCXN0cnVjdCBjaWZzX2NyZWRpdHMgY3Jl
ZGl0c19vbl9zdGFjazsKIAkJc3RydWN0IGNpZnNfY3JlZGl0cyAqY3JlZGl0cyA9ICZjcmVkaXRz
X29uX3N0YWNrOwogCQlzdHJ1Y3QgZm9saW8gKmZvbGlvOwpAQCAtNDYzMiwxMSArNDYyOCwxMSBA
QCBzdGF0aWMgdm9pZCBjaWZzX3JlYWRhaGVhZChzdHJ1Y3QgcmVhZGFoZWFkX2NvbnRyb2wgKnJh
Y3RsKQogCQkJCQkgICByZGF0YS0+b2Zmc2V0IC8gUEFHRV9TSVpFLAogCQkJCQkgICAocmRhdGEt
Pm9mZnNldCArIHJkYXRhLT5ieXRlcyAtIDEpIC8gUEFHRV9TSVpFKTsKIAkJCS8qIEZhbGxiYWNr
IHRvIHRoZSByZWFkcGFnZSBpbiBlcnJvci9yZWNvbm5lY3QgY2FzZXMgKi8KLQkJCWtyZWZfcHV0
KCZyZGF0YS0+cmVmY291bnQsIGNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCQljaWZzX3B1dF9y
ZWFkZGF0YShyZGF0YSk7CiAJCQlicmVhazsKIAkJfQogCi0JCWtyZWZfcHV0KCZyZGF0YS0+cmVm
Y291bnQsIGNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRh
KTsKIAl9CiAKIAlmcmVlX3hpZCh4aWQpOwpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9zbWIy
b3BzLmMgYi9mcy9zbWIvY2xpZW50L3NtYjJvcHMuYwppbmRleCBkOTU1M2MyNTU2YTIuLjYxZDgx
ZTM1YTZiNCAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9zbWIyb3BzLmMKKysrIGIvZnMvc21i
L2NsaWVudC9zbWIyb3BzLmMKQEAgLTQ0NjcsNyArNDQ2Nyw3IEBAIGhhbmRsZV9yZWFkX2RhdGEo
c3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCwK
IAl1bnNpZ25lZCBpbnQgY3VyX29mZjsKIAl1bnNpZ25lZCBpbnQgY3VyX3BhZ2VfaWR4OwogCXVu
c2lnbmVkIGludCBwYWRfbGVuOwotCXN0cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YSA9IG1pZC0+
Y2FsbGJhY2tfZGF0YTsKKwlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSA9IG1pZC0+
Y2FsbGJhY2tfZGF0YTsKIAlzdHJ1Y3Qgc21iMl9oZHIgKnNoZHIgPSAoc3RydWN0IHNtYjJfaGRy
ICopYnVmOwogCWludCBsZW5ndGg7CiAJYm9vbCB1c2VfcmRtYV9tciA9IGZhbHNlOwpkaWZmIC0t
Z2l0IGEvZnMvc21iL2NsaWVudC9zbWIycGR1LmMgYi9mcy9zbWIvY2xpZW50L3NtYjJwZHUuYwpp
bmRleCAyODgxOTlmMGI5ODcuLjM1YWZjN2U1MDBhNCAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVu
dC9zbWIycGR1LmMKKysrIGIvZnMvc21iL2NsaWVudC9zbWIycGR1LmMKQEAgLTIzLDYgKzIzLDgg
QEAKICNpbmNsdWRlIDxsaW51eC91dWlkLmg+CiAjaW5jbHVkZSA8bGludXgvcGFnZW1hcC5oPgog
I2luY2x1ZGUgPGxpbnV4L3hhdHRyLmg+CisjaW5jbHVkZSA8bGludXgvbmV0ZnMuaD4KKyNpbmNs
dWRlIDx0cmFjZS9ldmVudHMvbmV0ZnMuaD4KICNpbmNsdWRlICJjaWZzZ2xvYi5oIgogI2luY2x1
ZGUgImNpZnNhY2wuaCIKICNpbmNsdWRlICJjaWZzcHJvdG8uaCIKQEAgLTQyMjgsNyArNDIzMCw3
IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBzbWIzX3VzZV9yZG1hX29mZmxvYWQoc3RydWN0IGNpZnNf
aW9fcGFybXMgKmlvX3Bhcm1zKQogICovCiBzdGF0aWMgaW50CiBzbWIyX25ld19yZWFkX3JlcSh2
b2lkICoqYnVmLCB1bnNpZ25lZCBpbnQgKnRvdGFsX2xlbiwKLQlzdHJ1Y3QgY2lmc19pb19wYXJt
cyAqaW9fcGFybXMsIHN0cnVjdCBjaWZzX3JlYWRkYXRhICpyZGF0YSwKKwlzdHJ1Y3QgY2lmc19p
b19wYXJtcyAqaW9fcGFybXMsIHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhLAogCXVu
c2lnbmVkIGludCByZW1haW5pbmdfYnl0ZXMsIGludCByZXF1ZXN0X3R5cGUpCiB7CiAJaW50IHJj
ID0gLUVBQ0NFUzsKQEAgLTQzMjAsNyArNDMyMiw3IEBAIHNtYjJfbmV3X3JlYWRfcmVxKHZvaWQg
KipidWYsIHVuc2lnbmVkIGludCAqdG90YWxfbGVuLAogc3RhdGljIHZvaWQKIHNtYjJfcmVhZHZf
Y2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiB7Ci0Jc3RydWN0IGNpZnNfcmVhZGRh
dGEgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRhOworCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVl
c3QgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRhOwogCXN0cnVjdCBjaWZzX3Rjb24gKnRjb24g
PSB0bGlua190Y29uKHJkYXRhLT5jZmlsZS0+dGxpbmspOwogCXN0cnVjdCBUQ1BfU2VydmVyX0lu
Zm8gKnNlcnZlciA9IHJkYXRhLT5zZXJ2ZXI7CiAJc3RydWN0IHNtYjJfaGRyICpzaGRyID0KQEAg
LTQ0MDcsNyArNDQwOSw3IEBAIHNtYjJfcmVhZHZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5
ICptaWQpCiAKIC8qIHNtYjJfYXN5bmNfcmVhZHYgLSBzZW5kIGFuIGFzeW5jIHJlYWQsIGFuZCBz
ZXQgdXAgbWlkIHRvIGhhbmRsZSByZXN1bHQgKi8KIGludAotc21iMl9hc3luY19yZWFkdihzdHJ1
Y3QgY2lmc19yZWFkZGF0YSAqcmRhdGEpCitzbWIyX2FzeW5jX3JlYWR2KHN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKnJkYXRhKQogewogCWludCByYywgZmxhZ3MgPSAwOwogCWNoYXIgKmJ1ZjsK
QEAgLTQ0NjUsMTMgKzQ0NjcsMTMgQEAgc21iMl9hc3luY19yZWFkdihzdHJ1Y3QgY2lmc19yZWFk
ZGF0YSAqcmRhdGEpCiAJCWZsYWdzIHw9IENJRlNfSEFTX0NSRURJVFM7CiAJfQogCi0Ja3JlZl9n
ZXQoJnJkYXRhLT5yZWZjb3VudCk7CisJY2lmc19nZXRfcmVhZGRhdGEocmRhdGEpOwogCXJjID0g
Y2lmc19jYWxsX2FzeW5jKHNlcnZlciwgJnJxc3QsCiAJCQkgICAgIGNpZnNfcmVhZHZfcmVjZWl2
ZSwgc21iMl9yZWFkdl9jYWxsYmFjaywKIAkJCSAgICAgc21iM19oYW5kbGVfcmVhZF9kYXRhLCBy
ZGF0YSwgZmxhZ3MsCiAJCQkgICAgICZyZGF0YS0+Y3JlZGl0cyk7CiAJaWYgKHJjKSB7Ci0JCWty
ZWZfcHV0KCZyZGF0YS0+cmVmY291bnQsIGNpZnNfcmVhZGRhdGFfcmVsZWFzZSk7CisJCWNpZnNf
cHV0X3JlYWRkYXRhKHJkYXRhKTsKIAkJY2lmc19zdGF0c19mYWlsX2luYyhpb19wYXJtcy50Y29u
LCBTTUIyX1JFQURfSEUpOwogCQl0cmFjZV9zbWIzX3JlYWRfZXJyKDAgLyogeGlkICovLCBpb19w
YXJtcy5wZXJzaXN0ZW50X2ZpZCwKIAkJCQkgICAgaW9fcGFybXMudGNvbi0+dGlkLApkaWZmIC0t
Z2l0IGEvZnMvc21iL2NsaWVudC9zbWIycHJvdG8uaCBiL2ZzL3NtYi9jbGllbnQvc21iMnByb3Rv
LmgKaW5kZXggMDAzNGI1MzdiMGIzLi42MTE2YTgwM2Y2Y2YgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9j
bGllbnQvc21iMnByb3RvLmgKKysrIGIvZnMvc21iL2NsaWVudC9zbWIycHJvdG8uaApAQCAtMjAy
LDcgKzIwMiw3IEBAIGV4dGVybiBpbnQgU01CMl9xdWVyeV9hY2woY29uc3QgdW5zaWduZWQgaW50
IHhpZCwgc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwKIGV4dGVybiBpbnQgU01CMl9nZXRfc3J2X251
bShjb25zdCB1bnNpZ25lZCBpbnQgeGlkLCBzdHJ1Y3QgY2lmc190Y29uICp0Y29uLAogCQkJICAg
IHU2NCBwZXJzaXN0ZW50X2ZpZCwgdTY0IHZvbGF0aWxlX2ZpZCwKIAkJCSAgICBfX2xlNjQgKnVu
aXF1ZWlkKTsKLWV4dGVybiBpbnQgc21iMl9hc3luY19yZWFkdihzdHJ1Y3QgY2lmc19yZWFkZGF0
YSAqcmRhdGEpOworZXh0ZXJuIGludCBzbWIyX2FzeW5jX3JlYWR2KHN0cnVjdCBjaWZzX2lvX3N1
YnJlcXVlc3QgKnJkYXRhKTsKIGV4dGVybiBpbnQgU01CMl9yZWFkKGNvbnN0IHVuc2lnbmVkIGlu
dCB4aWQsIHN0cnVjdCBjaWZzX2lvX3Bhcm1zICppb19wYXJtcywKIAkJICAgICB1bnNpZ25lZCBp
bnQgKm5ieXRlcywgY2hhciAqKmJ1ZiwgaW50ICpidWZfdHlwZSk7CiBleHRlcm4gaW50IHNtYjJf
YXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX3dyaXRlZGF0YSAqd2RhdGEsCmRpZmYgLS1naXQgYS9m
cy9zbWIvY2xpZW50L3RyYW5zcG9ydC5jIGIvZnMvc21iL2NsaWVudC90cmFuc3BvcnQuYwppbmRl
eCA0ZjcxN2FkN2MyMWIuLmJhZTc1OGVjNjIxYiAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC90
cmFuc3BvcnQuYworKysgYi9mcy9zbWIvY2xpZW50L3RyYW5zcG9ydC5jCkBAIC0xNjc3LDcgKzE2
NzcsNyBAQCBfX2NpZnNfcmVhZHZfZGlzY2FyZChzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2
ZXIsIHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkLAogc3RhdGljIGludAogY2lmc19yZWFkdl9kaXNj
YXJkKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciwgc3RydWN0IG1pZF9xX2VudHJ5ICpt
aWQpCiB7Ci0Jc3RydWN0IGNpZnNfcmVhZGRhdGEgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRh
OworCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhID0gbWlkLT5jYWxsYmFja19kYXRh
OwogCiAJcmV0dXJuICBfX2NpZnNfcmVhZHZfZGlzY2FyZChzZXJ2ZXIsIG1pZCwgcmRhdGEtPnJl
c3VsdCk7CiB9CkBAIC0xNjg3LDcgKzE2ODcsNyBAQCBjaWZzX3JlYWR2X3JlY2VpdmUoc3RydWN0
IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyLCBzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCkKIHsKIAlp
bnQgbGVuZ3RoLCBsZW47CiAJdW5zaWduZWQgaW50IGRhdGFfb2Zmc2V0LCBkYXRhX2xlbjsKLQlz
dHJ1Y3QgY2lmc19yZWFkZGF0YSAqcmRhdGEgPSBtaWQtPmNhbGxiYWNrX2RhdGE7CisJc3RydWN0
IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEgPSBtaWQtPmNhbGxiYWNrX2RhdGE7CiAJY2hhciAq
YnVmID0gc2VydmVyLT5zbWFsbGJ1ZjsKIAl1bnNpZ25lZCBpbnQgYnVmbGVuID0gc2VydmVyLT5w
ZHVfc2l6ZSArIEhFQURFUl9QUkVBTUJMRV9TSVpFKHNlcnZlcik7CiAJYm9vbCB1c2VfcmRtYV9t
ciA9IGZhbHNlOwotLSAKMi40MC4xCgo=
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0003-cifs-Set-zero_point-in-the-copy_file_range-and-remap.patch"
Content-Disposition: attachment; 
	filename="0003-cifs-Set-zero_point-in-the-copy_file_range-and-remap.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46f8>
X-Attachment-Id: f_lrpgn46f8

RnJvbSA3ODA4ZGE4ODJjMmQ5MjZlNjJmZTFiY2I2MDRmMjhjYWQ2OTY0Yzc1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBUdWUsIDI4IE5vdiAyMDIzIDE2OjI2OjQ0ICswMDAwClN1YmplY3Q6IFtQQVRDSCAwMy8x
Ml0gY2lmczogU2V0IHplcm9fcG9pbnQgaW4gdGhlIGNvcHlfZmlsZV9yYW5nZSgpIGFuZAogcmVt
YXBfZmlsZV9yYW5nZSgpCgpTZXQgemVyb19wb2ludCBpbiB0aGUgY29weV9maWxlX3JhbmdlKCkg
YW5kIHJlbWFwX2ZpbGVfcmFuZ2UoKQppbXBsZW1lbnRhdGlvbnMgc28gdGhhdCB3ZSBkb24ndCBz
a2lwIHJlYWRpbmcgZGF0YSBtb2RpZmllZCBvbiBhCnNlcnZlci1zaWRlIGNvcHkuCgpTaWduZWQt
b2ZmLWJ5OiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpjYzogU2h5YW0gUHJh
c2FkIE4gPG5zcG1hbmdhbG9yZUBnbWFpbC5jb20+CmNjOiBSb2hpdGggU3VyYWJhdHR1bGEgPHJv
aGl0aHMubXNmdEBnbWFpbC5jb20+CmNjOiBKZWZmIExheXRvbiA8amxheXRvbkBrZXJuZWwub3Jn
PgpjYzogbGludXgtY2lmc0B2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0
LmNvbQpjYzogbGludXgtZnNkZXZlbEB2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNr
Lm9yZwotLS0KIGZzL3NtYi9jbGllbnQvY2lmc2ZzLmMgfCA2ICsrKysrKwogMSBmaWxlIGNoYW5n
ZWQsIDYgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvY2lmc2ZzLmMg
Yi9mcy9zbWIvY2xpZW50L2NpZnNmcy5jCmluZGV4IDJhNGE0ZTNhODc1MS4uNDE2MTc1NDFkMTc1
IDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2NpZnNmcy5jCisrKyBiL2ZzL3NtYi9jbGllbnQv
Y2lmc2ZzLmMKQEAgLTEzNDAsNiArMTM0MCw4IEBAIHN0YXRpYyBsb2ZmX3QgY2lmc19yZW1hcF9m
aWxlX3JhbmdlKHN0cnVjdCBmaWxlICpzcmNfZmlsZSwgbG9mZl90IG9mZiwKIAlyYyA9IGNpZnNf
Zmx1c2hfZm9saW8odGFyZ2V0X2lub2RlLCBkZXN0ZW5kLCAmZnN0YXJ0LCAmZmVuZCwgZmFsc2Up
OwogCWlmIChyYykKIAkJZ290byB1bmxvY2s7CisJaWYgKGZlbmQgPiB0YXJnZXRfY2lmc2ktPm5l
dGZzLnplcm9fcG9pbnQpCisJCXRhcmdldF9jaWZzaS0+bmV0ZnMuemVyb19wb2ludCA9IGZlbmQg
KyAxOwogCiAJLyogRGlzY2FyZCBhbGwgdGhlIGZvbGlvcyB0aGF0IG92ZXJsYXAgdGhlIGRlc3Rp
bmF0aW9uIHJlZ2lvbi4gKi8KIAljaWZzX2RiZyhGWUksICJhYm91dCB0byBkaXNjYXJkIHBhZ2Vz
ICVsbHgtJWxseFxuIiwgZnN0YXJ0LCBmZW5kKTsKQEAgLTEzNTgsNiArMTM2MCw4IEBAIHN0YXRp
YyBsb2ZmX3QgY2lmc19yZW1hcF9maWxlX3JhbmdlKHN0cnVjdCBmaWxlICpzcmNfZmlsZSwgbG9m
Zl90IG9mZiwKIAkJCWZzY2FjaGVfcmVzaXplX2Nvb2tpZShjaWZzX2lub2RlX2Nvb2tpZSh0YXJn
ZXRfaW5vZGUpLAogCQkJCQkgICAgICBuZXdfc2l6ZSk7CiAJCX0KKwkJaWYgKHJjID09IDAgJiYg
bmV3X3NpemUgPiB0YXJnZXRfY2lmc2ktPm5ldGZzLnplcm9fcG9pbnQpCisJCQl0YXJnZXRfY2lm
c2ktPm5ldGZzLnplcm9fcG9pbnQgPSBuZXdfc2l6ZTsKIAl9CiAKIAkvKiBmb3JjZSByZXZhbGlk
YXRlIG9mIHNpemUgYW5kIHRpbWVzdGFtcHMgb2YgdGFyZ2V0IGZpbGUgbm93CkBAIC0xNDQ5LDYg
KzE0NTMsOCBAQCBzc2l6ZV90IGNpZnNfZmlsZV9jb3B5Y2h1bmtfcmFuZ2UodW5zaWduZWQgaW50
IHhpZCwKIAlyYyA9IGNpZnNfZmx1c2hfZm9saW8odGFyZ2V0X2lub2RlLCBkZXN0ZW5kLCAmZnN0
YXJ0LCAmZmVuZCwgZmFsc2UpOwogCWlmIChyYykKIAkJZ290byB1bmxvY2s7CisJaWYgKGZlbmQg
PiB0YXJnZXRfY2lmc2ktPm5ldGZzLnplcm9fcG9pbnQpCisJCXRhcmdldF9jaWZzaS0+bmV0ZnMu
emVyb19wb2ludCA9IGZlbmQgKyAxOwogCiAJLyogRGlzY2FyZCBhbGwgdGhlIGZvbGlvcyB0aGF0
IG92ZXJsYXAgdGhlIGRlc3RpbmF0aW9uIHJlZ2lvbi4gKi8KIAl0cnVuY2F0ZV9pbm9kZV9wYWdl
c19yYW5nZSgmdGFyZ2V0X2lub2RlLT5pX2RhdGEsIGZzdGFydCwgZmVuZCk7Ci0tIAoyLjQwLjEK
Cg==
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0005-cifs-Use-more-fields-from-netfs_io_subrequest.patch"
Content-Disposition: attachment; 
	filename="0005-cifs-Use-more-fields-from-netfs_io_subrequest.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46d5>
X-Attachment-Id: f_lrpgn46d5

RnJvbSAxYmU3NDVjNDM5ZTc2ZDRjYzQwYzg3Mjk3YTdkNDM0MjExODJhNmU3IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTY6NTU6MjAgKzAxMDAKU3ViamVjdDogW1BBVENIIDA1LzEy
XSBjaWZzOiBVc2UgbW9yZSBmaWVsZHMgZnJvbSBuZXRmc19pb19zdWJyZXF1ZXN0CgpVc2UgbW9y
ZSBmaWVsZHMgZnJvbSBuZXRmc19pb19zdWJyZXF1ZXN0IGluc3RlYWQgb2YgdGhvc2UgaW5jb3Jw
b3JhdGVkIGludG8KY2lmc19pb19zdWJyZXF1ZXN0IGZyb20gY2lmc19yZWFkZGF0YSBhbmQgY2lm
c193cml0ZWRhdGEuCgpTaWduZWQtb2ZmLWJ5OiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRo
YXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1hbmdhbG9yZUBnbWFpbC5jb20+CmNjOiBS
b2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBnbWFpbC5jb20+CmNjOiBKZWZmIExheXRv
biA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgtY2lmc0B2Z2VyLmtlcm5lbC5vcmcKY2M6
IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGludXgtZnNkZXZlbEB2Z2VyLmtlcm5lbC5v
cmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZzL3NtYi9jbGllbnQvY2lmc2dsb2IuaCAg
fCAgIDMgLQogZnMvc21iL2NsaWVudC9jaWZzc21iLmMgICB8ICA1MiArKysrKysrKystLS0tLS0t
LS0KIGZzL3NtYi9jbGllbnQvZmlsZS5jICAgICAgfCAxMTIgKysrKysrKysrKysrKysrKysrKy0t
LS0tLS0tLS0tLS0tLS0tLS0KIGZzL3NtYi9jbGllbnQvc21iMm9wcy5jICAgfCAgIDQgKy0KIGZz
L3NtYi9jbGllbnQvc21iMnBkdS5jICAgfCAgNTIgKysrKysrKysrLS0tLS0tLS0tCiBmcy9zbWIv
Y2xpZW50L3RyYW5zcG9ydC5jIHwgICA2ICstCiA2IGZpbGVzIGNoYW5nZWQsIDExMyBpbnNlcnRp
b25zKCspLCAxMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC9jaWZz
Z2xvYi5oIGIvZnMvc21iL2NsaWVudC9jaWZzZ2xvYi5oCmluZGV4IDZiNDM0ZTBlMGRjNS4uYzRj
ZGMwMTI5MDAwIDEwMDY0NAotLS0gYS9mcy9zbWIvY2xpZW50L2NpZnNnbG9iLmgKKysrIGIvZnMv
c21iL2NsaWVudC9jaWZzZ2xvYi5oCkBAIC0xNDgwLDkgKzE0ODAsNiBAQCBzdHJ1Y3QgY2lmc19p
b19zdWJyZXF1ZXN0IHsKIAlzdHJ1Y3QgbGlzdF9oZWFkCQlsaXN0OwogCXN0cnVjdCBjb21wbGV0
aW9uCQlkb25lOwogCXN0cnVjdCB3b3JrX3N0cnVjdAkJd29yazsKLQlzdHJ1Y3QgaW92X2l0ZXIJ
CQlpdGVyOwotCV9fdTY0CQkJCW9mZnNldDsKLQl1bnNpZ25lZCBpbnQJCQlieXRlczsKIH07CiAK
IC8qCmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L2NpZnNzbWIuYyBiL2ZzL3NtYi9jbGllbnQv
Y2lmc3NtYi5jCmluZGV4IDFlYWQ4NjdhMGY0YS4uYjFjMzNhNjI0MTU3IDEwMDY0NAotLS0gYS9m
cy9zbWIvY2xpZW50L2NpZnNzbWIuYworKysgYi9mcy9zbWIvY2xpZW50L2NpZnNzbWIuYwpAQCAt
MTI2OSwxMiArMTI2OSwxMiBAQCBjaWZzX3JlYWR2X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRy
eSAqbWlkKQogCXN0cnVjdCBUQ1BfU2VydmVyX0luZm8gKnNlcnZlciA9IHRjb24tPnNlcy0+c2Vy
dmVyOwogCXN0cnVjdCBzbWJfcnFzdCBycXN0ID0geyAucnFfaW92ID0gcmRhdGEtPmlvdiwKIAkJ
CQkgLnJxX252ZWMgPSAyLAotCQkJCSAucnFfaXRlciA9IHJkYXRhLT5pdGVyIH07CisJCQkJIC5y
cV9pdGVyID0gcmRhdGEtPnN1YnJlcS5pb19pdGVyIH07CiAJc3RydWN0IGNpZnNfY3JlZGl0cyBj
cmVkaXRzID0geyAudmFsdWUgPSAxLCAuaW5zdGFuY2UgPSAwIH07CiAKLQljaWZzX2RiZyhGWUks
ICIlczogbWlkPSVsbHUgc3RhdGU9JWQgcmVzdWx0PSVkIGJ5dGVzPSV1XG4iLAorCWNpZnNfZGJn
KEZZSSwgIiVzOiBtaWQ9JWxsdSBzdGF0ZT0lZCByZXN1bHQ9JWQgYnl0ZXM9JXp1XG4iLAogCQkg
X19mdW5jX18sIG1pZC0+bWlkLCBtaWQtPm1pZF9zdGF0ZSwgcmRhdGEtPnJlc3VsdCwKLQkJIHJk
YXRhLT5ieXRlcyk7CisJCSByZGF0YS0+c3VicmVxLmxlbik7CiAKIAlzd2l0Y2ggKG1pZC0+bWlk
X3N0YXRlKSB7CiAJY2FzZSBNSURfUkVTUE9OU0VfUkVDRUlWRUQ6CkBAIC0xMzIyLDE0ICsxMzIy
LDE0IEBAIGNpZnNfYXN5bmNfcmVhZHYoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEp
CiAJc3RydWN0IHNtYl9ycXN0IHJxc3QgPSB7IC5ycV9pb3YgPSByZGF0YS0+aW92LAogCQkJCSAu
cnFfbnZlYyA9IDIgfTsKIAotCWNpZnNfZGJnKEZZSSwgIiVzOiBvZmZzZXQ9JWxsdSBieXRlcz0l
dVxuIiwKLQkJIF9fZnVuY19fLCByZGF0YS0+b2Zmc2V0LCByZGF0YS0+Ynl0ZXMpOworCWNpZnNf
ZGJnKEZZSSwgIiVzOiBvZmZzZXQ9JWxsdSBieXRlcz0lenVcbiIsCisJCSBfX2Z1bmNfXywgcmRh
dGEtPnN1YnJlcS5zdGFydCwgcmRhdGEtPnN1YnJlcS5sZW4pOwogCiAJaWYgKHRjb24tPnNlcy0+
Y2FwYWJpbGl0aWVzICYgQ0FQX0xBUkdFX0ZJTEVTKQogCQl3Y3QgPSAxMjsKIAllbHNlIHsKIAkJ
d2N0ID0gMTA7IC8qIG9sZCBzdHlsZSByZWFkICovCi0JCWlmICgocmRhdGEtPm9mZnNldCA+PiAz
MikgPiAwKSAgeworCQlpZiAoKHJkYXRhLT5zdWJyZXEuc3RhcnQgPj4gMzIpID4gMCkgIHsKIAkJ
CS8qIGNhbiBub3QgaGFuZGxlIHRoaXMgYmlnIG9mZnNldCBmb3Igb2xkICovCiAJCQlyZXR1cm4g
LUVJTzsKIAkJfQpAQCAtMTM0NCwxMiArMTM0NCwxMiBAQCBjaWZzX2FzeW5jX3JlYWR2KHN0cnVj
dCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKQogCiAJc21iLT5BbmRYQ29tbWFuZCA9IDB4RkY7
CS8qIG5vbmUgKi8KIAlzbWItPkZpZCA9IHJkYXRhLT5jZmlsZS0+ZmlkLm5ldGZpZDsKLQlzbWIt
Pk9mZnNldExvdyA9IGNwdV90b19sZTMyKHJkYXRhLT5vZmZzZXQgJiAweEZGRkZGRkZGKTsKKwlz
bWItPk9mZnNldExvdyA9IGNwdV90b19sZTMyKHJkYXRhLT5zdWJyZXEuc3RhcnQgJiAweEZGRkZG
RkZGKTsKIAlpZiAod2N0ID09IDEyKQotCQlzbWItPk9mZnNldEhpZ2ggPSBjcHVfdG9fbGUzMihy
ZGF0YS0+b2Zmc2V0ID4+IDMyKTsKKwkJc21iLT5PZmZzZXRIaWdoID0gY3B1X3RvX2xlMzIocmRh
dGEtPnN1YnJlcS5zdGFydCA+PiAzMik7CiAJc21iLT5SZW1haW5pbmcgPSAwOwotCXNtYi0+TWF4
Q291bnQgPSBjcHVfdG9fbGUxNihyZGF0YS0+Ynl0ZXMgJiAweEZGRkYpOwotCXNtYi0+TWF4Q291
bnRIaWdoID0gY3B1X3RvX2xlMzIocmRhdGEtPmJ5dGVzID4+IDE2KTsKKwlzbWItPk1heENvdW50
ID0gY3B1X3RvX2xlMTYocmRhdGEtPnN1YnJlcS5sZW4gJiAweEZGRkYpOworCXNtYi0+TWF4Q291
bnRIaWdoID0gY3B1X3RvX2xlMzIocmRhdGEtPnN1YnJlcS5sZW4gPj4gMTYpOwogCWlmICh3Y3Qg
PT0gMTIpCiAJCXNtYi0+Qnl0ZUNvdW50ID0gMDsKIAllbHNlIHsKQEAgLTE2MzMsMTMgKzE2MzMs
MTMgQEAgY2lmc193cml0ZXZfY2FsbGJhY2soc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiAJCSAq
IGNsaWVudC4gT1MvMiBzZXJ2ZXJzIGFyZSBrbm93biB0byBzZXQgaW5jb3JyZWN0CiAJCSAqIENv
dW50SGlnaCB2YWx1ZXMuCiAJCSAqLwotCQlpZiAod3JpdHRlbiA+IHdkYXRhLT5ieXRlcykKKwkJ
aWYgKHdyaXR0ZW4gPiB3ZGF0YS0+c3VicmVxLmxlbikKIAkJCXdyaXR0ZW4gJj0gMHhGRkZGOwog
Ci0JCWlmICh3cml0dGVuIDwgd2RhdGEtPmJ5dGVzKQorCQlpZiAod3JpdHRlbiA8IHdkYXRhLT5z
dWJyZXEubGVuKQogCQkJd2RhdGEtPnJlc3VsdCA9IC1FTk9TUEM7CiAJCWVsc2UKLQkJCXdkYXRh
LT5ieXRlcyA9IHdyaXR0ZW47CisJCQl3ZGF0YS0+c3VicmVxLmxlbiA9IHdyaXR0ZW47CiAJCWJy
ZWFrOwogCWNhc2UgTUlEX1JFUVVFU1RfU1VCTUlUVEVEOgogCWNhc2UgTUlEX1JFVFJZX05FRURF
RDoKQEAgLTE2NzAsNyArMTY3MCw3IEBAIGNpZnNfYXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKndkYXRhKQogCQl3Y3QgPSAxNDsKIAl9IGVsc2UgewogCQl3Y3QgPSAxMjsK
LQkJaWYgKHdkYXRhLT5vZmZzZXQgPj4gMzIgPiAwKSB7CisJCWlmICh3ZGF0YS0+c3VicmVxLnN0
YXJ0ID4+IDMyID4gMCkgewogCQkJLyogY2FuIG5vdCBoYW5kbGUgYmlnIG9mZnNldCBmb3Igb2xk
IHNydiAqLwogCQkJcmV0dXJuIC1FSU87CiAJCX0KQEAgLTE2ODUsOSArMTY4NSw5IEBAIGNpZnNf
YXN5bmNfd3JpdGV2KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCiAJc21iLT5B
bmRYQ29tbWFuZCA9IDB4RkY7CS8qIG5vbmUgKi8KIAlzbWItPkZpZCA9IHdkYXRhLT5jZmlsZS0+
ZmlkLm5ldGZpZDsKLQlzbWItPk9mZnNldExvdyA9IGNwdV90b19sZTMyKHdkYXRhLT5vZmZzZXQg
JiAweEZGRkZGRkZGKTsKKwlzbWItPk9mZnNldExvdyA9IGNwdV90b19sZTMyKHdkYXRhLT5zdWJy
ZXEuc3RhcnQgJiAweEZGRkZGRkZGKTsKIAlpZiAod2N0ID09IDE0KQotCQlzbWItPk9mZnNldEhp
Z2ggPSBjcHVfdG9fbGUzMih3ZGF0YS0+b2Zmc2V0ID4+IDMyKTsKKwkJc21iLT5PZmZzZXRIaWdo
ID0gY3B1X3RvX2xlMzIod2RhdGEtPnN1YnJlcS5zdGFydCA+PiAzMik7CiAJc21iLT5SZXNlcnZl
ZCA9IDB4RkZGRkZGRkY7CiAJc21iLT5Xcml0ZU1vZGUgPSAwOwogCXNtYi0+UmVtYWluaW5nID0g
MDsKQEAgLTE3MDMsMjQgKzE3MDMsMjQgQEAgY2lmc19hc3luY193cml0ZXYoc3RydWN0IGNpZnNf
aW9fc3VicmVxdWVzdCAqd2RhdGEpCiAKIAlycXN0LnJxX2lvdiA9IGlvdjsKIAlycXN0LnJxX252
ZWMgPSAyOwotCXJxc3QucnFfaXRlciA9IHdkYXRhLT5pdGVyOwotCXJxc3QucnFfaXRlcl9zaXpl
ID0gaW92X2l0ZXJfY291bnQoJndkYXRhLT5pdGVyKTsKKwlycXN0LnJxX2l0ZXIgPSB3ZGF0YS0+
c3VicmVxLmlvX2l0ZXI7CisJcnFzdC5ycV9pdGVyX3NpemUgPSBpb3ZfaXRlcl9jb3VudCgmd2Rh
dGEtPnN1YnJlcS5pb19pdGVyKTsKIAotCWNpZnNfZGJnKEZZSSwgImFzeW5jIHdyaXRlIGF0ICVs
bHUgJXUgYnl0ZXNcbiIsCi0JCSB3ZGF0YS0+b2Zmc2V0LCB3ZGF0YS0+Ynl0ZXMpOworCWNpZnNf
ZGJnKEZZSSwgImFzeW5jIHdyaXRlIGF0ICVsbHUgJXp1IGJ5dGVzXG4iLAorCQkgd2RhdGEtPnN1
YnJlcS5zdGFydCwgd2RhdGEtPnN1YnJlcS5sZW4pOwogCi0Jc21iLT5EYXRhTGVuZ3RoTG93ID0g
Y3B1X3RvX2xlMTYod2RhdGEtPmJ5dGVzICYgMHhGRkZGKTsKLQlzbWItPkRhdGFMZW5ndGhIaWdo
ID0gY3B1X3RvX2xlMTYod2RhdGEtPmJ5dGVzID4+IDE2KTsKKwlzbWItPkRhdGFMZW5ndGhMb3cg
PSBjcHVfdG9fbGUxNih3ZGF0YS0+c3VicmVxLmxlbiAmIDB4RkZGRik7CisJc21iLT5EYXRhTGVu
Z3RoSGlnaCA9IGNwdV90b19sZTE2KHdkYXRhLT5zdWJyZXEubGVuID4+IDE2KTsKIAogCWlmICh3
Y3QgPT0gMTQpIHsKLQkJaW5jX3JmYzEwMDFfbGVuKCZzbWItPmhkciwgd2RhdGEtPmJ5dGVzICsg
MSk7Ci0JCXB1dF9iY2Mod2RhdGEtPmJ5dGVzICsgMSwgJnNtYi0+aGRyKTsKKwkJaW5jX3JmYzEw
MDFfbGVuKCZzbWItPmhkciwgd2RhdGEtPnN1YnJlcS5sZW4gKyAxKTsKKwkJcHV0X2JjYyh3ZGF0
YS0+c3VicmVxLmxlbiArIDEsICZzbWItPmhkcik7CiAJfSBlbHNlIHsKIAkJLyogd2N0ID09IDEy
ICovCiAJCXN0cnVjdCBzbWJfY29tX3dyaXRleF9yZXEgKnNtYncgPQogCQkJCShzdHJ1Y3Qgc21i
X2NvbV93cml0ZXhfcmVxICopc21iOwotCQlpbmNfcmZjMTAwMV9sZW4oJnNtYnctPmhkciwgd2Rh
dGEtPmJ5dGVzICsgNSk7Ci0JCXB1dF9iY2Mod2RhdGEtPmJ5dGVzICsgNSwgJnNtYnctPmhkcik7
CisJCWluY19yZmMxMDAxX2xlbigmc21idy0+aGRyLCB3ZGF0YS0+c3VicmVxLmxlbiArIDUpOwor
CQlwdXRfYmNjKHdkYXRhLT5zdWJyZXEubGVuICsgNSwgJnNtYnctPmhkcik7CiAJCWlvdlsxXS5p
b3ZfbGVuICs9IDQ7IC8qIHBhZCBiaWdnZXIgYnkgZm91ciBieXRlcyAqLwogCX0KIApkaWZmIC0t
Z2l0IGEvZnMvc21iL2NsaWVudC9maWxlLmMgYi9mcy9zbWIvY2xpZW50L2ZpbGUuYwppbmRleCA0
NzkwZGM1NTBiODAuLmY3Y2I4ZDlhMzQ3NyAxMDA2NDQKLS0tIGEvZnMvc21iL2NsaWVudC9maWxl
LmMKKysrIGIvZnMvc21iL2NsaWVudC9maWxlLmMKQEAgLTI0NDAsOCArMjQ0MCw4IEBAIGNpZnNf
d3JpdGV2X3JlcXVldWUoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEpCiAJaW50IHJj
ID0gMDsKIAlzdHJ1Y3QgaW5vZGUgKmlub2RlID0gZF9pbm9kZSh3ZGF0YS0+Y2ZpbGUtPmRlbnRy
eSk7CiAJc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyOwotCXVuc2lnbmVkIGludCByZXN0
X2xlbiA9IHdkYXRhLT5ieXRlczsKLQlsb2ZmX3QgZnBvcyA9IHdkYXRhLT5vZmZzZXQ7CisJdW5z
aWduZWQgaW50IHJlc3RfbGVuID0gd2RhdGEtPnN1YnJlcS5sZW47CisJbG9mZl90IGZwb3MgPSB3
ZGF0YS0+c3VicmVxLnN0YXJ0OwogCiAJc2VydmVyID0gdGxpbmtfdGNvbih3ZGF0YS0+Y2ZpbGUt
PnRsaW5rKS0+c2VzLT5zZXJ2ZXI7CiAJZG8gewpAQCAtMjQ2NiwxNCArMjQ2NiwxNCBAQCBjaWZz
X3dyaXRldl9yZXF1ZXVlKHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCQl9CiAK
IAkJd2RhdGEyLT5zeW5jX21vZGUgPSB3ZGF0YS0+c3luY19tb2RlOwotCQl3ZGF0YTItPm9mZnNl
dAk9IGZwb3M7Ci0JCXdkYXRhMi0+Ynl0ZXMJPSBjdXJfbGVuOwotCQl3ZGF0YTItPml0ZXIgPSB3
ZGF0YS0+aXRlcjsKKwkJd2RhdGEyLT5zdWJyZXEuc3RhcnQJPSBmcG9zOworCQl3ZGF0YTItPnN1
YnJlcS5sZW4JPSBjdXJfbGVuOworCQl3ZGF0YTItPnN1YnJlcS5pb19pdGVyID0gd2RhdGEtPnN1
YnJlcS5pb19pdGVyOwogCi0JCWlvdl9pdGVyX2FkdmFuY2UoJndkYXRhMi0+aXRlciwgZnBvcyAt
IHdkYXRhLT5vZmZzZXQpOwotCQlpb3ZfaXRlcl90cnVuY2F0ZSgmd2RhdGEyLT5pdGVyLCB3ZGF0
YTItPmJ5dGVzKTsKKwkJaW92X2l0ZXJfYWR2YW5jZSgmd2RhdGEyLT5zdWJyZXEuaW9faXRlciwg
ZnBvcyAtIHdkYXRhLT5zdWJyZXEuc3RhcnQpOworCQlpb3ZfaXRlcl90cnVuY2F0ZSgmd2RhdGEy
LT5zdWJyZXEuaW9faXRlciwgd2RhdGEyLT5zdWJyZXEubGVuKTsKIAotCQlpZiAoaW92X2l0ZXJf
aXNfeGFycmF5KCZ3ZGF0YTItPml0ZXIpKQorCQlpZiAoaW92X2l0ZXJfaXNfeGFycmF5KCZ3ZGF0
YTItPnN1YnJlcS5pb19pdGVyKSkKIAkJCS8qIENoZWNrIGZvciBwYWdlcyBoYXZpbmcgYmVlbiBy
ZWRpcnRpZWQgYW5kIGNsZWFuCiAJCQkgKiB0aGVtLiAgV2UgY2FuIGRvIHRoaXMgYnkgd2Fsa2lu
ZyB0aGUgeGFycmF5LiAgSWYKIAkJCSAqIGl0J3Mgbm90IGFuIHhhcnJheSwgdGhlbiBpdCdzIGEg
RElPIGFuZCB3ZSBzaG91bGRuJ3QKQEAgLTI1MDcsNyArMjUwNyw3IEBAIGNpZnNfd3JpdGV2X3Jl
cXVldWUoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEpCiAJfSB3aGlsZSAocmVzdF9s
ZW4gPiAwKTsKIAogCS8qIENsZWFuIHVwIHJlbWFpbmluZyBwYWdlcyBmcm9tIHRoZSBvcmlnaW5h
bCB3ZGF0YSAqLwotCWlmIChpb3ZfaXRlcl9pc194YXJyYXkoJndkYXRhLT5pdGVyKSkKKwlpZiAo
aW92X2l0ZXJfaXNfeGFycmF5KCZ3ZGF0YS0+c3VicmVxLmlvX2l0ZXIpKQogCQljaWZzX3BhZ2Vz
X3dyaXRlX2ZhaWxlZChpbm9kZSwgZnBvcywgcmVzdF9sZW4pOwogCiAJaWYgKHJjICE9IDAgJiYg
IWlzX3JldHJ5YWJsZV9lcnJvcihyYykpCkBAIC0yNTI0LDE5ICsyNTI0LDE5IEBAIGNpZnNfd3Jp
dGV2X2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogCWlmICh3ZGF0YS0+cmVz
dWx0ID09IDApIHsKIAkJc3Bpbl9sb2NrKCZpbm9kZS0+aV9sb2NrKTsKLQkJY2lmc191cGRhdGVf
ZW9mKENJRlNfSShpbm9kZSksIHdkYXRhLT5vZmZzZXQsIHdkYXRhLT5ieXRlcyk7CisJCWNpZnNf
dXBkYXRlX2VvZihDSUZTX0koaW5vZGUpLCB3ZGF0YS0+c3VicmVxLnN0YXJ0LCB3ZGF0YS0+c3Vi
cmVxLmxlbik7CiAJCXNwaW5fdW5sb2NrKCZpbm9kZS0+aV9sb2NrKTsKIAkJY2lmc19zdGF0c19i
eXRlc193cml0dGVuKHRsaW5rX3Rjb24od2RhdGEtPmNmaWxlLT50bGluayksCi0JCQkJCSB3ZGF0
YS0+Ynl0ZXMpOworCQkJCQkgd2RhdGEtPnN1YnJlcS5sZW4pOwogCX0gZWxzZSBpZiAod2RhdGEt
PnN5bmNfbW9kZSA9PSBXQl9TWU5DX0FMTCAmJiB3ZGF0YS0+cmVzdWx0ID09IC1FQUdBSU4pCiAJ
CXJldHVybiBjaWZzX3dyaXRldl9yZXF1ZXVlKHdkYXRhKTsKIAogCWlmICh3ZGF0YS0+cmVzdWx0
ID09IC1FQUdBSU4pCi0JCWNpZnNfcGFnZXNfd3JpdGVfcmVkaXJ0eShpbm9kZSwgd2RhdGEtPm9m
ZnNldCwgd2RhdGEtPmJ5dGVzKTsKKwkJY2lmc19wYWdlc193cml0ZV9yZWRpcnR5KGlub2RlLCB3
ZGF0YS0+c3VicmVxLnN0YXJ0LCB3ZGF0YS0+c3VicmVxLmxlbik7CiAJZWxzZSBpZiAod2RhdGEt
PnJlc3VsdCA8IDApCi0JCWNpZnNfcGFnZXNfd3JpdGVfZmFpbGVkKGlub2RlLCB3ZGF0YS0+b2Zm
c2V0LCB3ZGF0YS0+Ynl0ZXMpOworCQljaWZzX3BhZ2VzX3dyaXRlX2ZhaWxlZChpbm9kZSwgd2Rh
dGEtPnN1YnJlcS5zdGFydCwgd2RhdGEtPnN1YnJlcS5sZW4pOwogCWVsc2UKLQkJY2lmc19wYWdl
c193cml0dGVuX2JhY2soaW5vZGUsIHdkYXRhLT5vZmZzZXQsIHdkYXRhLT5ieXRlcyk7CisJCWNp
ZnNfcGFnZXNfd3JpdHRlbl9iYWNrKGlub2RlLCB3ZGF0YS0+c3VicmVxLnN0YXJ0LCB3ZGF0YS0+
c3VicmVxLmxlbik7CiAKIAlpZiAod2RhdGEtPnJlc3VsdCAhPSAtRUFHQUlOKQogCQltYXBwaW5n
X3NldF9lcnJvcihpbm9kZS0+aV9tYXBwaW5nLCB3ZGF0YS0+cmVzdWx0KTsKQEAgLTI3NjgsNyAr
Mjc2OCw3IEBAIHN0YXRpYyBzc2l6ZV90IGNpZnNfd3JpdGVfYmFja19mcm9tX2xvY2tlZF9mb2xp
byhzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZywKIAl9CiAKIAl3ZGF0YS0+c3luY19tb2Rl
ID0gd2JjLT5zeW5jX21vZGU7Ci0Jd2RhdGEtPm9mZnNldCA9IGZvbGlvX3Bvcyhmb2xpbyk7CisJ
d2RhdGEtPnN1YnJlcS5zdGFydCA9IGZvbGlvX3Bvcyhmb2xpbyk7CiAJd2RhdGEtPnBpZCA9IGNm
aWxlLT5waWQ7CiAJd2RhdGEtPmNyZWRpdHMgPSBjcmVkaXRzX29uX3N0YWNrOwogCXdkYXRhLT5j
ZmlsZSA9IGNmaWxlOwpAQCAtMjgwMyw3ICsyODAzLDcgQEAgc3RhdGljIHNzaXplX3QgY2lmc193
cml0ZV9iYWNrX2Zyb21fbG9ja2VkX2ZvbGlvKHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5n
LAogCQlsZW4gPSBtaW5fdChsb2ZmX3QsIGxlbiwgbWF4X2xlbik7CiAJfQogCi0Jd2RhdGEtPmJ5
dGVzID0gbGVuOworCXdkYXRhLT5zdWJyZXEubGVuID0gbGVuOwogCiAJLyogV2Ugbm93IGhhdmUg
YSBjb250aWd1b3VzIHNldCBvZiBkaXJ0eSBwYWdlcywgZWFjaCB3aXRoIHdyaXRlYmFjawogCSAq
IHNldDsgdGhlIGZpcnN0IHBhZ2UgaXMgc3RpbGwgbG9ja2VkIGF0IHRoaXMgcG9pbnQsIGJ1dCBh
bGwgdGhlIHJlc3QKQEAgLTI4MTIsMTAgKzI4MTIsMTAgQEAgc3RhdGljIHNzaXplX3QgY2lmc193
cml0ZV9iYWNrX2Zyb21fbG9ja2VkX2ZvbGlvKHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5n
LAogCWZvbGlvX3VubG9jayhmb2xpbyk7CiAKIAlpZiAoc3RhcnQgPCBpX3NpemUpIHsKLQkJaW92
X2l0ZXJfeGFycmF5KCZ3ZGF0YS0+aXRlciwgSVRFUl9TT1VSQ0UsICZtYXBwaW5nLT5pX3BhZ2Vz
LAorCQlpb3ZfaXRlcl94YXJyYXkoJndkYXRhLT5zdWJyZXEuaW9faXRlciwgSVRFUl9TT1VSQ0Us
ICZtYXBwaW5nLT5pX3BhZ2VzLAogCQkJCXN0YXJ0LCBsZW4pOwogCi0JCXJjID0gYWRqdXN0X2Ny
ZWRpdHMod2RhdGEtPnNlcnZlciwgJndkYXRhLT5jcmVkaXRzLCB3ZGF0YS0+Ynl0ZXMpOworCQly
YyA9IGFkanVzdF9jcmVkaXRzKHdkYXRhLT5zZXJ2ZXIsICZ3ZGF0YS0+Y3JlZGl0cywgd2RhdGEt
PnN1YnJlcS5sZW4pOwogCQlpZiAocmMpCiAJCQlnb3RvIGVycl93ZGF0YTsKIApAQCAtMzIzNCw3
ICszMjM0LDcgQEAgY2lmc191bmNhY2hlZF93cml0ZXZfY29tcGxldGUoc3RydWN0IHdvcmtfc3Ry
dWN0ICp3b3JrKQogCXN0cnVjdCBjaWZzSW5vZGVJbmZvICpjaWZzaSA9IENJRlNfSShpbm9kZSk7
CiAKIAlzcGluX2xvY2soJmlub2RlLT5pX2xvY2spOwotCWNpZnNfdXBkYXRlX2VvZihjaWZzaSwg
d2RhdGEtPm9mZnNldCwgd2RhdGEtPmJ5dGVzKTsKKwljaWZzX3VwZGF0ZV9lb2YoY2lmc2ksIHdk
YXRhLT5zdWJyZXEuc3RhcnQsIHdkYXRhLT5zdWJyZXEubGVuKTsKIAlpZiAoY2lmc2ktPm5ldGZz
LnJlbW90ZV9pX3NpemUgPiBpbm9kZS0+aV9zaXplKQogCQlpX3NpemVfd3JpdGUoaW5vZGUsIGNp
ZnNpLT5uZXRmcy5yZW1vdGVfaV9zaXplKTsKIAlzcGluX3VubG9jaygmaW5vZGUtPmlfbG9jayk7
CkBAIC0zMjcwLDE5ICszMjcwLDE5IEBAIGNpZnNfcmVzZW5kX3dkYXRhKHN0cnVjdCBjaWZzX2lv
X3N1YnJlcXVlc3QgKndkYXRhLCBzdHJ1Y3QgbGlzdF9oZWFkICp3ZGF0YV9saXN0CiAJCSAqIHNl
Z21lbnRzCiAJCSAqLwogCQlkbyB7Ci0JCQlyYyA9IHNlcnZlci0+b3BzLT53YWl0X210dV9jcmVk
aXRzKHNlcnZlciwgd2RhdGEtPmJ5dGVzLAorCQkJcmMgPSBzZXJ2ZXItPm9wcy0+d2FpdF9tdHVf
Y3JlZGl0cyhzZXJ2ZXIsIHdkYXRhLT5zdWJyZXEubGVuLAogCQkJCQkJJndzaXplLCAmY3JlZGl0
cyk7CiAJCQlpZiAocmMpCiAJCQkJZ290byBmYWlsOwogCi0JCQlpZiAod3NpemUgPCB3ZGF0YS0+
Ynl0ZXMpIHsKKwkJCWlmICh3c2l6ZSA8IHdkYXRhLT5zdWJyZXEubGVuKSB7CiAJCQkJYWRkX2Ny
ZWRpdHNfYW5kX3dha2VfaWYoc2VydmVyLCAmY3JlZGl0cywgMCk7CiAJCQkJbXNsZWVwKDEwMDAp
OwogCQkJfQotCQl9IHdoaWxlICh3c2l6ZSA8IHdkYXRhLT5ieXRlcyk7CisJCX0gd2hpbGUgKHdz
aXplIDwgd2RhdGEtPnN1YnJlcS5sZW4pOwogCQl3ZGF0YS0+Y3JlZGl0cyA9IGNyZWRpdHM7CiAK
LQkJcmMgPSBhZGp1c3RfY3JlZGl0cyhzZXJ2ZXIsICZ3ZGF0YS0+Y3JlZGl0cywgd2RhdGEtPmJ5
dGVzKTsKKwkJcmMgPSBhZGp1c3RfY3JlZGl0cyhzZXJ2ZXIsICZ3ZGF0YS0+Y3JlZGl0cywgd2Rh
dGEtPnN1YnJlcS5sZW4pOwogCiAJCWlmICghcmMpIHsKIAkJCWlmICh3ZGF0YS0+Y2ZpbGUtPmlu
dmFsaWRIYW5kbGUpCkBAIC0zNDI4LDE5ICszNDI4LDE5IEBAIGNpZnNfd3JpdGVfZnJvbV9pdGVy
KGxvZmZfdCBmcG9zLCBzaXplX3QgbGVuLCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20sCiAKIAkJd2Rh
dGEtPnVuY2FjaGVkCT0gdHJ1ZTsKIAkJd2RhdGEtPnN5bmNfbW9kZSA9IFdCX1NZTkNfQUxMOwot
CQl3ZGF0YS0+b2Zmc2V0CT0gKF9fdTY0KWZwb3M7CisJCXdkYXRhLT5zdWJyZXEuc3RhcnQJPSAo
X191NjQpZnBvczsKIAkJd2RhdGEtPmNmaWxlCT0gY2lmc0ZpbGVJbmZvX2dldChvcGVuX2ZpbGUp
OwogCQl3ZGF0YS0+c2VydmVyCT0gc2VydmVyOwogCQl3ZGF0YS0+cGlkCT0gcGlkOwotCQl3ZGF0
YS0+Ynl0ZXMJPSBjdXJfbGVuOworCQl3ZGF0YS0+c3VicmVxLmxlbgk9IGN1cl9sZW47CiAJCXdk
YXRhLT5jcmVkaXRzCT0gY3JlZGl0c19vbl9zdGFjazsKLQkJd2RhdGEtPml0ZXIJPSAqZnJvbTsK
KwkJd2RhdGEtPnN1YnJlcS5pb19pdGVyCT0gKmZyb207CiAJCXdkYXRhLT5jdHgJPSBjdHg7CiAJ
CWtyZWZfZ2V0KCZjdHgtPnJlZmNvdW50KTsKIAotCQlpb3ZfaXRlcl90cnVuY2F0ZSgmd2RhdGEt
Pml0ZXIsIGN1cl9sZW4pOworCQlpb3ZfaXRlcl90cnVuY2F0ZSgmd2RhdGEtPnN1YnJlcS5pb19p
dGVyLCBjdXJfbGVuKTsKIAotCQlyYyA9IGFkanVzdF9jcmVkaXRzKHNlcnZlciwgJndkYXRhLT5j
cmVkaXRzLCB3ZGF0YS0+Ynl0ZXMpOworCQlyYyA9IGFkanVzdF9jcmVkaXRzKHNlcnZlciwgJndk
YXRhLT5jcmVkaXRzLCB3ZGF0YS0+c3VicmVxLmxlbik7CiAKIAkJaWYgKCFyYykgewogCQkJaWYg
KHdkYXRhLT5jZmlsZS0+aW52YWxpZEhhbmRsZSkKQEAgLTM1MDIsNyArMzUwMiw3IEBAIHN0YXRp
YyB2b2lkIGNvbGxlY3RfdW5jYWNoZWRfd3JpdGVfZGF0YShzdHJ1Y3QgY2lmc19haW9fY3R4ICpj
dHgpCiAJCQlpZiAod2RhdGEtPnJlc3VsdCkKIAkJCQlyYyA9IHdkYXRhLT5yZXN1bHQ7CiAJCQll
bHNlCi0JCQkJY3R4LT50b3RhbF9sZW4gKz0gd2RhdGEtPmJ5dGVzOworCQkJCWN0eC0+dG90YWxf
bGVuICs9IHdkYXRhLT5zdWJyZXEubGVuOwogCiAJCQkvKiByZXNlbmQgY2FsbCBpZiBpdCdzIGEg
cmV0cnlhYmxlIGVycm9yICovCiAJCQlpZiAocmMgPT0gLUVBR0FJTikgewpAQCAtMzUxNywxMCAr
MzUxNywxMCBAQCBzdGF0aWMgdm9pZCBjb2xsZWN0X3VuY2FjaGVkX3dyaXRlX2RhdGEoc3RydWN0
IGNpZnNfYWlvX2N0eCAqY3R4KQogCQkJCQkJd2RhdGEsICZ0bXBfbGlzdCwgY3R4KTsKIAkJCQll
bHNlIHsKIAkJCQkJaW92X2l0ZXJfYWR2YW5jZSgmdG1wX2Zyb20sCi0JCQkJCQkgd2RhdGEtPm9m
ZnNldCAtIGN0eC0+cG9zKTsKKwkJCQkJCSB3ZGF0YS0+c3VicmVxLnN0YXJ0IC0gY3R4LT5wb3Mp
OwogCi0JCQkJCXJjID0gY2lmc193cml0ZV9mcm9tX2l0ZXIod2RhdGEtPm9mZnNldCwKLQkJCQkJ
CXdkYXRhLT5ieXRlcywgJnRtcF9mcm9tLAorCQkJCQlyYyA9IGNpZnNfd3JpdGVfZnJvbV9pdGVy
KHdkYXRhLT5zdWJyZXEuc3RhcnQsCisJCQkJCQl3ZGF0YS0+c3VicmVxLmxlbiwgJnRtcF9mcm9t
LAogCQkJCQkJY3R4LT5jZmlsZSwgY2lmc19zYiwgJnRtcF9saXN0LAogCQkJCQkJY3R4KTsKIApA
QCAtMzg0MywyMCArMzg0MywyMCBAQCBzdGF0aWMgaW50IGNpZnNfcmVzZW5kX3JkYXRhKHN0cnVj
dCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhLAogCQkgKiBzZWdtZW50cwogCQkgKi8KIAkJZG8g
ewotCQkJcmMgPSBzZXJ2ZXItPm9wcy0+d2FpdF9tdHVfY3JlZGl0cyhzZXJ2ZXIsIHJkYXRhLT5i
eXRlcywKKwkJCXJjID0gc2VydmVyLT5vcHMtPndhaXRfbXR1X2NyZWRpdHMoc2VydmVyLCByZGF0
YS0+c3VicmVxLmxlbiwKIAkJCQkJCSZyc2l6ZSwgJmNyZWRpdHMpOwogCiAJCQlpZiAocmMpCiAJ
CQkJZ290byBmYWlsOwogCi0JCQlpZiAocnNpemUgPCByZGF0YS0+Ynl0ZXMpIHsKKwkJCWlmIChy
c2l6ZSA8IHJkYXRhLT5zdWJyZXEubGVuKSB7CiAJCQkJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYo
c2VydmVyLCAmY3JlZGl0cywgMCk7CiAJCQkJbXNsZWVwKDEwMDApOwogCQkJfQotCQl9IHdoaWxl
IChyc2l6ZSA8IHJkYXRhLT5ieXRlcyk7CisJCX0gd2hpbGUgKHJzaXplIDwgcmRhdGEtPnN1YnJl
cS5sZW4pOwogCQlyZGF0YS0+Y3JlZGl0cyA9IGNyZWRpdHM7CiAKLQkJcmMgPSBhZGp1c3RfY3Jl
ZGl0cyhzZXJ2ZXIsICZyZGF0YS0+Y3JlZGl0cywgcmRhdGEtPmJ5dGVzKTsKKwkJcmMgPSBhZGp1
c3RfY3JlZGl0cyhzZXJ2ZXIsICZyZGF0YS0+Y3JlZGl0cywgcmRhdGEtPnN1YnJlcS5sZW4pOwog
CQlpZiAoIXJjKSB7CiAJCQlpZiAocmRhdGEtPmNmaWxlLT5pbnZhbGlkSGFuZGxlKQogCQkJCXJj
ID0gLUVBR0FJTjsKQEAgLTM5NTQsMTcgKzM5NTQsMTcgQEAgY2lmc19zZW5kX2FzeW5jX3JlYWQo
bG9mZl90IGZwb3MsIHNpemVfdCBsZW4sIHN0cnVjdCBjaWZzRmlsZUluZm8gKm9wZW5fZmlsZSwK
IAogCQlyZGF0YS0+c2VydmVyCT0gc2VydmVyOwogCQlyZGF0YS0+Y2ZpbGUJPSBjaWZzRmlsZUlu
Zm9fZ2V0KG9wZW5fZmlsZSk7Ci0JCXJkYXRhLT5vZmZzZXQJPSBmcG9zOwotCQlyZGF0YS0+Ynl0
ZXMJPSBjdXJfbGVuOworCQlyZGF0YS0+c3VicmVxLnN0YXJ0CT0gZnBvczsKKwkJcmRhdGEtPnN1
YnJlcS5sZW4JPSBjdXJfbGVuOwogCQlyZGF0YS0+cGlkCT0gcGlkOwogCQlyZGF0YS0+Y3JlZGl0
cwk9IGNyZWRpdHNfb25fc3RhY2s7CiAJCXJkYXRhLT5jdHgJPSBjdHg7CiAJCWtyZWZfZ2V0KCZj
dHgtPnJlZmNvdW50KTsKIAotCQlyZGF0YS0+aXRlcgk9IGN0eC0+aXRlcjsKLQkJaW92X2l0ZXJf
dHJ1bmNhdGUoJnJkYXRhLT5pdGVyLCBjdXJfbGVuKTsKKwkJcmRhdGEtPnN1YnJlcS5pb19pdGVy
ID0gY3R4LT5pdGVyOworCQlpb3ZfaXRlcl90cnVuY2F0ZSgmcmRhdGEtPnN1YnJlcS5pb19pdGVy
LCBjdXJfbGVuKTsKIAotCQlyYyA9IGFkanVzdF9jcmVkaXRzKHNlcnZlciwgJnJkYXRhLT5jcmVk
aXRzLCByZGF0YS0+Ynl0ZXMpOworCQlyYyA9IGFkanVzdF9jcmVkaXRzKHNlcnZlciwgJnJkYXRh
LT5jcmVkaXRzLCByZGF0YS0+c3VicmVxLmxlbik7CiAKIAkJaWYgKCFyYykgewogCQkJaWYgKHJk
YXRhLT5jZmlsZS0+aW52YWxpZEhhbmRsZSkKQEAgLTQwMzQsOCArNDAzNCw4IEBAIGNvbGxlY3Rf
dW5jYWNoZWRfcmVhZF9kYXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCkKIAkJCQkJCSZ0bXBf
bGlzdCwgY3R4KTsKIAkJCQl9IGVsc2UgewogCQkJCQlyYyA9IGNpZnNfc2VuZF9hc3luY19yZWFk
KAotCQkJCQkJcmRhdGEtPm9mZnNldCArIGdvdF9ieXRlcywKLQkJCQkJCXJkYXRhLT5ieXRlcyAt
IGdvdF9ieXRlcywKKwkJCQkJCXJkYXRhLT5zdWJyZXEuc3RhcnQgKyBnb3RfYnl0ZXMsCisJCQkJ
CQlyZGF0YS0+c3VicmVxLmxlbiAtIGdvdF9ieXRlcywKIAkJCQkJCXJkYXRhLT5jZmlsZSwgY2lm
c19zYiwKIAkJCQkJCSZ0bXBfbGlzdCwgY3R4KTsKIApAQCAtNDA0OSw3ICs0MDQ5LDcgQEAgY29s
bGVjdF91bmNhY2hlZF9yZWFkX2RhdGEoc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4KQogCQkJCXJj
ID0gcmRhdGEtPnJlc3VsdDsKIAogCQkJLyogaWYgdGhlcmUgd2FzIGEgc2hvcnQgcmVhZCAtLSBk
aXNjYXJkIGFueXRoaW5nIGxlZnQgKi8KLQkJCWlmIChyZGF0YS0+Z290X2J5dGVzICYmIHJkYXRh
LT5nb3RfYnl0ZXMgPCByZGF0YS0+Ynl0ZXMpCisJCQlpZiAocmRhdGEtPmdvdF9ieXRlcyAmJiBy
ZGF0YS0+Z290X2J5dGVzIDwgcmRhdGEtPnN1YnJlcS5sZW4pCiAJCQkJcmMgPSAtRU5PREFUQTsK
IAogCQkJY3R4LT50b3RhbF9sZW4gKz0gcmRhdGEtPmdvdF9ieXRlczsKQEAgLTQ0MzMsMTYgKzQ0
MzMsMTYgQEAgc3RhdGljIHZvaWQgY2lmc19yZWFkYWhlYWRfY29tcGxldGUoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQogCXBnb2ZmX3QgbGFzdDsKIAlib29sIGdvb2QgPSByZGF0YS0+cmVzdWx0
ID09IDAgfHwgKHJkYXRhLT5yZXN1bHQgPT0gLUVBR0FJTiAmJiByZGF0YS0+Z290X2J5dGVzKTsK
IAotCVhBX1NUQVRFKHhhcywgJnJkYXRhLT5tYXBwaW5nLT5pX3BhZ2VzLCByZGF0YS0+b2Zmc2V0
IC8gUEFHRV9TSVpFKTsKKwlYQV9TVEFURSh4YXMsICZyZGF0YS0+bWFwcGluZy0+aV9wYWdlcywg
cmRhdGEtPnN1YnJlcS5zdGFydCAvIFBBR0VfU0laRSk7CiAKIAlpZiAoZ29vZCkKIAkJY2lmc19y
ZWFkYWhlYWRfdG9fZnNjYWNoZShyZGF0YS0+bWFwcGluZy0+aG9zdCwKLQkJCQkJICByZGF0YS0+
b2Zmc2V0LCByZGF0YS0+Ynl0ZXMpOworCQkJCQkgIHJkYXRhLT5zdWJyZXEuc3RhcnQsIHJkYXRh
LT5zdWJyZXEubGVuKTsKIAotCWlmIChpb3ZfaXRlcl9jb3VudCgmcmRhdGEtPml0ZXIpID4gMCkK
LQkJaW92X2l0ZXJfemVybyhpb3ZfaXRlcl9jb3VudCgmcmRhdGEtPml0ZXIpLCAmcmRhdGEtPml0
ZXIpOworCWlmIChpb3ZfaXRlcl9jb3VudCgmcmRhdGEtPnN1YnJlcS5pb19pdGVyKSA+IDApCisJ
CWlvdl9pdGVyX3plcm8oaW92X2l0ZXJfY291bnQoJnJkYXRhLT5zdWJyZXEuaW9faXRlciksICZy
ZGF0YS0+c3VicmVxLmlvX2l0ZXIpOwogCi0JbGFzdCA9IChyZGF0YS0+b2Zmc2V0ICsgcmRhdGEt
PmJ5dGVzIC0gMSkgLyBQQUdFX1NJWkU7CisJbGFzdCA9IChyZGF0YS0+c3VicmVxLnN0YXJ0ICsg
cmRhdGEtPnN1YnJlcS5sZW4gLSAxKSAvIFBBR0VfU0laRTsKIAogCXJjdV9yZWFkX2xvY2soKTsK
IAl4YXNfZm9yX2VhY2goJnhhcywgZm9saW8sIGxhc3QpIHsKQEAgLTQ1ODEsOCArNDU4MSw4IEBA
IHN0YXRpYyB2b2lkIGNpZnNfcmVhZGFoZWFkKHN0cnVjdCByZWFkYWhlYWRfY29udHJvbCAqcmFj
dGwpCiAJCQlicmVhazsKIAkJfQogCi0JCXJkYXRhLT5vZmZzZXQJPSByYV9pbmRleCAqIFBBR0Vf
U0laRTsKLQkJcmRhdGEtPmJ5dGVzCT0gbnJfcGFnZXMgKiBQQUdFX1NJWkU7CisJCXJkYXRhLT5z
dWJyZXEuc3RhcnQJPSByYV9pbmRleCAqIFBBR0VfU0laRTsKKwkJcmRhdGEtPnN1YnJlcS5sZW4J
PSBucl9wYWdlcyAqIFBBR0VfU0laRTsKIAkJcmRhdGEtPmNmaWxlCT0gY2lmc0ZpbGVJbmZvX2dl
dChvcGVuX2ZpbGUpOwogCQlyZGF0YS0+c2VydmVyCT0gc2VydmVyOwogCQlyZGF0YS0+bWFwcGlu
Zwk9IHJhY3RsLT5tYXBwaW5nOwpAQCAtNDU5NiwxMCArNDU5NiwxMCBAQCBzdGF0aWMgdm9pZCBj
aWZzX3JlYWRhaGVhZChzdHJ1Y3QgcmVhZGFoZWFkX2NvbnRyb2wgKnJhY3RsKQogCQlyYV9wYWdl
cyAtPSBucl9wYWdlczsKIAkJcmFfaW5kZXggKz0gbnJfcGFnZXM7CiAKLQkJaW92X2l0ZXJfeGFy
cmF5KCZyZGF0YS0+aXRlciwgSVRFUl9ERVNULCAmcmRhdGEtPm1hcHBpbmctPmlfcGFnZXMsCi0J
CQkJcmRhdGEtPm9mZnNldCwgcmRhdGEtPmJ5dGVzKTsKKwkJaW92X2l0ZXJfeGFycmF5KCZyZGF0
YS0+c3VicmVxLmlvX2l0ZXIsIElURVJfREVTVCwgJnJkYXRhLT5tYXBwaW5nLT5pX3BhZ2VzLAor
CQkJCXJkYXRhLT5zdWJyZXEuc3RhcnQsIHJkYXRhLT5zdWJyZXEubGVuKTsKIAotCQlyYyA9IGFk
anVzdF9jcmVkaXRzKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCByZGF0YS0+Ynl0ZXMpOworCQly
YyA9IGFkanVzdF9jcmVkaXRzKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCByZGF0YS0+c3VicmVx
Lmxlbik7CiAJCWlmICghcmMpIHsKIAkJCWlmIChyZGF0YS0+Y2ZpbGUtPmludmFsaWRIYW5kbGUp
CiAJCQkJcmMgPSAtRUFHQUlOOwpAQCAtNDYxMCw4ICs0NjEwLDggQEAgc3RhdGljIHZvaWQgY2lm
c19yZWFkYWhlYWQoc3RydWN0IHJlYWRhaGVhZF9jb250cm9sICpyYWN0bCkKIAkJaWYgKHJjKSB7
CiAJCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIsICZyZGF0YS0+Y3JlZGl0cywgMCk7
CiAJCQljaWZzX3VubG9ja19mb2xpb3MocmRhdGEtPm1hcHBpbmcsCi0JCQkJCSAgIHJkYXRhLT5v
ZmZzZXQgLyBQQUdFX1NJWkUsCi0JCQkJCSAgIChyZGF0YS0+b2Zmc2V0ICsgcmRhdGEtPmJ5dGVz
IC0gMSkgLyBQQUdFX1NJWkUpOworCQkJCQkgICByZGF0YS0+c3VicmVxLnN0YXJ0IC8gUEFHRV9T
SVpFLAorCQkJCQkgICAocmRhdGEtPnN1YnJlcS5zdGFydCArIHJkYXRhLT5zdWJyZXEubGVuIC0g
MSkgLyBQQUdFX1NJWkUpOwogCQkJLyogRmFsbGJhY2sgdG8gdGhlIHJlYWRwYWdlIGluIGVycm9y
L3JlY29ubmVjdCBjYXNlcyAqLwogCQkJY2lmc19wdXRfcmVhZGRhdGEocmRhdGEpOwogCQkJYnJl
YWs7CmRpZmYgLS1naXQgYS9mcy9zbWIvY2xpZW50L3NtYjJvcHMuYyBiL2ZzL3NtYi9jbGllbnQv
c21iMm9wcy5jCmluZGV4IGUxNjFhNDFjYjI2Mi4uNGYyMTliZjliODc0IDEwMDY0NAotLS0gYS9m
cy9zbWIvY2xpZW50L3NtYjJvcHMuYworKysgYi9mcy9zbWIvY2xpZW50L3NtYjJvcHMuYwpAQCAt
NDU3Nyw3ICs0NTc3LDcgQEAgaGFuZGxlX3JlYWRfZGF0YShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZv
ICpzZXJ2ZXIsIHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkLAogCiAJCS8qIENvcHkgdGhlIGRhdGEg
dG8gdGhlIG91dHB1dCBJL08gaXRlcmF0b3IuICovCiAJCXJkYXRhLT5yZXN1bHQgPSBjaWZzX2Nv
cHlfcGFnZXNfdG9faXRlcihwYWdlcywgcGFnZXNfbGVuLAotCQkJCQkJCWN1cl9vZmYsICZyZGF0
YS0+aXRlcik7CisJCQkJCQkJY3VyX29mZiwgJnJkYXRhLT5zdWJyZXEuaW9faXRlcik7CiAJCWlm
IChyZGF0YS0+cmVzdWx0ICE9IDApIHsKIAkJCWlmIChpc19vZmZsb2FkZWQpCiAJCQkJbWlkLT5t
aWRfc3RhdGUgPSBNSURfUkVTUE9OU0VfTUFMRk9STUVEOwpAQCAtNDU5MSw3ICs0NTkxLDcgQEAg
aGFuZGxlX3JlYWRfZGF0YShzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXIsIHN0cnVjdCBt
aWRfcV9lbnRyeSAqbWlkLAogCQkvKiByZWFkIHJlc3BvbnNlIHBheWxvYWQgaXMgaW4gYnVmICov
CiAJCVdBUk5fT05DRShwYWdlcyAmJiAheGFfZW1wdHkocGFnZXMpLAogCQkJICAicmVhZCBkYXRh
IGNhbiBiZSBlaXRoZXIgaW4gYnVmIG9yIGluIHBhZ2VzIik7Ci0JCWxlbmd0aCA9IGNvcHlfdG9f
aXRlcihidWYgKyBkYXRhX29mZnNldCwgZGF0YV9sZW4sICZyZGF0YS0+aXRlcik7CisJCWxlbmd0
aCA9IGNvcHlfdG9faXRlcihidWYgKyBkYXRhX29mZnNldCwgZGF0YV9sZW4sICZyZGF0YS0+c3Vi
cmVxLmlvX2l0ZXIpOwogCQlpZiAobGVuZ3RoIDwgMCkKIAkJCXJldHVybiBsZW5ndGg7CiAJCXJk
YXRhLT5nb3RfYnl0ZXMgPSBkYXRhX2xlbjsKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvc21i
MnBkdS5jIGIvZnMvc21iL2NsaWVudC9zbWIycGR1LmMKaW5kZXggMTZhZjRkMmZjZWMyLi5hOTdk
OGY3ODllOTAgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvc21iMnBkdS5jCisrKyBiL2ZzL3Nt
Yi9jbGllbnQvc21iMnBkdS5jCkBAIC00MjcxLDcgKzQyNzEsNyBAQCBzbWIyX25ld19yZWFkX3Jl
cSh2b2lkICoqYnVmLCB1bnNpZ25lZCBpbnQgKnRvdGFsX2xlbiwKIAkJc3RydWN0IHNtYmRfYnVm
ZmVyX2Rlc2NyaXB0b3JfdjEgKnYxOwogCQlib29sIG5lZWRfaW52YWxpZGF0ZSA9IHNlcnZlci0+
ZGlhbGVjdCA9PSBTTUIzMF9QUk9UX0lEOwogCi0JCXJkYXRhLT5tciA9IHNtYmRfcmVnaXN0ZXJf
bXIoc2VydmVyLT5zbWJkX2Nvbm4sICZyZGF0YS0+aXRlciwKKwkJcmRhdGEtPm1yID0gc21iZF9y
ZWdpc3Rlcl9tcihzZXJ2ZXItPnNtYmRfY29ubiwgJnJkYXRhLT5zdWJyZXEuaW9faXRlciwKIAkJ
CQkJICAgICB0cnVlLCBuZWVkX2ludmFsaWRhdGUpOwogCQlpZiAoIXJkYXRhLT5tcikKIAkJCXJl
dHVybiAtRUFHQUlOOwpAQCAtNDMzMSwxNyArNDMzMSwxNyBAQCBzbWIyX3JlYWR2X2NhbGxiYWNr
KHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCXN0cnVjdCBzbWJfcnFzdCBycXN0ID0geyAucnFf
aW92ID0gJnJkYXRhLT5pb3ZbMV0sIC5ycV9udmVjID0gMSB9OwogCiAJaWYgKHJkYXRhLT5nb3Rf
Ynl0ZXMpIHsKLQkJcnFzdC5ycV9pdGVyCSAgPSByZGF0YS0+aXRlcjsKLQkJcnFzdC5ycV9pdGVy
X3NpemUgPSBpb3ZfaXRlcl9jb3VudCgmcmRhdGEtPml0ZXIpOworCQlycXN0LnJxX2l0ZXIJICA9
IHJkYXRhLT5zdWJyZXEuaW9faXRlcjsKKwkJcnFzdC5ycV9pdGVyX3NpemUgPSBpb3ZfaXRlcl9j
b3VudCgmcmRhdGEtPnN1YnJlcS5pb19pdGVyKTsKIAl9CiAKIAlXQVJOX09OQ0UocmRhdGEtPnNl
cnZlciAhPSBtaWQtPnNlcnZlciwKIAkJICAicmRhdGEgc2VydmVyICVwICE9IG1pZCBzZXJ2ZXIg
JXAiLAogCQkgIHJkYXRhLT5zZXJ2ZXIsIG1pZC0+c2VydmVyKTsKIAotCWNpZnNfZGJnKEZZSSwg
IiVzOiBtaWQ9JWxsdSBzdGF0ZT0lZCByZXN1bHQ9JWQgYnl0ZXM9JXVcbiIsCisJY2lmc19kYmco
RllJLCAiJXM6IG1pZD0lbGx1IHN0YXRlPSVkIHJlc3VsdD0lZCBieXRlcz0lenVcbiIsCiAJCSBf
X2Z1bmNfXywgbWlkLT5taWQsIG1pZC0+bWlkX3N0YXRlLCByZGF0YS0+cmVzdWx0LAotCQkgcmRh
dGEtPmJ5dGVzKTsKKwkJIHJkYXRhLT5zdWJyZXEubGVuKTsKIAogCXN3aXRjaCAobWlkLT5taWRf
c3RhdGUpIHsKIAljYXNlIE1JRF9SRVNQT05TRV9SRUNFSVZFRDoKQEAgLTQzOTQsMTMgKzQzOTQs
MTMgQEAgc21iMl9yZWFkdl9jYWxsYmFjayhzdHJ1Y3QgbWlkX3FfZW50cnkgKm1pZCkKIAkJY2lm
c19zdGF0c19mYWlsX2luYyh0Y29uLCBTTUIyX1JFQURfSEUpOwogCQl0cmFjZV9zbWIzX3JlYWRf
ZXJyKDAgLyogeGlkICovLAogCQkJCSAgICByZGF0YS0+Y2ZpbGUtPmZpZC5wZXJzaXN0ZW50X2Zp
ZCwKLQkJCQkgICAgdGNvbi0+dGlkLCB0Y29uLT5zZXMtPlN1aWQsIHJkYXRhLT5vZmZzZXQsCi0J
CQkJICAgIHJkYXRhLT5ieXRlcywgcmRhdGEtPnJlc3VsdCk7CisJCQkJICAgIHRjb24tPnRpZCwg
dGNvbi0+c2VzLT5TdWlkLCByZGF0YS0+c3VicmVxLnN0YXJ0LAorCQkJCSAgICByZGF0YS0+c3Vi
cmVxLmxlbiwgcmRhdGEtPnJlc3VsdCk7CiAJfSBlbHNlCiAJCXRyYWNlX3NtYjNfcmVhZF9kb25l
KDAgLyogeGlkICovLAogCQkJCSAgICAgcmRhdGEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQs
CiAJCQkJICAgICB0Y29uLT50aWQsIHRjb24tPnNlcy0+U3VpZCwKLQkJCQkgICAgIHJkYXRhLT5v
ZmZzZXQsIHJkYXRhLT5nb3RfYnl0ZXMpOworCQkJCSAgICAgcmRhdGEtPnN1YnJlcS5zdGFydCwg
cmRhdGEtPmdvdF9ieXRlcyk7CiAKIAlxdWV1ZV93b3JrKGNpZnNpb2Rfd3EsICZyZGF0YS0+d29y
ayk7CiAJcmVsZWFzZV9taWQobWlkKTsKQEAgLTQ0MjIsMTYgKzQ0MjIsMTYgQEAgc21iMl9hc3lu
Y19yZWFkdihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKIAl1bnNpZ25lZCBpbnQg
dG90YWxfbGVuOwogCWludCBjcmVkaXRfcmVxdWVzdDsKIAotCWNpZnNfZGJnKEZZSSwgIiVzOiBv
ZmZzZXQ9JWxsdSBieXRlcz0ldVxuIiwKLQkJIF9fZnVuY19fLCByZGF0YS0+b2Zmc2V0LCByZGF0
YS0+Ynl0ZXMpOworCWNpZnNfZGJnKEZZSSwgIiVzOiBvZmZzZXQ9JWxsdSBieXRlcz0lenVcbiIs
CisJCSBfX2Z1bmNfXywgcmRhdGEtPnN1YnJlcS5zdGFydCwgcmRhdGEtPnN1YnJlcS5sZW4pOwog
CiAJaWYgKCFyZGF0YS0+c2VydmVyKQogCQlyZGF0YS0+c2VydmVyID0gY2lmc19waWNrX2NoYW5u
ZWwodGNvbi0+c2VzKTsKIAogCWlvX3Bhcm1zLnRjb24gPSB0bGlua190Y29uKHJkYXRhLT5jZmls
ZS0+dGxpbmspOwogCWlvX3Bhcm1zLnNlcnZlciA9IHNlcnZlciA9IHJkYXRhLT5zZXJ2ZXI7Ci0J
aW9fcGFybXMub2Zmc2V0ID0gcmRhdGEtPm9mZnNldDsKLQlpb19wYXJtcy5sZW5ndGggPSByZGF0
YS0+Ynl0ZXM7CisJaW9fcGFybXMub2Zmc2V0ID0gcmRhdGEtPnN1YnJlcS5zdGFydDsKKwlpb19w
YXJtcy5sZW5ndGggPSByZGF0YS0+c3VicmVxLmxlbjsKIAlpb19wYXJtcy5wZXJzaXN0ZW50X2Zp
ZCA9IHJkYXRhLT5jZmlsZS0+ZmlkLnBlcnNpc3RlbnRfZmlkOwogCWlvX3Bhcm1zLnZvbGF0aWxl
X2ZpZCA9IHJkYXRhLT5jZmlsZS0+ZmlkLnZvbGF0aWxlX2ZpZDsKIAlpb19wYXJtcy5waWQgPSBy
ZGF0YS0+cGlkOwpAQCAtNDQ1MCw3ICs0NDUwLDcgQEAgc21iMl9hc3luY19yZWFkdihzdHJ1Y3Qg
Y2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKIAlzaGRyID0gKHN0cnVjdCBzbWIyX2hkciAqKWJ1
ZjsKIAogCWlmIChyZGF0YS0+Y3JlZGl0cy52YWx1ZSA+IDApIHsKLQkJc2hkci0+Q3JlZGl0Q2hh
cmdlID0gY3B1X3RvX2xlMTYoRElWX1JPVU5EX1VQKHJkYXRhLT5ieXRlcywKKwkJc2hkci0+Q3Jl
ZGl0Q2hhcmdlID0gY3B1X3RvX2xlMTYoRElWX1JPVU5EX1VQKHJkYXRhLT5zdWJyZXEubGVuLAog
CQkJCQkJU01CMl9NQVhfQlVGRkVSX1NJWkUpKTsKIAkJY3JlZGl0X3JlcXVlc3QgPSBsZTE2X3Rv
X2NwdShzaGRyLT5DcmVkaXRDaGFyZ2UpICsgODsKIAkJaWYgKHNlcnZlci0+Y3JlZGl0cyA+PSBz
ZXJ2ZXItPm1heF9jcmVkaXRzKQpAQCAtNDQ2MCw3ICs0NDYwLDcgQEAgc21iMl9hc3luY19yZWFk
dihzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSkKIAkJCQltaW5fdChpbnQsIHNlcnZl
ci0+bWF4X2NyZWRpdHMgLQogCQkJCQkJc2VydmVyLT5jcmVkaXRzLCBjcmVkaXRfcmVxdWVzdCkp
OwogCi0JCXJjID0gYWRqdXN0X2NyZWRpdHMoc2VydmVyLCAmcmRhdGEtPmNyZWRpdHMsIHJkYXRh
LT5ieXRlcyk7CisJCXJjID0gYWRqdXN0X2NyZWRpdHMoc2VydmVyLCAmcmRhdGEtPmNyZWRpdHMs
IHJkYXRhLT5zdWJyZXEubGVuKTsKIAkJaWYgKHJjKQogCQkJZ290byBhc3luY19yZWFkdl9vdXQ7
CiAKQEAgLTQ2MDAsMTMgKzQ2MDAsMTMgQEAgc21iMl93cml0ZXZfY2FsbGJhY2soc3RydWN0IG1p
ZF9xX2VudHJ5ICptaWQpCiAJCSAqIGNsaWVudC4gT1MvMiBzZXJ2ZXJzIGFyZSBrbm93biB0byBz
ZXQgaW5jb3JyZWN0CiAJCSAqIENvdW50SGlnaCB2YWx1ZXMuCiAJCSAqLwotCQlpZiAod3JpdHRl
biA+IHdkYXRhLT5ieXRlcykKKwkJaWYgKHdyaXR0ZW4gPiB3ZGF0YS0+c3VicmVxLmxlbikKIAkJ
CXdyaXR0ZW4gJj0gMHhGRkZGOwogCi0JCWlmICh3cml0dGVuIDwgd2RhdGEtPmJ5dGVzKQorCQlp
ZiAod3JpdHRlbiA8IHdkYXRhLT5zdWJyZXEubGVuKQogCQkJd2RhdGEtPnJlc3VsdCA9IC1FTk9T
UEM7CiAJCWVsc2UKLQkJCXdkYXRhLT5ieXRlcyA9IHdyaXR0ZW47CisJCQl3ZGF0YS0+c3VicmVx
LmxlbiA9IHdyaXR0ZW47CiAJCWJyZWFrOwogCWNhc2UgTUlEX1JFUVVFU1RfU1VCTUlUVEVEOgog
CWNhc2UgTUlEX1JFVFJZX05FRURFRDoKQEAgLTQ2MzcsOCArNDYzNyw4IEBAIHNtYjJfd3JpdGV2
X2NhbGxiYWNrKHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCQljaWZzX3N0YXRzX2ZhaWxfaW5j
KHRjb24sIFNNQjJfV1JJVEVfSEUpOwogCQl0cmFjZV9zbWIzX3dyaXRlX2VycigwIC8qIG5vIHhp
ZCAqLywKIAkJCQkgICAgIHdkYXRhLT5jZmlsZS0+ZmlkLnBlcnNpc3RlbnRfZmlkLAotCQkJCSAg
ICAgdGNvbi0+dGlkLCB0Y29uLT5zZXMtPlN1aWQsIHdkYXRhLT5vZmZzZXQsCi0JCQkJICAgICB3
ZGF0YS0+Ynl0ZXMsIHdkYXRhLT5yZXN1bHQpOworCQkJCSAgICAgdGNvbi0+dGlkLCB0Y29uLT5z
ZXMtPlN1aWQsIHdkYXRhLT5zdWJyZXEuc3RhcnQsCisJCQkJICAgICB3ZGF0YS0+c3VicmVxLmxl
biwgd2RhdGEtPnJlc3VsdCk7CiAJCWlmICh3ZGF0YS0+cmVzdWx0ID09IC1FTk9TUEMpCiAJCQlw
cl93YXJuX29uY2UoIk91dCBvZiBzcGFjZSB3cml0aW5nIHRvICVzXG4iLAogCQkJCSAgICAgdGNv
bi0+dHJlZV9uYW1lKTsKQEAgLTQ2NDYsNyArNDY0Niw3IEBAIHNtYjJfd3JpdGV2X2NhbGxiYWNr
KHN0cnVjdCBtaWRfcV9lbnRyeSAqbWlkKQogCQl0cmFjZV9zbWIzX3dyaXRlX2RvbmUoMCAvKiBu
byB4aWQgKi8sCiAJCQkJICAgICAgd2RhdGEtPmNmaWxlLT5maWQucGVyc2lzdGVudF9maWQsCiAJ
CQkJICAgICAgdGNvbi0+dGlkLCB0Y29uLT5zZXMtPlN1aWQsCi0JCQkJICAgICAgd2RhdGEtPm9m
ZnNldCwgd2RhdGEtPmJ5dGVzKTsKKwkJCQkgICAgICB3ZGF0YS0+c3VicmVxLnN0YXJ0LCB3ZGF0
YS0+c3VicmVxLmxlbik7CiAKIAlxdWV1ZV93b3JrKGNpZnNpb2Rfd3EsICZ3ZGF0YS0+d29yayk7
CiAJcmVsZWFzZV9taWQobWlkKTsKQEAgLTQ2NzksOCArNDY3OSw4IEBAIHNtYjJfYXN5bmNfd3Jp
dGV2KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCV9pb19wYXJtcyA9IChzdHJ1
Y3QgY2lmc19pb19wYXJtcykgewogCQkudGNvbiA9IHRjb24sCiAJCS5zZXJ2ZXIgPSBzZXJ2ZXIs
Ci0JCS5vZmZzZXQgPSB3ZGF0YS0+b2Zmc2V0LAotCQkubGVuZ3RoID0gd2RhdGEtPmJ5dGVzLAor
CQkub2Zmc2V0ID0gd2RhdGEtPnN1YnJlcS5zdGFydCwKKwkJLmxlbmd0aCA9IHdkYXRhLT5zdWJy
ZXEubGVuLAogCQkucGVyc2lzdGVudF9maWQgPSB3ZGF0YS0+Y2ZpbGUtPmZpZC5wZXJzaXN0ZW50
X2ZpZCwKIAkJLnZvbGF0aWxlX2ZpZCA9IHdkYXRhLT5jZmlsZS0+ZmlkLnZvbGF0aWxlX2ZpZCwK
IAkJLnBpZCA9IHdkYXRhLT5waWQsCkBAIC00NzIyLDEwICs0NzIyLDEwIEBAIHNtYjJfYXN5bmNf
d3JpdGV2KHN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhKQogCSAqLwogCWlmIChzbWIz
X3VzZV9yZG1hX29mZmxvYWQoaW9fcGFybXMpKSB7CiAJCXN0cnVjdCBzbWJkX2J1ZmZlcl9kZXNj
cmlwdG9yX3YxICp2MTsKLQkJc2l6ZV90IGRhdGFfc2l6ZSA9IGlvdl9pdGVyX2NvdW50KCZ3ZGF0
YS0+aXRlcik7CisJCXNpemVfdCBkYXRhX3NpemUgPSBpb3ZfaXRlcl9jb3VudCgmd2RhdGEtPnN1
YnJlcS5pb19pdGVyKTsKIAkJYm9vbCBuZWVkX2ludmFsaWRhdGUgPSBzZXJ2ZXItPmRpYWxlY3Qg
PT0gU01CMzBfUFJPVF9JRDsKIAotCQl3ZGF0YS0+bXIgPSBzbWJkX3JlZ2lzdGVyX21yKHNlcnZl
ci0+c21iZF9jb25uLCAmd2RhdGEtPml0ZXIsCisJCXdkYXRhLT5tciA9IHNtYmRfcmVnaXN0ZXJf
bXIoc2VydmVyLT5zbWJkX2Nvbm4sICZ3ZGF0YS0+c3VicmVxLmlvX2l0ZXIsCiAJCQkJCSAgICAg
ZmFsc2UsIG5lZWRfaW52YWxpZGF0ZSk7CiAJCWlmICghd2RhdGEtPm1yKSB7CiAJCQlyYyA9IC1F
QUdBSU47CkBAIC00NzUyLDcgKzQ3NTIsNyBAQCBzbWIyX2FzeW5jX3dyaXRldihzdHJ1Y3QgY2lm
c19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKIAogCXJxc3QucnFfaW92ID0gaW92OwogCXJxc3QucnFf
bnZlYyA9IDE7Ci0JcnFzdC5ycV9pdGVyID0gd2RhdGEtPml0ZXI7CisJcnFzdC5ycV9pdGVyID0g
d2RhdGEtPnN1YnJlcS5pb19pdGVyOwogCXJxc3QucnFfaXRlcl9zaXplID0gaW92X2l0ZXJfY291
bnQoJnJxc3QucnFfaXRlcik7CiAjaWZkZWYgQ09ORklHX0NJRlNfU01CX0RJUkVDVAogCWlmICh3
ZGF0YS0+bXIpCkBAIC00NzcwLDcgKzQ3NzAsNyBAQCBzbWIyX2FzeW5jX3dyaXRldihzdHJ1Y3Qg
Y2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSkKICNlbmRpZgogCiAJaWYgKHdkYXRhLT5jcmVkaXRz
LnZhbHVlID4gMCkgewotCQlzaGRyLT5DcmVkaXRDaGFyZ2UgPSBjcHVfdG9fbGUxNihESVZfUk9V
TkRfVVAod2RhdGEtPmJ5dGVzLAorCQlzaGRyLT5DcmVkaXRDaGFyZ2UgPSBjcHVfdG9fbGUxNihE
SVZfUk9VTkRfVVAod2RhdGEtPnN1YnJlcS5sZW4sCiAJCQkJCQkgICAgU01CMl9NQVhfQlVGRkVS
X1NJWkUpKTsKIAkJY3JlZGl0X3JlcXVlc3QgPSBsZTE2X3RvX2NwdShzaGRyLT5DcmVkaXRDaGFy
Z2UpICsgODsKIAkJaWYgKHNlcnZlci0+Y3JlZGl0cyA+PSBzZXJ2ZXItPm1heF9jcmVkaXRzKQpk
aWZmIC0tZ2l0IGEvZnMvc21iL2NsaWVudC90cmFuc3BvcnQuYyBiL2ZzL3NtYi9jbGllbnQvdHJh
bnNwb3J0LmMKaW5kZXggYmFlNzU4ZWM2MjFiLi4zMDQ4NTE2NTczZTggMTAwNjQ0Ci0tLSBhL2Zz
L3NtYi9jbGllbnQvdHJhbnNwb3J0LmMKKysrIGIvZnMvc21iL2NsaWVudC90cmFuc3BvcnQuYwpA
QCAtMTY5Miw4ICsxNjkyLDggQEAgY2lmc19yZWFkdl9yZWNlaXZlKHN0cnVjdCBUQ1BfU2VydmVy
X0luZm8gKnNlcnZlciwgc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiAJdW5zaWduZWQgaW50IGJ1
ZmxlbiA9IHNlcnZlci0+cGR1X3NpemUgKyBIRUFERVJfUFJFQU1CTEVfU0laRShzZXJ2ZXIpOwog
CWJvb2wgdXNlX3JkbWFfbXIgPSBmYWxzZTsKIAotCWNpZnNfZGJnKEZZSSwgIiVzOiBtaWQ9JWxs
dSBvZmZzZXQ9JWxsdSBieXRlcz0ldVxuIiwKLQkJIF9fZnVuY19fLCBtaWQtPm1pZCwgcmRhdGEt
Pm9mZnNldCwgcmRhdGEtPmJ5dGVzKTsKKwljaWZzX2RiZyhGWUksICIlczogbWlkPSVsbHUgb2Zm
c2V0PSVsbHUgYnl0ZXM9JXp1XG4iLAorCQkgX19mdW5jX18sIG1pZC0+bWlkLCByZGF0YS0+c3Vi
cmVxLnN0YXJ0LCByZGF0YS0+c3VicmVxLmxlbik7CiAKIAkvKgogCSAqIHJlYWQgdGhlIHJlc3Qg
b2YgUkVBRF9SU1AgaGVhZGVyIChzYW5zIERhdGEgYXJyYXkpLCBvciB3aGF0ZXZlciB3ZQpAQCAt
MTc5OCw3ICsxNzk4LDcgQEAgY2lmc19yZWFkdl9yZWNlaXZlKHN0cnVjdCBUQ1BfU2VydmVyX0lu
Zm8gKnNlcnZlciwgc3RydWN0IG1pZF9xX2VudHJ5ICptaWQpCiAJCWxlbmd0aCA9IGRhdGFfbGVu
OyAvKiBBbiBSRE1BIHJlYWQgaXMgYWxyZWFkeSBkb25lLiAqLwogCWVsc2UKICNlbmRpZgotCQls
ZW5ndGggPSBjaWZzX3JlYWRfaXRlcl9mcm9tX3NvY2tldChzZXJ2ZXIsICZyZGF0YS0+aXRlciwK
KwkJbGVuZ3RoID0gY2lmc19yZWFkX2l0ZXJfZnJvbV9zb2NrZXQoc2VydmVyLCAmcmRhdGEtPnN1
YnJlcS5pb19pdGVyLAogCQkJCQkJICAgIGRhdGFfbGVuKTsKIAlpZiAobGVuZ3RoID4gMCkKIAkJ
cmRhdGEtPmdvdF9ieXRlcyArPSBsZW5ndGg7Ci0tIAoyLjQwLjEKCg==
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0012-cifs-Remove-some-code-that-s-no-longer-used-part-3.patch"
Content-Disposition: attachment; 
	filename="0012-cifs-Remove-some-code-that-s-no-longer-used-part-3.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46i11>
X-Attachment-Id: f_lrpgn46i11

RnJvbSA4YTRhYWY3M2QwNTAwNTJkNDRlMjcxOWMxYjM1MmMzZGIzMDkwYWE1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMjI6MzY6MzAgKzAxMDAKU3ViamVjdDogW1BBVENIIDEyLzEy
XSBjaWZzOiBSZW1vdmUgc29tZSBjb2RlIHRoYXQncyBubyBsb25nZXIgdXNlZCwgcGFydCAzCgpS
ZW1vdmUgc29tZSBjb2RlIHRoYXQgd2FzICNpZidkIG91dCB3aXRoIHRoZSBuZXRmc2xpYiBjb252
ZXJzaW9uLiAgVGhpcyBpcwpzcGxpdCBpbnRvIHBhcnRzIGZvciBmaWxlLmMgYXMgdGhlIGRpZmYg
Z2VuZXJhdG9yIG90aGVyd2lzZSBwcm9kdWNlcyBhIGhhcmQKdG8gcmVhZCBkaWZmIGZvciBwYXJ0
IG9mIGl0IHdoZXJlIGEgYmlnIGNodW5rIGlzIGN1dCBvdXQuCgpTaWduZWQtb2ZmLWJ5OiBEYXZp
ZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1h
bmdhbG9yZUBnbWFpbC5jb20+CmNjOiBSb2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBn
bWFpbC5jb20+CmNjOiBKZWZmIExheXRvbiA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgt
Y2lmc0B2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGlu
dXgtZnNkZXZlbEB2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZz
L3NtYi9jbGllbnQvZmlsZS5jIHwgMTAwMyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMDAzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2ZzL3NtYi9jbGllbnQvZmlsZS5jIGIvZnMvc21iL2NsaWVudC9maWxlLmMKaW5kZXggOGM0
YTA0MmE3YjI1Li5kM2NhMmFjM2U3NDkgMTAwNjQ0Ci0tLSBhL2ZzL3NtYi9jbGllbnQvZmlsZS5j
CisrKyBiL2ZzL3NtYi9jbGllbnQvZmlsZS5jCkBAIC0yNjg5LDQ3MCArMjY4OSw2IEBAIGludCBj
aWZzX2ZsdXNoKHN0cnVjdCBmaWxlICpmaWxlLCBmbF9vd25lcl90IGlkKQogCXJldHVybiByYzsK
IH0KIAotI2lmIDAgLy8gVE9ETyByZW1vdmUgMzU5NAotc3RhdGljIHZvaWQgY29sbGVjdF91bmNh
Y2hlZF93cml0ZV9kYXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCk7Ci0KLXN0YXRpYyB2b2lk
Ci1jaWZzX3VuY2FjaGVkX3dyaXRldl9jb21wbGV0ZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmsp
Ci17Ci0Jc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEgPSBjb250YWluZXJfb2Yod29y
aywKLQkJCQkJc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCwgd29yayk7Ci0Jc3RydWN0IGlub2Rl
ICppbm9kZSA9IGRfaW5vZGUod2RhdGEtPmNmaWxlLT5kZW50cnkpOwotCXN0cnVjdCBjaWZzSW5v
ZGVJbmZvICpjaWZzaSA9IENJRlNfSShpbm9kZSk7Ci0KLQlzcGluX2xvY2soJmlub2RlLT5pX2xv
Y2spOwotCWNpZnNfdXBkYXRlX2VvZihjaWZzaSwgd2RhdGEtPnN1YnJlcS5zdGFydCwgd2RhdGEt
PnN1YnJlcS5sZW4pOwotCWlmIChjaWZzaS0+bmV0ZnMucmVtb3RlX2lfc2l6ZSA+IGlub2RlLT5p
X3NpemUpCi0JCWlfc2l6ZV93cml0ZShpbm9kZSwgY2lmc2ktPm5ldGZzLnJlbW90ZV9pX3NpemUp
OwotCXNwaW5fdW5sb2NrKCZpbm9kZS0+aV9sb2NrKTsKLQotCWNvbXBsZXRlKCZ3ZGF0YS0+ZG9u
ZSk7Ci0JY29sbGVjdF91bmNhY2hlZF93cml0ZV9kYXRhKHdkYXRhLT5jdHgpOwotCS8qIHRoZSBi
ZWxvdyBjYWxsIGNhbiBwb3NzaWJseSBmcmVlIHRoZSBsYXN0IHJlZiB0byBhaW8gY3R4ICovCi0J
Y2lmc19wdXRfd3JpdGVkYXRhKHdkYXRhKTsKLX0KLQotc3RhdGljIGludAotY2lmc19yZXNlbmRf
d2RhdGEoc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEsIHN0cnVjdCBsaXN0X2hlYWQg
KndkYXRhX2xpc3QsCi0Jc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4KQotewotCXNpemVfdCB3c2l6
ZTsKLQlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHM7Ci0JaW50IHJjOwotCXN0cnVjdCBUQ1Bf
U2VydmVyX0luZm8gKnNlcnZlciA9IHdkYXRhLT5zZXJ2ZXI7Ci0KLQlkbyB7Ci0JCWlmICh3ZGF0
YS0+Y2ZpbGUtPmludmFsaWRIYW5kbGUpIHsKLQkJCXJjID0gY2lmc19yZW9wZW5fZmlsZSh3ZGF0
YS0+Y2ZpbGUsIGZhbHNlKTsKLQkJCWlmIChyYyA9PSAtRUFHQUlOKQotCQkJCWNvbnRpbnVlOwot
CQkJZWxzZSBpZiAocmMpCi0JCQkJYnJlYWs7Ci0JCX0KLQotCi0JCS8qCi0JCSAqIFdhaXQgZm9y
IGNyZWRpdHMgdG8gcmVzZW5kIHRoaXMgd2RhdGEuCi0JCSAqIE5vdGU6IHdlIGFyZSBhdHRlbXB0
aW5nIHRvIHJlc2VuZCB0aGUgd2hvbGUgd2RhdGEgbm90IGluCi0JCSAqIHNlZ21lbnRzCi0JCSAq
LwotCQlkbyB7Ci0JCQlyYyA9IHNlcnZlci0+b3BzLT53YWl0X210dV9jcmVkaXRzKHNlcnZlciwg
d2RhdGEtPnN1YnJlcS5sZW4sCi0JCQkJCQkmd3NpemUsICZjcmVkaXRzKTsKLQkJCWlmIChyYykK
LQkJCQlnb3RvIGZhaWw7Ci0KLQkJCWlmICh3c2l6ZSA8IHdkYXRhLT5zdWJyZXEubGVuKSB7Ci0J
CQkJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYoc2VydmVyLCAmY3JlZGl0cywgMCk7Ci0JCQkJbXNs
ZWVwKDEwMDApOwotCQkJfQotCQl9IHdoaWxlICh3c2l6ZSA8IHdkYXRhLT5zdWJyZXEubGVuKTsK
LQkJd2RhdGEtPmNyZWRpdHMgPSBjcmVkaXRzOwotCi0JCXJjID0gYWRqdXN0X2NyZWRpdHMoc2Vy
dmVyLCAmd2RhdGEtPmNyZWRpdHMsIHdkYXRhLT5zdWJyZXEubGVuKTsKLQotCQlpZiAoIXJjKSB7
Ci0JCQlpZiAod2RhdGEtPmNmaWxlLT5pbnZhbGlkSGFuZGxlKQotCQkJCXJjID0gLUVBR0FJTjsK
LQkJCWVsc2UgewotI2lmZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QKLQkJCQlpZiAod2RhdGEt
Pm1yKSB7Ci0JCQkJCXdkYXRhLT5tci0+bmVlZF9pbnZhbGlkYXRlID0gdHJ1ZTsKLQkJCQkJc21i
ZF9kZXJlZ2lzdGVyX21yKHdkYXRhLT5tcik7Ci0JCQkJCXdkYXRhLT5tciA9IE5VTEw7Ci0JCQkJ
fQotI2VuZGlmCi0JCQkJcmMgPSBzZXJ2ZXItPm9wcy0+YXN5bmNfd3JpdGV2KHdkYXRhKTsKLQkJ
CX0KLQkJfQotCi0JCS8qIElmIHRoZSB3cml0ZSB3YXMgc3VjY2Vzc2Z1bGx5IHNlbnQsIHdlIGFy
ZSBkb25lICovCi0JCWlmICghcmMpIHsKLQkJCWxpc3RfYWRkX3RhaWwoJndkYXRhLT5saXN0LCB3
ZGF0YV9saXN0KTsKLQkJCXJldHVybiAwOwotCQl9Ci0KLQkJLyogUm9sbCBiYWNrIGNyZWRpdHMg
YW5kIHJldHJ5IGlmIG5lZWRlZCAqLwotCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIs
ICZ3ZGF0YS0+Y3JlZGl0cywgMCk7Ci0JfSB3aGlsZSAocmMgPT0gLUVBR0FJTik7Ci0KLWZhaWw6
Ci0JY2lmc19wdXRfd3JpdGVkYXRhKHdkYXRhKTsKLQlyZXR1cm4gcmM7Ci19Ci0KLS8qCi0gKiBT
ZWxlY3Qgc3BhbiBvZiBhIGJ2ZWMgaXRlcmF0b3Igd2UncmUgZ29pbmcgdG8gdXNlLiAgTGltaXQg
aXQgYnkgYm90aCBtYXhpbXVtCi0gKiBzaXplIGFuZCBtYXhpbXVtIG51bWJlciBvZiBzZWdtZW50
cy4KLSAqLwotc3RhdGljIHNpemVfdCBjaWZzX2xpbWl0X2J2ZWNfc3Vic2V0KGNvbnN0IHN0cnVj
dCBpb3ZfaXRlciAqaXRlciwgc2l6ZV90IG1heF9zaXplLAotCQkJCSAgICAgc2l6ZV90IG1heF9z
ZWdzLCB1bnNpZ25lZCBpbnQgKl9uc2VncykKLXsKLQljb25zdCBzdHJ1Y3QgYmlvX3ZlYyAqYnZl
Y3MgPSBpdGVyLT5idmVjOwotCXVuc2lnbmVkIGludCBuYnYgPSBpdGVyLT5ucl9zZWdzLCBpeCA9
IDAsIG5zZWdzID0gMDsKLQlzaXplX3QgbGVuLCBzcGFuID0gMCwgbiA9IGl0ZXItPmNvdW50Owot
CXNpemVfdCBza2lwID0gaXRlci0+aW92X29mZnNldDsKLQotCWlmIChXQVJOX09OKCFpb3ZfaXRl
cl9pc19idmVjKGl0ZXIpKSB8fCBuID09IDApCi0JCXJldHVybiAwOwotCi0Jd2hpbGUgKG4gJiYg
aXggPCBuYnYgJiYgc2tpcCkgewotCQlsZW4gPSBidmVjc1tpeF0uYnZfbGVuOwotCQlpZiAoc2tp
cCA8IGxlbikKLQkJCWJyZWFrOwotCQlza2lwIC09IGxlbjsKLQkJbiAtPSBsZW47Ci0JCWl4Kys7
Ci0JfQotCi0Jd2hpbGUgKG4gJiYgaXggPCBuYnYpIHsKLQkJbGVuID0gbWluMyhuLCBidmVjc1tp
eF0uYnZfbGVuIC0gc2tpcCwgbWF4X3NpemUpOwotCQlzcGFuICs9IGxlbjsKLQkJbWF4X3NpemUg
LT0gbGVuOwotCQluc2VncysrOwotCQlpeCsrOwotCQlpZiAobWF4X3NpemUgPT0gMCB8fCBuc2Vn
cyA+PSBtYXhfc2VncykKLQkJCWJyZWFrOwotCQlza2lwID0gMDsKLQkJbiAtPSBsZW47Ci0JfQot
Ci0JKl9uc2VncyA9IG5zZWdzOwotCXJldHVybiBzcGFuOwotfQotCi1zdGF0aWMgaW50Ci1jaWZz
X3dyaXRlX2Zyb21faXRlcihsb2ZmX3QgZnBvcywgc2l6ZV90IGxlbiwgc3RydWN0IGlvdl9pdGVy
ICpmcm9tLAotCQkgICAgIHN0cnVjdCBjaWZzRmlsZUluZm8gKm9wZW5fZmlsZSwKLQkJICAgICBz
dHJ1Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiLCBzdHJ1Y3QgbGlzdF9oZWFkICp3ZGF0YV9saXN0
LAotCQkgICAgIHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCkKLXsKLQlpbnQgcmMgPSAwOwotCXNp
emVfdCBjdXJfbGVuLCBtYXhfbGVuOwotCXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRh
OwotCXBpZF90IHBpZDsKLQlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXI7Ci0JdW5zaWdu
ZWQgaW50IHhpZCwgbWF4X3NlZ3MgPSBJTlRfTUFYOwotCi0JaWYgKGNpZnNfc2ItPm1udF9jaWZz
X2ZsYWdzICYgQ0lGU19NT1VOVF9SV1BJREZPUldBUkQpCi0JCXBpZCA9IG9wZW5fZmlsZS0+cGlk
OwotCWVsc2UKLQkJcGlkID0gY3VycmVudC0+dGdpZDsKLQotCXNlcnZlciA9IGNpZnNfcGlja19j
aGFubmVsKHRsaW5rX3Rjb24ob3Blbl9maWxlLT50bGluayktPnNlcyk7Ci0JeGlkID0gZ2V0X3hp
ZCgpOwotCi0jaWZkZWYgQ09ORklHX0NJRlNfU01CX0RJUkVDVAotCWlmIChzZXJ2ZXItPnNtYmRf
Y29ubikKLQkJbWF4X3NlZ3MgPSBzZXJ2ZXItPnNtYmRfY29ubi0+bWF4X2ZybXJfZGVwdGg7Ci0j
ZW5kaWYKLQotCWRvIHsKLQkJc3RydWN0IGNpZnNfY3JlZGl0cyBjcmVkaXRzX29uX3N0YWNrOwot
CQlzdHJ1Y3QgY2lmc19jcmVkaXRzICpjcmVkaXRzID0gJmNyZWRpdHNfb25fc3RhY2s7Ci0JCXVu
c2lnbmVkIGludCBuc2VncyA9IDA7Ci0JCXNpemVfdCB3c2l6ZTsKLQotCQlpZiAoc2lnbmFsX3Bl
bmRpbmcoY3VycmVudCkpIHsKLQkJCXJjID0gLUVJTlRSOwotCQkJYnJlYWs7Ci0JCX0KLQotCQlp
ZiAob3Blbl9maWxlLT5pbnZhbGlkSGFuZGxlKSB7Ci0JCQlyYyA9IGNpZnNfcmVvcGVuX2ZpbGUo
b3Blbl9maWxlLCBmYWxzZSk7Ci0JCQlpZiAocmMgPT0gLUVBR0FJTikKLQkJCQljb250aW51ZTsK
LQkJCWVsc2UgaWYgKHJjKQotCQkJCWJyZWFrOwotCQl9Ci0KLQkJcmMgPSBzZXJ2ZXItPm9wcy0+
d2FpdF9tdHVfY3JlZGl0cyhzZXJ2ZXIsIGNpZnNfc2ItPmN0eC0+d3NpemUsCi0JCQkJCQkgICAm
d3NpemUsIGNyZWRpdHMpOwotCQlpZiAocmMpCi0JCQlicmVhazsKLQotCQltYXhfbGVuID0gbWlu
X3QoY29uc3Qgc2l6ZV90LCBsZW4sIHdzaXplKTsKLQkJaWYgKCFtYXhfbGVuKSB7Ci0JCQlyYyA9
IC1FQUdBSU47Ci0JCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIsIGNyZWRpdHMsIDAp
OwotCQkJYnJlYWs7Ci0JCX0KLQotCQljdXJfbGVuID0gY2lmc19saW1pdF9idmVjX3N1YnNldChm
cm9tLCBtYXhfbGVuLCBtYXhfc2VncywgJm5zZWdzKTsKLQkJY2lmc19kYmcoRllJLCAid3JpdGVf
ZnJvbV9pdGVyIGxlbj0lengvJXp4IG5zZWdzPSV1LyVsdS8ldVxuIiwKLQkJCSBjdXJfbGVuLCBt
YXhfbGVuLCBuc2VncywgZnJvbS0+bnJfc2VncywgbWF4X3NlZ3MpOwotCQlpZiAoY3VyX2xlbiA9
PSAwKSB7Ci0JCQlyYyA9IC1FSU87Ci0JCQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIs
IGNyZWRpdHMsIDApOwotCQkJYnJlYWs7Ci0JCX0KLQotCQl3ZGF0YSA9IGNpZnNfd3JpdGVkYXRh
X2FsbG9jKGNpZnNfdW5jYWNoZWRfd3JpdGV2X2NvbXBsZXRlKTsKLQkJaWYgKCF3ZGF0YSkgewot
CQkJcmMgPSAtRU5PTUVNOwotCQkJYWRkX2NyZWRpdHNfYW5kX3dha2VfaWYoc2VydmVyLCBjcmVk
aXRzLCAwKTsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJd2RhdGEtPnVuY2FjaGVkCT0gdHJ1ZTsKLQkJ
d2RhdGEtPnN5bmNfbW9kZSA9IFdCX1NZTkNfQUxMOwotCQl3ZGF0YS0+c3VicmVxLnN0YXJ0CT0g
KF9fdTY0KWZwb3M7Ci0JCXdkYXRhLT5jZmlsZQk9IGNpZnNGaWxlSW5mb19nZXQob3Blbl9maWxl
KTsKLQkJd2RhdGEtPnNlcnZlcgk9IHNlcnZlcjsKLQkJd2RhdGEtPnBpZAk9IHBpZDsKLQkJd2Rh
dGEtPnN1YnJlcS5sZW4JPSBjdXJfbGVuOwotCQl3ZGF0YS0+Y3JlZGl0cwk9IGNyZWRpdHNfb25f
c3RhY2s7Ci0JCXdkYXRhLT5zdWJyZXEuaW9faXRlcgk9ICpmcm9tOwotCQl3ZGF0YS0+Y3R4CT0g
Y3R4OwotCQlrcmVmX2dldCgmY3R4LT5yZWZjb3VudCk7Ci0KLQkJaW92X2l0ZXJfdHJ1bmNhdGUo
JndkYXRhLT5zdWJyZXEuaW9faXRlciwgY3VyX2xlbik7Ci0KLQkJcmMgPSBhZGp1c3RfY3JlZGl0
cyhzZXJ2ZXIsICZ3ZGF0YS0+Y3JlZGl0cywgd2RhdGEtPnN1YnJlcS5sZW4pOwotCi0JCWlmICgh
cmMpIHsKLQkJCWlmICh3ZGF0YS0+Y2ZpbGUtPmludmFsaWRIYW5kbGUpCi0JCQkJcmMgPSAtRUFH
QUlOOwotCQkJZWxzZQotCQkJCXJjID0gc2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0YSk7
Ci0JCX0KLQotCQlpZiAocmMpIHsKLQkJCWFkZF9jcmVkaXRzX2FuZF93YWtlX2lmKHNlcnZlciwg
JndkYXRhLT5jcmVkaXRzLCAwKTsKLQkJCWNpZnNfcHV0X3dyaXRlZGF0YSh3ZGF0YSk7Ci0JCQlp
ZiAocmMgPT0gLUVBR0FJTikKLQkJCQljb250aW51ZTsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJbGlz
dF9hZGRfdGFpbCgmd2RhdGEtPmxpc3QsIHdkYXRhX2xpc3QpOwotCQlpb3ZfaXRlcl9hZHZhbmNl
KGZyb20sIGN1cl9sZW4pOwotCQlmcG9zICs9IGN1cl9sZW47Ci0JCWxlbiAtPSBjdXJfbGVuOwot
CX0gd2hpbGUgKGxlbiA+IDApOwotCi0JZnJlZV94aWQoeGlkKTsKLQlyZXR1cm4gcmM7Ci19Ci0K
LXN0YXRpYyB2b2lkIGNvbGxlY3RfdW5jYWNoZWRfd3JpdGVfZGF0YShzdHJ1Y3QgY2lmc19haW9f
Y3R4ICpjdHgpCi17Ci0Jc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqd2RhdGEsICp0bXA7Ci0J
c3RydWN0IGNpZnNfdGNvbiAqdGNvbjsKLQlzdHJ1Y3QgY2lmc19zYl9pbmZvICpjaWZzX3NiOwot
CXN0cnVjdCBkZW50cnkgKmRlbnRyeSA9IGN0eC0+Y2ZpbGUtPmRlbnRyeTsKLQlzc2l6ZV90IHJj
OwotCi0JdGNvbiA9IHRsaW5rX3Rjb24oY3R4LT5jZmlsZS0+dGxpbmspOwotCWNpZnNfc2IgPSBD
SUZTX1NCKGRlbnRyeS0+ZF9zYik7Ci0KLQltdXRleF9sb2NrKCZjdHgtPmFpb19tdXRleCk7Ci0K
LQlpZiAobGlzdF9lbXB0eSgmY3R4LT5saXN0KSkgewotCQltdXRleF91bmxvY2soJmN0eC0+YWlv
X211dGV4KTsKLQkJcmV0dXJuOwotCX0KLQotCXJjID0gY3R4LT5yYzsKLQkvKgotCSAqIFdhaXQg
Zm9yIGFuZCBjb2xsZWN0IHJlcGxpZXMgZm9yIGFueSBzdWNjZXNzZnVsIHNlbmRzIGluIG9yZGVy
IG9mCi0JICogaW5jcmVhc2luZyBvZmZzZXQuIE9uY2UgYW4gZXJyb3IgaXMgaGl0LCB0aGVuIHJl
dHVybiB3aXRob3V0IHdhaXRpbmcKLQkgKiBmb3IgYW55IG1vcmUgcmVwbGllcy4KLQkgKi8KLXJl
c3RhcnRfbG9vcDoKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUod2RhdGEsIHRtcCwgJmN0eC0+
bGlzdCwgbGlzdCkgewotCQlpZiAoIXJjKSB7Ci0JCQlpZiAoIXRyeV93YWl0X2Zvcl9jb21wbGV0
aW9uKCZ3ZGF0YS0+ZG9uZSkpIHsKLQkJCQltdXRleF91bmxvY2soJmN0eC0+YWlvX211dGV4KTsK
LQkJCQlyZXR1cm47Ci0JCQl9Ci0KLQkJCWlmICh3ZGF0YS0+cmVzdWx0KQotCQkJCXJjID0gd2Rh
dGEtPnJlc3VsdDsKLQkJCWVsc2UKLQkJCQljdHgtPnRvdGFsX2xlbiArPSB3ZGF0YS0+c3VicmVx
LmxlbjsKLQotCQkJLyogcmVzZW5kIGNhbGwgaWYgaXQncyBhIHJldHJ5YWJsZSBlcnJvciAqLwot
CQkJaWYgKHJjID09IC1FQUdBSU4pIHsKLQkJCQlzdHJ1Y3QgbGlzdF9oZWFkIHRtcF9saXN0Owot
CQkJCXN0cnVjdCBpb3ZfaXRlciB0bXBfZnJvbSA9IGN0eC0+aXRlcjsKLQotCQkJCUlOSVRfTElT
VF9IRUFEKCZ0bXBfbGlzdCk7Ci0JCQkJbGlzdF9kZWxfaW5pdCgmd2RhdGEtPmxpc3QpOwotCi0J
CQkJaWYgKGN0eC0+ZGlyZWN0X2lvKQotCQkJCQlyYyA9IGNpZnNfcmVzZW5kX3dkYXRhKAotCQkJ
CQkJd2RhdGEsICZ0bXBfbGlzdCwgY3R4KTsKLQkJCQllbHNlIHsKLQkJCQkJaW92X2l0ZXJfYWR2
YW5jZSgmdG1wX2Zyb20sCi0JCQkJCQkgd2RhdGEtPnN1YnJlcS5zdGFydCAtIGN0eC0+cG9zKTsK
LQotCQkJCQlyYyA9IGNpZnNfd3JpdGVfZnJvbV9pdGVyKHdkYXRhLT5zdWJyZXEuc3RhcnQsCi0J
CQkJCQl3ZGF0YS0+c3VicmVxLmxlbiwgJnRtcF9mcm9tLAotCQkJCQkJY3R4LT5jZmlsZSwgY2lm
c19zYiwgJnRtcF9saXN0LAotCQkJCQkJY3R4KTsKLQotCQkJCQljaWZzX3B1dF93cml0ZWRhdGEo
d2RhdGEpOwotCQkJCX0KLQotCQkJCWxpc3Rfc3BsaWNlKCZ0bXBfbGlzdCwgJmN0eC0+bGlzdCk7
Ci0JCQkJZ290byByZXN0YXJ0X2xvb3A7Ci0JCQl9Ci0JCX0KLQkJbGlzdF9kZWxfaW5pdCgmd2Rh
dGEtPmxpc3QpOwotCQljaWZzX3B1dF93cml0ZWRhdGEod2RhdGEpOwotCX0KLQotCWNpZnNfc3Rh
dHNfYnl0ZXNfd3JpdHRlbih0Y29uLCBjdHgtPnRvdGFsX2xlbik7Ci0Jc2V0X2JpdChDSUZTX0lO
T19JTlZBTElEX01BUFBJTkcsICZDSUZTX0koZGVudHJ5LT5kX2lub2RlKS0+ZmxhZ3MpOwotCi0J
Y3R4LT5yYyA9IChyYyA9PSAwKSA/IGN0eC0+dG90YWxfbGVuIDogcmM7Ci0KLQltdXRleF91bmxv
Y2soJmN0eC0+YWlvX211dGV4KTsKLQotCWlmIChjdHgtPmlvY2IgJiYgY3R4LT5pb2NiLT5raV9j
b21wbGV0ZSkKLQkJY3R4LT5pb2NiLT5raV9jb21wbGV0ZShjdHgtPmlvY2IsIGN0eC0+cmMpOwot
CWVsc2UKLQkJY29tcGxldGUoJmN0eC0+ZG9uZSk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IF9fY2lm
c193cml0ZXYoCi0Jc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKmZyb20sIGJv
b2wgZGlyZWN0KQotewotCXN0cnVjdCBmaWxlICpmaWxlID0gaW9jYi0+a2lfZmlscDsKLQlzc2l6
ZV90IHRvdGFsX3dyaXR0ZW4gPSAwOwotCXN0cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlOwotCXN0
cnVjdCBjaWZzX3Rjb24gKnRjb247Ci0Jc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYjsKLQlz
dHJ1Y3QgY2lmc19haW9fY3R4ICpjdHg7Ci0JaW50IHJjOwotCi0JcmMgPSBnZW5lcmljX3dyaXRl
X2NoZWNrcyhpb2NiLCBmcm9tKTsKLQlpZiAocmMgPD0gMCkKLQkJcmV0dXJuIHJjOwotCi0JY2lm
c19zYiA9IENJRlNfRklMRV9TQihmaWxlKTsKLQljZmlsZSA9IGZpbGUtPnByaXZhdGVfZGF0YTsK
LQl0Y29uID0gdGxpbmtfdGNvbihjZmlsZS0+dGxpbmspOwotCi0JaWYgKCF0Y29uLT5zZXMtPnNl
cnZlci0+b3BzLT5hc3luY193cml0ZXYpCi0JCXJldHVybiAtRU5PU1lTOwotCi0JY3R4ID0gY2lm
c19haW9fY3R4X2FsbG9jKCk7Ci0JaWYgKCFjdHgpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JY3R4
LT5jZmlsZSA9IGNpZnNGaWxlSW5mb19nZXQoY2ZpbGUpOwotCi0JaWYgKCFpc19zeW5jX2tpb2Ni
KGlvY2IpKQotCQljdHgtPmlvY2IgPSBpb2NiOwotCi0JY3R4LT5wb3MgPSBpb2NiLT5raV9wb3M7
Ci0JY3R4LT5kaXJlY3RfaW8gPSBkaXJlY3Q7Ci0JY3R4LT5ucl9waW5uZWRfcGFnZXMgPSAwOwot
Ci0JaWYgKHVzZXJfYmFja2VkX2l0ZXIoZnJvbSkpIHsKLQkJLyoKLQkJICogRXh0cmFjdCBJT1ZF
Qy9VQlVGLXR5cGUgaXRlcmF0b3JzIHRvIGEgQlZFQy10eXBlIGl0ZXJhdG9yIGFzCi0JCSAqIHRo
ZXkgY29udGFpbiByZWZlcmVuY2VzIHRvIHRoZSBjYWxsaW5nIHByb2Nlc3MncyB2aXJ0dWFsCi0J
CSAqIG1lbW9yeSBsYXlvdXQgd2hpY2ggd29uJ3QgYmUgYXZhaWxhYmxlIGluIGFuIGFzeW5jIHdv
cmtlcgotCQkgKiB0aHJlYWQuICBUaGlzIGFsc28gdGFrZXMgYSBwaW4gb24gZXZlcnkgZm9saW8g
aW52b2x2ZWQuCi0JCSAqLwotCQlyYyA9IG5ldGZzX2V4dHJhY3RfdXNlcl9pdGVyKGZyb20sIGlv
dl9pdGVyX2NvdW50KGZyb20pLAotCQkJCQkgICAgICZjdHgtPml0ZXIsIDApOwotCQlpZiAocmMg
PCAwKSB7Ci0JCQlrcmVmX3B1dCgmY3R4LT5yZWZjb3VudCwgY2lmc19haW9fY3R4X3JlbGVhc2Up
OwotCQkJcmV0dXJuIHJjOwotCQl9Ci0KLQkJY3R4LT5ucl9waW5uZWRfcGFnZXMgPSByYzsKLQkJ
Y3R4LT5idiA9ICh2b2lkICopY3R4LT5pdGVyLmJ2ZWM7Ci0JCWN0eC0+YnZfbmVlZF91bnBpbiA9
IGlvdl9pdGVyX2V4dHJhY3Rfd2lsbF9waW4oZnJvbSk7Ci0JfSBlbHNlIGlmICgoaW92X2l0ZXJf
aXNfYnZlYyhmcm9tKSB8fCBpb3ZfaXRlcl9pc19rdmVjKGZyb20pKSAmJgotCQkgICAhaXNfc3lu
Y19raW9jYihpb2NiKSkgewotCQkvKgotCQkgKiBJZiB0aGUgb3AgaXMgYXN5bmNocm9ub3VzLCB3
ZSBuZWVkIHRvIGNvcHkgdGhlIGxpc3QgYXR0YWNoZWQKLQkJICogdG8gYSBCVkVDL0tWRUMtdHlw
ZSBpdGVyYXRvciwgYnV0IHdlIGFzc3VtZSB0aGF0IHRoZSBzdG9yYWdlCi0JCSAqIHdpbGwgYmUg
cGlubmVkIGJ5IHRoZSBjYWxsZXI7IGluIGFueSBjYXNlLCB3ZSBtYXkgb3IgbWF5IG5vdAotCQkg
KiBiZSBhYmxlIHRvIHBpbiB0aGUgcGFnZXMsIHNvIHdlIGRvbid0IHRyeS4KLQkJICovCi0JCWN0
eC0+YnYgPSAodm9pZCAqKWR1cF9pdGVyKCZjdHgtPml0ZXIsIGZyb20sIEdGUF9LRVJORUwpOwot
CQlpZiAoIWN0eC0+YnYpIHsKLQkJCWtyZWZfcHV0KCZjdHgtPnJlZmNvdW50LCBjaWZzX2Fpb19j
dHhfcmVsZWFzZSk7Ci0JCQlyZXR1cm4gLUVOT01FTTsKLQkJfQotCX0gZWxzZSB7Ci0JCS8qCi0J
CSAqIE90aGVyd2lzZSwgd2UganVzdCBwYXNzIHRoZSBpdGVyYXRvciBkb3duIGFzLWlzIGFuZCBy
ZWx5IG9uCi0JCSAqIHRoZSBjYWxsZXIgdG8gbWFrZSBzdXJlIHRoZSBwYWdlcyByZWZlcnJlZCB0
byBieSB0aGUKLQkJICogaXRlcmF0b3IgZG9uJ3QgZXZhcG9yYXRlLgotCQkgKi8KLQkJY3R4LT5p
dGVyID0gKmZyb207Ci0JfQotCi0JY3R4LT5sZW4gPSBpb3ZfaXRlcl9jb3VudCgmY3R4LT5pdGVy
KTsKLQotCS8qIGdyYWIgYSBsb2NrIGhlcmUgZHVlIHRvIHJlYWQgcmVzcG9uc2UgaGFuZGxlcnMg
Y2FuIGFjY2VzcyBjdHggKi8KLQltdXRleF9sb2NrKCZjdHgtPmFpb19tdXRleCk7Ci0KLQlyYyA9
IGNpZnNfd3JpdGVfZnJvbV9pdGVyKGlvY2ItPmtpX3BvcywgY3R4LT5sZW4sICZjdHgtPml0ZXIs
Ci0JCQkJICBjZmlsZSwgY2lmc19zYiwgJmN0eC0+bGlzdCwgY3R4KTsKLQotCS8qCi0JICogSWYg
YXQgbGVhc3Qgb25lIHdyaXRlIHdhcyBzdWNjZXNzZnVsbHkgc2VudCwgdGhlbiBkaXNjYXJkIGFu
eSByYwotCSAqIHZhbHVlIGZyb20gdGhlIGxhdGVyIHdyaXRlcy4gSWYgdGhlIG90aGVyIHdyaXRl
IHN1Y2NlZWRzLCB0aGVuCi0JICogd2UnbGwgZW5kIHVwIHJldHVybmluZyB3aGF0ZXZlciB3YXMg
d3JpdHRlbi4gSWYgaXQgZmFpbHMsIHRoZW4KLQkgKiB3ZSdsbCBnZXQgYSBuZXcgcmMgdmFsdWUg
ZnJvbSB0aGF0LgotCSAqLwotCWlmICghbGlzdF9lbXB0eSgmY3R4LT5saXN0KSkKLQkJcmMgPSAw
OwotCi0JbXV0ZXhfdW5sb2NrKCZjdHgtPmFpb19tdXRleCk7Ci0KLQlpZiAocmMpIHsKLQkJa3Jl
Zl9wdXQoJmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLQkJcmV0dXJuIHJj
OwotCX0KLQotCWlmICghaXNfc3luY19raW9jYihpb2NiKSkgewotCQlrcmVmX3B1dCgmY3R4LT5y
ZWZjb3VudCwgY2lmc19haW9fY3R4X3JlbGVhc2UpOwotCQlyZXR1cm4gLUVJT0NCUVVFVUVEOwot
CX0KLQotCXJjID0gd2FpdF9mb3JfY29tcGxldGlvbl9raWxsYWJsZSgmY3R4LT5kb25lKTsKLQlp
ZiAocmMpIHsKLQkJbXV0ZXhfbG9jaygmY3R4LT5haW9fbXV0ZXgpOwotCQljdHgtPnJjID0gcmMg
PSAtRUlOVFI7Ci0JCXRvdGFsX3dyaXR0ZW4gPSBjdHgtPnRvdGFsX2xlbjsKLQkJbXV0ZXhfdW5s
b2NrKCZjdHgtPmFpb19tdXRleCk7Ci0JfSBlbHNlIHsKLQkJcmMgPSBjdHgtPnJjOwotCQl0b3Rh
bF93cml0dGVuID0gY3R4LT50b3RhbF9sZW47Ci0JfQotCi0Ja3JlZl9wdXQoJmN0eC0+cmVmY291
bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLQotCWlmICh1bmxpa2VseSghdG90YWxfd3JpdHRl
bikpCi0JCXJldHVybiByYzsKLQotCWlvY2ItPmtpX3BvcyArPSB0b3RhbF93cml0dGVuOwotCXJl
dHVybiB0b3RhbF93cml0dGVuOwotfQotCi1zc2l6ZV90IGNpZnNfZGlyZWN0X3dyaXRldihzdHJ1
Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqZnJvbSkKLXsKLQlzdHJ1Y3QgZmlsZSAq
ZmlsZSA9IGlvY2ItPmtpX2ZpbHA7Ci0KLQljaWZzX3JldmFsaWRhdGVfbWFwcGluZyhmaWxlLT5m
X2lub2RlKTsKLQlyZXR1cm4gX19jaWZzX3dyaXRldihpb2NiLCBmcm9tLCB0cnVlKTsKLX0KLQot
c3NpemVfdCBjaWZzX3VzZXJfd3JpdGV2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9p
dGVyICpmcm9tKQotewotCXJldHVybiBfX2NpZnNfd3JpdGV2KGlvY2IsIGZyb20sIGZhbHNlKTsK
LX0KLSNlbmRpZiAvLyBUT0RPIHJlbW92ZSAzNTk0Ci0KIHN0YXRpYyBzc2l6ZV90CiBjaWZzX3dy
aXRldihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqZnJvbSkKIHsKQEAgLTMy
NDEsNDUwICsyNzc3LDYgQEAgY2lmc19zdHJpY3Rfd3JpdGV2KHN0cnVjdCBraW9jYiAqaW9jYiwg
c3RydWN0IGlvdl9pdGVyICpmcm9tKQogCXJldHVybiB3cml0dGVuOwogfQogCi0jaWYgMCAvLyBU
T0RPIHJlbW92ZSA0MTQzCi1zdGF0aWMgc3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqY2lmc19y
ZWFkZGF0YV9hbGxvYyh3b3JrX2Z1bmNfdCBjb21wbGV0ZSkKLXsKLQlzdHJ1Y3QgY2lmc19pb19z
dWJyZXF1ZXN0ICpyZGF0YTsKLQotCXJkYXRhID0ga3phbGxvYyhzaXplb2YoKnJkYXRhKSwgR0ZQ
X0tFUk5FTCk7Ci0JaWYgKHJkYXRhKSB7Ci0JCXJlZmNvdW50X3NldCgmcmRhdGEtPnN1YnJlcS5y
ZWYsIDEpOwotCQlJTklUX0xJU1RfSEVBRCgmcmRhdGEtPmxpc3QpOwotCQlpbml0X2NvbXBsZXRp
b24oJnJkYXRhLT5kb25lKTsKLQkJSU5JVF9XT1JLKCZyZGF0YS0+d29yaywgY29tcGxldGUpOwot
CX0KLQotCXJldHVybiByZGF0YTsKLX0KLQotdm9pZAotY2lmc19yZWFkZGF0YV9yZWxlYXNlKHN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKnJkYXRhKQotewotCWlmIChyZGF0YS0+Y3R4KQotCQlr
cmVmX3B1dCgmcmRhdGEtPmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLSNp
ZmRlZiBDT05GSUdfQ0lGU19TTUJfRElSRUNUCi0JaWYgKHJkYXRhLT5tcikgewotCQlzbWJkX2Rl
cmVnaXN0ZXJfbXIocmRhdGEtPm1yKTsKLQkJcmRhdGEtPm1yID0gTlVMTDsKLQl9Ci0jZW5kaWYK
LQlpZiAocmRhdGEtPmNmaWxlKQotCQljaWZzRmlsZUluZm9fcHV0KHJkYXRhLT5jZmlsZSk7Ci0K
LQlrZnJlZShyZGF0YSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGNvbGxlY3RfdW5jYWNoZWRfcmVhZF9k
YXRhKHN0cnVjdCBjaWZzX2Fpb19jdHggKmN0eCk7Ci0KLXN0YXRpYyB2b2lkCi1jaWZzX3VuY2Fj
aGVkX3JlYWR2X2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKLXsKLQlzdHJ1Y3Qg
Y2lmc19pb19zdWJyZXF1ZXN0ICpyZGF0YSA9Ci0JCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3Qg
Y2lmc19pb19zdWJyZXF1ZXN0LCB3b3JrKTsKLQotCWNvbXBsZXRlKCZyZGF0YS0+ZG9uZSk7Ci0J
Y29sbGVjdF91bmNhY2hlZF9yZWFkX2RhdGEocmRhdGEtPmN0eCk7Ci0JLyogdGhlIGJlbG93IGNh
bGwgY2FuIHBvc3NpYmx5IGZyZWUgdGhlIGxhc3QgcmVmIHRvIGFpbyBjdHggKi8KLQljaWZzX3B1
dF9yZWFkZGF0YShyZGF0YSk7Ci19Ci0KLXN0YXRpYyBpbnQgY2lmc19yZXNlbmRfcmRhdGEoc3Ry
dWN0IGNpZnNfaW9fc3VicmVxdWVzdCAqcmRhdGEsCi0JCQlzdHJ1Y3QgbGlzdF9oZWFkICpyZGF0
YV9saXN0LAotCQkJc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4KQotewotCXNpemVfdCByc2l6ZTsK
LQlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRpdHM7Ci0JaW50IHJjOwotCXN0cnVjdCBUQ1BfU2Vy
dmVyX0luZm8gKnNlcnZlcjsKLQotCS8qIFhYWDogc2hvdWxkIHdlIHBpY2sgYSBuZXcgY2hhbm5l
bCBoZXJlPyAqLwotCXNlcnZlciA9IHJkYXRhLT5zZXJ2ZXI7Ci0KLQlkbyB7Ci0JCWlmIChyZGF0
YS0+Y2ZpbGUtPmludmFsaWRIYW5kbGUpIHsKLQkJCXJjID0gY2lmc19yZW9wZW5fZmlsZShyZGF0
YS0+Y2ZpbGUsIHRydWUpOwotCQkJaWYgKHJjID09IC1FQUdBSU4pCi0JCQkJY29udGludWU7Ci0J
CQllbHNlIGlmIChyYykKLQkJCQlicmVhazsKLQkJfQotCi0JCS8qCi0JCSAqIFdhaXQgZm9yIGNy
ZWRpdHMgdG8gcmVzZW5kIHRoaXMgcmRhdGEuCi0JCSAqIE5vdGU6IHdlIGFyZSBhdHRlbXB0aW5n
IHRvIHJlc2VuZCB0aGUgd2hvbGUgcmRhdGEgbm90IGluCi0JCSAqIHNlZ21lbnRzCi0JCSAqLwot
CQlkbyB7Ci0JCQlyYyA9IHNlcnZlci0+b3BzLT53YWl0X210dV9jcmVkaXRzKHNlcnZlciwgcmRh
dGEtPnN1YnJlcS5sZW4sCi0JCQkJCQkmcnNpemUsICZjcmVkaXRzKTsKLQotCQkJaWYgKHJjKQot
CQkJCWdvdG8gZmFpbDsKLQotCQkJaWYgKHJzaXplIDwgcmRhdGEtPnN1YnJlcS5sZW4pIHsKLQkJ
CQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2ZXIsICZjcmVkaXRzLCAwKTsKLQkJCQltc2xl
ZXAoMTAwMCk7Ci0JCQl9Ci0JCX0gd2hpbGUgKHJzaXplIDwgcmRhdGEtPnN1YnJlcS5sZW4pOwot
CQlyZGF0YS0+Y3JlZGl0cyA9IGNyZWRpdHM7Ci0KLQkJcmMgPSBhZGp1c3RfY3JlZGl0cyhzZXJ2
ZXIsICZyZGF0YS0+Y3JlZGl0cywgcmRhdGEtPnN1YnJlcS5sZW4pOwotCQlpZiAoIXJjKSB7Ci0J
CQlpZiAocmRhdGEtPmNmaWxlLT5pbnZhbGlkSGFuZGxlKQotCQkJCXJjID0gLUVBR0FJTjsKLQkJ
CWVsc2UgewotI2lmZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QKLQkJCQlpZiAocmRhdGEtPm1y
KSB7Ci0JCQkJCXJkYXRhLT5tci0+bmVlZF9pbnZhbGlkYXRlID0gdHJ1ZTsKLQkJCQkJc21iZF9k
ZXJlZ2lzdGVyX21yKHJkYXRhLT5tcik7Ci0JCQkJCXJkYXRhLT5tciA9IE5VTEw7Ci0JCQkJfQot
I2VuZGlmCi0JCQkJcmMgPSBzZXJ2ZXItPm9wcy0+YXN5bmNfcmVhZHYocmRhdGEpOwotCQkJfQot
CQl9Ci0KLQkJLyogSWYgdGhlIHJlYWQgd2FzIHN1Y2Nlc3NmdWxseSBzZW50LCB3ZSBhcmUgZG9u
ZSAqLwotCQlpZiAoIXJjKSB7Ci0JCQkvKiBBZGQgdG8gYWlvIHBlbmRpbmcgbGlzdCAqLwotCQkJ
bGlzdF9hZGRfdGFpbCgmcmRhdGEtPmxpc3QsIHJkYXRhX2xpc3QpOwotCQkJcmV0dXJuIDA7Ci0J
CX0KLQotCQkvKiBSb2xsIGJhY2sgY3JlZGl0cyBhbmQgcmV0cnkgaWYgbmVlZGVkICovCi0JCWFk
ZF9jcmVkaXRzX2FuZF93YWtlX2lmKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCAwKTsKLQl9IHdo
aWxlIChyYyA9PSAtRUFHQUlOKTsKLQotZmFpbDoKLQljaWZzX3B1dF9yZWFkZGF0YShyZGF0YSk7
Ci0JcmV0dXJuIHJjOwotfQotCi1zdGF0aWMgaW50Ci1jaWZzX3NlbmRfYXN5bmNfcmVhZChsb2Zm
X3QgZnBvcywgc2l6ZV90IGxlbiwgc3RydWN0IGNpZnNGaWxlSW5mbyAqb3Blbl9maWxlLAotCQkg
ICAgIHN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2IsIHN0cnVjdCBsaXN0X2hlYWQgKnJkYXRh
X2xpc3QsCi0JCSAgICAgc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4KQotewotCXN0cnVjdCBjaWZz
X2lvX3N1YnJlcXVlc3QgKnJkYXRhOwotCXVuc2lnbmVkIGludCBuc2VncywgbWF4X3NlZ3MgPSBJ
TlRfTUFYOwotCXN0cnVjdCBjaWZzX2NyZWRpdHMgY3JlZGl0c19vbl9zdGFjazsKLQlzdHJ1Y3Qg
Y2lmc19jcmVkaXRzICpjcmVkaXRzID0gJmNyZWRpdHNfb25fc3RhY2s7Ci0Jc2l6ZV90IGN1cl9s
ZW4sIG1heF9sZW4sIHJzaXplOwotCWludCByYzsKLQlwaWRfdCBwaWQ7Ci0Jc3RydWN0IFRDUF9T
ZXJ2ZXJfSW5mbyAqc2VydmVyOwotCi0Jc2VydmVyID0gY2lmc19waWNrX2NoYW5uZWwodGxpbmtf
dGNvbihvcGVuX2ZpbGUtPnRsaW5rKS0+c2VzKTsKLQotI2lmZGVmIENPTkZJR19DSUZTX1NNQl9E
SVJFQ1QKLQlpZiAoc2VydmVyLT5zbWJkX2Nvbm4pCi0JCW1heF9zZWdzID0gc2VydmVyLT5zbWJk
X2Nvbm4tPm1heF9mcm1yX2RlcHRoOwotI2VuZGlmCi0KLQlpZiAoY2lmc19zYi0+bW50X2NpZnNf
ZmxhZ3MgJiBDSUZTX01PVU5UX1JXUElERk9SV0FSRCkKLQkJcGlkID0gb3Blbl9maWxlLT5waWQ7
Ci0JZWxzZQotCQlwaWQgPSBjdXJyZW50LT50Z2lkOwotCi0JZG8gewotCQlpZiAob3Blbl9maWxl
LT5pbnZhbGlkSGFuZGxlKSB7Ci0JCQlyYyA9IGNpZnNfcmVvcGVuX2ZpbGUob3Blbl9maWxlLCB0
cnVlKTsKLQkJCWlmIChyYyA9PSAtRUFHQUlOKQotCQkJCWNvbnRpbnVlOwotCQkJZWxzZSBpZiAo
cmMpCi0JCQkJYnJlYWs7Ci0JCX0KLQotCQlpZiAoY2lmc19zYi0+Y3R4LT5yc2l6ZSA9PSAwKQot
CQkJY2lmc19zYi0+Y3R4LT5yc2l6ZSA9Ci0JCQkJc2VydmVyLT5vcHMtPm5lZ290aWF0ZV9yc2l6
ZSh0bGlua190Y29uKG9wZW5fZmlsZS0+dGxpbmspLAotCQkJCQkJCSAgICAgY2lmc19zYi0+Y3R4
KTsKLQotCQlyYyA9IHNlcnZlci0+b3BzLT53YWl0X210dV9jcmVkaXRzKHNlcnZlciwgY2lmc19z
Yi0+Y3R4LT5yc2l6ZSwKLQkJCQkJCSAgICZyc2l6ZSwgY3JlZGl0cyk7Ci0JCWlmIChyYykKLQkJ
CWJyZWFrOwotCi0JCW1heF9sZW4gPSBtaW5fdChzaXplX3QsIGxlbiwgcnNpemUpOwotCi0JCWN1
cl9sZW4gPSBjaWZzX2xpbWl0X2J2ZWNfc3Vic2V0KCZjdHgtPml0ZXIsIG1heF9sZW4sCi0JCQkJ
CQkgbWF4X3NlZ3MsICZuc2Vncyk7Ci0JCWNpZnNfZGJnKEZZSSwgInJlYWQtdG8taXRlciBsZW49
JXp4LyV6eCBuc2Vncz0ldS8lbHUvJXVcbiIsCi0JCQkgY3VyX2xlbiwgbWF4X2xlbiwgbnNlZ3Ms
IGN0eC0+aXRlci5ucl9zZWdzLCBtYXhfc2Vncyk7Ci0JCWlmIChjdXJfbGVuID09IDApIHsKLQkJ
CXJjID0gLUVJTzsKLQkJCWFkZF9jcmVkaXRzX2FuZF93YWtlX2lmKHNlcnZlciwgY3JlZGl0cywg
MCk7Ci0JCQlicmVhazsKLQkJfQotCi0JCXJkYXRhID0gY2lmc19yZWFkZGF0YV9hbGxvYyhjaWZz
X3VuY2FjaGVkX3JlYWR2X2NvbXBsZXRlKTsKLQkJaWYgKCFyZGF0YSkgewotCQkJYWRkX2NyZWRp
dHNfYW5kX3dha2VfaWYoc2VydmVyLCBjcmVkaXRzLCAwKTsKLQkJCXJjID0gLUVOT01FTTsKLQkJ
CWJyZWFrOwotCQl9Ci0KLQkJcmRhdGEtPnNlcnZlcgk9IHNlcnZlcjsKLQkJcmRhdGEtPmNmaWxl
CT0gY2lmc0ZpbGVJbmZvX2dldChvcGVuX2ZpbGUpOwotCQlyZGF0YS0+c3VicmVxLnN0YXJ0CT0g
ZnBvczsKLQkJcmRhdGEtPnN1YnJlcS5sZW4JPSBjdXJfbGVuOwotCQlyZGF0YS0+cGlkCT0gcGlk
OwotCQlyZGF0YS0+Y3JlZGl0cwk9IGNyZWRpdHNfb25fc3RhY2s7Ci0JCXJkYXRhLT5jdHgJPSBj
dHg7Ci0JCWtyZWZfZ2V0KCZjdHgtPnJlZmNvdW50KTsKLQotCQlyZGF0YS0+c3VicmVxLmlvX2l0
ZXIgPSBjdHgtPml0ZXI7Ci0JCWlvdl9pdGVyX3RydW5jYXRlKCZyZGF0YS0+c3VicmVxLmlvX2l0
ZXIsIGN1cl9sZW4pOwotCi0JCXJjID0gYWRqdXN0X2NyZWRpdHMoc2VydmVyLCAmcmRhdGEtPmNy
ZWRpdHMsIHJkYXRhLT5zdWJyZXEubGVuKTsKLQotCQlpZiAoIXJjKSB7Ci0JCQlpZiAocmRhdGEt
PmNmaWxlLT5pbnZhbGlkSGFuZGxlKQotCQkJCXJjID0gLUVBR0FJTjsKLQkJCWVsc2UKLQkJCQly
YyA9IHNlcnZlci0+b3BzLT5hc3luY19yZWFkdihyZGF0YSk7Ci0JCX0KLQotCQlpZiAocmMpIHsK
LQkJCWFkZF9jcmVkaXRzX2FuZF93YWtlX2lmKHNlcnZlciwgJnJkYXRhLT5jcmVkaXRzLCAwKTsK
LQkJCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsKLQkJCWlmIChyYyA9PSAtRUFHQUlOKQotCQkJ
CWNvbnRpbnVlOwotCQkJYnJlYWs7Ci0JCX0KLQotCQlsaXN0X2FkZF90YWlsKCZyZGF0YS0+bGlz
dCwgcmRhdGFfbGlzdCk7Ci0JCWlvdl9pdGVyX2FkdmFuY2UoJmN0eC0+aXRlciwgY3VyX2xlbik7
Ci0JCWZwb3MgKz0gY3VyX2xlbjsKLQkJbGVuIC09IGN1cl9sZW47Ci0JfSB3aGlsZSAobGVuID4g
MCk7Ci0KLQlyZXR1cm4gcmM7Ci19Ci0KLXN0YXRpYyB2b2lkCi1jb2xsZWN0X3VuY2FjaGVkX3Jl
YWRfZGF0YShzdHJ1Y3QgY2lmc19haW9fY3R4ICpjdHgpCi17Ci0Jc3RydWN0IGNpZnNfaW9fc3Vi
cmVxdWVzdCAqcmRhdGEsICp0bXA7Ci0Jc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYjsKLQlp
bnQgcmM7Ci0KLQljaWZzX3NiID0gQ0lGU19TQihjdHgtPmNmaWxlLT5kZW50cnktPmRfc2IpOwot
Ci0JbXV0ZXhfbG9jaygmY3R4LT5haW9fbXV0ZXgpOwotCi0JaWYgKGxpc3RfZW1wdHkoJmN0eC0+
bGlzdCkpIHsKLQkJbXV0ZXhfdW5sb2NrKCZjdHgtPmFpb19tdXRleCk7Ci0JCXJldHVybjsKLQl9
Ci0KLQlyYyA9IGN0eC0+cmM7Ci0JLyogdGhlIGxvb3AgYmVsb3cgc2hvdWxkIHByb2NlZWQgaW4g
dGhlIG9yZGVyIG9mIGluY3JlYXNpbmcgb2Zmc2V0cyAqLwotYWdhaW46Ci0JbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKHJkYXRhLCB0bXAsICZjdHgtPmxpc3QsIGxpc3QpIHsKLQkJaWYgKCFyYykg
ewotCQkJaWYgKCF0cnlfd2FpdF9mb3JfY29tcGxldGlvbigmcmRhdGEtPmRvbmUpKSB7Ci0JCQkJ
bXV0ZXhfdW5sb2NrKCZjdHgtPmFpb19tdXRleCk7Ci0JCQkJcmV0dXJuOwotCQkJfQotCi0JCQlp
ZiAocmRhdGEtPnJlc3VsdCA9PSAtRUFHQUlOKSB7Ci0JCQkJLyogcmVzZW5kIGNhbGwgaWYgaXQn
cyBhIHJldHJ5YWJsZSBlcnJvciAqLwotCQkJCXN0cnVjdCBsaXN0X2hlYWQgdG1wX2xpc3Q7Ci0J
CQkJdW5zaWduZWQgaW50IGdvdF9ieXRlcyA9IHJkYXRhLT5nb3RfYnl0ZXM7Ci0KLQkJCQlsaXN0
X2RlbF9pbml0KCZyZGF0YS0+bGlzdCk7Ci0JCQkJSU5JVF9MSVNUX0hFQUQoJnRtcF9saXN0KTsK
LQotCQkJCWlmIChjdHgtPmRpcmVjdF9pbykgewotCQkJCQkvKgotCQkJCQkgKiBSZS11c2UgcmRh
dGEgYXMgdGhpcyBpcyBhCi0JCQkJCSAqIGRpcmVjdCBJL08KLQkJCQkJICovCi0JCQkJCXJjID0g
Y2lmc19yZXNlbmRfcmRhdGEoCi0JCQkJCQlyZGF0YSwKLQkJCQkJCSZ0bXBfbGlzdCwgY3R4KTsK
LQkJCQl9IGVsc2UgewotCQkJCQlyYyA9IGNpZnNfc2VuZF9hc3luY19yZWFkKAotCQkJCQkJcmRh
dGEtPnN1YnJlcS5zdGFydCArIGdvdF9ieXRlcywKLQkJCQkJCXJkYXRhLT5zdWJyZXEubGVuIC0g
Z290X2J5dGVzLAotCQkJCQkJcmRhdGEtPmNmaWxlLCBjaWZzX3NiLAotCQkJCQkJJnRtcF9saXN0
LCBjdHgpOwotCi0JCQkJCWNpZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsKLQkJCQl9Ci0KLQkJCQls
aXN0X3NwbGljZSgmdG1wX2xpc3QsICZjdHgtPmxpc3QpOwotCi0JCQkJZ290byBhZ2FpbjsKLQkJ
CX0gZWxzZSBpZiAocmRhdGEtPnJlc3VsdCkKLQkJCQlyYyA9IHJkYXRhLT5yZXN1bHQ7Ci0KLQkJ
CS8qIGlmIHRoZXJlIHdhcyBhIHNob3J0IHJlYWQgLS0gZGlzY2FyZCBhbnl0aGluZyBsZWZ0ICov
Ci0JCQlpZiAocmRhdGEtPmdvdF9ieXRlcyAmJiByZGF0YS0+Z290X2J5dGVzIDwgcmRhdGEtPnN1
YnJlcS5sZW4pCi0JCQkJcmMgPSAtRU5PREFUQTsKLQotCQkJY3R4LT50b3RhbF9sZW4gKz0gcmRh
dGEtPmdvdF9ieXRlczsKLQkJfQotCQlsaXN0X2RlbF9pbml0KCZyZGF0YS0+bGlzdCk7Ci0JCWNp
ZnNfcHV0X3JlYWRkYXRhKHJkYXRhKTsKLQl9Ci0KLQkvKiBtYXNrIG5vZGF0YSBjYXNlICovCi0J
aWYgKHJjID09IC1FTk9EQVRBKQotCQlyYyA9IDA7Ci0KLQljdHgtPnJjID0gKHJjID09IDApID8g
KHNzaXplX3QpY3R4LT50b3RhbF9sZW4gOiByYzsKLQotCW11dGV4X3VubG9jaygmY3R4LT5haW9f
bXV0ZXgpOwotCi0JaWYgKGN0eC0+aW9jYiAmJiBjdHgtPmlvY2ItPmtpX2NvbXBsZXRlKQotCQlj
dHgtPmlvY2ItPmtpX2NvbXBsZXRlKGN0eC0+aW9jYiwgY3R4LT5yYyk7Ci0JZWxzZQotCQljb21w
bGV0ZSgmY3R4LT5kb25lKTsKLX0KLQotc3RhdGljIHNzaXplX3QgX19jaWZzX3JlYWR2KAotCXN0
cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICp0bywgYm9vbCBkaXJlY3QpCi17Ci0J
c2l6ZV90IGxlbjsKLQlzdHJ1Y3QgZmlsZSAqZmlsZSA9IGlvY2ItPmtpX2ZpbHA7Ci0Jc3RydWN0
IGNpZnNfc2JfaW5mbyAqY2lmc19zYjsKLQlzdHJ1Y3QgY2lmc0ZpbGVJbmZvICpjZmlsZTsKLQlz
dHJ1Y3QgY2lmc190Y29uICp0Y29uOwotCXNzaXplX3QgcmMsIHRvdGFsX3JlYWQgPSAwOwotCWxv
ZmZfdCBvZmZzZXQgPSBpb2NiLT5raV9wb3M7Ci0Jc3RydWN0IGNpZnNfYWlvX2N0eCAqY3R4Owot
Ci0JbGVuID0gaW92X2l0ZXJfY291bnQodG8pOwotCWlmICghbGVuKQotCQlyZXR1cm4gMDsKLQot
CWNpZnNfc2IgPSBDSUZTX0ZJTEVfU0IoZmlsZSk7Ci0JY2ZpbGUgPSBmaWxlLT5wcml2YXRlX2Rh
dGE7Ci0JdGNvbiA9IHRsaW5rX3Rjb24oY2ZpbGUtPnRsaW5rKTsKLQotCWlmICghdGNvbi0+c2Vz
LT5zZXJ2ZXItPm9wcy0+YXN5bmNfcmVhZHYpCi0JCXJldHVybiAtRU5PU1lTOwotCi0JaWYgKChm
aWxlLT5mX2ZsYWdzICYgT19BQ0NNT0RFKSA9PSBPX1dST05MWSkKLQkJY2lmc19kYmcoRllJLCAi
YXR0ZW1wdGluZyByZWFkIG9uIHdyaXRlIG9ubHkgZmlsZSBpbnN0YW5jZVxuIik7Ci0KLQljdHgg
PSBjaWZzX2Fpb19jdHhfYWxsb2MoKTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0K
LQljdHgtPnBvcwk9IG9mZnNldDsKLQljdHgtPmRpcmVjdF9pbwk9IGRpcmVjdDsKLQljdHgtPmxl
bgk9IGxlbjsKLQljdHgtPmNmaWxlCT0gY2lmc0ZpbGVJbmZvX2dldChjZmlsZSk7Ci0JY3R4LT5u
cl9waW5uZWRfcGFnZXMgPSAwOwotCi0JaWYgKCFpc19zeW5jX2tpb2NiKGlvY2IpKQotCQljdHgt
PmlvY2IgPSBpb2NiOwotCi0JaWYgKHVzZXJfYmFja2VkX2l0ZXIodG8pKSB7Ci0JCS8qCi0JCSAq
IEV4dHJhY3QgSU9WRUMvVUJVRi10eXBlIGl0ZXJhdG9ycyB0byBhIEJWRUMtdHlwZSBpdGVyYXRv
ciBhcwotCQkgKiB0aGV5IGNvbnRhaW4gcmVmZXJlbmNlcyB0byB0aGUgY2FsbGluZyBwcm9jZXNz
J3MgdmlydHVhbAotCQkgKiBtZW1vcnkgbGF5b3V0IHdoaWNoIHdvbid0IGJlIGF2YWlsYWJsZSBp
biBhbiBhc3luYyB3b3JrZXIKLQkJICogdGhyZWFkLiAgVGhpcyBhbHNvIHRha2VzIGEgcGluIG9u
IGV2ZXJ5IGZvbGlvIGludm9sdmVkLgotCQkgKi8KLQkJcmMgPSBuZXRmc19leHRyYWN0X3VzZXJf
aXRlcih0bywgaW92X2l0ZXJfY291bnQodG8pLAotCQkJCQkgICAgICZjdHgtPml0ZXIsIDApOwot
CQlpZiAocmMgPCAwKSB7Ci0JCQlrcmVmX3B1dCgmY3R4LT5yZWZjb3VudCwgY2lmc19haW9fY3R4
X3JlbGVhc2UpOwotCQkJcmV0dXJuIHJjOwotCQl9Ci0KLQkJY3R4LT5ucl9waW5uZWRfcGFnZXMg
PSByYzsKLQkJY3R4LT5idiA9ICh2b2lkICopY3R4LT5pdGVyLmJ2ZWM7Ci0JCWN0eC0+YnZfbmVl
ZF91bnBpbiA9IGlvdl9pdGVyX2V4dHJhY3Rfd2lsbF9waW4odG8pOwotCQljdHgtPnNob3VsZF9k
aXJ0eSA9IHRydWU7Ci0JfSBlbHNlIGlmICgoaW92X2l0ZXJfaXNfYnZlYyh0bykgfHwgaW92X2l0
ZXJfaXNfa3ZlYyh0bykpICYmCi0JCSAgICFpc19zeW5jX2tpb2NiKGlvY2IpKSB7Ci0JCS8qCi0J
CSAqIElmIHRoZSBvcCBpcyBhc3luY2hyb25vdXMsIHdlIG5lZWQgdG8gY29weSB0aGUgbGlzdCBh
dHRhY2hlZAotCQkgKiB0byBhIEJWRUMvS1ZFQy10eXBlIGl0ZXJhdG9yLCBidXQgd2UgYXNzdW1l
IHRoYXQgdGhlIHN0b3JhZ2UKLQkJICogd2lsbCBiZSByZXRhaW5lZCBieSB0aGUgY2FsbGVyOyBp
biBhbnkgY2FzZSwgd2UgbWF5IG9yIG1heQotCQkgKiBub3QgYmUgYWJsZSB0byBwaW4gdGhlIHBh
Z2VzLCBzbyB3ZSBkb24ndCB0cnkuCi0JCSAqLwotCQljdHgtPmJ2ID0gKHZvaWQgKilkdXBfaXRl
cigmY3R4LT5pdGVyLCB0bywgR0ZQX0tFUk5FTCk7Ci0JCWlmICghY3R4LT5idikgewotCQkJa3Jl
Zl9wdXQoJmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLQkJCXJldHVybiAt
RU5PTUVNOwotCQl9Ci0JfSBlbHNlIHsKLQkJLyoKLQkJICogT3RoZXJ3aXNlLCB3ZSBqdXN0IHBh
c3MgdGhlIGl0ZXJhdG9yIGRvd24gYXMtaXMgYW5kIHJlbHkgb24KLQkJICogdGhlIGNhbGxlciB0
byBtYWtlIHN1cmUgdGhlIHBhZ2VzIHJlZmVycmVkIHRvIGJ5IHRoZQotCQkgKiBpdGVyYXRvciBk
b24ndCBldmFwb3JhdGUuCi0JCSAqLwotCQljdHgtPml0ZXIgPSAqdG87Ci0JfQotCi0JaWYgKGRp
cmVjdCkgewotCQlyYyA9IGZpbGVtYXBfd3JpdGVfYW5kX3dhaXRfcmFuZ2UoZmlsZS0+Zl9pbm9k
ZS0+aV9tYXBwaW5nLAotCQkJCQkJICBvZmZzZXQsIG9mZnNldCArIGxlbiAtIDEpOwotCQlpZiAo
cmMpIHsKLQkJCWtyZWZfcHV0KCZjdHgtPnJlZmNvdW50LCBjaWZzX2Fpb19jdHhfcmVsZWFzZSk7
Ci0JCQlyZXR1cm4gLUVBR0FJTjsKLQkJfQotCX0KLQotCS8qIGdyYWIgYSBsb2NrIGhlcmUgZHVl
IHRvIHJlYWQgcmVzcG9uc2UgaGFuZGxlcnMgY2FuIGFjY2VzcyBjdHggKi8KLQltdXRleF9sb2Nr
KCZjdHgtPmFpb19tdXRleCk7Ci0KLQlyYyA9IGNpZnNfc2VuZF9hc3luY19yZWFkKG9mZnNldCwg
bGVuLCBjZmlsZSwgY2lmc19zYiwgJmN0eC0+bGlzdCwgY3R4KTsKLQotCS8qIGlmIGF0IGxlYXN0
IG9uZSByZWFkIHJlcXVlc3Qgc2VuZCBzdWNjZWVkZWQsIHRoZW4gcmVzZXQgcmMgKi8KLQlpZiAo
IWxpc3RfZW1wdHkoJmN0eC0+bGlzdCkpCi0JCXJjID0gMDsKLQotCW11dGV4X3VubG9jaygmY3R4
LT5haW9fbXV0ZXgpOwotCi0JaWYgKHJjKSB7Ci0JCWtyZWZfcHV0KCZjdHgtPnJlZmNvdW50LCBj
aWZzX2Fpb19jdHhfcmVsZWFzZSk7Ci0JCXJldHVybiByYzsKLQl9Ci0KLQlpZiAoIWlzX3N5bmNf
a2lvY2IoaW9jYikpIHsKLQkJa3JlZl9wdXQoJmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9y
ZWxlYXNlKTsKLQkJcmV0dXJuIC1FSU9DQlFVRVVFRDsKLQl9Ci0KLQlyYyA9IHdhaXRfZm9yX2Nv
bXBsZXRpb25fa2lsbGFibGUoJmN0eC0+ZG9uZSk7Ci0JaWYgKHJjKSB7Ci0JCW11dGV4X2xvY2so
JmN0eC0+YWlvX211dGV4KTsKLQkJY3R4LT5yYyA9IHJjID0gLUVJTlRSOwotCQl0b3RhbF9yZWFk
ID0gY3R4LT50b3RhbF9sZW47Ci0JCW11dGV4X3VubG9jaygmY3R4LT5haW9fbXV0ZXgpOwotCX0g
ZWxzZSB7Ci0JCXJjID0gY3R4LT5yYzsKLQkJdG90YWxfcmVhZCA9IGN0eC0+dG90YWxfbGVuOwot
CX0KLQotCWtyZWZfcHV0KCZjdHgtPnJlZmNvdW50LCBjaWZzX2Fpb19jdHhfcmVsZWFzZSk7Ci0K
LQlpZiAodG90YWxfcmVhZCkgewotCQlpb2NiLT5raV9wb3MgKz0gdG90YWxfcmVhZDsKLQkJcmV0
dXJuIHRvdGFsX3JlYWQ7Ci0JfQotCXJldHVybiByYzsKLX0KLQotc3NpemVfdCBjaWZzX2RpcmVj
dF9yZWFkdihzdHJ1Y3Qga2lvY2IgKmlvY2IsIHN0cnVjdCBpb3ZfaXRlciAqdG8pCi17Ci0JcmV0
dXJuIF9fY2lmc19yZWFkdihpb2NiLCB0bywgdHJ1ZSk7Ci19Ci0KLXNzaXplX3QgY2lmc191c2Vy
X3JlYWR2KHN0cnVjdCBraW9jYiAqaW9jYiwgc3RydWN0IGlvdl9pdGVyICp0bykKLXsKLQlyZXR1
cm4gX19jaWZzX3JlYWR2KGlvY2IsIHRvLCBmYWxzZSk7Ci0KLX0KLSNlbmRpZiAvLyBlbmQgbmV0
ZnNsaWIgcmVtb3ZhbCA0MTQzCi0KIHNzaXplX3QgY2lmc19sb29zZV9yZWFkX2l0ZXIoc3RydWN0
IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKml0ZXIpCiB7CiAJc3NpemVfdCByYzsKQEAg
LTM3ODMsMTAxICsyODc1LDYgQEAgY2lmc19zdHJpY3RfcmVhZHYoc3RydWN0IGtpb2NiICppb2Ni
LCBzdHJ1Y3QgaW92X2l0ZXIgKnRvKQogCXJldHVybiByYzsKIH0KIAotI2lmIDAgLy8gVE9ETyBy
ZW1vdmUgNDYzMwotc3RhdGljIHNzaXplX3QKLWNpZnNfcmVhZChzdHJ1Y3QgZmlsZSAqZmlsZSwg
Y2hhciAqcmVhZF9kYXRhLCBzaXplX3QgcmVhZF9zaXplLCBsb2ZmX3QgKm9mZnNldCkKLXsKLQlp
bnQgcmMgPSAtRUFDQ0VTOwotCXVuc2lnbmVkIGludCBieXRlc19yZWFkID0gMDsKLQl1bnNpZ25l
ZCBpbnQgdG90YWxfcmVhZDsKLQl1bnNpZ25lZCBpbnQgY3VycmVudF9yZWFkX3NpemU7Ci0JdW5z
aWduZWQgaW50IHJzaXplOwotCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNpZnNfc2I7Ci0Jc3RydWN0
IGNpZnNfdGNvbiAqdGNvbjsKLQlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXI7Ci0JdW5z
aWduZWQgaW50IHhpZDsKLQljaGFyICpjdXJfb2Zmc2V0OwotCXN0cnVjdCBjaWZzRmlsZUluZm8g
Km9wZW5fZmlsZTsKLQlzdHJ1Y3QgY2lmc19pb19wYXJtcyBpb19wYXJtcyA9IHswfTsKLQlpbnQg
YnVmX3R5cGUgPSBDSUZTX05PX0JVRkZFUjsKLQlfX3UzMiBwaWQ7Ci0KLQl4aWQgPSBnZXRfeGlk
KCk7Ci0JY2lmc19zYiA9IENJRlNfRklMRV9TQihmaWxlKTsKLQotCS8qIEZJWE1FOiBzZXQgdXAg
aGFuZGxlcnMgZm9yIGxhcmdlciByZWFkcyBhbmQvb3IgY29udmVydCB0byBhc3luYyAqLwotCXJz
aXplID0gbWluX3QodW5zaWduZWQgaW50LCBjaWZzX3NiLT5jdHgtPnJzaXplLCBDSUZTTWF4QnVm
U2l6ZSk7Ci0KLQlpZiAoZmlsZS0+cHJpdmF0ZV9kYXRhID09IE5VTEwpIHsKLQkJcmMgPSAtRUJB
REY7Ci0JCWZyZWVfeGlkKHhpZCk7Ci0JCXJldHVybiByYzsKLQl9Ci0Jb3Blbl9maWxlID0gZmls
ZS0+cHJpdmF0ZV9kYXRhOwotCXRjb24gPSB0bGlua190Y29uKG9wZW5fZmlsZS0+dGxpbmspOwot
CXNlcnZlciA9IGNpZnNfcGlja19jaGFubmVsKHRjb24tPnNlcyk7Ci0KLQlpZiAoIXNlcnZlci0+
b3BzLT5zeW5jX3JlYWQpIHsKLQkJZnJlZV94aWQoeGlkKTsKLQkJcmV0dXJuIC1FTk9TWVM7Ci0J
fQotCi0JaWYgKGNpZnNfc2ItPm1udF9jaWZzX2ZsYWdzICYgQ0lGU19NT1VOVF9SV1BJREZPUldB
UkQpCi0JCXBpZCA9IG9wZW5fZmlsZS0+cGlkOwotCWVsc2UKLQkJcGlkID0gY3VycmVudC0+dGdp
ZDsKLQotCWlmICgoZmlsZS0+Zl9mbGFncyAmIE9fQUNDTU9ERSkgPT0gT19XUk9OTFkpCi0JCWNp
ZnNfZGJnKEZZSSwgImF0dGVtcHRpbmcgcmVhZCBvbiB3cml0ZSBvbmx5IGZpbGUgaW5zdGFuY2Vc
biIpOwotCi0JZm9yICh0b3RhbF9yZWFkID0gMCwgY3VyX29mZnNldCA9IHJlYWRfZGF0YTsgcmVh
ZF9zaXplID4gdG90YWxfcmVhZDsKLQkgICAgIHRvdGFsX3JlYWQgKz0gYnl0ZXNfcmVhZCwgY3Vy
X29mZnNldCArPSBieXRlc19yZWFkKSB7Ci0JCWRvIHsKLQkJCWN1cnJlbnRfcmVhZF9zaXplID0g
bWluX3QodWludCwgcmVhZF9zaXplIC0gdG90YWxfcmVhZCwKLQkJCQkJCSAgcnNpemUpOwotCQkJ
LyoKLQkJCSAqIEZvciB3aW5kb3dzIG1lIGFuZCA5eCB3ZSBkbyBub3Qgd2FudCB0byByZXF1ZXN0
IG1vcmUKLQkJCSAqIHRoYW4gaXQgbmVnb3RpYXRlZCBzaW5jZSBpdCB3aWxsIHJlZnVzZSB0aGUg
cmVhZAotCQkJICogdGhlbi4KLQkJCSAqLwotCQkJaWYgKCEodGNvbi0+c2VzLT5jYXBhYmlsaXRp
ZXMgJgotCQkJCXRjb24tPnNlcy0+c2VydmVyLT52YWxzLT5jYXBfbGFyZ2VfZmlsZXMpKSB7Ci0J
CQkJY3VycmVudF9yZWFkX3NpemUgPSBtaW5fdCh1aW50LAotCQkJCQljdXJyZW50X3JlYWRfc2l6
ZSwgQ0lGU01heEJ1ZlNpemUpOwotCQkJfQotCQkJaWYgKG9wZW5fZmlsZS0+aW52YWxpZEhhbmRs
ZSkgewotCQkJCXJjID0gY2lmc19yZW9wZW5fZmlsZShvcGVuX2ZpbGUsIHRydWUpOwotCQkJCWlm
IChyYyAhPSAwKQotCQkJCQlicmVhazsKLQkJCX0KLQkJCWlvX3Bhcm1zLnBpZCA9IHBpZDsKLQkJ
CWlvX3Bhcm1zLnRjb24gPSB0Y29uOwotCQkJaW9fcGFybXMub2Zmc2V0ID0gKm9mZnNldDsKLQkJ
CWlvX3Bhcm1zLmxlbmd0aCA9IGN1cnJlbnRfcmVhZF9zaXplOwotCQkJaW9fcGFybXMuc2VydmVy
ID0gc2VydmVyOwotCQkJcmMgPSBzZXJ2ZXItPm9wcy0+c3luY19yZWFkKHhpZCwgJm9wZW5fZmls
ZS0+ZmlkLCAmaW9fcGFybXMsCi0JCQkJCQkgICAgJmJ5dGVzX3JlYWQsICZjdXJfb2Zmc2V0LAot
CQkJCQkJICAgICZidWZfdHlwZSk7Ci0JCX0gd2hpbGUgKHJjID09IC1FQUdBSU4pOwotCi0JCWlm
IChyYyB8fCAoYnl0ZXNfcmVhZCA9PSAwKSkgewotCQkJaWYgKHRvdGFsX3JlYWQpIHsKLQkJCQli
cmVhazsKLQkJCX0gZWxzZSB7Ci0JCQkJZnJlZV94aWQoeGlkKTsKLQkJCQlyZXR1cm4gcmM7Ci0J
CQl9Ci0JCX0gZWxzZSB7Ci0JCQljaWZzX3N0YXRzX2J5dGVzX3JlYWQodGNvbiwgdG90YWxfcmVh
ZCk7Ci0JCQkqb2Zmc2V0ICs9IGJ5dGVzX3JlYWQ7Ci0JCX0KLQl9Ci0JZnJlZV94aWQoeGlkKTsK
LQlyZXR1cm4gdG90YWxfcmVhZDsKLX0KLSNlbmRpZiAvLyBlbmQgbmV0ZnNsaWIgcmVtb3ZlIDQ2
MzMKLQotCiBzdGF0aWMgdm1fZmF1bHRfdCBjaWZzX3BhZ2VfbWt3cml0ZShzdHJ1Y3Qgdm1fZmF1
bHQgKnZtZikKIHsKIAlyZXR1cm4gbmV0ZnNfcGFnZV9ta3dyaXRlKHZtZiwgTlVMTCk7Ci0tIAoy
LjQwLjEKCg==
--000000000000c5796c060f8fd206
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0011-cifs-Remove-some-code-that-s-no-longer-used-part-2.patch"
Content-Disposition: attachment; 
	filename="0011-cifs-Remove-some-code-that-s-no-longer-used-part-2.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_lrpgn46h10>
X-Attachment-Id: f_lrpgn46h10

RnJvbSBiMmE2Yzc4NmVhNjIzZjA1ZGUzMzg5MTQyMjYxOTExMzBlNDc2MWE2IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpE
YXRlOiBGcmksIDYgT2N0IDIwMjMgMTg6Mjk6NTkgKzAxMDAKU3ViamVjdDogW1BBVENIIDExLzEy
XSBjaWZzOiBSZW1vdmUgc29tZSBjb2RlIHRoYXQncyBubyBsb25nZXIgdXNlZCwgcGFydCAyCgpS
ZW1vdmUgc29tZSBjb2RlIHRoYXQgd2FzICNpZidkIG91dCB3aXRoIHRoZSBuZXRmc2xpYiBjb252
ZXJzaW9uLiAgVGhpcyBpcwpzcGxpdCBpbnRvIHBhcnRzIGZvciBmaWxlLmMgYXMgdGhlIGRpZmYg
Z2VuZXJhdG9yIG90aGVyd2lzZSBwcm9kdWNlcyBhIGhhcmQKdG8gcmVhZCBkaWZmIGZvciBwYXJ0
IG9mIGl0IHdoZXJlIGEgYmlnIGNodW5rIGlzIGN1dCBvdXQuCgpTaWduZWQtb2ZmLWJ5OiBEYXZp
ZCBIb3dlbGxzIDxkaG93ZWxsc0ByZWRoYXQuY29tPgpjYzogU2h5YW0gUHJhc2FkIE4gPG5zcG1h
bmdhbG9yZUBnbWFpbC5jb20+CmNjOiBSb2hpdGggU3VyYWJhdHR1bGEgPHJvaGl0aHMubXNmdEBn
bWFpbC5jb20+CmNjOiBKZWZmIExheXRvbiA8amxheXRvbkBrZXJuZWwub3JnPgpjYzogbGludXgt
Y2lmc0B2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LWNhY2hlZnNAcmVkaGF0LmNvbQpjYzogbGlu
dXgtZnNkZXZlbEB2Z2VyLmtlcm5lbC5vcmcKY2M6IGxpbnV4LW1tQGt2YWNrLm9yZwotLS0KIGZz
L3NtYi9jbGllbnQvZmlsZS5jIHwgNjk0ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxIGluc2VydGlvbigrKSwgNjkzIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2ZzL3NtYi9jbGllbnQvZmlsZS5jIGIvZnMvc21iL2NsaWVudC9m
aWxlLmMKaW5kZXggNzkyOTczYjczOGI2Li44YzRhMDQyYTdiMjUgMTAwNjQ0Ci0tLSBhL2ZzL3Nt
Yi9jbGllbnQvZmlsZS5jCisrKyBiL2ZzL3NtYi9jbGllbnQvZmlsZS5jCkBAIC0yNTYzLDY5OSAr
MjU2Myw2IEBAIGNpZnNfZ2V0X3JlYWRhYmxlX3BhdGgoc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwg
Y29uc3QgY2hhciAqbmFtZSwKIAlyZXR1cm4gLUVOT0VOVDsKIH0KIAotI2lmIDAgLy8gVE9ETyBy
ZW1vdmUgMjc3Mwotdm9pZAotY2lmc193cml0ZWRhdGFfcmVsZWFzZShzdHJ1Y3QgY2lmc19pb19z
dWJyZXF1ZXN0ICp3ZGF0YSkKLXsKLQlpZiAod2RhdGEtPnVuY2FjaGVkKQotCQlrcmVmX3B1dCgm
d2RhdGEtPmN0eC0+cmVmY291bnQsIGNpZnNfYWlvX2N0eF9yZWxlYXNlKTsKLSNpZmRlZiBDT05G
SUdfQ0lGU19TTUJfRElSRUNUCi0JaWYgKHdkYXRhLT5tcikgewotCQlzbWJkX2RlcmVnaXN0ZXJf
bXIod2RhdGEtPm1yKTsKLQkJd2RhdGEtPm1yID0gTlVMTDsKLQl9Ci0jZW5kaWYKLQotCWlmICh3
ZGF0YS0+Y2ZpbGUpCi0JCWNpZnNGaWxlSW5mb19wdXQod2RhdGEtPmNmaWxlKTsKLQotCWtmcmVl
KHdkYXRhKTsKLX0KLQotLyoKLSAqIFdyaXRlIGZhaWxlZCB3aXRoIGEgcmV0cnlhYmxlIGVycm9y
LiBSZXNlbmQgdGhlIHdyaXRlIHJlcXVlc3QuIEl0J3MgYWxzbwotICogcG9zc2libGUgdGhhdCB0
aGUgcGFnZSB3YXMgcmVkaXJ0aWVkIHNvIHJlLWNsZWFuIHRoZSBwYWdlLgotICovCi1zdGF0aWMg
dm9pZAotY2lmc193cml0ZXZfcmVxdWV1ZShzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0
YSkKLXsKLQlpbnQgcmMgPSAwOwotCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBkX2lub2RlKHdkYXRh
LT5jZmlsZS0+ZGVudHJ5KTsKLQlzdHJ1Y3QgVENQX1NlcnZlcl9JbmZvICpzZXJ2ZXI7Ci0JdW5z
aWduZWQgaW50IHJlc3RfbGVuID0gd2RhdGEtPnN1YnJlcS5sZW47Ci0JbG9mZl90IGZwb3MgPSB3
ZGF0YS0+c3VicmVxLnN0YXJ0OwotCi0Jc2VydmVyID0gdGxpbmtfdGNvbih3ZGF0YS0+Y2ZpbGUt
PnRsaW5rKS0+c2VzLT5zZXJ2ZXI7Ci0JZG8gewotCQlzdHJ1Y3QgY2lmc19pb19zdWJyZXF1ZXN0
ICp3ZGF0YTI7Ci0JCXVuc2lnbmVkIGludCB3c2l6ZSwgY3VyX2xlbjsKLQotCQl3c2l6ZSA9IHNl
cnZlci0+b3BzLT53cF9yZXRyeV9zaXplKGlub2RlKTsKLQkJaWYgKHdzaXplIDwgcmVzdF9sZW4p
IHsKLQkJCWlmICh3c2l6ZSA8IFBBR0VfU0laRSkgewotCQkJCXJjID0gLUVPUE5PVFNVUFA7Ci0J
CQkJYnJlYWs7Ci0JCQl9Ci0JCQljdXJfbGVuID0gbWluKHJvdW5kX2Rvd24od3NpemUsIFBBR0Vf
U0laRSksIHJlc3RfbGVuKTsKLQkJfSBlbHNlIHsKLQkJCWN1cl9sZW4gPSByZXN0X2xlbjsKLQkJ
fQotCi0JCXdkYXRhMiA9IGNpZnNfd3JpdGVkYXRhX2FsbG9jKGNpZnNfd3JpdGV2X2NvbXBsZXRl
KTsKLQkJaWYgKCF3ZGF0YTIpIHsKLQkJCXJjID0gLUVOT01FTTsKLQkJCWJyZWFrOwotCQl9Ci0K
LQkJd2RhdGEyLT5zeW5jX21vZGUgPSB3ZGF0YS0+c3luY19tb2RlOwotCQl3ZGF0YTItPnN1YnJl
cS5zdGFydAk9IGZwb3M7Ci0JCXdkYXRhMi0+c3VicmVxLmxlbgk9IGN1cl9sZW47Ci0JCXdkYXRh
Mi0+c3VicmVxLmlvX2l0ZXIgPSB3ZGF0YS0+c3VicmVxLmlvX2l0ZXI7Ci0KLQkJaW92X2l0ZXJf
YWR2YW5jZSgmd2RhdGEyLT5zdWJyZXEuaW9faXRlciwgZnBvcyAtIHdkYXRhLT5zdWJyZXEuc3Rh
cnQpOwotCQlpb3ZfaXRlcl90cnVuY2F0ZSgmd2RhdGEyLT5zdWJyZXEuaW9faXRlciwgd2RhdGEy
LT5zdWJyZXEubGVuKTsKLQotCQlpZiAoaW92X2l0ZXJfaXNfeGFycmF5KCZ3ZGF0YTItPnN1YnJl
cS5pb19pdGVyKSkKLQkJCS8qIENoZWNrIGZvciBwYWdlcyBoYXZpbmcgYmVlbiByZWRpcnRpZWQg
YW5kIGNsZWFuCi0JCQkgKiB0aGVtLiAgV2UgY2FuIGRvIHRoaXMgYnkgd2Fsa2luZyB0aGUgeGFy
cmF5LiAgSWYKLQkJCSAqIGl0J3Mgbm90IGFuIHhhcnJheSwgdGhlbiBpdCdzIGEgRElPIGFuZCB3
ZSBzaG91bGRuJ3QKLQkJCSAqIGJlIG11Y2tpbmcgYXJvdW5kIHdpdGggdGhlIHBhZ2UgYml0cy4K
LQkJCSAqLwotCQkJY2lmc191bmRpcnR5X2ZvbGlvcyhpbm9kZSwgZnBvcywgY3VyX2xlbik7Ci0K
LQkJcmMgPSBjaWZzX2dldF93cml0YWJsZV9maWxlKENJRlNfSShpbm9kZSksIEZJTkRfV1JfQU5Z
LAotCQkJCQkgICAgJndkYXRhMi0+Y2ZpbGUpOwotCQlpZiAoIXdkYXRhMi0+Y2ZpbGUpIHsKLQkJ
CWNpZnNfZGJnKFZGUywgIk5vIHdyaXRhYmxlIGhhbmRsZSB0byByZXRyeSB3cml0ZXBhZ2VzIHJj
PSVkXG4iLAotCQkJCSByYyk7Ci0JCQlpZiAoIWlzX3JldHJ5YWJsZV9lcnJvcihyYykpCi0JCQkJ
cmMgPSAtRUJBREY7Ci0JCX0gZWxzZSB7Ci0JCQl3ZGF0YTItPnBpZCA9IHdkYXRhMi0+Y2ZpbGUt
PnBpZDsKLQkJCXJjID0gc2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0YTIpOwotCQl9Ci0K
LQkJY2lmc19wdXRfd3JpdGVkYXRhKHdkYXRhMik7Ci0JCWlmIChyYykgewotCQkJaWYgKGlzX3Jl
dHJ5YWJsZV9lcnJvcihyYykpCi0JCQkJY29udGludWU7Ci0JCQlmcG9zICs9IGN1cl9sZW47Ci0J
CQlyZXN0X2xlbiAtPSBjdXJfbGVuOwotCQkJYnJlYWs7Ci0JCX0KLQotCQlmcG9zICs9IGN1cl9s
ZW47Ci0JCXJlc3RfbGVuIC09IGN1cl9sZW47Ci0JfSB3aGlsZSAocmVzdF9sZW4gPiAwKTsKLQot
CS8qIENsZWFuIHVwIHJlbWFpbmluZyBwYWdlcyBmcm9tIHRoZSBvcmlnaW5hbCB3ZGF0YSAqLwot
CWlmIChpb3ZfaXRlcl9pc194YXJyYXkoJndkYXRhLT5zdWJyZXEuaW9faXRlcikpCi0JCWNpZnNf
cGFnZXNfd3JpdGVfZmFpbGVkKGlub2RlLCBmcG9zLCByZXN0X2xlbik7Ci0KLQlpZiAocmMgIT0g
MCAmJiAhaXNfcmV0cnlhYmxlX2Vycm9yKHJjKSkKLQkJbWFwcGluZ19zZXRfZXJyb3IoaW5vZGUt
PmlfbWFwcGluZywgcmMpOwotCWNpZnNfcHV0X3dyaXRlZGF0YSh3ZGF0YSk7Ci19Ci0KLXZvaWQK
LWNpZnNfd3JpdGV2X2NvbXBsZXRlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKLXsKLQlzdHJ1
Y3QgY2lmc19pb19zdWJyZXF1ZXN0ICp3ZGF0YSA9IGNvbnRhaW5lcl9vZih3b3JrLAotCQkJCQkJ
c3RydWN0IGNpZnNfaW9fc3VicmVxdWVzdCwgd29yayk7Ci0Jc3RydWN0IGlub2RlICppbm9kZSA9
IGRfaW5vZGUod2RhdGEtPmNmaWxlLT5kZW50cnkpOwotCi0JaWYgKHdkYXRhLT5yZXN1bHQgPT0g
MCkgewotCQlzcGluX2xvY2soJmlub2RlLT5pX2xvY2spOwotCQljaWZzX3VwZGF0ZV9lb2YoQ0lG
U19JKGlub2RlKSwgd2RhdGEtPnN1YnJlcS5zdGFydCwgd2RhdGEtPnN1YnJlcS5sZW4pOwotCQlz
cGluX3VubG9jaygmaW5vZGUtPmlfbG9jayk7Ci0JCWNpZnNfc3RhdHNfYnl0ZXNfd3JpdHRlbih0
bGlua190Y29uKHdkYXRhLT5jZmlsZS0+dGxpbmspLAotCQkJCQkgd2RhdGEtPnN1YnJlcS5sZW4p
OwotCX0gZWxzZSBpZiAod2RhdGEtPnN5bmNfbW9kZSA9PSBXQl9TWU5DX0FMTCAmJiB3ZGF0YS0+
cmVzdWx0ID09IC1FQUdBSU4pCi0JCXJldHVybiBjaWZzX3dyaXRldl9yZXF1ZXVlKHdkYXRhKTsK
LQotCWlmICh3ZGF0YS0+cmVzdWx0ID09IC1FQUdBSU4pCi0JCWNpZnNfcGFnZXNfd3JpdGVfcmVk
aXJ0eShpbm9kZSwgd2RhdGEtPnN1YnJlcS5zdGFydCwgd2RhdGEtPnN1YnJlcS5sZW4pOwotCWVs
c2UgaWYgKHdkYXRhLT5yZXN1bHQgPCAwKQotCQljaWZzX3BhZ2VzX3dyaXRlX2ZhaWxlZChpbm9k
ZSwgd2RhdGEtPnN1YnJlcS5zdGFydCwgd2RhdGEtPnN1YnJlcS5sZW4pOwotCWVsc2UKLQkJY2lm
c19wYWdlc193cml0dGVuX2JhY2soaW5vZGUsIHdkYXRhLT5zdWJyZXEuc3RhcnQsIHdkYXRhLT5z
dWJyZXEubGVuKTsKLQotCWlmICh3ZGF0YS0+cmVzdWx0ICE9IC1FQUdBSU4pCi0JCW1hcHBpbmdf
c2V0X2Vycm9yKGlub2RlLT5pX21hcHBpbmcsIHdkYXRhLT5yZXN1bHQpOwotCWNpZnNfcHV0X3dy
aXRlZGF0YSh3ZGF0YSk7Ci19Ci0KLXN0cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKmNpZnNfd3Jp
dGVkYXRhX2FsbG9jKHdvcmtfZnVuY190IGNvbXBsZXRlKQotewotCXN0cnVjdCBjaWZzX2lvX3N1
YnJlcXVlc3QgKndkYXRhOwotCi0Jd2RhdGEgPSBremFsbG9jKHNpemVvZigqd2RhdGEpLCBHRlBf
Tk9GUyk7Ci0JaWYgKHdkYXRhICE9IE5VTEwpIHsKLQkJcmVmY291bnRfc2V0KCZ3ZGF0YS0+c3Vi
cmVxLnJlZiwgMSk7Ci0JCUlOSVRfTElTVF9IRUFEKCZ3ZGF0YS0+bGlzdCk7Ci0JCWluaXRfY29t
cGxldGlvbigmd2RhdGEtPmRvbmUpOwotCQlJTklUX1dPUksoJndkYXRhLT53b3JrLCBjb21wbGV0
ZSk7Ci0JfQotCXJldHVybiB3ZGF0YTsKLX0KLQotc3RhdGljIGludCBjaWZzX3BhcnRpYWxwYWdl
d3JpdGUoc3RydWN0IHBhZ2UgKnBhZ2UsIHVuc2lnbmVkIGZyb20sIHVuc2lnbmVkIHRvKQotewot
CXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0gcGFnZS0+bWFwcGluZzsKLQlsb2ZmX3Qg
b2Zmc2V0ID0gKGxvZmZfdClwYWdlLT5pbmRleCA8PCBQQUdFX1NISUZUOwotCWNoYXIgKndyaXRl
X2RhdGE7Ci0JaW50IHJjID0gLUVGQVVMVDsKLQlpbnQgYnl0ZXNfd3JpdHRlbiA9IDA7Ci0Jc3Ry
dWN0IGlub2RlICppbm9kZTsKLQlzdHJ1Y3QgY2lmc0ZpbGVJbmZvICpvcGVuX2ZpbGU7Ci0KLQlp
ZiAoIW1hcHBpbmcgfHwgIW1hcHBpbmctPmhvc3QpCi0JCXJldHVybiAtRUZBVUxUOwotCi0JaW5v
ZGUgPSBwYWdlLT5tYXBwaW5nLT5ob3N0OwotCi0Jb2Zmc2V0ICs9IChsb2ZmX3QpZnJvbTsKLQl3
cml0ZV9kYXRhID0ga21hcChwYWdlKTsKLQl3cml0ZV9kYXRhICs9IGZyb207Ci0KLQlpZiAoKHRv
ID4gUEFHRV9TSVpFKSB8fCAoZnJvbSA+IHRvKSkgewotCQlrdW5tYXAocGFnZSk7Ci0JCXJldHVy
biAtRUlPOwotCX0KLQotCS8qIHJhY2luZyB3aXRoIHRydW5jYXRlPyAqLwotCWlmIChvZmZzZXQg
PiBtYXBwaW5nLT5ob3N0LT5pX3NpemUpIHsKLQkJa3VubWFwKHBhZ2UpOwotCQlyZXR1cm4gMDsg
LyogZG9uJ3QgY2FyZSAqLwotCX0KLQotCS8qIGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGF0IHdlIGFy
ZSBub3QgZXh0ZW5kaW5nIHRoZSBmaWxlICovCi0JaWYgKG1hcHBpbmctPmhvc3QtPmlfc2l6ZSAt
IG9mZnNldCA8IChsb2ZmX3QpdG8pCi0JCXRvID0gKHVuc2lnbmVkKShtYXBwaW5nLT5ob3N0LT5p
X3NpemUgLSBvZmZzZXQpOwotCi0JcmMgPSBjaWZzX2dldF93cml0YWJsZV9maWxlKENJRlNfSSht
YXBwaW5nLT5ob3N0KSwgRklORF9XUl9BTlksCi0JCQkJICAgICZvcGVuX2ZpbGUpOwotCWlmICgh
cmMpIHsKLQkJYnl0ZXNfd3JpdHRlbiA9IGNpZnNfd3JpdGUob3Blbl9maWxlLCBvcGVuX2ZpbGUt
PnBpZCwKLQkJCQkJICAgd3JpdGVfZGF0YSwgdG8gLSBmcm9tLCAmb2Zmc2V0KTsKLQkJY2lmc0Zp
bGVJbmZvX3B1dChvcGVuX2ZpbGUpOwotCQkvKiBEb2VzIG1tIG9yIHZmcyBhbHJlYWR5IHNldCB0
aW1lcz8gKi8KLQkJc2ltcGxlX2lub2RlX2luaXRfdHMoaW5vZGUpOwotCQlpZiAoKGJ5dGVzX3dy
aXR0ZW4gPiAwKSAmJiAob2Zmc2V0KSkKLQkJCXJjID0gMDsKLQkJZWxzZSBpZiAoYnl0ZXNfd3Jp
dHRlbiA8IDApCi0JCQlyYyA9IGJ5dGVzX3dyaXR0ZW47Ci0JCWVsc2UKLQkJCXJjID0gLUVGQVVM
VDsKLQl9IGVsc2UgewotCQljaWZzX2RiZyhGWUksICJObyB3cml0YWJsZSBoYW5kbGUgZm9yIHdy
aXRlIHBhZ2UgcmM9JWRcbiIsIHJjKTsKLQkJaWYgKCFpc19yZXRyeWFibGVfZXJyb3IocmMpKQot
CQkJcmMgPSAtRUlPOwotCX0KLQotCWt1bm1hcChwYWdlKTsKLQlyZXR1cm4gcmM7Ci19Ci0KLS8q
Ci0gKiBFeHRlbmQgdGhlIHJlZ2lvbiB0byBiZSB3cml0dGVuIGJhY2sgdG8gaW5jbHVkZSBzdWJz
ZXF1ZW50IGNvbnRpZ3VvdXNseQotICogZGlydHkgcGFnZXMgaWYgcG9zc2libGUsIGJ1dCBkb24n
dCBzbGVlcCB3aGlsZSBkb2luZyBzby4KLSAqLwotc3RhdGljIHZvaWQgY2lmc19leHRlbmRfd3Jp
dGViYWNrKHN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nLAotCQkJCSAgbG9uZyAqX2NvdW50
LAotCQkJCSAgbG9mZl90IHN0YXJ0LAotCQkJCSAgaW50IG1heF9wYWdlcywKLQkJCQkgIHNpemVf
dCBtYXhfbGVuLAotCQkJCSAgdW5zaWduZWQgaW50ICpfbGVuKQotewotCXN0cnVjdCBmb2xpb19i
YXRjaCBiYXRjaDsKLQlzdHJ1Y3QgZm9saW8gKmZvbGlvOwotCXVuc2lnbmVkIGludCBwc2l6ZSwg
bnJfcGFnZXM7Ci0Jc2l6ZV90IGxlbiA9ICpfbGVuOwotCXBnb2ZmX3QgaW5kZXggPSAoc3RhcnQg
KyBsZW4pIC8gUEFHRV9TSVpFOwotCWJvb2wgc3RvcCA9IHRydWU7Ci0JdW5zaWduZWQgaW50IGk7
Ci0JWEFfU1RBVEUoeGFzLCAmbWFwcGluZy0+aV9wYWdlcywgaW5kZXgpOwotCi0JZm9saW9fYmF0
Y2hfaW5pdCgmYmF0Y2gpOwotCi0JZG8gewotCQkvKiBGaXJzdGx5LCB3ZSBnYXRoZXIgdXAgYSBi
YXRjaCBvZiBjb250aWd1b3VzIGRpcnR5IHBhZ2VzCi0JCSAqIHVuZGVyIHRoZSBSQ1UgcmVhZCBs
b2NrIC0gYnV0IHdlIGNhbid0IGNsZWFyIHRoZSBkaXJ0eSBmbGFncwotCQkgKiB0aGVyZSBpZiBh
bnkgb2YgdGhvc2UgcGFnZXMgYXJlIG1hcHBlZC4KLQkJICovCi0JCXJjdV9yZWFkX2xvY2soKTsK
LQotCQl4YXNfZm9yX2VhY2goJnhhcywgZm9saW8sIFVMT05HX01BWCkgewotCQkJc3RvcCA9IHRy
dWU7Ci0JCQlpZiAoeGFzX3JldHJ5KCZ4YXMsIGZvbGlvKSkKLQkJCQljb250aW51ZTsKLQkJCWlm
ICh4YV9pc192YWx1ZShmb2xpbykpCi0JCQkJYnJlYWs7Ci0JCQlpZiAoZm9saW9faW5kZXgoZm9s
aW8pICE9IGluZGV4KQotCQkJCWJyZWFrOwotCQkJaWYgKCFmb2xpb190cnlfZ2V0X3JjdShmb2xp
bykpIHsKLQkJCQl4YXNfcmVzZXQoJnhhcyk7Ci0JCQkJY29udGludWU7Ci0JCQl9Ci0JCQlucl9w
YWdlcyA9IGZvbGlvX25yX3BhZ2VzKGZvbGlvKTsKLQkJCWlmIChucl9wYWdlcyA+IG1heF9wYWdl
cykKLQkJCQlicmVhazsKLQotCQkJLyogSGFzIHRoZSBwYWdlIG1vdmVkIG9yIGJlZW4gc3BsaXQ/
ICovCi0JCQlpZiAodW5saWtlbHkoZm9saW8gIT0geGFzX3JlbG9hZCgmeGFzKSkpIHsKLQkJCQlm
b2xpb19wdXQoZm9saW8pOwotCQkJCWJyZWFrOwotCQkJfQotCi0JCQlpZiAoIWZvbGlvX3RyeWxv
Y2soZm9saW8pKSB7Ci0JCQkJZm9saW9fcHV0KGZvbGlvKTsKLQkJCQlicmVhazsKLQkJCX0KLQkJ
CWlmICghZm9saW9fdGVzdF9kaXJ0eShmb2xpbykgfHwgZm9saW9fdGVzdF93cml0ZWJhY2soZm9s
aW8pKSB7Ci0JCQkJZm9saW9fdW5sb2NrKGZvbGlvKTsKLQkJCQlmb2xpb19wdXQoZm9saW8pOwot
CQkJCWJyZWFrOwotCQkJfQotCi0JCQltYXhfcGFnZXMgLT0gbnJfcGFnZXM7Ci0JCQlwc2l6ZSA9
IGZvbGlvX3NpemUoZm9saW8pOwotCQkJbGVuICs9IHBzaXplOwotCQkJc3RvcCA9IGZhbHNlOwot
CQkJaWYgKG1heF9wYWdlcyA8PSAwIHx8IGxlbiA+PSBtYXhfbGVuIHx8ICpfY291bnQgPD0gMCkK
LQkJCQlzdG9wID0gdHJ1ZTsKLQotCQkJaW5kZXggKz0gbnJfcGFnZXM7Ci0JCQlpZiAoIWZvbGlv
X2JhdGNoX2FkZCgmYmF0Y2gsIGZvbGlvKSkKLQkJCQlicmVhazsKLQkJCWlmIChzdG9wKQotCQkJ
CWJyZWFrOwotCQl9Ci0KLQkJaWYgKCFzdG9wKQotCQkJeGFzX3BhdXNlKCZ4YXMpOwotCQlyY3Vf
cmVhZF91bmxvY2soKTsKLQotCQkvKiBOb3csIGlmIHdlIG9idGFpbmVkIGFueSBwYWdlcywgd2Ug
Y2FuIHNoaWZ0IHRoZW0gdG8gYmVpbmcKLQkJICogd3JpdGFibGUgYW5kIG1hcmsgdGhlbSBmb3Ig
Y2FjaGluZy4KLQkJICovCi0JCWlmICghZm9saW9fYmF0Y2hfY291bnQoJmJhdGNoKSkKLQkJCWJy
ZWFrOwotCi0JCWZvciAoaSA9IDA7IGkgPCBmb2xpb19iYXRjaF9jb3VudCgmYmF0Y2gpOyBpKysp
IHsKLQkJCWZvbGlvID0gYmF0Y2guZm9saW9zW2ldOwotCQkJLyogVGhlIGZvbGlvIHNob3VsZCBi
ZSBsb2NrZWQsIGRpcnR5IGFuZCBub3QgdW5kZXJnb2luZwotCQkJICogd3JpdGViYWNrIGZyb20g
dGhlIGxvb3AgYWJvdmUuCi0JCQkgKi8KLQkJCWlmICghZm9saW9fY2xlYXJfZGlydHlfZm9yX2lv
KGZvbGlvKSkKLQkJCQlXQVJOX09OKDEpOwotCQkJZm9saW9fc3RhcnRfd3JpdGViYWNrKGZvbGlv
KTsKLQotCQkJKl9jb3VudCAtPSBmb2xpb19ucl9wYWdlcyhmb2xpbyk7Ci0JCQlmb2xpb191bmxv
Y2soZm9saW8pOwotCQl9Ci0KLQkJZm9saW9fYmF0Y2hfcmVsZWFzZSgmYmF0Y2gpOwotCQljb25k
X3Jlc2NoZWQoKTsKLQl9IHdoaWxlICghc3RvcCk7Ci0KLQkqX2xlbiA9IGxlbjsKLX0KLQotLyoK
LSAqIFdyaXRlIGJhY2sgdGhlIGxvY2tlZCBwYWdlIGFuZCBhbnkgc3Vic2VxdWVudCBub24tbG9j
a2VkIGRpcnR5IHBhZ2VzLgotICovCi1zdGF0aWMgc3NpemVfdCBjaWZzX3dyaXRlX2JhY2tfZnJv
bV9sb2NrZWRfZm9saW8oc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcsCi0JCQkJCQkgc3Ry
dWN0IHdyaXRlYmFja19jb250cm9sICp3YmMsCi0JCQkJCQkgc3RydWN0IGZvbGlvICpmb2xpbywK
LQkJCQkJCSBsb2ZmX3Qgc3RhcnQsIGxvZmZfdCBlbmQpCi17Ci0Jc3RydWN0IGlub2RlICppbm9k
ZSA9IG1hcHBpbmctPmhvc3Q7Ci0Jc3RydWN0IFRDUF9TZXJ2ZXJfSW5mbyAqc2VydmVyOwotCXN0
cnVjdCBjaWZzX2lvX3N1YnJlcXVlc3QgKndkYXRhOwotCXN0cnVjdCBjaWZzX3NiX2luZm8gKmNp
ZnNfc2IgPSBDSUZTX1NCKGlub2RlLT5pX3NiKTsKLQlzdHJ1Y3QgY2lmc19jcmVkaXRzIGNyZWRp
dHNfb25fc3RhY2s7Ci0Jc3RydWN0IGNpZnNfY3JlZGl0cyAqY3JlZGl0cyA9ICZjcmVkaXRzX29u
X3N0YWNrOwotCXN0cnVjdCBjaWZzRmlsZUluZm8gKmNmaWxlID0gTlVMTDsKLQl1bnNpZ25lZCBp
bnQgeGlkLCBsZW47Ci0JbG9mZl90IGlfc2l6ZSA9IGlfc2l6ZV9yZWFkKGlub2RlKTsKLQlzaXpl
X3QgbWF4X2xlbiwgd3NpemU7Ci0JbG9uZyBjb3VudCA9IHdiYy0+bnJfdG9fd3JpdGU7Ci0JaW50
IHJjOwotCi0JLyogVGhlIGZvbGlvIHNob3VsZCBiZSBsb2NrZWQsIGRpcnR5IGFuZCBub3QgdW5k
ZXJnb2luZyB3cml0ZWJhY2suICovCi0JZm9saW9fc3RhcnRfd3JpdGViYWNrKGZvbGlvKTsKLQot
CWNvdW50IC09IGZvbGlvX25yX3BhZ2VzKGZvbGlvKTsKLQlsZW4gPSBmb2xpb19zaXplKGZvbGlv
KTsKLQotCXhpZCA9IGdldF94aWQoKTsKLQlzZXJ2ZXIgPSBjaWZzX3BpY2tfY2hhbm5lbChjaWZz
X3NiX21hc3Rlcl90Y29uKGNpZnNfc2IpLT5zZXMpOwotCi0JcmMgPSBjaWZzX2dldF93cml0YWJs
ZV9maWxlKENJRlNfSShpbm9kZSksIEZJTkRfV1JfQU5ZLCAmY2ZpbGUpOwotCWlmIChyYykgewot
CQljaWZzX2RiZyhWRlMsICJObyB3cml0YWJsZSBoYW5kbGUgaW4gd3JpdGVwYWdlcyByYz0lZFxu
IiwgcmMpOwotCQlnb3RvIGVycl94aWQ7Ci0JfQotCi0JcmMgPSBzZXJ2ZXItPm9wcy0+d2FpdF9t
dHVfY3JlZGl0cyhzZXJ2ZXIsIGNpZnNfc2ItPmN0eC0+d3NpemUsCi0JCQkJCSAgICZ3c2l6ZSwg
Y3JlZGl0cyk7Ci0JaWYgKHJjICE9IDApCi0JCWdvdG8gZXJyX2Nsb3NlOwotCi0Jd2RhdGEgPSBj
aWZzX3dyaXRlZGF0YV9hbGxvYyhjaWZzX3dyaXRldl9jb21wbGV0ZSk7Ci0JaWYgKCF3ZGF0YSkg
ewotCQlyYyA9IC1FTk9NRU07Ci0JCWdvdG8gZXJyX3VuY3JlZGl0OwotCX0KLQotCXdkYXRhLT5z
eW5jX21vZGUgPSB3YmMtPnN5bmNfbW9kZTsKLQl3ZGF0YS0+c3VicmVxLnN0YXJ0ID0gZm9saW9f
cG9zKGZvbGlvKTsKLQl3ZGF0YS0+cGlkID0gY2ZpbGUtPnBpZDsKLQl3ZGF0YS0+Y3JlZGl0cyA9
IGNyZWRpdHNfb25fc3RhY2s7Ci0Jd2RhdGEtPmNmaWxlID0gY2ZpbGU7Ci0Jd2RhdGEtPnNlcnZl
ciA9IHNlcnZlcjsKLQljZmlsZSA9IE5VTEw7Ci0KLQkvKiBGaW5kIGFsbCBjb25zZWN1dGl2ZSBs
b2NrYWJsZSBkaXJ0eSBwYWdlcywgc3RvcHBpbmcgd2hlbiB3ZSBmaW5kIGEKLQkgKiBwYWdlIHRo
YXQgaXMgbm90IGltbWVkaWF0ZWx5IGxvY2thYmxlLCBpcyBub3QgZGlydHkgb3IgaXMgbWlzc2lu
ZywKLQkgKiBvciB3ZSByZWFjaCB0aGUgZW5kIG9mIHRoZSByYW5nZS4KLQkgKi8KLQlpZiAoc3Rh
cnQgPCBpX3NpemUpIHsKLQkJLyogVHJpbSB0aGUgd3JpdGUgdG8gdGhlIEVPRjsgdGhlIGV4dHJh
IGRhdGEgaXMgaWdub3JlZC4gIEFsc28KLQkJICogcHV0IGFuIHVwcGVyIGxpbWl0IG9uIHRoZSBz
aXplIG9mIGEgc2luZ2xlIHN0b3JlZGF0YSBvcC4KLQkJICovCi0JCW1heF9sZW4gPSB3c2l6ZTsK
LQkJbWF4X2xlbiA9IG1pbl90KHVuc2lnbmVkIGxvbmcgbG9uZywgbWF4X2xlbiwgZW5kIC0gc3Rh
cnQgKyAxKTsKLQkJbWF4X2xlbiA9IG1pbl90KHVuc2lnbmVkIGxvbmcgbG9uZywgbWF4X2xlbiwg
aV9zaXplIC0gc3RhcnQpOwotCi0JCWlmIChsZW4gPCBtYXhfbGVuKSB7Ci0JCQlpbnQgbWF4X3Bh
Z2VzID0gSU5UX01BWDsKLQotI2lmZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QKLQkJCWlmIChz
ZXJ2ZXItPnNtYmRfY29ubikKLQkJCQltYXhfcGFnZXMgPSBzZXJ2ZXItPnNtYmRfY29ubi0+bWF4
X2ZybXJfZGVwdGg7Ci0jZW5kaWYKLQkJCW1heF9wYWdlcyAtPSBmb2xpb19ucl9wYWdlcyhmb2xp
byk7Ci0KLQkJCWlmIChtYXhfcGFnZXMgPiAwKQotCQkJCWNpZnNfZXh0ZW5kX3dyaXRlYmFjayht
YXBwaW5nLCAmY291bnQsIHN0YXJ0LAotCQkJCQkJICAgICAgbWF4X3BhZ2VzLCBtYXhfbGVuLCAm
bGVuKTsKLQkJfQotCQlsZW4gPSBtaW5fdChsb2ZmX3QsIGxlbiwgbWF4X2xlbik7Ci0JfQotCi0J
d2RhdGEtPnN1YnJlcS5sZW4gPSBsZW47Ci0KLQkvKiBXZSBub3cgaGF2ZSBhIGNvbnRpZ3VvdXMg
c2V0IG9mIGRpcnR5IHBhZ2VzLCBlYWNoIHdpdGggd3JpdGViYWNrCi0JICogc2V0OyB0aGUgZmly
c3QgcGFnZSBpcyBzdGlsbCBsb2NrZWQgYXQgdGhpcyBwb2ludCwgYnV0IGFsbCB0aGUgcmVzdAot
CSAqIGhhdmUgYmVlbiB1bmxvY2tlZC4KLQkgKi8KLQlmb2xpb191bmxvY2soZm9saW8pOwotCi0J
aWYgKHN0YXJ0IDwgaV9zaXplKSB7Ci0JCWlvdl9pdGVyX3hhcnJheSgmd2RhdGEtPnN1YnJlcS5p
b19pdGVyLCBJVEVSX1NPVVJDRSwgJm1hcHBpbmctPmlfcGFnZXMsCi0JCQkJc3RhcnQsIGxlbik7
Ci0KLQkJcmMgPSBhZGp1c3RfY3JlZGl0cyh3ZGF0YS0+c2VydmVyLCAmd2RhdGEtPmNyZWRpdHMs
IHdkYXRhLT5zdWJyZXEubGVuKTsKLQkJaWYgKHJjKQotCQkJZ290byBlcnJfd2RhdGE7Ci0KLQkJ
aWYgKHdkYXRhLT5jZmlsZS0+aW52YWxpZEhhbmRsZSkKLQkJCXJjID0gLUVBR0FJTjsKLQkJZWxz
ZQotCQkJcmMgPSB3ZGF0YS0+c2VydmVyLT5vcHMtPmFzeW5jX3dyaXRldih3ZGF0YSk7Ci0JCWlm
IChyYyA+PSAwKSB7Ci0JCQljaWZzX3B1dF93cml0ZWRhdGEod2RhdGEpOwotCQkJZ290byBlcnJf
Y2xvc2U7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBUaGUgZGlydHkgcmVnaW9uIHdhcyBlbnRpcmVs
eSBiZXlvbmQgdGhlIEVPRi4gKi8KLQkJY2lmc19wYWdlc193cml0dGVuX2JhY2soaW5vZGUsIHN0
YXJ0LCBsZW4pOwotCQlyYyA9IDA7Ci0JfQotCi1lcnJfd2RhdGE6Ci0JY2lmc19wdXRfd3JpdGVk
YXRhKHdkYXRhKTsKLWVycl91bmNyZWRpdDoKLQlhZGRfY3JlZGl0c19hbmRfd2FrZV9pZihzZXJ2
ZXIsIGNyZWRpdHMsIDApOwotZXJyX2Nsb3NlOgotCWlmIChjZmlsZSkKLQkJY2lmc0ZpbGVJbmZv
X3B1dChjZmlsZSk7Ci1lcnJfeGlkOgotCWZyZWVfeGlkKHhpZCk7Ci0JaWYgKHJjID09IDApIHsK
LQkJd2JjLT5ucl90b193cml0ZSA9IGNvdW50OwotCQlyYyA9IGxlbjsKLQl9IGVsc2UgaWYgKGlz
X3JldHJ5YWJsZV9lcnJvcihyYykpIHsKLQkJY2lmc19wYWdlc193cml0ZV9yZWRpcnR5KGlub2Rl
LCBzdGFydCwgbGVuKTsKLQl9IGVsc2UgewotCQljaWZzX3BhZ2VzX3dyaXRlX2ZhaWxlZChpbm9k
ZSwgc3RhcnQsIGxlbik7Ci0JCW1hcHBpbmdfc2V0X2Vycm9yKG1hcHBpbmcsIHJjKTsKLQl9Ci0J
LyogSW5kaWNhdGlvbiB0byB1cGRhdGUgY3RpbWUgYW5kIG10aW1lIGFzIGNsb3NlIGlzIGRlZmVy
cmVkICovCi0Jc2V0X2JpdChDSUZTX0lOT19NT0RJRklFRF9BVFRSLCAmQ0lGU19JKGlub2RlKS0+
ZmxhZ3MpOwotCXJldHVybiByYzsKLX0KLQotLyoKLSAqIHdyaXRlIGEgcmVnaW9uIG9mIHBhZ2Vz
IGJhY2sgdG8gdGhlIHNlcnZlcgotICovCi1zdGF0aWMgaW50IGNpZnNfd3JpdGVwYWdlc19yZWdp
b24oc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcsCi0JCQkJICBzdHJ1Y3Qgd3JpdGViYWNr
X2NvbnRyb2wgKndiYywKLQkJCQkgIGxvZmZfdCBzdGFydCwgbG9mZl90IGVuZCwgbG9mZl90ICpf
bmV4dCkKLXsKLQlzdHJ1Y3QgZm9saW9fYmF0Y2ggZmJhdGNoOwotCWludCBza2lwcyA9IDA7Ci0K
LQlmb2xpb19iYXRjaF9pbml0KCZmYmF0Y2gpOwotCWRvIHsKLQkJaW50IG5yOwotCQlwZ29mZl90
IGluZGV4ID0gc3RhcnQgLyBQQUdFX1NJWkU7Ci0KLQkJbnIgPSBmaWxlbWFwX2dldF9mb2xpb3Nf
dGFnKG1hcHBpbmcsICZpbmRleCwgZW5kIC8gUEFHRV9TSVpFLAotCQkJCQkgICAgUEFHRUNBQ0hF
X1RBR19ESVJUWSwgJmZiYXRjaCk7Ci0JCWlmICghbnIpCi0JCQlicmVhazsKLQotCQlmb3IgKGlu
dCBpID0gMDsgaSA8IG5yOyBpKyspIHsKLQkJCXNzaXplX3QgcmV0OwotCQkJc3RydWN0IGZvbGlv
ICpmb2xpbyA9IGZiYXRjaC5mb2xpb3NbaV07Ci0KLXJlZG9fZm9saW86Ci0JCQlzdGFydCA9IGZv
bGlvX3Bvcyhmb2xpbyk7IC8qIE1heSByZWdyZXNzIHdpdGggVEhQcyAqLwotCi0JCQkvKiBBdCB0
aGlzIHBvaW50IHdlIGhvbGQgbmVpdGhlciB0aGUgaV9wYWdlcyBsb2NrIG5vciB0aGUKLQkJCSAq
IHBhZ2UgbG9jazogdGhlIHBhZ2UgbWF5IGJlIHRydW5jYXRlZCBvciBpbnZhbGlkYXRlZAotCQkJ
ICogKGNoYW5naW5nIHBhZ2UtPm1hcHBpbmcgdG8gTlVMTCksIG9yIGV2ZW4gc3dpenpsZWQKLQkJ
CSAqIGJhY2sgZnJvbSBzd2FwcGVyX3NwYWNlIHRvIHRtcGZzIGZpbGUgbWFwcGluZwotCQkJICov
Ci0JCQlpZiAod2JjLT5zeW5jX21vZGUgIT0gV0JfU1lOQ19OT05FKSB7Ci0JCQkJcmV0ID0gZm9s
aW9fbG9ja19raWxsYWJsZShmb2xpbyk7Ci0JCQkJaWYgKHJldCA8IDApCi0JCQkJCWdvdG8gd3Jp
dGVfZXJyb3I7Ci0JCQl9IGVsc2UgewotCQkJCWlmICghZm9saW9fdHJ5bG9jayhmb2xpbykpCi0J
CQkJCWdvdG8gc2tpcF93cml0ZTsKLQkJCX0KLQotCQkJaWYgKGZvbGlvX21hcHBpbmcoZm9saW8p
ICE9IG1hcHBpbmcgfHwKLQkJCSAgICAhZm9saW9fdGVzdF9kaXJ0eShmb2xpbykpIHsKLQkJCQlz
dGFydCArPSBmb2xpb19zaXplKGZvbGlvKTsKLQkJCQlmb2xpb191bmxvY2soZm9saW8pOwotCQkJ
CWNvbnRpbnVlOwotCQkJfQotCi0JCQlpZiAoZm9saW9fdGVzdF93cml0ZWJhY2soZm9saW8pIHx8
Ci0JCQkgICAgZm9saW9fdGVzdF9mc2NhY2hlKGZvbGlvKSkgewotCQkJCWZvbGlvX3VubG9jayhm
b2xpbyk7Ci0JCQkJaWYgKHdiYy0+c3luY19tb2RlID09IFdCX1NZTkNfTk9ORSkKLQkJCQkJZ290
byBza2lwX3dyaXRlOwotCi0JCQkJZm9saW9fd2FpdF93cml0ZWJhY2soZm9saW8pOwotI2lmZGVm
IENPTkZJR19DSUZTX0ZTQ0FDSEUKLQkJCQlmb2xpb193YWl0X2ZzY2FjaGUoZm9saW8pOwotI2Vu
ZGlmCi0JCQkJZ290byByZWRvX2ZvbGlvOwotCQkJfQotCi0JCQlpZiAoIWZvbGlvX2NsZWFyX2Rp
cnR5X2Zvcl9pbyhmb2xpbykpCi0JCQkJLyogV2UgaG9sZCB0aGUgcGFnZSBsb2NrIC0gaXQgc2hv
dWxkJ3ZlIGJlZW4gZGlydHkuICovCi0JCQkJV0FSTl9PTigxKTsKLQotCQkJcmV0ID0gY2lmc193
cml0ZV9iYWNrX2Zyb21fbG9ja2VkX2ZvbGlvKG1hcHBpbmcsIHdiYywgZm9saW8sIHN0YXJ0LCBl
bmQpOwotCQkJaWYgKHJldCA8IDApCi0JCQkJZ290byB3cml0ZV9lcnJvcjsKLQotCQkJc3RhcnQg
Kz0gcmV0OwotCQkJY29udGludWU7Ci0KLXdyaXRlX2Vycm9yOgotCQkJZm9saW9fYmF0Y2hfcmVs
ZWFzZSgmZmJhdGNoKTsKLQkJCSpfbmV4dCA9IHN0YXJ0OwotCQkJcmV0dXJuIHJldDsKLQotc2tp
cF93cml0ZToKLQkJCS8qCi0JCQkgKiBUb28gbWFueSBza2lwcGVkIHdyaXRlcywgb3IgbmVlZCB0
byByZXNjaGVkdWxlPwotCQkJICogVHJlYXQgaXQgYXMgYSB3cml0ZSBlcnJvciB3aXRob3V0IGFu
IGVycm9yIGNvZGUuCi0JCQkgKi8KLQkJCWlmIChza2lwcyA+PSA1IHx8IG5lZWRfcmVzY2hlZCgp
KSB7Ci0JCQkJcmV0ID0gMDsKLQkJCQlnb3RvIHdyaXRlX2Vycm9yOwotCQkJfQotCi0JCQkvKiBP
dGhlcndpc2UsIGp1c3Qgc2tpcCB0aGF0IGZvbGlvIGFuZCBnbyBvbiB0byB0aGUgbmV4dCAqLwot
CQkJc2tpcHMrKzsKLQkJCXN0YXJ0ICs9IGZvbGlvX3NpemUoZm9saW8pOwotCQkJY29udGludWU7
Ci0JCX0KLQotCQlmb2xpb19iYXRjaF9yZWxlYXNlKCZmYmF0Y2gpOwotCQljb25kX3Jlc2NoZWQo
KTsKLQl9IHdoaWxlICh3YmMtPm5yX3RvX3dyaXRlID4gMCk7Ci0KLQkqX25leHQgPSBzdGFydDsK
LQlyZXR1cm4gMDsKLX0KLQotLyoKLSAqIFdyaXRlIHNvbWUgb2YgdGhlIHBlbmRpbmcgZGF0YSBi
YWNrIHRvIHRoZSBzZXJ2ZXIKLSAqLwotc3RhdGljIGludCBjaWZzX3dyaXRlcGFnZXMoc3RydWN0
IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcsCi0JCQkgICBzdHJ1Y3Qgd3JpdGViYWNrX2NvbnRyb2wg
KndiYykKLXsKLQlsb2ZmX3Qgc3RhcnQsIG5leHQ7Ci0JaW50IHJldDsKLQotCS8qIFdlIGhhdmUg
dG8gYmUgY2FyZWZ1bCBhcyB3ZSBjYW4gZW5kIHVwIHJhY2luZyB3aXRoIHNldGF0dHIoKQotCSAq
IHRydW5jYXRpbmcgdGhlIHBhZ2VjYWNoZSBzaW5jZSB0aGUgY2FsbGVyIGRvZXNuJ3QgdGFrZSBh
IGxvY2sgaGVyZQotCSAqIHRvIHByZXZlbnQgaXQuCi0JICovCi0KLQlpZiAod2JjLT5yYW5nZV9j
eWNsaWMpIHsKLQkJc3RhcnQgPSBtYXBwaW5nLT53cml0ZWJhY2tfaW5kZXggKiBQQUdFX1NJWkU7
Ci0JCXJldCA9IGNpZnNfd3JpdGVwYWdlc19yZWdpb24obWFwcGluZywgd2JjLCBzdGFydCwgTExP
TkdfTUFYLCAmbmV4dCk7Ci0JCWlmIChyZXQgPT0gMCkgewotCQkJbWFwcGluZy0+d3JpdGViYWNr
X2luZGV4ID0gbmV4dCAvIFBBR0VfU0laRTsKLQkJCWlmIChzdGFydCA+IDAgJiYgd2JjLT5ucl90
b193cml0ZSA+IDApIHsKLQkJCQlyZXQgPSBjaWZzX3dyaXRlcGFnZXNfcmVnaW9uKG1hcHBpbmcs
IHdiYywgMCwKLQkJCQkJCQkgICAgIHN0YXJ0LCAmbmV4dCk7Ci0JCQkJaWYgKHJldCA9PSAwKQot
CQkJCQltYXBwaW5nLT53cml0ZWJhY2tfaW5kZXggPQotCQkJCQkJbmV4dCAvIFBBR0VfU0laRTsK
LQkJCX0KLQkJfQotCX0gZWxzZSBpZiAod2JjLT5yYW5nZV9zdGFydCA9PSAwICYmIHdiYy0+cmFu
Z2VfZW5kID09IExMT05HX01BWCkgewotCQlyZXQgPSBjaWZzX3dyaXRlcGFnZXNfcmVnaW9uKG1h
cHBpbmcsIHdiYywgMCwgTExPTkdfTUFYLCAmbmV4dCk7Ci0JCWlmICh3YmMtPm5yX3RvX3dyaXRl
ID4gMCAmJiByZXQgPT0gMCkKLQkJCW1hcHBpbmctPndyaXRlYmFja19pbmRleCA9IG5leHQgLyBQ
QUdFX1NJWkU7Ci0JfSBlbHNlIHsKLQkJcmV0ID0gY2lmc193cml0ZXBhZ2VzX3JlZ2lvbihtYXBw
aW5nLCB3YmMsCi0JCQkJCSAgICAgd2JjLT5yYW5nZV9zdGFydCwgd2JjLT5yYW5nZV9lbmQsICZu
ZXh0KTsKLQl9Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgaW50Ci1jaWZzX3dyaXRlcGFn
ZV9sb2NrZWQoc3RydWN0IHBhZ2UgKnBhZ2UsIHN0cnVjdCB3cml0ZWJhY2tfY29udHJvbCAqd2Jj
KQotewotCWludCByYzsKLQl1bnNpZ25lZCBpbnQgeGlkOwotCi0JeGlkID0gZ2V0X3hpZCgpOwot
LyogQkIgYWRkIGNoZWNrIGZvciB3YmMgZmxhZ3MgKi8KLQlnZXRfcGFnZShwYWdlKTsKLQlpZiAo
IVBhZ2VVcHRvZGF0ZShwYWdlKSkKLQkJY2lmc19kYmcoRllJLCAicHB3IC0gcGFnZSBub3QgdXAg
dG8gZGF0ZVxuIik7Ci0KLQkvKgotCSAqIFNldCB0aGUgIndyaXRlYmFjayIgZmxhZywgYW5kIGNs
ZWFyICJkaXJ0eSIgaW4gdGhlIHJhZGl4IHRyZWUuCi0JICoKLQkgKiBBIHdyaXRlcGFnZSgpIGlt
cGxlbWVudGF0aW9uIGFsd2F5cyBuZWVkcyB0byBkbyBlaXRoZXIgdGhpcywKLQkgKiBvciByZS1k
aXJ0eSB0aGUgcGFnZSB3aXRoICJyZWRpcnR5X3BhZ2VfZm9yX3dyaXRlcGFnZSgpIiBpbgotCSAq
IHRoZSBjYXNlIG9mIGEgZmFpbHVyZS4KLQkgKgotCSAqIEp1c3QgdW5sb2NraW5nIHRoZSBwYWdl
IHdpbGwgY2F1c2UgdGhlIHJhZGl4IHRyZWUgdGFnLWJpdHMKLQkgKiB0byBmYWlsIHRvIHVwZGF0
ZSB3aXRoIHRoZSBzdGF0ZSBvZiB0aGUgcGFnZSBjb3JyZWN0bHkuCi0JICovCi0Jc2V0X3BhZ2Vf
d3JpdGViYWNrKHBhZ2UpOwotcmV0cnlfd3JpdGU6Ci0JcmMgPSBjaWZzX3BhcnRpYWxwYWdld3Jp
dGUocGFnZSwgMCwgUEFHRV9TSVpFKTsKLQlpZiAoaXNfcmV0cnlhYmxlX2Vycm9yKHJjKSkgewot
CQlpZiAod2JjLT5zeW5jX21vZGUgPT0gV0JfU1lOQ19BTEwgJiYgcmMgPT0gLUVBR0FJTikKLQkJ
CWdvdG8gcmV0cnlfd3JpdGU7Ci0JCXJlZGlydHlfcGFnZV9mb3Jfd3JpdGVwYWdlKHdiYywgcGFn
ZSk7Ci0JfSBlbHNlIGlmIChyYyAhPSAwKSB7Ci0JCVNldFBhZ2VFcnJvcihwYWdlKTsKLQkJbWFw
cGluZ19zZXRfZXJyb3IocGFnZS0+bWFwcGluZywgcmMpOwotCX0gZWxzZSB7Ci0JCVNldFBhZ2VV
cHRvZGF0ZShwYWdlKTsKLQl9Ci0JZW5kX3BhZ2Vfd3JpdGViYWNrKHBhZ2UpOwotCXB1dF9wYWdl
KHBhZ2UpOwotCWZyZWVfeGlkKHhpZCk7Ci0JcmV0dXJuIHJjOwotfQotCi1zdGF0aWMgaW50IGNp
ZnNfd3JpdGVfZW5kKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFw
cGluZywKLQkJCWxvZmZfdCBwb3MsIHVuc2lnbmVkIGxlbiwgdW5zaWduZWQgY29waWVkLAotCQkJ
c3RydWN0IHBhZ2UgKnBhZ2UsIHZvaWQgKmZzZGF0YSkKLXsKLQlpbnQgcmM7Ci0Jc3RydWN0IGlu
b2RlICppbm9kZSA9IG1hcHBpbmctPmhvc3Q7Ci0Jc3RydWN0IGNpZnNGaWxlSW5mbyAqY2ZpbGUg
PSBmaWxlLT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGNpZnNfc2JfaW5mbyAqY2lmc19zYiA9IENJ
RlNfU0IoY2ZpbGUtPmRlbnRyeS0+ZF9zYik7Ci0Jc3RydWN0IGZvbGlvICpmb2xpbyA9IHBhZ2Vf
Zm9saW8ocGFnZSk7Ci0JX191MzIgcGlkOwotCi0JaWYgKGNpZnNfc2ItPm1udF9jaWZzX2ZsYWdz
ICYgQ0lGU19NT1VOVF9SV1BJREZPUldBUkQpCi0JCXBpZCA9IGNmaWxlLT5waWQ7Ci0JZWxzZQot
CQlwaWQgPSBjdXJyZW50LT50Z2lkOwotCi0JY2lmc19kYmcoRllJLCAid3JpdGVfZW5kIGZvciBw
YWdlICVwIGZyb20gcG9zICVsbGQgd2l0aCAlZCBieXRlc1xuIiwKLQkJIHBhZ2UsIHBvcywgY29w
aWVkKTsKLQotCWlmIChmb2xpb190ZXN0X2NoZWNrZWQoZm9saW8pKSB7Ci0JCWlmIChjb3BpZWQg
PT0gbGVuKQotCQkJZm9saW9fbWFya191cHRvZGF0ZShmb2xpbyk7Ci0JCWZvbGlvX2NsZWFyX2No
ZWNrZWQoZm9saW8pOwotCX0gZWxzZSBpZiAoIWZvbGlvX3Rlc3RfdXB0b2RhdGUoZm9saW8pICYm
IGNvcGllZCA9PSBQQUdFX1NJWkUpCi0JCWZvbGlvX21hcmtfdXB0b2RhdGUoZm9saW8pOwotCi0J
aWYgKCFmb2xpb190ZXN0X3VwdG9kYXRlKGZvbGlvKSkgewotCQljaGFyICpwYWdlX2RhdGE7Ci0J
CXVuc2lnbmVkIG9mZnNldCA9IHBvcyAmIChQQUdFX1NJWkUgLSAxKTsKLQkJdW5zaWduZWQgaW50
IHhpZDsKLQotCQl4aWQgPSBnZXRfeGlkKCk7Ci0JCS8qIHRoaXMgaXMgcHJvYmFibHkgYmV0dGVy
IHRoYW4gZGlyZWN0bHkgY2FsbGluZwotCQkgICBwYXJ0aWFscGFnZV93cml0ZSBzaW5jZSBpbiB0
aGlzIGZ1bmN0aW9uIHRoZSBmaWxlIGhhbmRsZSBpcwotCQkgICBrbm93biB3aGljaCB3ZSBtaWdo
dCBhcyB3ZWxsCWxldmVyYWdlICovCi0JCS8qIEJCIGNoZWNrIGlmIGFueXRoaW5nIGVsc2UgbWlz
c2luZyBvdXQgb2YgcHB3Ci0JCSAgIHN1Y2ggYXMgdXBkYXRpbmcgbGFzdCB3cml0ZSB0aW1lICov
Ci0JCXBhZ2VfZGF0YSA9IGttYXAocGFnZSk7Ci0JCXJjID0gY2lmc193cml0ZShjZmlsZSwgcGlk
LCBwYWdlX2RhdGEgKyBvZmZzZXQsIGNvcGllZCwgJnBvcyk7Ci0JCS8qIGlmIChyYyA8IDApIHNo
b3VsZCB3ZSBzZXQgd3JpdGViZWhpbmQgcmM/ICovCi0JCWt1bm1hcChwYWdlKTsKLQotCQlmcmVl
X3hpZCh4aWQpOwotCX0gZWxzZSB7Ci0JCXJjID0gY29waWVkOwotCQlwb3MgKz0gY29waWVkOwot
CQlzZXRfcGFnZV9kaXJ0eShwYWdlKTsKLQl9Ci0KLQlpZiAocmMgPiAwKSB7Ci0JCXNwaW5fbG9j
aygmaW5vZGUtPmlfbG9jayk7Ci0JCWlmIChwb3MgPiBpbm9kZS0+aV9zaXplKSB7Ci0JCQlpX3Np
emVfd3JpdGUoaW5vZGUsIHBvcyk7Ci0JCQlpbm9kZS0+aV9ibG9ja3MgPSAoNTEyIC0gMSArIHBv
cykgPj4gOTsKLQkJfQotCQlzcGluX3VubG9jaygmaW5vZGUtPmlfbG9jayk7Ci0JfQotCi0JdW5s
b2NrX3BhZ2UocGFnZSk7Ci0JcHV0X3BhZ2UocGFnZSk7Ci0JLyogSW5kaWNhdGlvbiB0byB1cGRh
dGUgY3RpbWUgYW5kIG10aW1lIGFzIGNsb3NlIGlzIGRlZmVycmVkICovCi0Jc2V0X2JpdChDSUZT
X0lOT19NT0RJRklFRF9BVFRSLCAmQ0lGU19JKGlub2RlKS0+ZmxhZ3MpOwotCi0JcmV0dXJuIHJj
OwotfQotI2VuZGlmIC8vIEVuZCBuZXRmcyByZW1vdmFsIDI3NzMKLQogLyoKICAqIEZsdXNoIGRh
dGEgb24gYSBzdHJpY3QgZmlsZS4KICAqLwpAQCAtNDU3MCw2ICszODc3LDcgQEAgY2lmc19yZWFk
KHN0cnVjdCBmaWxlICpmaWxlLCBjaGFyICpyZWFkX2RhdGEsIHNpemVfdCByZWFkX3NpemUsIGxv
ZmZfdCAqb2Zmc2V0KQogfQogI2VuZGlmIC8vIGVuZCBuZXRmc2xpYiByZW1vdmUgNDYzMwogCisK
IHN0YXRpYyB2bV9mYXVsdF90IGNpZnNfcGFnZV9ta3dyaXRlKHN0cnVjdCB2bV9mYXVsdCAqdm1m
KQogewogCXJldHVybiBuZXRmc19wYWdlX21rd3JpdGUodm1mLCBOVUxMKTsKLS0gCjIuNDAuMQoK
--000000000000c5796c060f8fd206--

